(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(t,e,n){t.exports=n("zUnb")},crnd:function(t,e){function n(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="crnd"},qe5e:function(t,e,n){"use strict";var r,o;function i(t,e){if(!t)throw"First parameter is required.";e=new a(t,e=e||{type:"video"});var n=this;function r(n){n&&(e.initCallback=function(){n(),n=e.initCallback=null});var r=new s(t,e);(p=new r(t,e)).record(),h("recording"),e.disableLogs||console.log("Initialized recorderType:",p.constructor.name,"for output-type:",e.type)}function o(t){if(t=t||function(){},p){if("paused"===n.state)return n.resumeRecording(),void setTimeout(function(){o(t)},1);"recording"===n.state||e.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',n.state),e.disableLogs||console.log("Stopped recording "+e.type+" stream."),"gif"!==e.type?p.stop(r):(p.stop(),r()),h("stopped")}else v();function r(r){if(p){Object.keys(p).forEach(function(t){"function"!=typeof p[t]&&(n[t]=p[t])});var o=p.blob;if(!o){if(!r)throw"Recording failed.";p.blob=o=r}if(o&&!e.disableLogs&&console.log(o.type,"->",b(o.size)),t){var i;try{i=f.createObjectURL(o)}catch(a){}"function"==typeof t.call?t.call(n,i):t(i)}e.autoWriteToDisk&&c(function(t){var n={};n[e.type+"Blob"]=t,N.Store(n)})}else"function"==typeof t.call?t.call(n,""):t("")}}function u(t){postMessage((new FileReaderSync).readAsDataURL(t))}function c(t,n){if(!t)throw"Pass a callback function over getDataURL.";var r=n?n.blob:(p||{}).blob;if(!r)return e.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){c(t,n)},1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var o=new FileReader;o.readAsDataURL(r),o.onload=function(e){t(e.target.result)}}else{var i=function(t){try{var e=f.createObjectURL(new Blob([t.toString(),"this.onmessage =  function (eee) {"+t.name+"(eee.data);}"],{type:"application/javascript"})),n=new Worker(e);return f.revokeObjectURL(e),n}catch(r){}}(u);i.onmessage=function(e){t(e.data)},i.postMessage(r)}}function l(t){t=t||0,"paused"!==n.state?"stopped"!==n.state&&(t>=n.recordingDuration?o(n.onRecordingStopped):(t+=1e3,setTimeout(function(){l(t)},1e3))):setTimeout(function(){l(t)},1e3)}function h(t){n&&(n.state=t,"function"==typeof n.onStateChanged.call?n.onStateChanged.call(n,t):n.onStateChanged(t))}var p,d='It seems that recorder is destroyed or "startRecording" is not invoked for '+e.type+" recorder.";function v(){!0!==e.disableLogs&&console.warn(d)}var m={startRecording:function(o){return o&&(e=new a(t,o)),e.disableLogs||console.log("started recording "+e.type+" stream."),p?(p.clearRecordedData(),p.record(),h("recording"),n.recordingDuration&&l(),n):(r(function(){n.recordingDuration&&l()}),n)},stopRecording:o,pauseRecording:function(){p?"recording"===n.state?(h("paused"),p.pause(),e.disableLogs||console.log("Paused recording.")):e.disableLogs||console.warn("Unable to pause the recording. Recording state: ",n.state):v()},resumeRecording:function(){p?"paused"===n.state?(h("recording"),p.resume(),e.disableLogs||console.log("Resumed recording.")):e.disableLogs||console.warn("Unable to resume the recording. Recording state: ",n.state):v()},initRecorder:r,setRecordingDuration:function(t,e){if(void 0===t)throw"recordingDuration is required.";if("number"!=typeof t)throw"recordingDuration must be a number.";return n.recordingDuration=t,n.onRecordingStopped=e||function(){},{onRecordingStopped:function(t){n.onRecordingStopped=t}}},clearRecordedData:function(){p?(p.clearRecordedData(),e.disableLogs||console.log("Cleared old recorded data.")):v()},getBlob:function(){if(p)return p.blob;v()},getDataURL:c,toURL:function(){if(p)return f.createObjectURL(p.blob);v()},getInternalRecorder:function(){return p},save:function(t){p?function(t,e){if(!t)throw"Blob object is required.";if(!t.type)try{t.type="video/webm"}catch(a){}var n=(t.type||"video/webm").split("/")[1];if(e&&-1!==e.indexOf(".")){var r=e.split(".");e=r[0],n=r[1]}var o=(e||Math.round(9999999999*Math.random())+888888888)+"."+n;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(t,o);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(t,o);var i=document.createElement("a");i.href=f.createObjectURL(t),i.download=o,i.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(i),"function"==typeof i.click?i.click():(i.target="_blank",i.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),f.revokeObjectURL(i.href)}(p.blob,t):v()},getFromDisk:function(t){p?i.getFromDisk(e.type,t):v()},setAdvertisementArray:function(t){e.advertisement=[];for(var n=t.length,r=0;r<n;r++)e.advertisement.push({duration:r,image:t[r]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){p&&"function"==typeof p.clearRecordedData&&p.clearRecordedData(),p=null,h("inactive"),n.blob=null},onStateChanged:function(t){e.disableLogs||console.log("Recorder state changed:",t)},state:"inactive",getState:function(){return n.state},destroy:function(){var t=e.disableLogs;e={disableLogs:!0},n.reset(),h("destroyed"),m=n=null,C.AudioContextConstructor&&(C.AudioContextConstructor.close(),C.AudioContextConstructor=null),e.disableLogs=t,e.disableLogs||console.warn("RecordRTC is destroyed.")},version:"5.5.4"};if(!this)return n=m,m;for(var g in m)this[g]=m[g];return n=this,m}function a(t,e){return e.recorderType||e.type||(e.audio&&e.video?e.type="video":e.audio&&!e.video&&(e.type="audio")),e.recorderType&&!e.type&&(e.recorderType===k||e.recorderType===T||e.recorderType===P?e.type="video":e.recorderType===A?e.type="gif":e.recorderType===R?e.type="audio":e.recorderType===S&&(x(t,"audio").length&&x(t,"video").length?e.type="video":!x(t,"audio").length&&x(t,"video").length?e.type="video":x(t,"audio").length&&!x(t,"video").length&&(e.type="audio"))),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(e.mimeType||(e.mimeType="video/webm"),e.type||(e.type=e.mimeType.split("/")[0])),e.type||(e.mimeType&&(e.type=e.mimeType.split("/")[0]),e.type||(e.type="audio")),e}function s(t,e){var n;return(g||d||v)&&(n=R),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!g&&(n=S),"video"===e.type&&(g||v)&&(n=k,"undefined"!=typeof ReadableStream&&(n=P)),"gif"===e.type&&(n=A),"canvas"===e.type&&(n=T),E()&&n!==T&&n!==A&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(x(t,"video").length||x(t,"audio").length)&&("audio"===e.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(n=S):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(n=S)),t instanceof Array&&t.length&&(n=M),e.recorderType&&(n=e.recorderType),!e.disableLogs&&n&&n.name&&console.log("Using recorderType:",n.name||n.constructor.name),!n&&y&&(n=S),n}function u(t){this.addStream=function(e){e&&(t=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e,n=this.mediaType,r=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof n.audio&&E()&&!x(t,"audio").length&&(n.audio=!1),"function"!=typeof n.video&&E()&&!x(t,"video").length&&(n.video=!1),"function"!=typeof n.gif&&E()&&!x(t,"video").length&&(n.gif=!1),!n.audio&&!n.video&&!n.gif)throw"MediaStream must have either audio or video tracks.";if(n.audio&&(e=null,"function"==typeof n.audio&&(e=n.audio),this.audioRecorder=new i(t,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:e,mimeType:r.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),n.video||this.audioRecorder.startRecording()),n.video){e=null,"function"==typeof n.video&&(e=n.video);var o=t;if(E()&&n.audio&&"function"==typeof n.audio){var a=x(t,"video")[0];m?((o=new w).addTrack(a),e&&e===k&&(e=S)):(o=new w).addTrack(a)}this.videoRecorder=new i(o,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:e,mimeType:r.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),n.audio||this.videoRecorder.startRecording()}if(n.audio&&n.video){var s=this,u=!0===E();n.audio instanceof R&&n.video?u=!1:!0!==n.audio&&!0!==n.video&&n.audio!==n.video&&(u=!1),!0===u?(s.audioRecorder=null,s.videoRecorder.startRecording()):s.videoRecorder.initRecorder(function(){s.audioRecorder.initRecorder(function(){s.videoRecorder.startRecording(),s.audioRecorder.startRecording()})})}n.gif&&(e=null,"function"==typeof n.gif&&(e=n.gif),this.gifRecorder=new i(t,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:e,mimeType:r.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(t){t=t||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(e){t(e,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(e){t(e,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(e){t(e,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(t){var e={};return this.audioRecorder&&(e.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(e.video=this.videoRecorder.getBlob()),this.gifRecorder&&(e.gif=this.gifRecorder.getBlob()),t&&t(e),e},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(t){function e(t,e){if("undefined"!=typeof Worker){var n=function(t){var e,n=f.createObjectURL(new Blob([t.toString(),"this.onmessage =  function (eee) {"+t.name+"(eee.data);}"],{type:"application/javascript"})),r=new Worker(n);if(void 0!==f)e=f;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";e=webkitURL}return e.revokeObjectURL(n),r}(function(t){postMessage((new FileReaderSync).readAsDataURL(t))});n.onmessage=function(t){e(t.data)},n.postMessage(t)}else{var r=new FileReader;r.readAsDataURL(t),r.onload=function(t){e(t.target.result)}}}this.getBlob(function(n){n.audio&&n.video?e(n.audio,function(r){e(n.video,function(e){t({audio:r,video:e})})}):n.audio?e(n.audio,function(e){t({audio:e})}):n.video&&e(n.video,function(e){t({video:e})})})},this.writeToDisk=function(){i.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(t){(t=t||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof t.audio?t.audio:""),t.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof t.video?t.video:""),t.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof t.gif?t.gif:"")}}i.version="5.5.4",t.exports=i,void 0===(r=(function(){return i}).apply(e,[]))||(t.exports=r),i.getFromDisk=function(t,e){if(!e)throw"callback is mandatory.";console.log("Getting recorded "+("all"===t?"blobs":t+" blob ")+" from disk!"),N.Fetch(function(n,r){"all"!==t&&r===t+"Blob"&&e&&e(n),"all"===t&&e&&e(n,r.replace("Blob",""))})},i.writeToDisk=function(t){console.log("Writing recorded blob(s) to disk!"),(t=t||{}).audio&&t.video&&t.gif?t.audio.getDataURL(function(e){t.video.getDataURL(function(n){t.gif.getDataURL(function(t){N.Store({audioBlob:e,videoBlob:n,gifBlob:t})})})}):t.audio&&t.video?t.audio.getDataURL(function(e){t.video.getDataURL(function(t){N.Store({audioBlob:e,videoBlob:t})})}):t.audio&&t.gif?t.audio.getDataURL(function(e){t.gif.getDataURL(function(t){N.Store({audioBlob:e,gifBlob:t})})}):t.video&&t.gif?t.video.getDataURL(function(e){t.gif.getDataURL(function(t){N.Store({videoBlob:e,gifBlob:t})})}):t.audio?t.audio.getDataURL(function(t){N.Store({audioBlob:t})}):t.video?t.video.getDataURL(function(t){N.Store({videoBlob:t})}):t.gif&&t.gif.getDataURL(function(t){N.Store({gifBlob:t})})},u.getFromDisk=i.getFromDisk,u.writeToDisk=i.writeToDisk,i.MRecordRTC=u,(o="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0!==global.console.log&&void 0!==global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(o.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var t={getContext:function(){return t},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return t},o.HTMLVideoElement=function(){}),"undefined"==typeof location&&(o.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(o.screen={width:0,height:0}),void 0===f&&(o.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),o.window=global);var c=window.requestAnimationFrame;if(void 0===c)if("undefined"!=typeof webkitRequestAnimationFrame)c=webkitRequestAnimationFrame;else if("undefined"!=typeof mozRequestAnimationFrame)c=mozRequestAnimationFrame;else if("undefined"!=typeof msRequestAnimationFrame)c=msRequestAnimationFrame;else if(void 0===c){var l=0;c=function(t,e){var n=(new Date).getTime(),r=Math.max(0,16-(n-l)),o=setTimeout(function(){t(n+r)},r);return l=n+r,o}}var h=window.cancelAnimationFrame;void 0===h&&("undefined"!=typeof webkitCancelAnimationFrame?h=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?h=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?h=msCancelAnimationFrame:void 0===h&&(h=function(t){clearTimeout(t)}));var p=window.AudioContext;void 0===p&&("undefined"!=typeof webkitAudioContext&&(p=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(p=mozAudioContext));var f=window.URL;void 0===f&&"undefined"!=typeof webkitURL&&(f=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var d=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),v=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),m=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),g=!v&&!d&&!!navigator.webkitGetUserMedia||"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),y=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);y&&!g&&-1!==navigator.userAgent.indexOf("CriOS")&&(y=!1,g=!0);var w=window.MediaStream;function b(t){if(0===t)return"0 Bytes";var e=parseInt(Math.floor(Math.log(t)/Math.log(1e3)),10);return(t/Math.pow(1e3,e)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][e]}function x(t,e){return t&&t.getTracks?t.getTracks().filter(function(t){return t.kind===(e||"audio")}):[]}function _(t,e){"srcObject"in e?e.srcObject=t:"mozSrcObject"in e?e.mozSrcObject=t:e.srcObject=t}void 0===w&&"undefined"!=typeof webkitMediaStream&&(w=webkitMediaStream),void 0!==w&&void 0===w.prototype.stop&&(w.prototype.stop=function(){this.getTracks().forEach(function(t){t.stop()})});var C={};function E(){if(m||y||d)return!0;navigator;var t,e,n=navigator.userAgent,r=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10);return(g||v)&&(t=n.indexOf("Chrome"),r=n.substring(t+7)),-1!==(e=r.indexOf(";"))&&(r=r.substring(0,e)),-1!==(e=r.indexOf(" "))&&(r=r.substring(0,e)),o=parseInt(""+r,10),isNaN(o)&&(r=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10)),o>=49}function S(t,e){var n,r=this;if(void 0===t)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not supports Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";"audio"===(e=e||{mimeType:"video/webm"}).type&&(x(t,"video").length&&x(t,"audio").length&&(navigator.mozGetUserMedia?(n=new w).addTrack(x(t,"audio")[0]):n=new w(x(t,"audio")),t=n),e.mimeType&&-1!==e.mimeType.toString().toLowerCase().indexOf("audio")||(e.mimeType=g?"audio/webm":"audio/ogg"),e.mimeType&&"audio/ogg"!==e.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(e.mimeType="audio/ogg"));var o,i=[];function a(){r.timestamps.push((new Date).getTime()),"function"==typeof e.onTimeStamp&&e.onTimeStamp(r.timestamps[r.timestamps.length-1],r.timestamps)}function s(t){return o&&o.mimeType?o.mimeType:t.mimeType||"video/webm"}function u(){i=[],o=null,r.timestamps=[]}this.getArrayOfBlobs=function(){return i},this.record=function(){r.blob=null,r.clearRecordedData(),r.timestamps=[],c=[],i=[];var n=e;e.disableLogs||console.log("Passing following config over MediaRecorder API.",n),o&&(o=null),g&&!E()&&(n="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&n.mimeType&&(MediaRecorder.isTypeSupported(n.mimeType)||(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",n.mimeType),n.mimeType="audio"===e.type?"audio/webm":"video/webm"));try{o=new MediaRecorder(t,n),e.mimeType=n.mimeType}catch(u){o=new MediaRecorder(t)}n.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in o&&!1===o.canRecordMimeType(n.mimeType)&&(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",n.mimeType)),o.ondataavailable=function(t){if(t.data&&c.push("ondataavailable: "+b(t.data.size)),"number"!=typeof e.timeSlice)!t.data||!t.data.size||t.data.size<100||r.blob?r.recordingCallback&&(r.recordingCallback(new Blob([],{type:s(n)})),r.recordingCallback=null):(r.blob=e.getNativeBlob?t.data:new Blob([t.data],{type:s(n)}),r.recordingCallback&&(r.recordingCallback(r.blob),r.recordingCallback=null));else if(t.data&&t.data.size&&t.data.size>100&&(i.push(t.data),a(),"function"==typeof e.ondataavailable)){var o=e.getNativeBlob?t.data:new Blob([t.data],{type:s(n)});e.ondataavailable(o)}},o.onstart=function(){c.push("started")},o.onpause=function(){c.push("paused")},o.onresume=function(){c.push("resumed")},o.onstop=function(){c.push("stopped")},o.onerror=function(t){t&&(t.name||(t.name="UnknownError"),c.push("error: "+t),e.disableLogs||(-1!==t.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",t):-1!==t.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",n.mimeType,") is not supported.",t):-1!==t.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",t):"OutOfMemory"===t.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",t):"IllegalStreamModification"===t.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",t):"OtherRecordingError"===t.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",t):"GenericError"===t.name?console.error("The UA cannot provide the codec or recording option that has been requested.",t):console.error("MediaRecorder Error",t)),function(t){if(!r.manuallyStopped&&o&&"inactive"===o.state)return delete e.timeslice,void o.start(6e5);setTimeout(void 0,1e3)}(),"inactive"!==o.state&&"stopped"!==o.state&&o.stop())},"number"==typeof e.timeSlice?(a(),o.start(e.timeSlice)):o.start(36e5),e.initCallback&&e.initCallback()},this.timestamps=[],this.stop=function(t){t=t||function(){},r.manuallyStopped=!0,o&&(this.recordingCallback=t,"recording"===o.state&&o.stop(),"number"==typeof e.timeSlice&&setTimeout(function(){r.blob=new Blob(i,{type:s(e)}),r.recordingCallback(r.blob)},100))},this.pause=function(){o&&"recording"===o.state&&o.pause()},this.resume=function(){o&&"paused"===o.state&&o.resume()},this.clearRecordedData=function(){o&&"recording"===o.state&&r.stop(u),u()},this.getInternalRecorder=function(){return o},this.blob=null,this.getState=function(){return o&&o.state||"inactive"};var c=[];this.getAllStates=function(){return c},void 0===e.checkForInactiveTracks&&(e.checkForInactiveTracks=!1),r=this,function n(){if(o&&!1!==e.checkForInactiveTracks)return!1===function(){if("active"in t){if(!t.active)return!1}else if("ended"in t&&t.ended)return!1;return!0}()?(e.disableLogs||console.log("MediaStream seems stopped."),void r.stop()):void setTimeout(n,1e3)}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function R(t,e){if(!x(t,"audio").length)throw"Your stream has no audio tracks.";var n,r=this,o=[],i=[],a=!1,s=0,u=2,c=(e=e||{}).desiredSampRate;function l(){if(!1===e.checkForInactiveTracks)return!0;if("active"in t){if(!t.active)return!1}else if("ended"in t&&t.ended)return!1;return!0}function h(t,e){function n(t,e){var n,r=t.numberOfAudioChannels,o=t.leftBuffers.slice(0),i=t.rightBuffers.slice(0),a=t.sampleRate,s=t.internalInterleavedLength,u=t.desiredSampRate;function c(t,e,n){var r=Math.round(t.length*(e/n)),o=[],i=Number((t.length-1)/(r-1));o[0]=t[0];for(var a=1;a<r-1;a++){var s=a*i,u=Number(Math.floor(s)).toFixed(),c=Number(Math.ceil(s)).toFixed();o[a]=l(t[u],t[c],s-u)}return o[r-1]=t[t.length-1],o}function l(t,e,n){return t+(e-t)*n}function h(t,e){for(var n=new Float64Array(e),r=0,o=t.length,i=0;i<o;i++){var a=t[i];n.set(a,r),r+=a.length}return n}function p(t,e,n){for(var r=n.length,o=0;o<r;o++)t.setUint8(e+o,n.charCodeAt(o))}2===r&&(o=h(o,s),i=h(i,s),u&&(o=c(o,u,a),i=c(i,u,a))),1===r&&(o=h(o,s),u&&(o=c(o,u,a))),u&&(a=u),2===r&&(n=function(t,e){for(var n=t.length+e.length,r=new Float64Array(n),o=0,i=0;i<n;)r[i++]=t[o],r[i++]=e[o],o++;return r}(o,i)),1===r&&(n=o);var f=n.length,d=new ArrayBuffer(44+2*f),v=new DataView(d);p(v,0,"RIFF"),v.setUint32(4,36+2*f,!0),p(v,8,"WAVE"),p(v,12,"fmt "),v.setUint32(16,16,!0),v.setUint16(20,1,!0),v.setUint16(22,r,!0),v.setUint32(24,a,!0),v.setUint32(28,2*a,!0),v.setUint16(32,2*r,!0),v.setUint16(34,16,!0),p(v,36,"data"),v.setUint32(40,2*f,!0);for(var m=f,g=44,y=0;y<m;y++)v.setInt16(g,32767*n[y],!0),g+=2;if(e)return e({buffer:d,view:v});postMessage({buffer:d,view:v})}if(t.noWorker)n(t,function(t){e(t.buffer,t.view)});else{var r,o,i,a=(r=n,o=f.createObjectURL(new Blob([r.toString(),";this.onmessage =  function (eee) {"+r.name+"(eee.data);}"],{type:"application/javascript"})),(i=new Worker(o)).workerURL=o,i);a.onmessage=function(t){e(t.data.buffer,t.data.view),f.revokeObjectURL(a.workerURL),a.terminate()},a.postMessage(t)}}if(!0===e.leftChannel&&(u=1),1===e.numberOfAudioChannels&&(u=1),(!u||u<1)&&(u=2),e.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+u),void 0===e.checkForInactiveTracks&&(e.checkForInactiveTracks=!0),this.record=function(){if(!1===l())throw"Please make sure MediaStream is active.";b(),C=w=!1,a=!0,void 0!==e.timeSlice&&S()},this.stop=function(t){t=t||function(){},a=!1,h({desiredSampRate:c,sampleRate:y,numberOfAudioChannels:u,internalInterleavedLength:s,leftBuffers:o,rightBuffers:1===u?[]:i,noWorker:e.noWorker},function(e,n){r.blob=new Blob([n],{type:"audio/wav"}),r.buffer=new ArrayBuffer(n.buffer.byteLength),r.view=n,r.sampleRate=c||y,r.bufferSize=g,r.length=s,C=!1,t&&t(r.blob)})},void 0===p)var p={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext};p.AudioContextConstructor||(p.AudioContextConstructor=new p.AudioContext);var d=p.AudioContextConstructor,v=d.createMediaStreamSource(t),m=[0,256,512,1024,2048,4096,8192,16384],g=void 0===e.bufferSize?4096:e.bufferSize;if(-1===m.indexOf(g)&&(e.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(m,null,"\t"))),d.createJavaScriptNode)n=d.createJavaScriptNode(g,u,u);else{if(!d.createScriptProcessor)throw"WebAudio API has no support on this browser.";n=d.createScriptProcessor(g,u,u)}v.connect(n),e.bufferSize||(g=n.bufferSize);var y=void 0!==e.sampleRate?e.sampleRate:d.sampleRate||44100;(y<22050||y>96e3)&&(e.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),e.disableLogs||e.desiredSampRate&&console.log("Desired sample-rate: "+e.desiredSampRate);var w=!1;function b(){i=[],s=0,C=!1,a=!1,w=!1,d=null,r.leftchannel=o=[],r.rightchannel=i,r.numberOfAudioChannels=u,r.desiredSampRate=c,r.sampleRate=y,r.recordingLength=s,E={left:[],right:[],recordingLength:0}}function _(){n&&(n.onaudioprocess=null,n.disconnect(),n=null),v&&(v.disconnect(),v=null),b()}this.pause=function(){w=!0},this.resume=function(){if(!1===l())throw"Please make sure MediaStream is active.";if(!a)return e.disableLogs||console.log("Seems recording has been restarted."),void this.record();w=!1},this.clearRecordedData=function(){e.checkForInactiveTracks=!1,a&&this.stop(_),_()},this.name="StereoAudioRecorder",this.toString=function(){return this.name};var C=!1;n.onaudioprocess=function(t){if(!w)if(!1===l()&&(e.disableLogs||console.log("MediaStream seems stopped."),n.disconnect(),a=!1),a){C||(C=!0,e.onAudioProcessStarted&&e.onAudioProcessStarted(),e.initCallback&&e.initCallback());var c=t.inputBuffer.getChannelData(0),h=new Float32Array(c);if(o.push(h),2===u){var p=t.inputBuffer.getChannelData(1),f=new Float32Array(p);i.push(f)}r.recordingLength=s+=g,void 0!==e.timeSlice&&(E.recordingLength+=g,E.left.push(h),2===u&&E.right.push(f))}else v&&(v.disconnect(),v=null)},n.connect(d.createMediaStreamDestination?d.createMediaStreamDestination():d.destination),this.leftchannel=o,this.rightchannel=i,this.numberOfAudioChannels=u,this.desiredSampRate=c,this.sampleRate=y,r.recordingLength=s;var E={left:[],right:[],recordingLength:0};function S(){a&&"function"==typeof e.ondataavailable&&void 0!==e.timeSlice&&(E.left.length?(h({desiredSampRate:c,sampleRate:y,numberOfAudioChannels:u,internalInterleavedLength:E.recordingLength,leftBuffers:E.left,rightBuffers:1===u?[]:E.right},function(t,n){var r=new Blob([n],{type:"audio/wav"});e.ondataavailable(r),setTimeout(S,e.timeSlice)}),E={left:[],right:[],recordingLength:0}):setTimeout(S,e.timeSlice))}}function T(t,e){if("undefined"==typeof html2canvas)throw"Please link: https://cdn.webrtc-experiment.com/screenshot.js";(e=e||{}).frameInterval||(e.frameInterval=10);var n=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(t){t in document.createElement("canvas")&&(n=!0)});var r,o,i,a=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),s=50,u=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(a&&u&&u[2]&&(s=parseInt(u[2],10)),a&&s<52&&(n=!1),e.useWhammyRecorder&&(n=!1),n)if(e.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),t instanceof HTMLCanvasElement)r=t;else{if(!(t instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";r=t.canvas}else navigator.mozGetUserMedia&&(e.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(i=!0,n&&!e.useWhammyRecorder){var t;"captureStream"in r?t=r.captureStream(25):"mozCaptureStream"in r?t=r.mozCaptureStream(25):"webkitCaptureStream"in r&&(t=r.webkitCaptureStream(25));try{var a=new w;a.addTrack(x(t,"video")[0]),t=a}catch(s){}if(!t)throw"captureStream API are NOT available.";(o=new S(t,{mimeType:e.mimeType||"video/webm"})).record()}else f.frames=[],p=(new Date).getTime(),h();e.initCallback&&e.initCallback()},this.getWebPImages=function(n){if("canvas"===t.nodeName.toLowerCase()){var r=f.frames.length;f.frames.forEach(function(t,n){var o=r-n;e.disableLogs||console.log(o+"/"+r+" frames remaining"),e.onEncodingCallback&&e.onEncodingCallback(o,r);var i=t.image.toDataURL("image/webp",1);f.frames[n].image=i}),e.disableLogs||console.log("Generating WebM"),n()}else n()},this.stop=function(t){i=!1;var r=this;n&&o?o.stop(t):this.getWebPImages(function(){f.compile(function(n){e.disableLogs||console.log("Recording finished!"),r.blob=n,r.blob.forEach&&(r.blob=new Blob([],{type:"video/webm"})),t&&t(r.blob),f.frames=[]})})};var c=!1;function l(){f.frames=[],i=!1,c=!1}function h(){if(c)return p=(new Date).getTime(),setTimeout(h,500);if("canvas"===t.nodeName.toLowerCase()){var n=(new Date).getTime()-p;return p=(new Date).getTime(),f.frames.push({image:(r=document.createElement("canvas"),o=r.getContext("2d"),r.width=t.width,r.height=t.height,o.drawImage(t,0,0),r),duration:n}),void(i&&setTimeout(h,e.frameInterval))}var r,o;html2canvas(t,{grabMouse:void 0===e.showMousePointer||e.showMousePointer,onrendered:function(t){var n=(new Date).getTime()-p;if(!n)return setTimeout(h,e.frameInterval);p=(new Date).getTime(),f.frames.push({image:t.toDataURL("image/webp",1),duration:n}),i&&setTimeout(h,e.frameInterval)}})}this.pause=function(){c=!0,o instanceof S&&o.pause()},this.resume=function(){c=!1,o instanceof S?o.resume():i||this.record()},this.clearRecordedData=function(){i&&this.stop(l),l()},this.name="CanvasRecorder",this.toString=function(){return this.name};var p=(new Date).getTime(),f=new I.Video(100)}function k(t,e){function n(t){t=void 0!==t?t:10;var e=(new Date).getTime()-s;return e?o?(s=(new Date).getTime(),setTimeout(n,100)):(s=(new Date).getTime(),a.paused&&a.play(),l.drawImage(a,0,0,c.width,c.height),u.frames.push({duration:e,image:c.toDataURL("image/webp")}),void(r||setTimeout(n,t,t))):setTimeout(n,t,t)}(e=e||{}).frameInterval||(e.frameInterval=10),e.disableLogs||console.log("Using frames-interval:",e.frameInterval),this.record=function(){e.width||(e.width=320),e.height||(e.height=240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),c.width=e.canvas.width||320,c.height=e.canvas.height||240,l=c.getContext("2d"),e.video&&e.video instanceof HTMLVideoElement?(a=e.video.cloneNode(),e.initCallback&&e.initCallback()):(a=document.createElement("video"),_(t,a),a.onloadedmetadata=function(){e.initCallback&&e.initCallback()},a.width=e.video.width,a.height=e.video.height),a.muted=!0,a.play(),s=(new Date).getTime(),u=new I.Video,e.disableLogs||(console.log("canvas resolutions",c.width,"*",c.height),console.log("video width/height",a.width||c.width,"*",a.height||c.height)),n(e.frameInterval)};var r=!1;this.stop=function(t){t=t||function(){},r=!0;var n=this;setTimeout(function(){!function(t,e,n,r,o){var i=document.createElement("canvas");i.width=c.width,i.height=c.height;var a,s,u,l=i.getContext("2d"),h=[],p=t.length,f=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),d=!1;s=-1,u=(a={length:p,functionToLoop:function(e,n){var r,o,i,a=function(){!d&&i-r<=0*i||(d=!0,h.push(t[n])),e()};if(d)a();else{var s=new Image;s.onload=function(){l.drawImage(s,0,0,c.width,c.height);var t=l.getImageData(0,0,c.width,c.height);r=0,o=t.data.length,i=t.data.length/4;for(var e=0;e<o;e+=4){var n={r:t.data[e],g:t.data[e+1],b:t.data[e+2]};Math.sqrt(Math.pow(n.r-0,2)+Math.pow(n.g-0,2)+Math.pow(n.b-0,2))<=0*f&&r++}a()},s.src=t[n].image}},callback:function(){(h=h.concat(t.slice(p))).length<=0&&h.push(t[t.length-1]),o(h)}}).length,function t(){++s!==u?setTimeout(function(){a.functionToLoop(t,s)},1):a.callback()}()}(u.frames,0,0,0,function(r){u.frames=r,e.advertisement&&e.advertisement.length&&(u.frames=e.advertisement.concat(u.frames)),u.compile(function(e){n.blob=e,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),t&&t(n.blob)})})},10)};var o=!1;function i(){u.frames=[],r=!0,o=!1}this.pause=function(){o=!0},this.resume=function(){o=!1,r&&this.record()},this.clearRecordedData=function(){r||this.stop(i),i()},this.name="WhammyRecorder",this.toString=function(){return this.name};var a,s,u,c=document.createElement("canvas"),l=c.getContext("2d")}void 0!==p?C.AudioContext=p:"undefined"!=typeof webkitAudioContext&&(C.AudioContext=webkitAudioContext),i.Storage=C,i.MediaStreamRecorder=S,i.StereoAudioRecorder=R,i.CanvasRecorder=T,i.WhammyRecorder=k;var I=function(){function t(t){this.frames=[],this.duration=t||1,this.quality=.8}function e(t){function e(t,e,n){return[{data:t,id:231}].concat(n.map(function(t){var n=function(t){var e=0;if(t.keyframe&&(e|=128),t.invisible&&(e|=8),t.lacing&&(e|=t.lacing<<1),t.discardable&&(e|=1),t.trackNum>127)throw"TrackNumber > 127 not supported";return[128|t.trackNum,t.timecode>>8,255&t.timecode,e].map(function(t){return String.fromCharCode(t)}).join("")+t.frame}({discardable:0,frame:t.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(e)});return e+=t.duration,{data:n,id:163}}))}function n(t){for(var e=[];t>0;)e.push(255&t),t>>=8;return new Uint8Array(e.reverse())}function r(t){var e=[];t=(t.length%8?new Array(9-t.length%8).join("0"):"")+t;for(var n=0;n<t.length;n+=8)e.push(parseInt(t.substr(n,8),2));return new Uint8Array(e)}function o(t,e){return parseInt(t.substr(e+4,4).split("").map(function(t){var e=t.charCodeAt(0).toString(2);return new Array(8-e.length+1).join("0")+e}).join(""),2)}var i=new function(t){var o=function(t){if(t[0]){for(var e=t[0].width,n=t[0].height,r=t[0].duration,o=1;o<t.length;o++)r+=t[o].duration;return{duration:r,width:e,height:n}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(t);if(!o)return[];for(var i,a=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(i=o.duration,[].slice.call(new Uint8Array(new Float64Array([i]).buffer),0).map(function(t){return String.fromCharCode(t)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:o.width,id:176},{data:o.height,id:186}]}]}]}]}],s=0,u=0;s<t.length;){var c=[],l=0;do{c.push(t[s]),l+=t[s].duration,s++}while(s<t.length&&l<3e4);var h={id:524531317,data:e(u,0,c)};a[1].data.push(h),u+=l}return function t(e){for(var o=[],i=0;i<e.length;i++){var a=e[i].data;"object"==typeof a&&(a=t(a)),"number"==typeof a&&(a=r(a.toString(2))),"string"==typeof a&&(a=new Uint8Array(a.split("").map(function(t){return t.charCodeAt(0)})));var s=a.size||a.byteLength||a.length,u=Math.ceil(Math.ceil(Math.log(s)/Math.log(2))/8),c=s.toString(2),l=new Array(7*u+7+1-c.length).join("0")+c,h=new Array(u).join("0")+"1"+l;o.push(n(e[i].id)),o.push(r(h)),o.push(a)}return new Blob(o,{type:"video/webm"})}(a)}(t.map(function(t){var e=function(t){for(var e=t.RIFF[0].WEBP[0],n=e.indexOf("\x9d\x01*"),r=0,o=[];r<4;r++)o[r]=e.charCodeAt(n+3+r);return{width:16383&(o[1]<<8|o[0]),height:16383&(o[3]<<8|o[2]),data:e,riff:t}}(function t(e){for(var n=0,r={};n<e.length;){var i=e.substr(n,4),a=o(e,n),s=e.substr(n+4+4,a);n+=8+a,r[i]=r[i]||[],r[i].push("RIFF"===i||"LIST"===i?t(s):s)}return r}(atob(t.image.slice(23))));return e.duration=t.duration,e}));postMessage(i)}return t.prototype.add=function(t,e){if("canvas"in t&&(t=t.canvas),"toDataURL"in t&&(t=t.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(t))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:t,duration:e||this.duration})},t.prototype.compile=function(t){var n,r,o,i=(n=e,r=f.createObjectURL(new Blob([n.toString(),"this.onmessage =  function (eee) {"+n.name+"(eee.data);}"],{type:"application/javascript"})),o=new Worker(r),f.revokeObjectURL(r),o);i.onmessage=function(e){e.data.error?console.error(e.data.error):t(e.data)},i.postMessage(this.frames)},{Video:t}}();i.Whammy=I;var N={init:function(){var t=this;if("undefined"!=typeof indexedDB&&void 0!==indexedDB.open){var e,n=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),r=indexedDB.open(n,1);r.onerror=t.onError,r.onsuccess=function(){(e=r.result).onerror=t.onError,e.setVersion&&1!==e.version?e.setVersion(1).onsuccess=function(){o(e),i()}:i()},r.onupgradeneeded=function(t){o(t.target.result)}}else console.error("IndexedDB API are not available in this browser.");function o(e){e.createObjectStore(t.dataStoreName)}function i(){var n=e.transaction([t.dataStoreName],"readwrite");function r(e){n.objectStore(t.dataStoreName).get(e).onsuccess=function(n){t.callback&&t.callback(n.target.result,e)}}t.videoBlob&&n.objectStore(t.dataStoreName).put(t.videoBlob,"videoBlob"),t.gifBlob&&n.objectStore(t.dataStoreName).put(t.gifBlob,"gifBlob"),t.audioBlob&&n.objectStore(t.dataStoreName).put(t.audioBlob,"audioBlob"),r("audioBlob"),r("videoBlob"),r("gifBlob")}},Fetch:function(t){return this.callback=t,this.init(),this},Store:function(t){return this.audioBlob=t.audioBlob,this.videoBlob=t.videoBlob,this.gifBlob=t.gifBlob,this.init(),this},onError:function(t){console.error(JSON.stringify(t,null,"\t"))},dataStoreName:"recordRTC",dbName:null};function A(t,e){if("undefined"==typeof GIFEncoder){var n=document.createElement("script");n.src="https://cdn.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(n)}e=e||{};var r=t instanceof CanvasRenderingContext2D||t instanceof HTMLCanvasElement;this.record=function(){"undefined"!=typeof GIFEncoder&&s?(r||(e.width||(e.width=u.offsetWidth||320),e.height||(e.height=u.offsetHeight||240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),i.width=e.canvas.width||320,i.height=e.canvas.height||240,u.width=e.video.width||320,u.height=e.video.height||240),(p=new GIFEncoder).setRepeat(0),p.setDelay(e.frameRate||200),p.setQuality(e.quality||10),p.start(),"function"==typeof e.onGifRecordingStarted&&e.onGifRecordingStarted(),Date.now(),f=c(function t(n){if(!0!==d.clearedRecordedData){if(o)return setTimeout(function(){t(n)},100);f=c(t),void 0===typeof l&&(l=n),n-l<90||(!r&&u.paused&&u.play(),r||a.drawImage(u,0,0,i.width,i.height),e.onGifPreview&&e.onGifPreview(i.toDataURL("image/png")),p.addFrame(a),l=n)}}),e.initCallback&&e.initCallback()):setTimeout(d.record,1e3)},this.stop=function(t){t=t||function(){},f&&h(f),Date.now(),this.blob=new Blob([new Uint8Array(p.stream().bin)],{type:"image/gif"}),t(this.blob),p.stream().bin=[]};var o=!1;this.pause=function(){o=!0},this.resume=function(){o=!1},this.clearRecordedData=function(){d.clearedRecordedData=!0,p&&(p.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name};var i=document.createElement("canvas"),a=i.getContext("2d");r&&(t instanceof CanvasRenderingContext2D?i=(a=t).canvas:t instanceof HTMLCanvasElement&&(a=t.getContext("2d"),i=t));var s=!0;if(!r){var u=document.createElement("video");u.muted=!0,u.autoplay=!0,s=!1,u.onloadedmetadata=function(){s=!0},_(t,u),u.play()}var l,p,f=null,d=this}function D(t){var e=[],n=!1,r=document.createElement("canvas"),o=r.getContext("2d");r.style="opacity:0;position:absolute;z-index:-1;top: -100000000;left:-1000000000; margin-top:-1000000000;margin-left:-1000000000;",(document.body||document.documentElement).appendChild(r),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var i=this,a=window.AudioContext;void 0===a&&("undefined"!=typeof webkitAudioContext&&(a=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(a=mozAudioContext));var s=window.URL;void 0===s&&"undefined"!=typeof webkitURL&&(s=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var u=window.MediaStream;void 0===u&&"undefined"!=typeof webkitMediaStream&&(u=webkitMediaStream),void 0!==u&&void 0===u.prototype.stop&&(u.prototype.stop=function(){this.getTracks().forEach(function(t){t.stop()})});var c={};function l(){if(!n){var t=e.length,o=!1,a=[];if(e.forEach(function(t){t.stream||(t.stream={}),t.stream.fullcanvas?o=t:a.push(t)}),o)r.width=o.stream.width,r.height=o.stream.height;else if(a.length){r.width=t>1?2*a[0].width:a[0].width;var s=1;3!==t&&4!==t||(s=2),5!==t&&6!==t||(s=3),7!==t&&8!==t||(s=4),9!==t&&10!==t||(s=5),r.height=a[0].height*s}else r.width=i.width||360,r.height=i.height||240;o&&o instanceof HTMLVideoElement&&h(o),a.forEach(function(t,e){h(t,e)}),setTimeout(l,i.frameInterval)}}function h(t,e){if(!n){var r=0,i=0,a=t.width,s=t.height;1===e&&(r=t.width),2===e&&(i=t.height),3===e&&(r=t.width,i=t.height),4===e&&(i=2*t.height),5===e&&(r=t.width,i=2*t.height),6===e&&(i=3*t.height),7===e&&(r=t.width,i=3*t.height),void 0!==t.stream.left&&(r=t.stream.left),void 0!==t.stream.top&&(i=t.stream.top),void 0!==t.stream.width&&(a=t.stream.width),void 0!==t.stream.height&&(s=t.stream.height),o.drawImage(t,r,i,a,s),"function"==typeof t.stream.onRender&&t.stream.onRender(o,r,i,a,s,e)}}function p(t){var e=document.createElement("video");return function(t,e){"srcObject"in e?e.srcObject=t:"mozSrcObject"in e?e.mozSrcObject=t:e.srcObject=t}(t,e),e.muted=!0,e.volume=0,e.width=t.width||i.width||360,e.height=t.height||i.height||240,e.play(),e}function f(n){e=[],(n=n||t).forEach(function(t){if(t.getTracks().filter(function(t){return"video"===t.kind}).length){var n=p(t);n.stream=t,e.push(n)}})}void 0!==a?c.AudioContext=a:"undefined"!=typeof webkitAudioContext&&(c.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){l()},this.appendStreams=function(n){if(!n)throw"First parameter is required.";n instanceof Array||(n=[n]),t.concat(n),n.forEach(function(t){if(t.getTracks().filter(function(t){return"video"===t.kind}).length){var n=p(t);n.stream=t,e.push(n)}if(t.getTracks().filter(function(t){return"audio"===t.kind}).length&&i.audioContext){var r=i.audioContext.createMediaStreamSource(t);r.connect(i.audioDestination),i.audioSources.push(r)}})},this.releaseStreams=function(){e=[],n=!0,i.gainNode&&(i.gainNode.disconnect(),i.gainNode=null),i.audioSources.length&&(i.audioSources.forEach(function(t){t.disconnect()}),i.audioSources=[]),i.audioDestination&&(i.audioDestination.disconnect(),i.audioDestination=null),i.audioContext&&i.audioContext.close(),i.audioContext=null,o.clearRect(0,0,r.width,r.height),r.stream&&(r.stream.stop(),r.stream=null)},this.resetVideoStreams=function(t){!t||t instanceof Array||(t=[t]),f(t)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){n=!1;var e=function(){var t;f(),"captureStream"in r?t=r.captureStream():"mozCaptureStream"in r?t=r.mozCaptureStream():i.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var e=new u;return t.getTracks().filter(function(t){return"video"===t.kind}).forEach(function(t){e.addTrack(t)}),r.stream=e,e}(),o=function(){c.AudioContextConstructor||(c.AudioContextConstructor=new c.AudioContext),i.audioContext=c.AudioContextConstructor,i.audioSources=[],!0===i.useGainNode&&(i.gainNode=i.audioContext.createGain(),i.gainNode.connect(i.audioContext.destination),i.gainNode.gain.value=0);var e=0;if(t.forEach(function(t){if(t.getTracks().filter(function(t){return"audio"===t.kind}).length){e++;var n=i.audioContext.createMediaStreamSource(t);!0===i.useGainNode&&n.connect(i.gainNode),i.audioSources.push(n)}}),e)return i.audioDestination=i.audioContext.createMediaStreamDestination(),i.audioSources.forEach(function(t){t.connect(i.audioDestination)}),i.audioDestination.stream}();return o&&o.getTracks().filter(function(t){return"audio"===t.kind}).forEach(function(t){e.addTrack(t)}),t.forEach(function(t){}),e}}function M(t,e){t=t||[];var n,r,o=this;(e=e||{mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(e.frameInterval=10),e.video||(e.video={}),e.video.width||(e.video.width=360),e.video.height||(e.video.height=240),this.record=function(){var o;n=new D(t),(o=[],t.forEach(function(t){x(t,"video").forEach(function(t){o.push(t)})}),o).length&&(n.frameInterval=e.frameInterval||10,n.width=e.video.width||360,n.height=e.video.height||240,n.startDrawingFrames()),e.previewStream&&"function"==typeof e.previewStream&&e.previewStream(n.getMixedStream()),(r=new S(n.getMixedStream(),e)).record()},this.stop=function(t){r&&r.stop(function(e){o.blob=e,t(e),o.clearRecordedData()})},this.pause=function(){r&&r.pause()},this.resume=function(){r&&r.resume()},this.clearRecordedData=function(){r&&(r.clearRecordedData(),r=null),n&&(n.releaseStreams(),n=null)},this.addStreams=function(e){if(!e)throw"First parameter is required.";e instanceof Array||(e=[e]),t.concat(e),r&&n&&n.appendStreams(e)},this.resetVideoStreams=function(t){n&&(!t||t instanceof Array||(t=[t]),n.resetVideoStreams(t))},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}function P(t,e){function n(){return new ReadableStream({start:function(n){var r=document.createElement("canvas"),o=document.createElement("video");o.srcObject=t,o.onplaying=function(){r.width=e.width,r.height=e.height;var t=r.getContext("2d"),i=1e3/e.frameRate;setTimeout(function r(){t.drawImage(o,0,0),n.enqueue(t.getImageData(0,0,e.width,e.height)),setTimeout(r,i)},i)},o.play()}})}var r,o;"undefined"!=typeof ReadableStream&&"undefined"!=typeof WritableStream||console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(e=e||{}).width=e.width||640,e.height=e.height||480,e.frameRate=e.frameRate||30,e.bitrate=e.bitrate||1200,this.record=function(){i=[],o=!1,this.blob=null,function t(a,s){if(e.workerPath||s){if(!e.workerPath&&s instanceof ArrayBuffer){var u=new Blob([s],{type:"text/javascript"});e.workerPath=f.createObjectURL(u)}e.workerPath||console.error("workerPath parameter is missing."),(r=new Worker(e.workerPath)).postMessage(e.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),r.addEventListener("message",function(t){"READY"===t.data?(r.postMessage({width:e.width,height:e.height,bitrate:e.bitrate||1200,timebaseDen:e.frameRate||30,realtime:!0}),n().pipeTo(new WritableStream({write:function(t){r&&r.postMessage(t.data.buffer,[t.data.buffer])}}))):t.data&&(o||i.push(t.data))})}else fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(e){e.arrayBuffer().then(function(e){t(a,e)})})}(t),"function"==typeof e.initCallback&&e.initCallback()},this.pause=function(){o=!0},this.resume=function(){o=!1};var i=[];this.stop=function(t){r&&(r.postMessage(null),r.terminate(),r=null),this.blob=new Blob(i,{type:"video/webm"}),t(this.blob)},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){i=[],o=!1,this.blob=null},this.blob=null}i.DiskStorage=N,i.GifRecorder=A,i.MultiStreamRecorder=M,i.RecordRTCPromisesHandler=function(t,e){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===t)throw'First argument "MediaStream" is required.';var n=this;n.recordRTC=new i(t,e),this.startRecording=function(){return new Promise(function(t,e){try{n.recordRTC.startRecording(),t()}catch(r){e(r)}})},this.stopRecording=function(){return new Promise(function(t,e){try{n.recordRTC.stopRecording(function(r){n.blob=n.recordRTC.getBlob(),n.blob&&n.blob.size?t(r):e("Empty blob.",n.blob)})}catch(r){e(r)}})},this.getDataURL=function(t){return new Promise(function(t,e){try{n.recordRTC.getDataURL(function(e){t(e)})}catch(r){e(r)}})},this.getBlob=function(){return new Promise(function(t,e){try{t(n.recordRTC.getBlob())}catch(r){e(r)}})},this.blob=null},i.WebAssemblyRecorder=P},zUnb:function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"getModelUris",function(){return zS}),n.d(r,"convLayer",function(){return CS}),n.d(r,"disposeUnusedWeightTensors",function(){return ES}),n.d(r,"extractConvParamsFactory",function(){return SS}),n.d(r,"extractFCParamsFactory",function(){return RS}),n.d(r,"extractSeparableConvParamsFactory",function(){return kS}),n.d(r,"loadSeparableConvParamsFactory",function(){return IS}),n.d(r,"extractWeightEntryFactory",function(){return VS}),n.d(r,"extractWeightsFactory",function(){return jS}),n.d(r,"SeparableConvParams",function(){return TS}),n.d(r,"TinyYolov2",function(){return RR}),n.d(r,"TinyYolov2SizeType",function(){return ER}),n.d(r,"TinyYolov2Options",function(){return SR}),n.d(r,"validateConfig",function(){return bR});var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function s(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(pm){i(pm)}}function s(t){try{u(r.throw(t))}catch(pm){i(pm)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function l(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(pm){i=[6,pm],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function h(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}var d=Array.isArray||function(t){return t&&"number"==typeof t.length};function v(t){return null!=t&&"object"==typeof t}function m(t){return"function"==typeof t}var g,y={e:{}};function w(){try{return g.apply(this,arguments)}catch(pm){return y.e=pm,y}}function b(t){return g=t,w}function x(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}x.prototype=Object.create(Error.prototype);var _=x,C=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var n=this._parent,r=this._parents,o=this._unsubscribe,i=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var a=-1,s=r?r.length:0;n;)n.remove(this),n=++a<s&&r[a]||null;if(m(o)&&b(o).call(this)===y&&(e=!0,t=t||(y.e instanceof _?E(y.e.errors):[y.e])),d(i))for(a=-1,s=i.length;++a<s;){var u=i[a];if(v(u)&&b(u.unsubscribe).call(u)===y){e=!0,t=t||[];var c=y.e;c instanceof _?t=t.concat(E(c.errors)):t.push(c)}}if(e)throw new _(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var n=e;switch(typeof e){case"function":n=new t(e);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.prototype._addParent=function(t){var e=this._parent,n=this._parents;e&&e!==t?n?-1===n.indexOf(t)&&n.push(t):this._parents=[t]:this._parent=t},t.EMPTY=((e=new t).closed=!0,e),t}();function E(t){return t.reduce(function(t,e){return t.concat(e instanceof _?e.errors:e)},[])}var S=!1,R={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){S=t},get useDeprecatedSynchronousErrorHandling(){return S}};function T(t){setTimeout(function(){throw t})}var k={closed:!0,next:function(t){},error:function(t){if(R.useDeprecatedSynchronousErrorHandling)throw t;T(t)},complete:function(){}},I="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),N=function(t){function e(n,r,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,i._parentSubscription=null,arguments.length){case 0:i.destination=k;break;case 1:if(!n){i.destination=k;break}if("object"==typeof n){n instanceof e?(i.syncErrorThrowable=n.syncErrorThrowable,i.destination=n,n.add(i)):(i.syncErrorThrowable=!0,i.destination=new A(i,n));break}default:i.syncErrorThrowable=!0,i.destination=new A(i,n,r,o)}return i}return i(e,t),e.prototype[I]=function(){return this},e.create=function(t,n,r){var o=new e(t,n,r);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this._parentSubscription=null,this},e}(C),A=function(t){function e(e,n,r,o){var i,a=t.call(this)||this;a._parentSubscriber=e;var s=a;return m(n)?i=n:n&&(i=n.next,r=n.error,o=n.complete,n!==k&&(m((s=Object.create(n)).unsubscribe)&&a.add(s.unsubscribe.bind(s)),s.unsubscribe=a.unsubscribe.bind(a))),a._context=s,a._next=i,a._error=r,a._complete=o,a}return i(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;R.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=R.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):T(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;T(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};R.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),R.useDeprecatedSynchronousErrorHandling)throw n;T(n)}},e.prototype.__tryOrSetError=function(t,e,n){if(!R.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(r){return R.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(T(r),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(N),D="function"==typeof Symbol&&Symbol.observable||"@@observable";function M(){}function P(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return O(t)}function O(t){return t?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:M}var F=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,o=function(t,e,n){if(t){if(t instanceof N)return t;if(t[I])return t[I]()}return t||e||n?new N(t,e,n):new N(k)}(t,e,n);if(r?r.call(o,this.source):o.add(this.source||R.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),R.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){R.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t.destination;if(t.closed||t.isStopped)return!1;t=e&&e instanceof N?e:null}return!0}(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=L(e))(function(e,r){var o;o=n.subscribe(function(e){try{t(e)}catch(n){r(n),o&&o.unsubscribe()}},r,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[D]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:O(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=L(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function L(t){if(t||(t=R.Promise||Promise),!t)throw new Error("no Promise impl found");return t}function B(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}B.prototype=Object.create(Error.prototype);var U=B,V=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return i(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(C),j=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return i(e,t),e}(N),z=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return i(e,t),e.prototype[I]=function(){return new j(this)},e.prototype.lift=function(t){var e=new W(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new U;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),o=0;o<n;o++)r[o].next(t)},e.prototype.error=function(t){if(this.closed)throw new U;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),o=0;o<n;o++)r[o].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new U;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new U;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new U;return this.hasError?(t.error(this.thrownError),C.EMPTY):this.isStopped?(t.complete(),C.EMPTY):(this.observers.push(t),new V(this,t))},e.prototype.asObservable=function(){var t=new F;return t.source=this,t},e.create=function(t,e){return new W(t,e)},e}(F),W=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return i(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):C.EMPTY},e}(z);function H(t){return t&&"function"==typeof t.schedule}var G=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parent=e,o.outerValue=n,o.outerIndex=r,o.index=0,o}return i(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(N),q=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.closed||e.complete()}},$=function(t){return function(e){return t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,T),e}};function K(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var X=K(),Q=function(t){return function(e){for(var n=t[X]();;){var r=n.next();if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add(function(){n.return&&n.return()}),e}},Y=function(t){return function(e){var n=t[D]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)}},Z=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function J(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var tt=function(t){if(t instanceof F)return function(e){return t._isScalar?(e.next(t.value),void e.complete()):t.subscribe(e)};if(t&&"function"==typeof t[D])return Y(t);if(Z(t))return q(t);if(J(t))return $(t);if(t&&"function"==typeof t[X])return Q(t);var e=v(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function et(t,e,n,r,o){if(void 0===o&&(o=new G(t,n,r)),!o.closed)return tt(e)(o)}var nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(N);function rt(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new ot(t,e))}}var ot=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new it(t,this.project,this.thisArg))},t}(),it=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.project=n,o.count=0,o.thisArg=r||o,o}return i(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)},e}(N);function at(t,e){return new F(e?function(n){var r=new C,o=0;return r.add(e.schedule(function(){o!==t.length?(n.next(t[o++]),n.closed||r.add(this.schedule())):n.complete()})),r}:q(t))}function st(t,e){if(!e)return t instanceof F?t:new F(tt(t));if(null!=t){if(function(t){return t&&"function"==typeof t[D]}(t))return function(t,e){return new F(e?function(n){var r=new C;return r.add(e.schedule(function(){var o=t[D]();r.add(o.subscribe({next:function(t){r.add(e.schedule(function(){return n.next(t)}))},error:function(t){r.add(e.schedule(function(){return n.error(t)}))},complete:function(){r.add(e.schedule(function(){return n.complete()}))}}))})),r}:Y(t))}(t,e);if(J(t))return function(t,e){return new F(e?function(n){var r=new C;return r.add(e.schedule(function(){return t.then(function(t){r.add(e.schedule(function(){n.next(t),r.add(e.schedule(function(){return n.complete()}))}))},function(t){r.add(e.schedule(function(){return n.error(t)}))})})),r}:$(t))}(t,e);if(Z(t))return at(t,e);if(function(t){return t&&"function"==typeof t[X]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new F(e?function(n){var r,o=new C;return o.add(function(){r&&"function"==typeof r.return&&r.return()}),o.add(e.schedule(function(){r=t[X](),o.add(e.schedule(function(){if(!n.closed){var t,e;try{var o=r.next();t=o.value,e=o.done}catch(i){return void n.error(i)}e?n.complete():(n.next(t),this.schedule())}}))})),o}:Q(t))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function ut(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(ut(function(n,r){return st(t(n,r)).pipe(rt(function(t,o){return e(n,t,r,o)}))},n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new ct(t,n))})}var ct=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new lt(t,this.project,this.concurrent))},t}(),lt=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var o=t.call(this,e)||this;return o.project=n,o.concurrent=r,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return i(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=new G(this,void 0,void 0);this.destination.add(r),et(this,t,e,n,r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(nt);function ht(t){return t}function pt(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),ut(ht,t)}function ft(){return function(t){return t.lift(new dt(t))}}var dt=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var r=new vt(t,n),o=e.subscribe(r);return r.closed||(r.connection=n.connect()),o},t}(),vt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return i(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},e}(N),mt=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return i(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new C).add(this.source.subscribe(new yt(this.getSubject(),this))),t.closed?(this._connection=null,t=C.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return ft()(this)},e}(F).prototype,gt={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:mt._subscribe},_isComplete:{value:mt._isComplete,writable:!0},getSubject:{value:mt.getSubject},connect:{value:mt.connect},refCount:{value:mt.refCount}},yt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return i(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(j);function wt(){return new z}function bt(t){for(var e in t)if(t[e]===bt)return e;throw Error("Could not find renamed property on target object.")}var xt=bt({ngComponentDef:bt}),_t=bt({ngInjectableDef:bt}),Ct=bt({ngInjectorDef:bt}),Et=bt({ngModuleDef:bt}),St=bt({__NG_ELEMENT_ID__:bt});function Rt(t){return{providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Tt(t){return t.hasOwnProperty(_t)?t[_t]:null}function kt(t){return t.hasOwnProperty(Ct)?t[Ct]:null}var It=function(){function t(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0!==e?Rt({providedIn:e.providedIn||"root",factory:e.factory}):void 0}return t.prototype.toString=function(){return"InjectionToken "+this._desc},t}(),Nt="__parameters__";function At(t,e,n){var r=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t){var r=t.apply(void 0,f(e));for(var o in r)this[o]=r[o]}}}(e);function o(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof o)return r.apply(this,e),this;var i=new((t=o).bind.apply(t,f([void 0],e)));return a.annotation=i,a;function a(t,e,n){for(var r=t.hasOwnProperty(Nt)?t[Nt]:Object.defineProperty(t,Nt,{value:[]})[Nt];r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(i),t}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o}var Dt=new It("AnalyzeForEntryComponents"),Mt=function(t){return t[t.Emulated=0]="Emulated",t[t.Native=1]="Native",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}({}),Pt="undefined"!=typeof window&&window,Ot="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ft="undefined"!=typeof global&&global||Pt||Ot,Lt=Promise.resolve(0),Bt=null;function Ut(){if(!Bt){var t=Ft.Symbol;if(t&&t.iterator)Bt=t.iterator;else for(var e=Object.getOwnPropertyNames(Map.prototype),n=0;n<e.length;++n){var r=e[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Bt=r)}}return Bt}function Vt(t){"undefined"==typeof Zone?Lt.then(function(){t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}function jt(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function zt(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(zt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;var e=t.toString();if(null==e)return""+e;var n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}var Wt,Ht=At("Inject",function(t){return{token:t}}),Gt=At("Optional"),qt=At("Self"),$t=At("SkipSelf"),Kt=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}({}),Xt=void 0;function Qt(t){var e=Xt;return Xt=t,e}function Yt(t){var e=Wt;return Wt=t,e}function Zt(t,e){return void 0===e&&(e=Kt.Default),(Wt||function(t,e){if(void 0===e&&(e=Kt.Default),void 0===Xt)throw new Error("inject() must be called from an injection context");return null===Xt?Jt(t,void 0,e):Xt.get(t,e&Kt.Optional?null:void 0,e)})(t,e)}function Jt(t,e,n){var r=Tt(t);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&Kt.Optional)return null;if(void 0!==e)return e;throw new Error("Injector: NOT_FOUND ["+zt(t)+"]")}function te(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");for(var o=void 0,i=Kt.Default,a=0;a<r.length;a++){var s=r[a];s instanceof Gt||"Optional"===s.ngMetadataName?i|=Kt.Optional:s instanceof $t||"SkipSelf"===s.ngMetadataName?i|=Kt.SkipSelf:s instanceof qt||"Self"===s.ngMetadataName?i|=Kt.Self:o=s instanceof Ht?s.token:s}e.push(Zt(o,i))}else e.push(Zt(r))}return e}var ee=8,ne=8,re=9,oe=-1,ie=function(){return function(t,e,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=n}}(),ae=ie.prototype,se=17,ue=0,ce=1,le=2,he=3,pe=4,fe=5,de=6,ve=7,me=8,ge=9,ye=10,we=11,be=12,xe=14,_e=16;function Ce(t,e,n){t.afterContentInit&&(e.contentHooks||(e.contentHooks=[])).push(n,t.afterContentInit),t.afterContentChecked&&((e.contentHooks||(e.contentHooks=[])).push(n,t.afterContentChecked),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,t.afterContentChecked))}function Ee(t,e,n){t.afterViewInit&&(e.viewHooks||(e.viewHooks=[])).push(n,t.afterViewInit),t.afterViewChecked&&((e.viewHooks||(e.viewHooks=[])).push(n,t.afterViewChecked),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,t.afterViewChecked))}function Se(t,e,n){null!=t.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(n,t.onDestroy)}function Re(t,e,n,r){var o=r?e:n;o&&Te(t,o)}function Te(t,e){for(var n=0;n<e.length;n+=2)e[n+1].call(t[e[n]])}function ke(t,e){var n=Ae(t),r=Ae(e);return n&&r?function(t,e,n){for(var r=t[Ut()](),o=e[Ut()]();;){var i=r.next(),a=o.next();if(i.done&&a.done)return!0;if(i.done||a.done)return!1;if(!n(i.value,a.value))return!1}}(t,e,ke):!(n||!t||"object"!=typeof t&&"function"!=typeof t||r||!e||"object"!=typeof e&&"function"!=typeof e)||jt(t,e)}var Ie=function(){function t(t){this.wrapped=t}return t.wrap=function(e){return new t(e)},t.unwrap=function(e){return t.isWrapped(e)?e.wrapped:e},t.isWrapped=function(e){return e instanceof t},t}(),Ne=function(){function t(t,e,n){this.previousValue=t,this.currentValue=e,this.firstChange=n}return t.prototype.isFirstChange=function(){return this.firstChange},t}();function Ae(t){return!!De(t)&&(Array.isArray(t)||!(t instanceof Map)&&Ut()in t)}function De(t){return null!==t&&("function"==typeof t||"object"==typeof t)}var Me=0,Pe=1,Oe=6,Fe="__ngContext__";function Le(t){return"function"==typeof t?t.name||t:"string"==typeof t?t:null==t?"":""+t}function Be(t){for(;Array.isArray(t);)t=t[fe];return t}function Ue(t,e){return Be(e[t.index])}function Ve(t,e){var n=e[t];return n.length>=se?n:n[fe]}function je(t){return t[Fe]}function ze(t){var e=je(t);return e?Array.isArray(e)?e:e.lViewData:null}function We(t){return 32767&t}function He(t,e){for(var n=t>>16,r=e;n>0;)r=r[_e],n--;return r}var Ge,qe,$e,Ke,Xe,Qe,Ye,Ze,Je=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ft);function tn(){return Ge}function en(){return qe}function nn(){return $e}function rn(t){$e=t}function on(t,e){$e=t,Ze=e}function an(){return Ke}function sn(t){Ke=t}function un(){return Xe}function cn(){return Ye}function ln(){return Ze}var hn=!1;function pn(){return hn}function fn(t){hn=t}var dn=!0;function vn(t){dn=t}function mn(t,e){var n=Ze;return Xe=t&&t[ue],Ye=t&&1==(1&t[ce]),dn=t&&Xe.firstTemplatePass,Ge=t&&t[we],$e=e,Ke=!0,Ze=t,n&&(n[pe]=Qe),Qe=t&&t[pe],n}function gn(t,e){e||(hn||Re(Ze,Xe.viewHooks,Xe.viewCheckHooks,Ye),Ze[ce]&=-6),Ze[ce]|=16,Ze[ve]=Xe.bindingStartIndex,mn(t,null)}var yn=!1;function wn(t){var e=yn;return yn=t,e}var bn=255,xn=0;function _n(t,e){var n=En(t,e);if(-1!==n)return n;var r=e[ue];r.firstTemplatePass&&(t.injectorIndex=e.length,Cn(r.data,t),Cn(e,null),Cn(r.blueprint,null));var o=Sn(t,e),i=We(o),a=He(o,e),s=t.injectorIndex;if(o!==oe)for(var u=a[ue].data,c=0;c<8;c++)e[s+c]=a[i+c]|u[i+c];return e[s+ne]=o,s}function Cn(t,e){t.push(0,0,0,0,0,0,0,0,e)}function En(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null==e[t.injectorIndex+ne]?-1:t.injectorIndex}function Sn(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;for(var n=e[de],r=1;n&&-1===n.injectorIndex;)n=(e=e[_e])[de],r++;return n?n.injectorIndex|r<<16|(n&&3===n.type?32768:0):-1}var Rn={};function Tn(t,e,n,r){var o=e[ue],i=o.data[t+ee],a=i.flags,s=i.providerIndexes,u=o.data,c=!1;(null==r&&function(t){return 4096==(4096&t.flags)}(i)&&yn||null!=r&&r!=o&&(null==o.node||3===o.node.type))&&(c=!0);for(var l=65535&s,h=a>>16,p=4095&a,f=c?l:l+(s>>16);f<h+p;f++){var d=u[f];if(f<h&&n===d||f>=h&&d.type===n)return kn(u,e,f,i)}return Rn}function kn(t,e,n,r){var o,i=e[n];if(null!=(o=i)&&"object"==typeof o&&Object.getPrototypeOf(o)==ae){var a=i;if(a.resolving)throw new Error("Circular dep for "+Le(t[n]));var s=wn(a.canSeeViewProviders);a.resolving=!0;var u=void 0;a.injectImpl&&(u=Yt(a.injectImpl));var c=nn(),l=ln();on(r,e);try{i=e[n]=a.factory(null,t,e,r)}finally{a.injectImpl&&Yt(u),wn(s),a.resolving=!1,on(c,l)}}return i}function In(t,e,n){var r=64&t,o=32&t;return!!((128&t?r?o?n[e+7]:n[e+6]:o?n[e+5]:n[e+4]:r?o?n[e+3]:n[e+2]:o?n[e+1]:n[e])&1<<t)}function Nn(t,e){return!(t&Kt.Self||t&Kt.Host&&32768&e)}var An=function(){function t(t,e){this._tNode=t,this._hostView=e,this._injectorIndex=_n(t,e)}return t.prototype.get=function(t){return on(this._tNode,this._hostView),function(t,e,n,r,o){void 0===r&&(r=Kt.Default);var i=function(t){var e=t[St];return"number"==typeof e?e&bn:e}(n);if("function"==typeof i){var a=nn(),s=ln();on(t,e);try{var u=i();if(null!=u||r&Kt.Optional)return u;throw new Error("No provider for "+Le(n))}finally{on(a,s)}}else if("number"==typeof i){var c=null,l=En(t,e),h=oe;for((-1===l||r&Kt.SkipSelf)&&(Nn(r,h=-1===l?Sn(t,e):e[l+ne])?(c=e[ue],l=We(h),e=He(h,e)):l=-1);-1!==l;){h=e[l+ne];var p=e[ue];if(In(i,l,p.data)){var f=Tn(l,e,n,c);if(f!==Rn)return f}Nn(r,h)&&In(i,l,e)?(c=p,l=We(h),e=He(h,e)):l=-1}}if(r&Kt.Optional&&void 0===o&&(o=null),0==(r&(Kt.Self|Kt.Host))){var d=e[ye];return d?d.get(n,o,r&Kt.Optional):Jt(n,o,r&Kt.Optional)}if(r&Kt.Optional)return o;throw new Error("NodeInjector: NOT_FOUND ["+Le(n)+"]")}(this._tNode,this._hostView,t)},t}();function Dn(t,e){t[Fe]=e}function Mn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}var Pn=bt({__forward_ref__:bt});function On(t){return t.__forward_ref__=On,t.toString=function(){return zt(this())},t}function Fn(t){var e=t;return"function"==typeof e&&e.hasOwnProperty(Pn)&&e.__forward_ref__===On?e():t}var Ln="__source",Bn=new Object,Un=Bn,Vn=new It("INJECTOR"),jn=function(){function t(){}return t.prototype.get=function(t,e){if(void 0===e&&(e=Bn),e===Bn)throw new Error("NullInjectorError: No provider for "+zt(t)+"!");return e},t}(),zn=function(){function t(){}return t.create=function(t,e){return Array.isArray(t)?new Zn(t,e):new Zn(t.providers,t.parent,t.name||null)},t.THROW_IF_NOT_FOUND=Bn,t.NULL=new jn,t.ngInjectableDef=Rt({providedIn:"any",factory:function(){return Zt(Vn)}}),t.__NG_ELEMENT_ID__=function(){return Wn()},t}(),Wn=Mn,Hn=function(t){return t},Gn=[],qn=Hn,$n=function(){return Array.prototype.slice.call(arguments)},Kn=bt({provide:String,useValue:bt}),Xn=zn.NULL,Qn=/\n/gm,Yn="\u0275",Zn=function(){function t(t,e,n){void 0===e&&(e=Xn),void 0===n&&(n=null),this.parent=e,this.source=n;var r=this._records=new Map;r.set(zn,{token:zn,fn:Hn,deps:Gn,value:this,useNew:!1}),r.set(Vn,{token:Vn,fn:Hn,deps:Gn,value:this,useNew:!1}),function t(e,n){if(n)if((n=Fn(n))instanceof Array)for(var r=0;r<n.length;r++)t(e,n[r]);else{if("function"==typeof n)throw er("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw er("Unexpected provider",n);var o=Fn(n.provide),i=function(t){var e=function(t){var e=Gn,n=t.deps;if(n&&n.length){e=[];for(var r=0;r<n.length;r++){var o=6;if((u=Fn(n[r]))instanceof Array)for(var i=0,a=u;i<a.length;i++){var s=a[i];s instanceof Gt||s==Gt?o|=1:s instanceof $t||s==$t?o&=-3:s instanceof qt||s==qt?o&=-5:u=s instanceof Ht?s.token:Fn(s)}e.push({token:u,options:o})}}else if(t.useExisting){var u;e=[{token:u=Fn(t.useExisting),options:6}]}else if(!(n||Kn in t))throw er("'deps' required",t);return e}(t),n=Hn,r=Gn,o=!1,i=Fn(t.provide);if(Kn in t)r=t.useValue;else if(t.useFactory)n=t.useFactory;else if(t.useExisting);else if(t.useClass)o=!0,n=Fn(t.useClass);else{if("function"!=typeof i)throw er("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);o=!0,n=i}return{deps:e,fn:n,useNew:o,value:r}}(n);if(!0===n.multi){var a=e.get(o);if(a){if(a.fn!==$n)throw Jn(o)}else e.set(o,a={token:n.provide,deps:[],useNew:!1,fn:$n,value:Gn});a.deps.push({token:o=n,options:6})}var s=e.get(o);if(s&&s.fn==$n)throw Jn(o);e.set(o,i)}}(r,t)}return t.prototype.get=function(t,e,n){void 0===n&&(n=Kt.Default);var r=this._records.get(t);try{return function t(e,n,r,o,i,a){try{return function(e,n,r,o,i,a){var s,u;if(!n||a&Kt.SkipSelf)a&Kt.Self||(u=o.get(e,i,Kt.Default));else{if((u=n.value)==qn)throw Error(Yn+"Circular dependency");if(u===Gn){n.value=qn;var c=n.useNew,l=n.fn,h=n.deps,p=Gn;if(h.length){p=[];for(var d=0;d<h.length;d++){var v=h[d],m=v.options,g=2&m?r.get(v.token):void 0;p.push(t(v.token,g,r,g||4&m?o:Xn,1&m?null:zn.THROW_IF_NOT_FOUND,Kt.Default))}}n.value=u=c?new((s=l).bind.apply(s,f([void 0],p))):l.apply(void 0,p)}}return u}(e,n,r,o,i,a)}catch(pm){throw pm instanceof Error||(pm=new Error(pm)),(pm.ngTempTokenPath=pm.ngTempTokenPath||[]).unshift(e),n&&n.value==qn&&(n.value=Gn),pm}}(t,r,this._records,this.parent,e,n)}catch(pm){var o=pm.ngTempTokenPath;throw t[Ln]&&o.unshift(t[Ln]),pm.message=tr("\n"+pm.message,o,this.source),pm.ngTokenPath=o,pm.ngTempTokenPath=null,pm}},t.prototype.toString=function(){var t=[];return this._records.forEach(function(e,n){return t.push(zt(n))}),"StaticInjector["+t.join(", ")+"]"},t}();function Jn(t){return er("Cannot mix multi providers and regular providers",t)}function tr(t,e,n){void 0===n&&(n=null),t=t&&"\n"===t.charAt(0)&&t.charAt(1)==Yn?t.substr(2):t;var r=zt(e);if(e instanceof Array)r=e.map(zt).join(" -> ");else if("object"==typeof e){var o=[];for(var i in e)if(e.hasOwnProperty(i)){var a=e[i];o.push(i+":"+("string"==typeof a?JSON.stringify(a):zt(a)))}r="{"+o.join(", ")+"}"}return"StaticInjectorError"+(n?"("+n+")":"")+"["+r+"]: "+t.replace(Qn,"\n  ")}function er(t,e){return new Error(tr(t,e))}var nr=function(){return function(){}}(),rr=function(){return function(){}}(),or="ngProjectAs";function ir(t){return!!t.listen}var ar={createRenderer:function(t,e){return document}},sr=[];function ur(t){for(var e=t[de];e&&2===e.type;)e=(t=t[le])[de];return t}function cr(t,e,n,r,o){0===t?ir(e)?e.insertBefore(n,r,o):n.insertBefore(r,o,!0):1===t?ir(e)?e.removeChild(n,r):n.removeChild(r):2===t&&e.destroyNode(r)}function lr(t){var e=t[ue].childIndex;return-1===e?null:t[e]}function hr(t,e){var n;return t.length>=se&&(n=t[de])&&2===n.type?function(e,n){if(-1===e.index){var r=t[xe];return r>-1?t[le][r]:null}return t[le][e.parent.index]}(n):t[le]===e?null:t[le]}function pr(t){if(t.length>=se){var e=t;!function(t){var e=t[ue].cleanup;if(null!=e){for(var n=0;n<e.length-1;n+=2)"string"==typeof e[n]?(Be(t[e[n+1]]).removeEventListener(e[n],t[me][e[n+2]],e[n+3]),n+=2):"number"==typeof e[n]?(0,t[me][e[n]])():e[n].call(t[me][e[n+1]]);t[me]=null}}(e),function(t){var e,n=t[ue];null!=n&&null!=(e=n.destroyHooks)&&Te(t,e)}(e),(r=(n=e)[ue]&&n[ue].pipeDestroyHooks)&&Te(n,r),-1===e[ue].id&&ir(e[we])&&e[we].destroy()}var n,r}var fr={},dr=Promise.resolve(null);function vr(t,e){var n=un(),r=dn;if(n.firstTemplatePass=!1,vn(!1),1!==e){var o=cn(),i=pn();i||function(t,e,n){16&t[ce]&&(Re(t,e.initHooks,e.checkHooks,n),t[ce]&=-17)}(t,n,o),function(e){for(var n=lr(t);null!==n;n=n[he])if(n.length<se&&-1===n[Me])for(var r=n,o=0;o<r[Pe].length;o++){var i=r[Pe][o];yr(i,i[ue],i[ge],2)}}(),function(t){if(null!=t.contentQueries)for(var e=0;e<t.contentQueries.length;e+=2){var n=t.contentQueries[e];t.data[n].contentQueriesRefresh(n-se,t.contentQueries[e+1])}}(n),i||Re(t,n.contentHooks,n.contentCheckHooks,o),function(t,e){if(t.expandoInstructions)for(var n=e[ve]=t.expandoStartIndex,r=-1,o=-1,i=0;i<t.expandoInstructions.length;i++){var a=t.expandoInstructions[i];if("number"==typeof a)if(a<=0){o=-a;var s=t.expandoInstructions[++i];r=n+=re+s}else n+=a;else e[ve]=n,rn(un().data[o+se]),a(r-se,o),r++}}(n,t)}!function(t,e,n){if(null!=t)for(var r=0;r<t.length;r++)Rr(t[r],e,n)}(n.components,r,e)}function mr(t,e,n,r,o,i,a){var s=n.blueprint.slice();return s[ce]=25|o,s[le]=s[_e]=t,s[ge]=r,s[ye]=void 0===a?t?t[ye]:null:a,s[we]=e,s[be]=i||null,s}function gr(t,e,n,r,o){var i=ln(),a=un(),s=t+se;i[s]=n;var u=a.data[s];if(null==u){var c=nn(),l=an();u=a.data[s]=Sr(i,e,s,r,o,null),c&&(!l||null!=c.child||null===u.parent&&2!==c.type?l||(c.next=u):c.child=u)}return null==a.firstChild&&3===e&&(a.firstChild=u),rn(u),sn(!0),u}function yr(t,e,n,r){var o,i=an(),a=nn();if(sn(!0),rn(null),64&t[ce])kr(function(t){for(var e=Array.isArray(t)?t:ze(t);e&&!(64&e[ce]);)e=e[le];return e}(t)[ge]);else try{sn(!0),rn(null),o=mn(t,t[de]),_r(),e.template(r,n),2&r?vr(t,null):(t[ue].firstTemplatePass=!1,vn(!1))}finally{gn(o,1==(1&r)),sn(i),rn(a)}}function wr(t,e,n,r){var o=en(),i=mn(t,t[de]);try{o.begin&&o.begin(),r&&(_r(),r(n||br(t),e)),vr(t,n)}finally{o.end&&o.end(),gn(i)}}function br(t){return 1&t[ce]?3:2}var xr=null;function _r(){xr=null}function Cr(t,e,n,r,o,i,a){var s=se+n,u=s+r,c=function(t,e){var n=new Array(e).fill(null,0,t).fill(fr,t);return n[xe]=-1,n[ve]=t,n}(s,u);return c[ue]={id:t,blueprint:c,template:e,viewQuery:a,node:null,data:c.slice(),childIndex:-1,bindingStartIndex:s,expandoStartIndex:u,expandoInstructions:null,firstTemplatePass:!0,initHooks:null,checkHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,pipeDestroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof i?i():i,firstChild:null}}function Er(t,e){!function(t){qe=t}(t);var n=t.createRenderer(null,null);return"string"==typeof e?ir(n)?n.selectRootElement(e):n.querySelector(e):e}function Sr(t,e,n,r,o,i){var a=nn(),s=an()?a:a&&a.parent,u=s&&t&&s!==t[de]?s:null;return{type:e,index:n,injectorIndex:u?u.injectorIndex:-1,flags:0,providerIndexes:0,tagName:r,attrs:o,localNames:null,initialInputs:void 0,inputs:void 0,outputs:void 0,tViews:i,next:null,child:null,parent:u,detached:null,stylingTemplate:null,projection:null}}function Rr(t,e,n){var r=Ve(t,ln());Tr(r)&&6&r[ce]&&(e&&function(t){for(var e=t[ue],n=t.length;n<e.blueprint.length;n++)t[n]=e.blueprint[n]}(r),Ar(r,r[ge],n))}function Tr(t){return 8==(8&t[ce])}function kr(t){for(var e=0;e<t.components.length;e++){var n=t.components[e];wr(ze(n),n,2)}}function Ir(t){Ar(function(t){var e,n=je(t);if(Array.isArray(n)){var r=function(t,e){var n=t[ue].components;if(n)for(var r=0;r<n.length;r++){var o=n[r];if(Ve(o,t)[ge]===e)return o}else if(Ve(se,t)[ge]===e)return se;return-1}(n,t);(o=function(t,e,n){return{lViewData:t,nodeIndex:e,native:n,component:void 0,directives:void 0,localRefs:void 0}}(n,r,(e=Ve(r,n))[fe])).component=t,Dn(t,o),Dn(o.native,o)}else{var o;e=Ve((o=n).nodeIndex,o.lViewData)}return e}(t),t,null)}function Nr(t){kr(t[ge])}function Ar(t,e,n){var r=t[ue],o=mn(t,t[de]),i=r.template,a=r.viewQuery;try{_r(),function(e,r,o,i){e&&(1===n||null===n&&1&t[ce])&&e(1,i)}(a,0,0,e),i(n||br(t),e),vr(t,n),function(e,n,r){e&&2&t[ce]&&e(2,r)}(a,0,e)}finally{gn(o,1===n)}}var Dr,Mr=dr,Pr=function(t){function e(e){var n=t.call(this,e,null,-1)||this;return n._view=e,n}return i(e,t),e.prototype.detectChanges=function(){Nr(this._view)},e.prototype.checkNoChanges=function(){!function(t){fn(!0);try{Nr(t)}finally{fn(!1)}}(this._view)},Object.defineProperty(e.prototype,"context",{get:function(){return null},enumerable:!0,configurable:!0}),e}(function(){function t(t,e,n){this._context=e,this._componentIndex=n,this._appRef=null,this._viewContainerRef=null,this._tViewNode=null,this._view=t}return Object.defineProperty(t.prototype,"rootNodes",{get:function(){return null==this._view[fe]?function t(e,n,r){for(var o=n.child;o;)r.push(Ue(o,e)),4===o.type&&t(e,o,r),o=o.next;return r}(this._view,this._view[de],[]):[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._context?this._context:this._lookUpContext()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return 32==(32&this._view[ce])},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){var t,e;this._viewContainerRef&&Tr(this._view)&&(this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),this._viewContainerRef=null),ir(e=(t=this._view)[we])&&e.destroyNode&&function(e,n,r,o,i){for(var a=t[ue].node,s=-1,u=t,c=a.child;c;){var l=null;if(3===c.type){cr(2,r,null,Ue(c,u),i);var h=u[c.index];v=h,Array.isArray(v)&&"number"==typeof v[Me]&&cr(2,r,null,h[Oe],i)}else if(0===c.type){var p=u[c.index];cr(2,r,null,p[Oe],i),p[Pe].length&&(l=(u=p[Pe][0])[ue].node,i=p[Oe])}else if(1===c.type){var f=ur(u),d=f[de].projection[c.projection];sr[++s]=c,sr[++s]=u,d&&(l=(u=f[le])[ue].data[d.index])}else l=c.child;if(null===l)for(null===c.next&&8192&c.flags&&(u=sr[s--],c=sr[s--]),l=c.next;!l;){if(null===(c=c.parent||u[ue].node)||c===a)return null;0===c.type&&(i=(u=u[le])[c.index][Oe]),l=2===c.type&&u[he]?(u=u[he])[ue].node:c.next}c=l}var v}(0,0,e),function(t){if(-1===t[ue].childIndex)return pr(t);for(var e=lr(t);e;){var n=null;if(e.length>=se?e[ue].childIndex>-1&&(n=lr(e)):e[Pe].length&&(n=e[Pe][0]),null==n){for(;e&&!e[he]&&e!==t;)pr(e),e=hr(e,t);pr(e||t),n=e&&e[he]}e=n}}(t),t[ce]|=32},t.prototype.onDestroy=function(t){var e,n;n=t,function(t){return t[me]||(t[me]=[])}(e=this._view).push(n),e[ue].firstTemplatePass&&function(t){return t[ue].cleanup||(t[ue].cleanup=[])}(e).push(e[me].length-1,null)},t.prototype.markForCheck=function(){!function(t){for(var e=t;e&&!(64&e[ce]);)e[ce]|=4,e=e[le];var n,r,o;e[ce]|=4,o=0===(n=e[ge]).flags,n.flags|=1,o&&n.clean==dr&&(n.clean=new Promise(function(t){return r=t}),n.scheduler(function(){if(1&n.flags&&(n.flags&=-2,kr(n)),2&n.flags){n.flags&=-3;var t=n.playerHandler;t&&t.flushPlayers()}n.clean=dr,r(null)}))}(this._view)},t.prototype.detach=function(){this._view[ce]&=-9},t.prototype.reattach=function(){this._view[ce]|=8},t.prototype.detectChanges=function(){var t=en();t.begin&&t.begin(),Ir(this.context),t.end&&t.end()},t.prototype.checkNoChanges=function(){!function(t){fn(!0);try{Ir(t)}finally{fn(!1)}}(this.context)},t.prototype.attachToViewContainerRef=function(t){this._viewContainerRef=t},t.prototype.detachFromAppRef=function(){this._appRef=null},t.prototype.attachToAppRef=function(t){this._appRef=t},t.prototype._lookUpContext=function(){return this._context=this._view[le][this._componentIndex]},t}());function Or(t,e,n,r,o){var i=n[ue],a=function(t,e,n){var r=nn();t.firstTemplatePass&&(n.providersResolver&&n.providersResolver(n),function(t,e,n){var o=-(r.index-se),i=t.data.length-(65535&r.providerIndexes);(t.expandoInstructions||(t.expandoInstructions=[])).push(o,i,1)}(t),function(t,e,n,r){t.data.push(n);var o=new ie(r,function(t){return null!==t.template}(n),null);t.blueprint.push(o),e.push(o),function(t,e){t.expandoInstructions.push(e.hostBindings||Mn),e.hostVars&&t.expandoInstructions.push(e.hostVars)}(t,n)}(t,e,n,n.factory));var o=kn(t.data,e,e.length-1,r);return function(t,e,n,r){var o=Ue(e,t);Dn(n,t),o&&Dn(o,t),null!=r.attributes&&3==e.type&&function(t,e){for(var n=tn(),r=ir(n),o=0;o<e.length;){var i=e[o];if(1===i)break;if(i===or)o+=2;else if(0===i){var a=e[o+1],s=e[o+2],u=e[o+3];r?n.setAttribute(t,s,u,a):t.setAttributeNS(a,s,u),o+=4}else u=e[o+1],r?n.setAttribute(t,i,u):t.setAttribute(i,u),o+=2}}(o,r.attributes)}(e,r,o,n),o}(i,n,e);return r.components.push(a),t[ge]=a,o&&o.forEach(function(t){return t(a,e)}),i.firstTemplatePass&&function(t,e,n){for(var r=0;r<n;r++)e.push(fr),t.blueprint.push(fr),t.data.push(null)}(i,n,e.hostVars),a}function Fr(t,e){return{components:[],scheduler:t||Je,clean:Mr,playerHandler:e||null,flags:0}}function Lr(t,e){var n,r,o,i,a=ze(t)[ue],s=a.data.length-1;n=s,o=e.doCheck,i=a,(r=e.onInit)&&(i.initHooks||(i.initHooks=[])).push(n,r),o&&((i.initHooks||(i.initHooks=[])).push(n,o),(i.checkHooks||(i.checkHooks=[])).push(n,o)),function(t,e){if(e.firstTemplatePass)for(var n=t>>16,r=n+(4095&t),o=n;o<r;o++){var i=e.data[o];Ce(i,e,o),Ee(i,e,o),Se(i,e,o)}}(s<<16|1,a)}var Br=new It("The presence of this token marks an injector as being the root injector."),Ur={},Vr={},jr=[],zr=void 0;function Wr(){return void 0===zr&&(zr=new jn),zr}var Hr=function(){function t(t,e,n){var r=this;this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this.destroyed=!1;var o=[];$r([t],function(t){return r.processInjectorType(t,[],o)}),e&&$r(e,function(t){return r.processProvider(t)}),this.records.set(Vn,qr(void 0,this)),this.isRootInjector=this.records.has(Br),this.injectorDefTypes.forEach(function(t){return r.get(t)})}return t.prototype.destroy=function(){this.assertNotDestroyed(),this.destroyed=!0;try{this.onDestroy.forEach(function(t){return t.ngOnDestroy()})}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}},t.prototype.get=function(t,e,n){void 0===e&&(e=Un),void 0===n&&(n=Kt.Default),this.assertNotDestroyed();var r,o=Qt(this);try{if(!(n&Kt.SkipSelf)){var i=this.records.get(t);if(void 0===i){var a=("function"==typeof(r=t)||"object"==typeof r&&r instanceof It)&&Tt(t);a&&this.injectableDefInScope(a)&&(i=qr(Gr(t),Ur),this.records.set(t,i))}if(void 0!==i)return this.hydrate(t,i)}return(n&Kt.Self?Wr():this.parent).get(t,e)}finally{Qt(o)}},t.prototype.assertNotDestroyed=function(){if(this.destroyed)throw new Error("Injector has already been destroyed.")},t.prototype.processInjectorType=function(t,e,n){var r=this;if(t=Fn(t)){var o=kt(t),i=null==o&&t.ngModule||void 0,a=void 0===i?t:i;if(-1===n.indexOf(a)){var s=void 0!==i&&t.providers||jr;if(void 0!==i&&(o=kt(i)),null!=o){if(this.injectorDefTypes.add(a),this.records.set(a,qr(o.factory)),null!=o.imports){n.push(a);try{$r(o.imports,function(t){return r.processInjectorType(t,e,n)})}finally{}}null!=o.providers&&$r(o.providers,function(t){return r.processProvider(t)}),$r(s,function(t){return r.processProvider(t)})}}}},t.prototype.processProvider=function(t){var e=Xr(t=Fn(t))?t:Fn(t.provide),n=function(t){var e=function(t){var e=void 0;if(Xr(t))return Gr(Fn(t));if(Kr(t))e=function(){return Fn(t.useValue)};else if(t.useExisting)e=function(){return Zt(Fn(t.useExisting))};else if(t.useFactory)e=function(){return t.useFactory.apply(t,f(te(t.deps||[])))};else{var n=Fn(t.useClass||t.provide);if(!t.deps)return Gr(n);e=function(){return new(n.bind.apply(n,f([void 0],te(t.deps))))}}return e}(t);return Kr(t)?qr(void 0,t.useValue):qr(e,Ur)}(t);if(Xr(t)||!0!==t.multi){var r=this.records.get(e);if(r&&void 0!==r.multi)throw new Error("Mixed multi-provider for "+zt(e))}else{var o=this.records.get(e);if(o){if(void 0===o.multi)throw new Error("Mixed multi-provider for "+e+".")}else(o=qr(void 0,Ur,!0)).factory=function(){return te(o.multi)},this.records.set(e,o);e=t,o.multi.push(t)}this.records.set(e,n)},t.prototype.hydrate=function(t,e){if(e.value===Vr)throw new Error("Circular dep for "+zt(t));var n;return e.value===Ur&&(e.value=Vr,e.value=e.factory()),"object"==typeof e.value&&e.value&&"object"==typeof(n=e.value)&&null!=n&&n.ngOnDestroy&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(e.value),e.value},t.prototype.injectableDefInScope=function(t){return!!t.providedIn&&("string"==typeof t.providedIn?"any"===t.providedIn||"root"===t.providedIn&&this.isRootInjector:this.injectorDefTypes.has(t.providedIn))},t}();function Gr(t){var e=Tt(t);if(null===e){if(t instanceof It)throw new Error("Token "+zt(t)+" is missing an ngInjectableDef definition.");return function(){return new t}}return e.factory}function qr(t,e,n){return void 0===e&&(e=Ur),void 0===n&&(n=!1),{factory:t,value:e,multi:n?[]:void 0}}function $r(t,e){t.forEach(function(t){return Array.isArray(t)?$r(t,e):e(t)})}function Kr(t){return Kn in t}function Xr(t){return"function"==typeof t}var Qr=function(){return function(){}}(),Yr=function(){return function(){}}();function Zr(t){var e=Error("No component factory found for "+zt(t)+". Did you add it to @NgModule.entryComponents?");return e[Jr]=t,e}var Jr="ngComponent",to=function(){function t(){}return t.prototype.resolveComponentFactory=function(t){throw Zr(t)},t}(),eo=function(){function t(){}return t.NULL=new to,t}(),no=function(){function t(t,e,n){this._parent=e,this._ngModule=n,this._factories=new Map;for(var r=0;r<t.length;r++){var o=t[r];this._factories.set(o.componentType,o)}}return t.prototype.resolveComponentFactory=function(t){var e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw Zr(t);return new ro(e,this._ngModule)},t}(),ro=function(t){function e(e,n){var r=t.call(this)||this;return r.factory=e,r.ngModule=n,r.selector=e.selector,r.componentType=e.componentType,r.ngContentSelectors=e.ngContentSelectors,r.inputs=e.inputs,r.outputs=e.outputs,r}return i(e,t),e.prototype.create=function(t,e,n,r){return this.factory.create(t,e,n,r||this.ngModule)},e}(Yr),oo=function(){function t(t){this.nativeElement=t}return t.__NG_ELEMENT_ID__=function(){return io(t)},t}(),io=Mn,ao=function(){return function(){}}(),so=function(){return function(){}}(),uo=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}({}),co=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return lo()},t}(),lo=Mn,ho=new(function(){return function(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}())("7.1.4"),po=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.resolveComponentFactory=function(t){return new wo(t[xt]||null)},e}(eo);function fo(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}var vo=new It("ROOT_CONTEXT_TOKEN",{providedIn:"root",factory:function(){return Fr(Zt(mo))}}),mo=new It("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return Je}}),go=new It("WRAP_RENDERER_FACTORY2"),yo={},wo=function(t){function e(e){var n=t.call(this)||this;return n.componentDef=e,n.componentType=e.type,n.selector=e.selectors[0][0],n.ngContentSelectors=[],n}return i(e,t),Object.defineProperty(e.prototype,"inputs",{get:function(){return fo(this.componentDef.inputs)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return fo(this.componentDef.outputs)},enumerable:!0,configurable:!0}),e.prototype.create=function(t,e,n,r){var o,a=void 0===n;o=r?r.injector.get(go,function(t){return t})(r.injector.get(so)):ar;var s,u,c=a?(s=this.selector,ir(u=o.createRenderer(null,this.componentDef)||tn())?u.createElement(s,xr):null===xr?u.createElement(s):u.createElementNS(xr,s)):Er(o,n),l=this.componentDef.onPush?68:66,h=r&&!a?r.injector.get(vo):Fr(),p=o.createRenderer(c,this.componentDef),f=r?function(t,e){return{get:function(n,r){var o=t.get(n,yo);return o!==yo?o:e.get(n,r)}}}(t,r.injector):t;n&&c&&(ir(p)?p.setAttribute(c,"ng-version",ho.full):c.setAttribute("ng-version",ho.full));var d,v,m=mr(null,p,Cr(-1,null,1,0,null,null,null),h,l,void 0,f),g=mn(m,null);try{o.begin&&o.begin();var y=function(t,e,n,r,o){Ke=!1,$e=null;var i,a,s,u=n[ue],c=mr(n,r,(i=e.template).ngPrivateData||(i.ngPrivateData=Cr(-1,i,e.consts,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery)),null,e.onPush?4:2,o),l=gr(0,3,t,null,null);return u.firstTemplatePass&&(a=_n(l,n),s=e.type,function(t,e,n){var r=s[St];null==r&&(r=s[St]=xn++);var o=r&bn,i=1<<o,a=64&o,u=32&o,c=e.data;128&o?a?u?c[t+7]|=i:c[t+6]|=i:u?c[t+5]|=i:c[t+4]|=i:a?u?c[t+3]|=i:c[t+2]|=i:u?c[t+1]|=i:c[t]|=i}(a,n[ue]),l.flags=4096,function(t,e,n){t.flags=e<<16|4096&t.flags|1,t.providerIndexes=e}(l,n.length),function(t){var e=un();(e.components||(e.components=[])).push(t.index)}(l)),c[fe]=n[se],c[de]=l,n[se]=c}(c,this.componentDef,m,p);if(v=m[ue].data[0+se],e)for(var w=0,b=m[ue],x=v.projection=[],_=0;_<e.length;_++){for(var C=e[_],E=null,S=null,R=0;R<C.length;R++){b.firstTemplatePass&&(b.expandoStartIndex++,b.blueprint.splice(++w+se,0,null),b.data.splice(w+se,0,null),m.splice(w+se,0,null));var T=gr(w,3,C[R],null,null);S?S.next=T:E=T,S=T}x.push(E)}d=Or(y,this.componentDef,m,h,[Lr]),vr(m,1)}finally{gn(g,!0),o.end&&o.end()}var k=new bo(this.componentType,d,function(t,e,n){return Dr||(Dr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(oo)),new Dr(Ue(e,n))}(0,v,m),m,v);return a&&(k.hostView._tViewNode.child=v),k},e}(Yr),bo=function(t){function e(e,n,r,o,i){var a=t.call(this)||this;return a.location=r,a._rootView=o,a._tNode=i,a.destroyCbs=[],a.instance=n,a.hostView=a.changeDetectorRef=new Pr(o),a.hostView._tViewNode=function(t,e){null==e[ue].node&&(e[ue].node=Sr(e,2,-1,null,null,null)),sn(!0);var n=e[ue].node;return rn(n),e[de]=n}(0,o),a.componentType=e,a}return i(e,t),Object.defineProperty(e.prototype,"injector",{get:function(){return new An(this._tNode,this._rootView)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.destroyCbs.forEach(function(t){return t()}),this.destroyCbs=null},e.prototype.onDestroy=function(t){this.destroyCbs.push(t)},e}(Qr),xo=!0,_o=!1;function Co(){return _o=!0,xo}var Eo=function(){function t(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){var e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e),this.inertBodyElement=this.inertDocument.createElement("body"),e.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(pm){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return t.prototype.getInertBodyElement_XHR=function(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(pm){return null}var e=new XMLHttpRequest;e.responseType="document",e.open("GET","data:text/html;charset=utf-8,"+t,!1),e.send(void 0);var n=e.response.body;return n.removeChild(n.firstChild),n},t.prototype.getInertBodyElement_DOMParser=function(t){t="<body><remove></remove>"+t+"</body>";try{var e=(new window.DOMParser).parseFromString(t,"text/html").body;return e.removeChild(e.firstChild),e}catch(pm){return null}},t.prototype.getInertBodyElement_InertDocument=function(t){var e=this.inertDocument.createElement("template");return"content"in e?(e.innerHTML=t,e):(this.inertBodyElement.innerHTML=t,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)},t.prototype.stripCustomNsAttrs=function(t){for(var e=t.attributes,n=e.length-1;0<n;n--){var r=e.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||t.removeAttribute(r)}for(var o=t.firstChild;o;)o.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(o),o=o.nextSibling},t}(),So=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:\/?#]*(?:[\/?#]|$))/gi,Ro=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function To(t){return(t=String(t)).match(So)||t.match(Ro)?t:(Co()&&console.warn("WARNING: sanitizing unsafe URL value "+t+" (see http://g.co/ng/security#xss)"),"unsafe:"+t)}function ko(t){var e,n,r={};try{for(var o=h(t.split(",")),i=o.next();!i.done;i=o.next())r[i.value]=!0}catch(a){e={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}function Io(){for(var t,e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o={};try{for(var i=h(n),a=i.next();!a.done;a=i.next()){var s=a.value;for(var u in s)s.hasOwnProperty(u)&&(o[u]=!0)}}catch(c){t={error:c}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return o}var No,Ao=ko("area,br,col,hr,img,wbr"),Do=ko("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Mo=ko("rp,rt"),Po=Io(Mo,Do),Oo=Io(Ao,Io(Do,ko("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Io(Mo,ko("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Po),Fo=ko("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Lo=ko("srcset"),Bo=Io(Fo,Lo,ko("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width")),Uo=function(){function t(){this.sanitizedSomething=!1,this.buf=[]}return t.prototype.sanitizeChildren=function(t){for(var e=t.firstChild,n=!0;e;)if(e.nodeType===Node.ELEMENT_NODE?n=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,n&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);var r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")},t.prototype.startElement=function(t){var e,n=t.nodeName.toLowerCase();if(!Oo.hasOwnProperty(n))return this.sanitizedSomething=!0,!1;this.buf.push("<"),this.buf.push(n);for(var r=t.attributes,o=0;o<r.length;o++){var i=r.item(o),a=i.name,s=a.toLowerCase();if(Bo.hasOwnProperty(s)){var u=i.value;Fo[s]&&(u=To(u)),Lo[s]&&(e=u,u=(e=String(e)).split(",").map(function(t){return To(t.trim())}).join(", ")),this.buf.push(" ",a,'="',zo(u),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0},t.prototype.endElement=function(t){var e=t.nodeName.toLowerCase();Oo.hasOwnProperty(e)&&!Ao.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))},t.prototype.chars=function(t){this.buf.push(zo(t))},t.prototype.checkClobberedElement=function(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: "+t.outerHTML);return e},t}(),Vo=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,jo=/([^\#-~ |!])/g;function zo(t){return t.replace(/&/g,"&amp;").replace(Vo,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(jo,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Wo(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var Ho={provide:eo,useFactory:function(){return new po},deps:[]},Go=function(t){function e(e,n){var r=t.call(this)||this;return r._bootstrapComponents=[],r.destroyCbs=[],r._bootstrapComponents=(e[Et]||null).bootstrap,r.injector=function(t,e,n){return void 0===e&&(e=null),void 0===n&&(n=null),e=e||Wr(),new Hr(t,n,e)}(e,n,[Ho,{provide:nr,useValue:r}]),r.instance=r.injector.get(e),r.componentFactoryResolver=new po,r}return i(e,t),e.prototype.destroy=function(){this.destroyCbs.forEach(function(t){return t()}),this.destroyCbs=null},e.prototype.onDestroy=function(t){this.destroyCbs.push(t)},e}(nr);!function(t){function e(e){var n=t.call(this)||this;return n.moduleType=e,n}i(e,t),e.prototype.create=function(t){return new Go(this.moduleType,t)}}(rr);var qo=function(t){function e(e){void 0===e&&(e=!1);var n=t.call(this)||this;return n.__isAsync=e,n}return i(e,t),e.prototype.emit=function(e){t.prototype.next.call(this,e)},e.prototype.subscribe=function(e,n,r){var o,i=function(t){return null},a=function(){return null};e&&"object"==typeof e?(o=this.__isAsync?function(t){setTimeout(function(){return e.next(t)})}:function(t){e.next(t)},e.error&&(i=this.__isAsync?function(t){setTimeout(function(){return e.error(t)})}:function(t){e.error(t)}),e.complete&&(a=this.__isAsync?function(){setTimeout(function(){return e.complete()})}:function(){e.complete()})):(o=this.__isAsync?function(t){setTimeout(function(){return e(t)})}:function(t){e(t)},n&&(i=this.__isAsync?function(t){setTimeout(function(){return n(t)})}:function(t){n(t)}),r&&(a=this.__isAsync?function(){setTimeout(function(){return r()})}:function(){r()}));var s=t.prototype.subscribe.call(this,o,i,a);return e instanceof C&&e.add(s),s},e}(z),$o=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return Ko(t,oo)},t}(),Ko=Mn,Xo=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}({}),Qo=function(){return function(){}}(),Yo=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),Zo=/^url\(([^)]+)\)$/;Function,String,String;var Jo="ngDebugContext",ti="ngOriginalError",ei="ngErrorLogger";function ni(t){return t[Jo]}function ri(t){return t[ti]}function oi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.error.apply(t,f(e))}var ii=function(){function t(){this._console=console}return t.prototype.handleError=function(t){var e=this._findOriginalError(t),n=this._findContext(t),r=function(t){return t[ei]||oi}(t);r(this._console,"ERROR",t),e&&r(this._console,"ORIGINAL ERROR",e),n&&r(this._console,"ERROR CONTEXT",n)},t.prototype._findContext=function(t){return t?ni(t)?ni(t):this._findContext(ri(t)):null},t.prototype._findOriginalError=function(t){for(var e=ri(t);e&&ri(e);)e=ri(e);return e},t}();function ai(t){return!!t&&"function"==typeof t.then}function si(t){return!!t&&"function"==typeof t.subscribe}var ui=new It("Application Initializer"),ci=function(){function t(t){var e=this;this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise(function(t,n){e.resolve=t,e.reject=n})}return t.prototype.runInitializers=function(){var t=this;if(!this.initialized){var e=[],n=function(){t.done=!0,t.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var o=this.appInits[r]();ai(o)&&e.push(o)}Promise.all(e).then(function(){n()}).catch(function(e){t.reject(e)}),0===e.length&&n(),this.initialized=!0}},t}(),li=new It("AppId");function hi(){return""+pi()+pi()+pi()}function pi(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var fi=new It("Platform Initializer"),di=new It("Platform ID"),vi=new It("appBootstrapListener"),mi=function(){function t(){}return t.prototype.log=function(t){console.log(t)},t.prototype.warn=function(t){console.warn(t)},t}();function gi(){throw new Error("Runtime compiler is not loaded")}var yi,wi,bi=function(){function t(){}return t.prototype.compileModuleSync=function(t){throw gi()},t.prototype.compileModuleAsync=function(t){throw gi()},t.prototype.compileModuleAndAllComponentsSync=function(t){throw gi()},t.prototype.compileModuleAndAllComponentsAsync=function(t){throw gi()},t.prototype.clearCache=function(){},t.prototype.clearCacheFor=function(t){},t.prototype.getModuleId=function(t){},t}(),xi=function(){return function(){}}();function _i(){var t=Ft.wtf;return!(!t||!(yi=t.trace)||(wi=yi.events,0))}var Ci=_i();function Ei(t,e){return null}var Si=Ci?function(t,e){return void 0===e&&(e=null),wi.createScope(t,e)}:function(t,e){return Ei},Ri=Ci?function(t,e){return yi.leaveScope(t,e),e}:function(t,e){return e},Ti=function(){function t(t){var e,n=t.enableLongStackTrace,r=void 0!==n&&n;if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new qo(!1),this.onMicrotaskEmpty=new qo(!1),this.onStable=new qo(!1),this.onError=new qo(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(e=this)._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(t,n,r,o,i,a){try{return Ai(e),t.invokeTask(r,o,i,a)}finally{Di(e)}},onInvoke:function(t,n,r,o,i,a,s){try{return Ai(e),t.invoke(r,o,i,a,s)}finally{Di(e)}},onHasTask:function(t,n,r,o){t.hasTask(r,o),n===r&&("microTask"==o.change?(e.hasPendingMicrotasks=o.microTask,Ni(e)):"macroTask"==o.change&&(e.hasPendingMacrotasks=o.macroTask))},onHandleError:function(t,n,r,o){return t.handleError(r,o),e.runOutsideAngular(function(){return e.onError.emit(o)}),!1}})}return t.isInAngularZone=function(){return!0===Zone.current.get("isAngularZone")},t.assertInAngularZone=function(){if(!t.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")},t.assertNotInAngularZone=function(){if(t.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")},t.prototype.run=function(t,e,n){return this._inner.run(t,e,n)},t.prototype.runTask=function(t,e,n,r){var o=this._inner,i=o.scheduleEventTask("NgZoneEvent: "+r,t,Ii,ki,ki);try{return o.runTask(i,e,n)}finally{o.cancelTask(i)}},t.prototype.runGuarded=function(t,e,n){return this._inner.runGuarded(t,e,n)},t.prototype.runOutsideAngular=function(t){return this._outer.run(t)},t}();function ki(){}var Ii={};function Ni(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(function(){return t.onStable.emit(null)})}finally{t.isStable=!0}}}function Ai(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Di(t){t._nesting--,Ni(t)}var Mi,Pi=function(){function t(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new qo,this.onMicrotaskEmpty=new qo,this.onStable=new qo,this.onError=new qo}return t.prototype.run=function(t){return t()},t.prototype.runGuarded=function(t){return t()},t.prototype.runOutsideAngular=function(t){return t()},t.prototype.runTask=function(t){return t()},t}(),Oi=function(){function t(t){var e=this;this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(function(){e.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}return t.prototype._watchAngularEvents=function(){var t=this;this._ngZone.onUnstable.subscribe({next:function(){t._didWork=!0,t._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){t._ngZone.onStable.subscribe({next:function(){Ti.assertNotInAngularZone(),Vt(function(){t._isZoneStable=!0,t._runCallbacksIfReady()})}})})},t.prototype.increasePendingRequestCount=function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount},t.prototype.decreasePendingRequestCount=function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount},t.prototype.isStable=function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks},t.prototype._runCallbacksIfReady=function(){var t=this;if(this.isStable())Vt(function(){for(;0!==t._callbacks.length;){var e=t._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(t._didWork)}t._didWork=!1});else{var e=this.getPendingTasks();this._callbacks=this._callbacks.filter(function(t){return!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)}),this._didWork=!0}},t.prototype.getPendingTasks=function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(function(t){return{source:t.source,creationLocation:t.creationLocation,data:t.data}}):[]},t.prototype.addCallback=function(t,e,n){var r=this,o=-1;e&&e>0&&(o=setTimeout(function(){r._callbacks=r._callbacks.filter(function(t){return t.timeoutId!==o}),t(r._didWork,r.getPendingTasks())},e)),this._callbacks.push({doneCb:t,timeoutId:o,updateCb:n})},t.prototype.whenStable=function(t,e,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(t,e,n),this._runCallbacksIfReady()},t.prototype.getPendingRequestCount=function(){return this._pendingCount},t.prototype.findProviders=function(t,e,n){return[]},t}(),Fi=function(){function t(){this._applications=new Map,Li.addToWindow(this)}return t.prototype.registerApplication=function(t,e){this._applications.set(t,e)},t.prototype.unregisterApplication=function(t){this._applications.delete(t)},t.prototype.unregisterAllApplications=function(){this._applications.clear()},t.prototype.getTestability=function(t){return this._applications.get(t)||null},t.prototype.getAllTestabilities=function(){return Array.from(this._applications.values())},t.prototype.getAllRootElements=function(){return Array.from(this._applications.keys())},t.prototype.findTestabilityInTree=function(t,e){return void 0===e&&(e=!0),Li.findTestabilityInTree(this,t,e)},s([u("design:paramtypes",[])],t)}(),Li=new(function(){function t(){}return t.prototype.addToWindow=function(t){},t.prototype.findTestabilityInTree=function(t,e,n){return null},t}()),Bi=new It("AllowMultipleToken"),Ui=function(){return function(t,e){this.name=t,this.token=e}}();function Vi(t,e,n){void 0===n&&(n=[]);var r="Platform: "+e,o=new It(r);return function(e){void 0===e&&(e=[]);var i=ji();if(!i||i.injector.get(Bi,!1))if(t)t(n.concat(e).concat({provide:o,useValue:!0}));else{var a=n.concat(e).concat({provide:o,useValue:!0});!function(t){if(Mi&&!Mi.destroyed&&!Mi.injector.get(Bi,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Mi=t.get(zi);var e=t.get(fi,null);e&&e.forEach(function(t){return t()})}(zn.create({providers:a,name:r}))}return function(t){var e=ji();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(o)}}function ji(){return Mi&&!Mi.destroyed?Mi:null}var zi=function(){function t(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return t.prototype.bootstrapModuleFactory=function(t,e){var n,r=this,o="noop"===(n=e?e.ngZone:void 0)?new Pi:("zone.js"===n?void 0:n)||new Ti({enableLongStackTrace:Co()}),i=[{provide:Ti,useValue:o}];return o.run(function(){var e=zn.create({providers:i,parent:r.injector,name:t.moduleType.name}),n=t.create(e),a=n.injector.get(ii,null);if(!a)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.onDestroy(function(){return Gi(r._modules,n)}),o.runOutsideAngular(function(){return o.onError.subscribe({next:function(t){a.handleError(t)}})}),function(t,e,o){try{var i=((a=n.injector.get(ci)).runInitializers(),a.donePromise.then(function(){return r._moduleDoBootstrap(n),n}));return ai(i)?i.catch(function(n){throw e.runOutsideAngular(function(){return t.handleError(n)}),n}):i}catch(pm){throw e.runOutsideAngular(function(){return t.handleError(pm)}),pm}var a}(a,o)})},t.prototype.bootstrapModule=function(t,e){var n=this;void 0===e&&(e=[]);var r=Wi({},e);return function(t,e,n){return t.get(xi).createCompiler([e]).compileModuleAsync(n)}(this.injector,r,t).then(function(t){return n.bootstrapModuleFactory(t,r)})},t.prototype._moduleDoBootstrap=function(t){var e=t.injector.get(Hi);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(function(t){return e.bootstrap(t)});else{if(!t.instance.ngDoBootstrap)throw new Error("The module "+zt(t.instance.constructor)+' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.');t.instance.ngDoBootstrap(e)}this._modules.push(t)},t.prototype.onDestroy=function(t){this._destroyListeners.push(t)},Object.defineProperty(t.prototype,"injector",{get:function(){return this._injector},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(t){return t.destroy()}),this._destroyListeners.forEach(function(t){return t()}),this._destroyed=!0},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),t}();function Wi(t,e){return Array.isArray(e)?e.reduce(Wi,t):a({},t,e)}var Hi=function(){function t(t,e,n,r,o,i){var a=this;this._zone=t,this._console=e,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=o,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Co(),this._zone.onMicrotaskEmpty.subscribe({next:function(){a._zone.run(function(){a.tick()})}});var s=new F(function(t){a._stable=a._zone.isStable&&!a._zone.hasPendingMacrotasks&&!a._zone.hasPendingMicrotasks,a._zone.runOutsideAngular(function(){t.next(a._stable),t.complete()})}),u=new F(function(t){var e;a._zone.runOutsideAngular(function(){e=a._zone.onStable.subscribe(function(){Ti.assertNotInAngularZone(),Vt(function(){a._stable||a._zone.hasPendingMacrotasks||a._zone.hasPendingMicrotasks||(a._stable=!0,t.next(!0))})})});var n=a._zone.onUnstable.subscribe(function(){Ti.assertInAngularZone(),a._stable&&(a._stable=!1,a._zone.runOutsideAngular(function(){t.next(!1)}))});return function(){e.unsubscribe(),n.unsubscribe()}});this.isStable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,r=null,o=t[t.length-1];return H(o)?(r=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof o&&(n=t.pop()),null===r&&1===t.length&&t[0]instanceof F?t[0]:pt(n)(at(t,r))}(s,u.pipe(function(t){return ft()((e=wt,function(t){var n;n="function"==typeof e?e:function(){return e};var r=Object.create(t,gt);return r.source=t,r.subjectFactory=n,r})(t));var e}))}var e;return e=t,t.prototype.bootstrap=function(t,e){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=t instanceof Yr?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(n.componentType);var o=n instanceof ro?null:this._injector.get(nr),i=n.create(zn.NULL,[],e||n.selector,o);i.onDestroy(function(){r._unloadComponent(i)});var a=i.injector.get(Oi,null);return a&&i.injector.get(Fi).registerApplication(i.location.nativeElement,a),this._loadComponent(i),Co()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i},t.prototype.tick=function(){var t=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var n=e._tickScope();try{this._runningTick=!0,this._views.forEach(function(t){return t.detectChanges()}),this._enforceNoNewChanges&&this._views.forEach(function(t){return t.checkNoChanges()})}catch(pm){this._zone.runOutsideAngular(function(){return t._exceptionHandler.handleError(pm)})}finally{this._runningTick=!1,Ri(n)}},t.prototype.attachView=function(t){var e=t;this._views.push(e),e.attachToAppRef(this)},t.prototype.detachView=function(t){var e=t;Gi(this._views,e),e.detachFromAppRef()},t.prototype._loadComponent=function(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(vi,[]).concat(this._bootstrapListeners).forEach(function(e){return e(t)})},t.prototype._unloadComponent=function(t){this.detachView(t.hostView),Gi(this.components,t)},t.prototype.ngOnDestroy=function(){this._views.slice().forEach(function(t){return t.destroy()})},Object.defineProperty(t.prototype,"viewCount",{get:function(){return this._views.length},enumerable:!0,configurable:!0}),t._tickScope=Si("ApplicationRef#tick()"),t}();function Gi(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}var qi=function(){return function(){}}(),$i=function(){function t(){this.dirty=!0,this._results=[],this.changes=new qo,this.length=0}return t.prototype.map=function(t){return this._results.map(t)},t.prototype.filter=function(t){return this._results.filter(t)},t.prototype.find=function(t){return this._results.find(t)},t.prototype.reduce=function(t,e){return this._results.reduce(t,e)},t.prototype.forEach=function(t){this._results.forEach(t)},t.prototype.some=function(t){return this._results.some(t)},t.prototype.toArray=function(){return this._results.slice()},t.prototype[Ut()]=function(){return this._results[Ut()]()},t.prototype.toString=function(){return this._results.toString()},t.prototype.reset=function(t){this._results=function t(e){return e.reduce(function(e,n){var r=Array.isArray(n)?t(n):n;return e.concat(r)},[])}(t),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]},t.prototype.notifyOnChanges=function(){this.changes.emit(this)},t.prototype.setDirty=function(){this.dirty=!0},t.prototype.destroy=function(){this.changes.complete(),this.changes.unsubscribe()},t}(),Ki=function(){return function(){}}(),Xi={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},Qi=function(){function t(t,e){this._compiler=t,this._config=e||Xi}return t.prototype.load=function(t){return this._compiler instanceof bi?this.loadFactory(t):this.loadAndCompile(t)},t.prototype.loadAndCompile=function(t){var e=this,r=p(t.split("#"),2),o=r[0],i=r[1];return void 0===i&&(i="default"),n("crnd")(o).then(function(t){return t[i]}).then(function(t){return Yi(t,o,i)}).then(function(t){return e._compiler.compileModuleAsync(t)})},t.prototype.loadFactory=function(t){var e=p(t.split("#"),2),r=e[0],o=e[1],i="NgFactory";return void 0===o&&(o="default",i=""),n("crnd")(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(function(t){return t[o+i]}).then(function(t){return Yi(t,r,o)})},t}();function Yi(t,e,n){if(!t)throw new Error("Cannot find '"+n+"' in '"+e+"'");return t}var Zi,Ji=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return ta(t,oo)},t}(),ta=Mn,ea=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return na()},t}(),na=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},ra=(i(function(){return null!==Zi&&Zi.apply(this,arguments)||this},Zi=ea),function(){return function(t,e){this.name=t,this.callback=e}}()),oa=function(){function t(t,e,n){this.nativeNode=t,this._debugContext=n,this.listeners=[],this.parent=null,e&&e instanceof ia&&e.addChild(this)}return Object.defineProperty(t.prototype,"injector",{get:function(){return this._debugContext.injector},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentInstance",{get:function(){return this._debugContext.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._debugContext.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){return this._debugContext.references},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){return this._debugContext.providerTokens},enumerable:!0,configurable:!0}),t}(),ia=function(t){function e(e,n,r){var o=t.call(this,e,n,r)||this;return o.properties={},o.attributes={},o.classes={},o.styles={},o.childNodes=[],o.nativeElement=e,o}return i(e,t),e.prototype.addChild=function(t){t&&(this.childNodes.push(t),t.parent=this)},e.prototype.removeChild=function(t){var e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))},e.prototype.insertChildrenAfter=function(t,e){var n,r=this,o=this.childNodes.indexOf(t);-1!==o&&((n=this.childNodes).splice.apply(n,f([o+1,0],e)),e.forEach(function(t){t.parent&&t.parent.removeChild(t),t.parent=r}))},e.prototype.insertBefore=function(t,e){var n=this.childNodes.indexOf(t);-1===n?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(n,0,e))},e.prototype.query=function(t){return this.queryAll(t)[0]||null},e.prototype.queryAll=function(t){var e=[];return function t(e,n,r){e.childNodes.forEach(function(e){e instanceof ia&&(n(e)&&r.push(e),t(e,n,r))})}(this,t,e),e},e.prototype.queryAllNodes=function(t){var e=[];return function t(e,n,r){e instanceof ia&&e.childNodes.forEach(function(e){n(e)&&r.push(e),e instanceof ia&&t(e,n,r)})}(this,t,e),e},Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes.filter(function(t){return t instanceof e})},enumerable:!0,configurable:!0}),e.prototype.triggerEventHandler=function(t,e){this.listeners.forEach(function(n){n.name==t&&n.callback(e)})},e}(oa),aa=new Map;function sa(t){return aa.get(t)||null}function ua(t){aa.set(t.nativeNode,t)}var ca=function(){function t(){}return t.prototype.supports=function(t){return Ae(t)},t.prototype.create=function(t){return new ha(t)},t}(),la=function(t,e){return e},ha=function(){function t(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||la}return t.prototype.forEachItem=function(t){var e;for(e=this._itHead;null!==e;e=e._next)t(e)},t.prototype.forEachOperation=function(t){for(var e=this._itHead,n=this._removalsHead,r=0,o=null;e||n;){var i=!n||e&&e.currentIndex<va(n,r,o)?e:n,a=va(i,r,o),s=i.currentIndex;if(i===n)r--,n=n._nextRemoved;else if(e=e._next,null==i.previousIndex)r++;else{o||(o=[]);var u=a-r,c=s-r;if(u!=c){for(var l=0;l<u;l++){var h=l<o.length?o[l]:o[l]=0,p=h+l;c<=p&&p<u&&(o[l]=h+1)}o[i.previousIndex]=c-u}}a!==s&&t(i,a,s)}},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachMovedItem=function(t){var e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.forEachIdentityChange=function(t){var e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)},t.prototype.diff=function(t){if(null==t&&(t=[]),!Ae(t))throw new Error("Error trying to diff '"+zt(t)+"'. Only arrays and iterables are allowed");return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var n,r,o,i=this._itHead,a=!1;if(Array.isArray(t)){this.length=t.length;for(var s=0;s<this.length;s++)o=this._trackByFn(s,r=t[s]),null!==i&&jt(i.trackById,o)?(a&&(i=this._verifyReinsertion(i,r,o,s)),jt(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,o,s),a=!0),i=i._next}else n=0,function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)e(t[n]);else for(var r=t[Ut()](),o=void 0;!(o=r.next()).done;)e(o.value)}(t,function(t){o=e._trackByFn(n,t),null!==i&&jt(i.trackById,o)?(a&&(i=e._verifyReinsertion(i,t,o,n)),jt(i.item,t)||e._addIdentityChange(i,t)):(i=e._mismatch(i,t,o,n),a=!0),i=i._next,n++}),this.length=n;return this._truncate(i),this.collection=t,this.isDirty},Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead},enumerable:!0,configurable:!0}),t.prototype._reset=function(){if(this.isDirty){var t=void 0,e=void 0;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}},t.prototype._mismatch=function(t,e,n,r){var o;return null===t?o=this._itTail:(o=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(jt(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,o,r)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(jt(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,o,r)):t=this._addAfter(new pa(e,n),o,r),t},t.prototype._verifyReinsertion=function(t,e,n,r){var o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==o?t=this._reinsertAfter(o,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t},t.prototype._truncate=function(t){for(;null!==t;){var e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)},t.prototype._reinsertAfter=function(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);var r=t._prevRemoved,o=t._nextRemoved;return null===r?this._removalsHead=o:r._nextRemoved=o,null===o?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(t,e,n),this._addToMoves(t,n),t},t.prototype._moveAfter=function(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t},t.prototype._addAfter=function(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t},t.prototype._insertAfter=function(t,e,n){var r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new da),this._linkedRecords.put(t),t.currentIndex=n,t},t.prototype._remove=function(t){return this._addToRemovals(this._unlink(t))},t.prototype._unlink=function(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);var e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t},t.prototype._addToMoves=function(t,e){return t.previousIndex===e?t:(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t,t)},t.prototype._addToRemovals=function(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new da),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t},t.prototype._addIdentityChange=function(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t},t}(),pa=function(){return function(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}(),fa=function(){function t(){this._head=null,this._tail=null}return t.prototype.add=function(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)},t.prototype.get=function(t,e){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&jt(n.trackById,t))return n;return null},t.prototype.remove=function(t){var e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head},t}(),da=function(){function t(){this.map=new Map}return t.prototype.put=function(t){var e=t.trackById,n=this.map.get(e);n||(n=new fa,this.map.set(e,n)),n.add(t)},t.prototype.get=function(t,e){var n=this.map.get(t);return n?n.get(t,e):null},t.prototype.remove=function(t){var e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.map.size},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.map.clear()},t}();function va(t,e,n){var r=t.previousIndex;if(null===r)return r;var o=0;return n&&r<n.length&&(o=n[r]),r+e+o}var ma=function(){function t(){}return t.prototype.supports=function(t){return t instanceof Map||De(t)},t.prototype.create=function(){return new ga},t}(),ga=function(){function t(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead},enumerable:!0,configurable:!0}),t.prototype.forEachItem=function(t){var e;for(e=this._mapHead;null!==e;e=e._next)t(e)},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachChangedItem=function(t){var e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.diff=function(t){if(t){if(!(t instanceof Map||De(t)))throw new Error("Error trying to diff '"+zt(t)+"'. Only maps and objects are allowed")}else t=new Map;return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(t,function(t,r){if(n&&n.key===r)e._maybeAddToChanges(n,t),e._appendAfter=n,n=n._next;else{var o=e._getOrCreateRecordForKey(r,t);n=e._insertBeforeOrAppend(n,o)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty},t.prototype._insertBeforeOrAppend=function(t,e){if(t){var n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null},t.prototype._getOrCreateRecordForKey=function(t,e){if(this._records.has(t)){var n=this._records.get(t);this._maybeAddToChanges(n,e);var r=n._prev,o=n._next;return r&&(r._next=o),o&&(o._prev=r),n._next=null,n._prev=null,n}var i=new ya(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i},t.prototype._reset=function(){if(this.isDirty){var t=void 0;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}},t.prototype._maybeAddToChanges=function(t,e){jt(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))},t.prototype._addToAdditions=function(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)},t.prototype._addToChanges=function(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)},t.prototype._forEach=function(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(function(n){return e(t[n],n)})},t}(),ya=function(){return function(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}(),wa=function(){function t(t){this.factories=t}return t.create=function(e,n){if(null!=n){var r=n.factories.slice();e=e.concat(r)}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return t.create(e,n)},deps:[[t,new $t,new Gt]]}},t.prototype.find=function(t){var e,n=this.factories.find(function(e){return e.supports(t)});if(null!=n)return n;throw new Error("Cannot find a differ supporting object '"+t+"' of type '"+((e=t).name||typeof e)+"'")},t.ngInjectableDef=Rt({providedIn:"root",factory:function(){return new t([new ca])}}),t}(),ba=function(){function t(t){this.factories=t}return t.create=function(e,n){if(n){var r=n.factories.slice();e=e.concat(r)}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return t.create(e,n)},deps:[[t,new $t,new Gt]]}},t.prototype.find=function(t){var e=this.factories.find(function(e){return e.supports(t)});if(e)return e;throw new Error("Cannot find a differ supporting object '"+t+"'")},t.ngInjectableDef=Rt({providedIn:"root",factory:function(){return new t([new ma])}}),t}(),xa=[new ma],_a=new wa([new ca]),Ca=new ba(xa),Ea=Vi(null,"core",[{provide:di,useValue:"unknown"},{provide:zi,deps:[zn]},{provide:Fi,deps:[]},{provide:mi,deps:[]}]),Sa=new It("LocaleId");function Ra(){return _a}function Ta(){return Ca}function ka(t){return t||"en-US"}var Ia=function(){return function(t){}}();function Na(t,e,n){var r=t.state,o=1792&r;return o===e?(t.state=-1793&r|n,t.initIndex=-1,!0):o===n}function Aa(t,e,n){return(1792&t.state)===e&&t.initIndex<=n&&(t.initIndex=n+1,!0)}function Da(t,e){return t.nodes[e]}function Ma(t,e){return t.nodes[e]}function Pa(t,e){return t.nodes[e]}function Oa(t,e){return t.nodes[e]}function Fa(t,e){return t.nodes[e]}var La={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0};function Ba(t,e,n,r){var o="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '"+e+"'. Current value: '"+n+"'.";return r&&(o+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){var n=new Error(t);return Ua(n,e),n}(o,t)}function Ua(t,e){t[Jo]=e,t[ei]=e.logError.bind(e)}function Va(t){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+t)}var ja=function(){},za=new Map;function Wa(t){var e=za.get(t);return e||(e=zt(t)+"_"+za.size,za.set(t,e)),e}var Ha="$$undefined",Ga="$$empty";function qa(t){return{id:Ha,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}var $a=0;function Ka(t,e,n,r){return!(!(2&t.state)&&jt(t.oldValues[e.bindingIndex+n],r))}function Xa(t,e,n,r){return!!Ka(t,e,n,r)&&(t.oldValues[e.bindingIndex+n]=r,!0)}function Qa(t,e,n,r){var o=t.oldValues[e.bindingIndex+n];if(1&t.state||!ke(o,r)){var i=e.bindings[n].name;throw Ba(La.createDebugContext(t,e.nodeIndex),i+": "+o,i+": "+r,0!=(1&t.state))}}function Ya(t){for(var e=t;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function Za(t,e){for(var n=t;n&&n!==e;)n.state|=64,n=n.viewContainerParent||n.parent}function Ja(t,e,n,r){try{return Ya(33554432&t.def.nodes[e].flags?Ma(t,e).componentView:t),La.handleEvent(t,e,n,r)}catch(pm){t.root.errorHandler.handleError(pm)}}function ts(t){return t.parent?Ma(t.parent,t.parentNodeDef.nodeIndex):null}function es(t){return t.parent?t.parentNodeDef.parent:null}function ns(t,e){switch(201347067&e.flags){case 1:return Ma(t,e.nodeIndex).renderElement;case 2:return Da(t,e.nodeIndex).renderText}}function rs(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function os(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function is(t){return 1<<t%32}function as(t){var e={},n=0,r={};return t&&t.forEach(function(t){var o=p(t,2),i=o[0],a=o[1];"number"==typeof i?(e[i]=a,n|=is(i)):r[i]=a}),{matchedQueries:e,references:r,matchedQueryIds:n}}function ss(t,e){return t.map(function(t){var n,r,o;return Array.isArray(t)?(o=(n=p(t,2))[0],r=n[1]):(o=0,r=t),r&&("function"==typeof r||"object"==typeof r)&&e&&Object.defineProperty(r,Ln,{value:e,configurable:!0}),{flags:o,token:r,tokenKey:Wa(r)}})}function us(t,e,n){var r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===Mt.Native?Ma(t,n.renderParent.nodeIndex).renderElement:void 0:e}var cs=new WeakMap;function ls(t){var e=cs.get(t);return e||((e=t(function(){return ja})).factory=t,cs.set(t,e)),e}function hs(t,e,n,r,o){3===e&&(n=t.renderer.parentNode(ns(t,t.def.lastRenderRootNode))),ps(t,e,0,t.def.nodes.length-1,n,r,o)}function ps(t,e,n,r,o,i,a){for(var s=n;s<=r;s++){var u=t.def.nodes[s];11&u.flags&&ds(t,u,e,o,i,a),s+=u.childCount}}function fs(t,e,n,r,o,i){for(var a=t;a&&!rs(a);)a=a.parent;for(var s=a.parent,u=es(a),c=u.nodeIndex+u.childCount,l=u.nodeIndex+1;l<=c;l++){var h=s.def.nodes[l];h.ngContentIndex===e&&ds(s,h,n,r,o,i),l+=h.childCount}if(!s.parent){var p=t.root.projectableNodes[e];if(p)for(l=0;l<p.length;l++)vs(t,p[l],n,r,o,i)}}function ds(t,e,n,r,o,i){if(8&e.flags)fs(t,e.ngContent.index,n,r,o,i);else{var a=ns(t,e);if(3===n&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&vs(t,a,n,r,o,i),32&e.bindingFlags&&vs(Ma(t,e.nodeIndex).componentView,a,n,r,o,i)):vs(t,a,n,r,o,i),16777216&e.flags)for(var s=Ma(t,e.nodeIndex).viewContainer._embeddedViews,u=0;u<s.length;u++)hs(s[u],n,r,o,i);1&e.flags&&!e.element.name&&ps(t,n,e.nodeIndex+1,e.nodeIndex+e.childCount,r,o,i)}}function vs(t,e,n,r,o,i){var a=t.renderer;switch(n){case 1:a.appendChild(r,e);break;case 2:a.insertBefore(r,e,o);break;case 3:a.removeChild(r,e);break;case 0:i.push(e)}}var ms=/^:([^:]+):(.+)$/;function gs(t){if(":"===t[0]){var e=t.match(ms);return[e[1],e[2]]}return["",t]}function ys(t){for(var e=0,n=0;n<t.length;n++)e|=t[n].flags;return e}function ws(t,e,n,r,o,i){t|=1;var a=as(e);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:a.matchedQueries,matchedQueryIds:a.matchedQueryIds,references:a.references,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:i?ls(i):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:o||ja},provider:null,text:null,query:null,ngContent:null}}function bs(t,e,n,r,o,i,a,s,u,c,l,h){var f;void 0===a&&(a=[]),c||(c=ja);var d=as(n),v=d.matchedQueries,m=d.references,g=d.matchedQueryIds,y=null,w=null;i&&(y=(f=p(gs(i),2))[0],w=f[1]),s=s||[];for(var b=new Array(s.length),x=0;x<s.length;x++){var _=p(s[x],3),C=_[0],E=_[2],S=p(gs(_[1]),2),R=S[0],T=S[1],k=void 0,I=void 0;switch(15&C){case 4:I=E;break;case 1:case 8:k=E}b[x]={flags:C,ns:R,name:T,nonMinifiedName:T,securityContext:k,suffix:I}}u=u||[];var N=new Array(u.length);for(x=0;x<u.length;x++){var A=p(u[x],2);N[x]={type:0,target:A[0],eventName:A[1],propName:null}}var D=(a=a||[]).map(function(t){var e=p(t,2),n=e[1],r=p(gs(e[0]),2);return[r[0],r[1],n]});return h=function(t){if(t&&t.id===Ha){var e=null!=t.encapsulation&&t.encapsulation!==Mt.None||t.styles.length||Object.keys(t.data).length;t.id=e?"c"+$a++:Ga}return t&&t.id===Ga&&(t=null),t||null}(h),l&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:v,matchedQueryIds:g,references:m,ngContentIndex:r,childCount:o,bindings:b,bindingFlags:ys(b),outputs:N,element:{ns:y,name:w,attrs:D,template:null,componentProvider:null,componentView:l||null,componentRendererType:h,publicProviders:null,allProviders:null,handleEvent:c||ja},provider:null,text:null,query:null,ngContent:null}}function xs(t,e,n){var r,o=n.element,i=t.root.selectorOrNode,a=t.renderer;if(t.parent||!i){r=o.name?a.createElement(o.name,o.ns):a.createComment("");var s=us(t,e,n);s&&a.appendChild(s,r)}else r=a.selectRootElement(i,!!o.componentRendererType&&o.componentRendererType.encapsulation===Mt.ShadowDom);if(o.attrs)for(var u=0;u<o.attrs.length;u++){var c=p(o.attrs[u],3);a.setAttribute(r,c[1],c[2],c[0])}return r}function _s(t,e,n,r){for(var o=0;o<n.outputs.length;o++){var i=n.outputs[o],a=Cs(t,n.nodeIndex,(h=i.eventName,(l=i.target)?l+":"+h:h)),s=i.target,u=t;"component"===i.target&&(s=null,u=e);var c=u.renderer.listen(s||r,i.eventName,a);t.disposables[n.outputIndex+o]=c}var l,h}function Cs(t,e,n){return function(r){return Ja(t,e,n,r)}}function Es(t,e,n,r){if(!Xa(t,e,n,r))return!1;var o=e.bindings[n],i=Ma(t,e.nodeIndex),a=i.renderElement,s=o.name;switch(15&o.flags){case 1:!function(t,e,n,r,o,i){var a=e.securityContext,s=a?t.root.sanitizer.sanitize(a,i):i;s=null!=s?s.toString():null;var u=t.renderer;null!=i?u.setAttribute(n,o,s,r):u.removeAttribute(n,o,r)}(t,o,a,o.ns,s,r);break;case 2:!function(t,e,n,r){var o=t.renderer;r?o.addClass(e,n):o.removeClass(e,n)}(t,a,s,r);break;case 4:!function(t,e,n,r,o){var i=t.root.sanitizer.sanitize(Xo.STYLE,o);if(null!=i){i=i.toString();var a=e.suffix;null!=a&&(i+=a)}else i=null;var s=t.renderer;null!=i?s.setStyle(n,r,i):s.removeStyle(n,r)}(t,o,a,s,r);break;case 8:!function(t,e,n,r,o){var i=e.securityContext,a=i?t.root.sanitizer.sanitize(i,o):o;t.renderer.setProperty(n,r,a)}(33554432&e.flags&&32&o.flags?i.componentView:t,o,a,s,r)}return!0}var Ss=new Object,Rs=Wa(zn),Ts=Wa(Vn),ks=Wa(nr);function Is(t,e,n,r){return n=Fn(n),{index:-1,deps:ss(r,zt(e)),flags:t,token:e,value:n}}function Ns(t,e,n){void 0===n&&(n=zn.THROW_IF_NOT_FOUND);var r,o,i=Qt(t);try{if(8&e.flags)return e.token;if(2&e.flags&&(n=null),1&e.flags)return t._parent.get(e.token,n);var a=e.tokenKey;switch(a){case Rs:case Ts:case ks:return t}var s,u=t._def.providersByKey[a];if(u){var c=t._providers[u.index];return void 0===c&&(c=t._providers[u.index]=As(t,u)),c===Ss?void 0:c}if((s=Tt(e.token))&&(r=t,null!=(o=s).providedIn&&(function(t,e){return t._def.modules.indexOf(o.providedIn)>-1}(r)||"root"===o.providedIn&&r._def.isRoot))){var l=t._providers.length;return t._def.providersByKey[e.tokenKey]={flags:5120,value:s.factory,deps:[],index:l,token:e.token},t._providers[l]=Ss,t._providers[l]=As(t,t._def.providersByKey[e.tokenKey])}return 4&e.flags?n:t._parent.get(e.token,n)}finally{Qt(i)}}function As(t,e){var n;switch(201347067&e.flags){case 512:n=function(t,e,n){var r=n.length;switch(r){case 0:return new e;case 1:return new e(Ns(t,n[0]));case 2:return new e(Ns(t,n[0]),Ns(t,n[1]));case 3:return new e(Ns(t,n[0]),Ns(t,n[1]),Ns(t,n[2]));default:for(var o=new Array(r),i=0;i<r;i++)o[i]=Ns(t,n[i]);return new(e.bind.apply(e,f([void 0],o)))}}(t,e.value,e.deps);break;case 1024:n=function(t,e,n){var r=n.length;switch(r){case 0:return e();case 1:return e(Ns(t,n[0]));case 2:return e(Ns(t,n[0]),Ns(t,n[1]));case 3:return e(Ns(t,n[0]),Ns(t,n[1]),Ns(t,n[2]));default:for(var o=Array(r),i=0;i<r;i++)o[i]=Ns(t,n[i]);return e.apply(void 0,f(o))}}(t,e.value,e.deps);break;case 2048:n=Ns(t,e.deps[0]);break;case 256:n=e.value}return n===Ss||null==n||"object"!=typeof n||131072&e.flags||"function"!=typeof n.ngOnDestroy||(e.flags|=131072),void 0===n?Ss:n}function Ds(t,e){var n=t.viewContainer._embeddedViews;if((null==e||e>=n.length)&&(e=n.length-1),e<0)return null;var r=n[e];return r.viewContainerParent=null,Fs(n,e),La.dirtyParentQueries(r),Ps(r),r}function Ms(t,e,n){var r=e?ns(e,e.def.lastRenderRootNode):t.renderElement,o=n.renderer.parentNode(r),i=n.renderer.nextSibling(r);hs(n,2,o,i,void 0)}function Ps(t){hs(t,3,null,null,void 0)}function Os(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Fs(t,e){e>=t.length-1?t.pop():t.splice(e,1)}var Ls=new Object;function Bs(t,e,n,r,o,i){return new Us(t,e,n,r,o,i)}var Us=function(t){function e(e,n,r,o,i,a){var s=t.call(this)||this;return s.selector=e,s.componentType=n,s._inputs=o,s._outputs=i,s.ngContentSelectors=a,s.viewDefFactory=r,s}return i(e,t),Object.defineProperty(e.prototype,"inputs",{get:function(){var t=[],e=this._inputs;for(var n in e)t.push({propName:n,templateName:e[n]});return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){var t=[];for(var e in this._outputs)t.push({propName:e,templateName:this._outputs[e]});return t},enumerable:!0,configurable:!0}),e.prototype.create=function(t,e,n,r){if(!r)throw new Error("ngModule should be provided");var o=ls(this.viewDefFactory),i=o.nodes[0].element.componentProvider.nodeIndex,a=La.createRootView(t,e||[],n,o,r,Ls),s=Pa(a,i).instance;return n&&a.renderer.setAttribute(Ma(a,0).renderElement,"ng-version",ho.full),new Vs(a,new Hs(a),s)},e}(Yr),Vs=function(t){function e(e,n,r){var o=t.call(this)||this;return o._view=e,o._viewRef=n,o._component=r,o._elDef=o._view.def.nodes[0],o.hostView=n,o.changeDetectorRef=n,o.instance=r,o}return i(e,t),Object.defineProperty(e.prototype,"location",{get:function(){return new oo(Ma(this._view,this._elDef.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return new Ks(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentType",{get:function(){return this._component.constructor},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._viewRef.destroy()},e.prototype.onDestroy=function(t){this._viewRef.onDestroy(t)},e}(Qr);function js(t,e,n){return new zs(t,e,n)}var zs=function(){function t(t,e,n){this._view=t,this._elDef=e,this._data=n,this._embeddedViews=[]}return Object.defineProperty(t.prototype,"element",{get:function(){return new oo(this._data.renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return new Ks(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentInjector",{get:function(){for(var t=this._view,e=this._elDef.parent;!e&&t;)e=es(t),t=t.parent;return t?new Ks(t,e):new Ks(this._view,null)},enumerable:!0,configurable:!0}),t.prototype.clear=function(){for(var t=this._embeddedViews.length-1;t>=0;t--){var e=Ds(this._data,t);La.destroyView(e)}},t.prototype.get=function(t){var e=this._embeddedViews[t];if(e){var n=new Hs(e);return n.attachToViewContainerRef(this),n}return null},Object.defineProperty(t.prototype,"length",{get:function(){return this._embeddedViews.length},enumerable:!0,configurable:!0}),t.prototype.createEmbeddedView=function(t,e,n){var r=t.createEmbeddedView(e||{});return this.insert(r,n),r},t.prototype.createComponent=function(t,e,n,r,o){var i=n||this.parentInjector;o||t instanceof ro||(o=i.get(nr));var a=t.create(i,r,void 0,o);return this.insert(a.hostView,e),a},t.prototype.insert=function(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var n,r,o,i,a=t;return i=(n=this._data).viewContainer._embeddedViews,null==(r=e)&&(r=i.length),(o=a._view).viewContainerParent=this._view,Os(i,r,o),function(t,e){var n=ts(e);if(n&&n!==t&&!(16&e.state)){e.state|=16;var r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(e),function(t,n){if(!(4&n.flags)){e.parent.def.nodeFlags|=4,n.flags|=4;for(var r=n.parent;r;)r.childFlags|=4,r=r.parent}}(0,e.parentNodeDef)}}(n,o),La.dirtyParentQueries(o),Ms(n,r>0?i[r-1]:null,o),a.attachToViewContainerRef(this),t},t.prototype.move=function(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var n,r,o,i,a,s=this._embeddedViews.indexOf(t._view);return o=e,a=(i=(n=this._data).viewContainer._embeddedViews)[r=s],Fs(i,r),null==o&&(o=i.length),Os(i,o,a),La.dirtyParentQueries(a),Ps(a),Ms(n,o>0?i[o-1]:null,a),t},t.prototype.indexOf=function(t){return this._embeddedViews.indexOf(t._view)},t.prototype.remove=function(t){var e=Ds(this._data,t);e&&La.destroyView(e)},t.prototype.detach=function(t){var e=Ds(this._data,t);return e?new Hs(e):null},t}();function Ws(t){return new Hs(t)}var Hs=function(){function t(t){this._view=t,this._viewContainerRef=null,this._appRef=null}return Object.defineProperty(t.prototype,"rootNodes",{get:function(){return hs(this._view,0,void 0,void 0,t=[]),t;var t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._view.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return 0!=(128&this._view.state)},enumerable:!0,configurable:!0}),t.prototype.markForCheck=function(){Ya(this._view)},t.prototype.detach=function(){this._view.state&=-5},t.prototype.detectChanges=function(){var t=this._view.root.rendererFactory;t.begin&&t.begin();try{La.checkAndUpdateView(this._view)}finally{t.end&&t.end()}},t.prototype.checkNoChanges=function(){La.checkNoChangesView(this._view)},t.prototype.reattach=function(){this._view.state|=4},t.prototype.onDestroy=function(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)},t.prototype.destroy=function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),La.destroyView(this._view)},t.prototype.detachFromAppRef=function(){this._appRef=null,Ps(this._view),La.dirtyParentQueries(this._view)},t.prototype.attachToAppRef=function(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t},t.prototype.attachToViewContainerRef=function(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t},t}();function Gs(t,e){return new qs(t,e)}var qs=function(t){function e(e,n){var r=t.call(this)||this;return r._parentView=e,r._def=n,r}return i(e,t),e.prototype.createEmbeddedView=function(t){return new Hs(La.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))},Object.defineProperty(e.prototype,"elementRef",{get:function(){return new oo(Ma(this._parentView,this._def.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),e}($o);function $s(t,e){return new Ks(t,e)}var Ks=function(){function t(t,e){this.view=t,this.elDef=e}return t.prototype.get=function(t,e){return void 0===e&&(e=zn.THROW_IF_NOT_FOUND),La.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:Wa(t)},e)},t}();function Xs(t){return new Qs(t.renderer)}var Qs=function(){function t(t){this.delegate=t}return t.prototype.selectRootElement=function(t){return this.delegate.selectRootElement(t)},t.prototype.createElement=function(t,e){var n=p(gs(e),2),r=this.delegate.createElement(n[1],n[0]);return t&&this.delegate.appendChild(t,r),r},t.prototype.createViewRoot=function(t){return t},t.prototype.createTemplateAnchor=function(t){var e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e},t.prototype.createText=function(t,e){var n=this.delegate.createText(e);return t&&this.delegate.appendChild(t,n),n},t.prototype.projectNodes=function(t,e){for(var n=0;n<e.length;n++)this.delegate.appendChild(t,e[n])},t.prototype.attachViewAfter=function(t,e){for(var n=this.delegate.parentNode(t),r=this.delegate.nextSibling(t),o=0;o<e.length;o++)this.delegate.insertBefore(n,e[o],r)},t.prototype.detachView=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}},t.prototype.destroyView=function(t,e){for(var n=0;n<e.length;n++)this.delegate.destroyNode(e[n])},t.prototype.listen=function(t,e,n){return this.delegate.listen(t,e,n)},t.prototype.listenGlobal=function(t,e,n){return this.delegate.listen(t,e,n)},t.prototype.setElementProperty=function(t,e,n){this.delegate.setProperty(t,e,n)},t.prototype.setElementAttribute=function(t,e,n){var r=p(gs(e),2),o=r[0],i=r[1];null!=n?this.delegate.setAttribute(t,i,n,o):this.delegate.removeAttribute(t,i,o)},t.prototype.setBindingDebugInfo=function(t,e,n){},t.prototype.setElementClass=function(t,e,n){n?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)},t.prototype.setElementStyle=function(t,e,n){null!=n?this.delegate.setStyle(t,e,n):this.delegate.removeStyle(t,e)},t.prototype.invokeElementMethod=function(t,e,n){t[e].apply(t,n)},t.prototype.setText=function(t,e){this.delegate.setValue(t,e)},t.prototype.animate=function(){throw new Error("Renderer.animate is no longer supported!")},t}();function Ys(t,e,n,r){return new Zs(t,e,n,r)}var Zs=function(){function t(t,e,n,r){this._moduleType=t,this._parent=e,this._bootstrapComponents=n,this._def=r,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(t){for(var e=t._def,n=t._providers=new Array(e.providers.length),r=0;r<e.providers.length;r++){var o=e.providers[r];4096&o.flags||void 0===n[r]&&(n[r]=As(t,o))}}(this)}return t.prototype.get=function(t,e,n){void 0===e&&(e=zn.THROW_IF_NOT_FOUND),void 0===n&&(n=Kt.Default);var r=0;return n&Kt.SkipSelf?r|=1:n&Kt.Self&&(r|=4),Ns(this,{token:t,tokenKey:Wa(t),flags:r},e)},Object.defineProperty(t.prototype,"instance",{get:function(){return this.get(this._moduleType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentFactoryResolver",{get:function(){return this.get(eo)},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){if(this._destroyed)throw new Error("The ng module "+zt(this.instance.constructor)+" has already been destroyed.");this._destroyed=!0,function(t,e){for(var n=t._def,r=new Set,o=0;o<n.providers.length;o++)if(131072&n.providers[o].flags){var i=t._providers[o];if(i&&i!==Ss){var a=i.ngOnDestroy;"function"!=typeof a||r.has(i)||(a.apply(i),r.add(i))}}}(this),this._destroyListeners.forEach(function(t){return t()})},t.prototype.onDestroy=function(t){this._destroyListeners.push(t)},t}(),Js=Wa(ao),tu=Wa(co),eu=Wa(oo),nu=Wa(Ji),ru=Wa($o),ou=Wa(ea),iu=Wa(zn),au=Wa(Vn);function su(t,e,n,r,o,i,a,s){var u=[];if(a)for(var c in a){var l=p(a[c],2);u[l[0]]={flags:8,name:c,nonMinifiedName:l[1],ns:null,securityContext:null,suffix:null}}var h=[];if(s)for(var f in s)h.push({type:1,propName:f,target:null,eventName:s[f]});return function(t,e,n,r,o,i,a,s,u){var c=as(n),l=c.matchedQueries,h=c.references,p=c.matchedQueryIds;u||(u=[]),s||(s=[]),i=Fn(i);var f=ss(a,zt(o));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:l,matchedQueryIds:p,references:h,ngContentIndex:-1,childCount:r,bindings:s,bindingFlags:ys(s),outputs:u,element:null,provider:{token:o,value:i,deps:f},text:null,query:null,ngContent:null}}(t,e|=16384,n,r,o,o,i,u,h)}function uu(t,e){return pu(t,e)}function cu(t,e){for(var n=t;n.parent&&!rs(n);)n=n.parent;return fu(n.parent,es(n),!0,e.provider.value,e.provider.deps)}function lu(t,e){var n=fu(t,e.parent,(32768&e.flags)>0,e.provider.value,e.provider.deps);if(e.outputs.length)for(var r=0;r<e.outputs.length;r++){var o=e.outputs[r],i=n[o.propName];if(!si(i))throw new Error("@Output "+o.propName+" not initialized in '"+n.constructor.name+"'.");var a=i.subscribe(hu(t,e.parent.nodeIndex,o.eventName));t.disposables[e.outputIndex+r]=a.unsubscribe.bind(a)}return n}function hu(t,e,n){return function(r){return Ja(t,e,n,r)}}function pu(t,e){var n=(8192&e.flags)>0,r=e.provider;switch(201347067&e.flags){case 512:return fu(t,e.parent,n,r.value,r.deps);case 1024:return function(t,e,n,r,o){var i=o.length;switch(i){case 0:return r();case 1:return r(vu(t,e,n,o[0]));case 2:return r(vu(t,e,n,o[0]),vu(t,e,n,o[1]));case 3:return r(vu(t,e,n,o[0]),vu(t,e,n,o[1]),vu(t,e,n,o[2]));default:for(var a=Array(i),s=0;s<i;s++)a[s]=vu(t,e,n,o[s]);return r.apply(void 0,f(a))}}(t,e.parent,n,r.value,r.deps);case 2048:return vu(t,e.parent,n,r.deps[0]);case 256:return r.value}}function fu(t,e,n,r,o){var i=o.length;switch(i){case 0:return new r;case 1:return new r(vu(t,e,n,o[0]));case 2:return new r(vu(t,e,n,o[0]),vu(t,e,n,o[1]));case 3:return new r(vu(t,e,n,o[0]),vu(t,e,n,o[1]),vu(t,e,n,o[2]));default:for(var a=new Array(i),s=0;s<i;s++)a[s]=vu(t,e,n,o[s]);return new(r.bind.apply(r,f([void 0],a)))}}var du={};function vu(t,e,n,r,o){if(void 0===o&&(o=zn.THROW_IF_NOT_FOUND),8&r.flags)return r.token;var i=t;2&r.flags&&(o=null);var a=r.tokenKey;a===ou&&(n=!(!e||!e.element.componentView)),e&&1&r.flags&&(n=!1,e=e.parent);for(var s=t;s;){if(e)switch(a){case Js:return Xs(mu(s,e,n));case tu:return mu(s,e,n).renderer;case eu:return new oo(Ma(s,e.nodeIndex).renderElement);case nu:return Ma(s,e.nodeIndex).viewContainer;case ru:if(e.element.template)return Ma(s,e.nodeIndex).template;break;case ou:return Ws(mu(s,e,n));case iu:case au:return $s(s,e);default:var u=(n?e.element.allProviders:e.element.publicProviders)[a];if(u){var c=Pa(s,u.nodeIndex);return c||(c={instance:pu(s,u)},s.nodes[u.nodeIndex]=c),c.instance}}n=rs(s),e=es(s),s=s.parent,4&r.flags&&(s=null)}var l=i.root.injector.get(r.token,du);return l!==du||o===du?l:i.root.ngModule.injector.get(r.token,o)}function mu(t,e,n){var r;if(n)r=Ma(t,e.nodeIndex).componentView;else for(r=t;r.parent&&!rs(r);)r=r.parent;return r}function gu(t,e,n,r,o,i){if(32768&n.flags){var a=Ma(t,n.parent.nodeIndex).componentView;2&a.def.flags&&(a.state|=8)}if(e.instance[n.bindings[r].name]=o,524288&n.flags){i=i||{};var s=Ie.unwrap(t.oldValues[n.bindingIndex+r]);i[n.bindings[r].nonMinifiedName]=new Ne(s,o,0!=(2&t.state))}return t.oldValues[n.bindingIndex+r]=o,i}function yu(t,e){if(t.def.nodeFlags&e)for(var n=t.def.nodes,r=0,o=0;o<n.length;o++){var i=n[o],a=i.parent;for(!a&&i.flags&e&&bu(t,o,i.flags&e,r++),0==(i.childFlags&e)&&(o+=i.childCount);a&&1&a.flags&&o===a.nodeIndex+a.childCount;)a.directChildFlags&e&&(r=wu(t,a,e,r)),a=a.parent}}function wu(t,e,n,r){for(var o=e.nodeIndex+1;o<=e.nodeIndex+e.childCount;o++){var i=t.def.nodes[o];i.flags&n&&bu(t,o,i.flags&n,r++),o+=i.childCount}return r}function bu(t,e,n,r){var o=Pa(t,e);if(o){var i=o.instance;i&&(La.setCurrentNode(t,e),1048576&n&&Aa(t,512,r)&&i.ngAfterContentInit(),2097152&n&&i.ngAfterContentChecked(),4194304&n&&Aa(t,768,r)&&i.ngAfterViewInit(),8388608&n&&i.ngAfterViewChecked(),131072&n&&i.ngOnDestroy())}}function xu(t,e,n){var r=[];for(var o in n)r.push({propName:o,bindingType:n[o]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:is(e),bindings:r},ngContent:null}}function _u(t){for(var e=t.def.nodeMatchedQueries;t.parent&&os(t);){var n=t.parentNodeDef;t=t.parent;for(var r=n.nodeIndex+n.childCount,o=0;o<=r;o++)67108864&(i=t.def.nodes[o]).flags&&536870912&i.flags&&(i.query.filterId&e)===i.query.filterId&&Fa(t,o).setDirty(),!(1&i.flags&&o+i.childCount<n.nodeIndex)&&67108864&i.childFlags&&536870912&i.childFlags||(o+=i.childCount)}if(134217728&t.def.nodeFlags)for(o=0;o<t.def.nodes.length;o++){var i;134217728&(i=t.def.nodes[o]).flags&&536870912&i.flags&&Fa(t,o).setDirty(),o+=i.childCount}}function Cu(t,e){var n=Fa(t,e.nodeIndex);if(n.dirty){var r,o=void 0;if(67108864&e.flags){var i=e.parent.parent;o=Eu(t,i.nodeIndex,i.nodeIndex+i.childCount,e.query,[]),r=Pa(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(o=Eu(t,0,t.def.nodes.length-1,e.query,[]),r=t.component);n.reset(o);for(var a=e.query.bindings,s=!1,u=0;u<a.length;u++){var c=a[u],l=void 0;switch(c.bindingType){case 0:l=n.first;break;case 1:l=n,s=!0}r[c.propName]=l}s&&n.notifyOnChanges()}}function Eu(t,e,n,r,o){for(var i=e;i<=n;i++){var a=t.def.nodes[i],s=a.matchedQueries[r.id];if(null!=s&&o.push(Su(t,a,s)),1&a.flags&&a.element.template&&(a.element.template.nodeMatchedQueries&r.filterId)===r.filterId){var u=Ma(t,i);if((a.childMatchedQueries&r.filterId)===r.filterId&&(Eu(t,i+1,i+a.childCount,r,o),i+=a.childCount),16777216&a.flags)for(var c=u.viewContainer._embeddedViews,l=0;l<c.length;l++){var h=c[l],p=ts(h);p&&p===u&&Eu(h,0,h.def.nodes.length-1,r,o)}var f=u.template._projectedViews;if(f)for(l=0;l<f.length;l++){var d=f[l];Eu(d,0,d.def.nodes.length-1,r,o)}}(a.childMatchedQueries&r.filterId)!==r.filterId&&(i+=a.childCount)}return o}function Su(t,e,n){if(null!=n)switch(n){case 1:return Ma(t,e.nodeIndex).renderElement;case 0:return new oo(Ma(t,e.nodeIndex).renderElement);case 2:return Ma(t,e.nodeIndex).template;case 3:return Ma(t,e.nodeIndex).viewContainer;case 4:return Pa(t,e.nodeIndex).instance}}function Ru(t,e,n){var r=us(t,e,n);r&&fs(t,n.ngContent.index,1,r,null,void 0)}function Tu(t,e,n){for(var r=new Array(n.length-1),o=1;o<n.length;o++)r[o-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[o]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function ku(t,e,n){var r,o=t.renderer;r=o.createText(n.text.prefix);var i=us(t,e,n);return i&&o.appendChild(i,r),{renderText:r}}function Iu(t,e){return(null!=t?t.toString():"")+e.suffix}function Nu(t,e,n,r){for(var o=0,i=0,a=0,s=0,u=0,c=null,l=null,h=!1,p=!1,f=null,d=0;d<e.length;d++){var v=e[d];if(v.nodeIndex=d,v.parent=c,v.bindingIndex=o,v.outputIndex=i,v.renderParent=l,a|=v.flags,u|=v.matchedQueryIds,v.element){var m=v.element;m.publicProviders=c?c.element.publicProviders:Object.create(null),m.allProviders=m.publicProviders,h=!1,p=!1,v.element.template&&(u|=v.element.template.nodeMatchedQueries)}if(Du(c,v,e.length),o+=v.bindings.length,i+=v.outputs.length,!l&&3&v.flags&&(f=v),20224&v.flags){h||(h=!0,c.element.publicProviders=Object.create(c.element.publicProviders),c.element.allProviders=c.element.publicProviders);var g=0!=(32768&v.flags);0==(8192&v.flags)||g?c.element.publicProviders[Wa(v.provider.token)]=v:(p||(p=!0,c.element.allProviders=Object.create(c.element.publicProviders)),c.element.allProviders[Wa(v.provider.token)]=v),g&&(c.element.componentProvider=v)}if(c?(c.childFlags|=v.flags,c.directChildFlags|=v.flags,c.childMatchedQueries|=v.matchedQueryIds,v.element&&v.element.template&&(c.childMatchedQueries|=v.element.template.nodeMatchedQueries)):s|=v.flags,v.childCount>0)c=v,Au(v)||(l=v);else for(;c&&d===c.nodeIndex+c.childCount;){var y=c.parent;y&&(y.childFlags|=c.childFlags,y.childMatchedQueries|=c.childMatchedQueries),l=(c=y)&&Au(c)?c.renderParent:c}}return{factory:null,nodeFlags:a,rootNodeFlags:s,nodeMatchedQueries:u,flags:t,nodes:e,updateDirectives:n||ja,updateRenderer:r||ja,handleEvent:function(t,n,r,o){return e[n].element.handleEvent(t,r,o)},bindingCount:o,outputCount:i,lastRenderRootNode:f}}function Au(t){return 0!=(1&t.flags)&&null===t.element.name}function Du(t,e,n){var r=e.element&&e.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index "+e.nodeIndex+"!")}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index "+e.nodeIndex+"!");if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index "+e.nodeIndex+"!");if(134217728&e.flags&&t)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index "+e.nodeIndex+"!")}if(e.childCount){var o=t?t.nodeIndex+t.childCount:n-1;if(e.nodeIndex<=o&&e.nodeIndex+e.childCount>o)throw new Error("Illegal State: childCount of node leads outside of parent, at index "+e.nodeIndex+"!")}}function Mu(t,e,n,r){var o=Fu(t.root,t.renderer,t,e,n);return Lu(o,t.component,r),Bu(o),o}function Pu(t,e,n){var r=Fu(t,t.renderer,null,null,e);return Lu(r,n,n),Bu(r),r}function Ou(t,e,n,r){var o,i=e.element.componentRendererType;return o=i?t.root.rendererFactory.createRenderer(r,i):t.root.renderer,Fu(t.root,o,t,e.element.componentProvider,n)}function Fu(t,e,n,r,o){var i=new Array(o.nodes.length),a=o.outputCount?new Array(o.outputCount):null;return{def:o,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:i,state:13,root:t,renderer:e,oldValues:new Array(o.bindingCount),disposables:a,initIndex:-1}}function Lu(t,e,n){t.component=e,t.context=n}function Bu(t){var e;rs(t)&&(e=Ma(t.parent,t.parentNodeDef.parent.nodeIndex).renderElement);for(var n=t.def,r=t.nodes,o=0;o<n.nodes.length;o++){var i=n.nodes[o];La.setCurrentNode(t,o);var a=void 0;switch(201347067&i.flags){case 1:var s=xs(t,e,i),u=void 0;if(33554432&i.flags){var c=ls(i.element.componentView);u=La.createComponentView(t,i,c,s)}_s(t,u,i,s),a={renderElement:s,componentView:u,viewContainer:null,template:i.element.template?Gs(t,i):void 0},16777216&i.flags&&(a.viewContainer=js(t,i,a));break;case 2:a=ku(t,e,i);break;case 512:case 1024:case 2048:case 256:(a=r[o])||4096&i.flags||(a={instance:uu(t,i)});break;case 16:a={instance:cu(t,i)};break;case 16384:(a=r[o])||(a={instance:lu(t,i)}),32768&i.flags&&Lu(Ma(t,i.parent.nodeIndex).componentView,a.instance,a.instance);break;case 32:case 64:case 128:a={value:void 0};break;case 67108864:case 134217728:a=new $i;break;case 8:Ru(t,e,i),a=void 0}r[o]=a}$u(t,qu.CreateViewNodes),Yu(t,201326592,268435456,0)}function Uu(t){zu(t),La.updateDirectives(t,1),Ku(t,qu.CheckNoChanges),La.updateRenderer(t,1),$u(t,qu.CheckNoChanges),t.state&=-97}function Vu(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,Na(t,0,256),zu(t),La.updateDirectives(t,0),Ku(t,qu.CheckAndUpdate),Yu(t,67108864,536870912,0);var e=Na(t,256,512);yu(t,2097152|(e?1048576:0)),La.updateRenderer(t,0),$u(t,qu.CheckAndUpdate),Yu(t,134217728,536870912,0),yu(t,8388608|((e=Na(t,512,768))?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97,Na(t,768,1024)}function ju(t,e,n,r,o,i,a,s,u,c,l,h,p){return 0===n?function(t,e,n,r,o,i,a,s,u,c,l,h){switch(201347067&e.flags){case 1:return function(t,e,n,r,o,i,a,s,u,c,l,h){var p=e.bindings.length,f=!1;return p>0&&Es(t,e,0,n)&&(f=!0),p>1&&Es(t,e,1,r)&&(f=!0),p>2&&Es(t,e,2,o)&&(f=!0),p>3&&Es(t,e,3,i)&&(f=!0),p>4&&Es(t,e,4,a)&&(f=!0),p>5&&Es(t,e,5,s)&&(f=!0),p>6&&Es(t,e,6,u)&&(f=!0),p>7&&Es(t,e,7,c)&&(f=!0),p>8&&Es(t,e,8,l)&&(f=!0),p>9&&Es(t,e,9,h)&&(f=!0),f}(t,e,n,r,o,i,a,s,u,c,l,h);case 2:return function(t,e,n,r,o,i,a,s,u,c,l,h){var p=!1,f=e.bindings,d=f.length;if(d>0&&Xa(t,e,0,n)&&(p=!0),d>1&&Xa(t,e,1,r)&&(p=!0),d>2&&Xa(t,e,2,o)&&(p=!0),d>3&&Xa(t,e,3,i)&&(p=!0),d>4&&Xa(t,e,4,a)&&(p=!0),d>5&&Xa(t,e,5,s)&&(p=!0),d>6&&Xa(t,e,6,u)&&(p=!0),d>7&&Xa(t,e,7,c)&&(p=!0),d>8&&Xa(t,e,8,l)&&(p=!0),d>9&&Xa(t,e,9,h)&&(p=!0),p){var v=e.text.prefix;d>0&&(v+=Iu(n,f[0])),d>1&&(v+=Iu(r,f[1])),d>2&&(v+=Iu(o,f[2])),d>3&&(v+=Iu(i,f[3])),d>4&&(v+=Iu(a,f[4])),d>5&&(v+=Iu(s,f[5])),d>6&&(v+=Iu(u,f[6])),d>7&&(v+=Iu(c,f[7])),d>8&&(v+=Iu(l,f[8])),d>9&&(v+=Iu(h,f[9]));var m=Da(t,e.nodeIndex).renderText;t.renderer.setValue(m,v)}return p}(t,e,n,r,o,i,a,s,u,c,l,h);case 16384:return function(t,e,n,r,o,i,a,s,u,c,l,h){var p=Pa(t,e.nodeIndex),f=p.instance,d=!1,v=void 0,m=e.bindings.length;return m>0&&Ka(t,e,0,n)&&(d=!0,v=gu(t,p,e,0,n,v)),m>1&&Ka(t,e,1,r)&&(d=!0,v=gu(t,p,e,1,r,v)),m>2&&Ka(t,e,2,o)&&(d=!0,v=gu(t,p,e,2,o,v)),m>3&&Ka(t,e,3,i)&&(d=!0,v=gu(t,p,e,3,i,v)),m>4&&Ka(t,e,4,a)&&(d=!0,v=gu(t,p,e,4,a,v)),m>5&&Ka(t,e,5,s)&&(d=!0,v=gu(t,p,e,5,s,v)),m>6&&Ka(t,e,6,u)&&(d=!0,v=gu(t,p,e,6,u,v)),m>7&&Ka(t,e,7,c)&&(d=!0,v=gu(t,p,e,7,c,v)),m>8&&Ka(t,e,8,l)&&(d=!0,v=gu(t,p,e,8,l,v)),m>9&&Ka(t,e,9,h)&&(d=!0,v=gu(t,p,e,9,h,v)),v&&f.ngOnChanges(v),65536&e.flags&&Aa(t,256,e.nodeIndex)&&f.ngOnInit(),262144&e.flags&&f.ngDoCheck(),d}(t,e,n,r,o,i,a,s,u,c,l,h);case 32:case 64:case 128:return function(t,e,n,r,o,i,a,s,u,c,l,h){var p=e.bindings,f=!1,d=p.length;if(d>0&&Xa(t,e,0,n)&&(f=!0),d>1&&Xa(t,e,1,r)&&(f=!0),d>2&&Xa(t,e,2,o)&&(f=!0),d>3&&Xa(t,e,3,i)&&(f=!0),d>4&&Xa(t,e,4,a)&&(f=!0),d>5&&Xa(t,e,5,s)&&(f=!0),d>6&&Xa(t,e,6,u)&&(f=!0),d>7&&Xa(t,e,7,c)&&(f=!0),d>8&&Xa(t,e,8,l)&&(f=!0),d>9&&Xa(t,e,9,h)&&(f=!0),f){var v=Oa(t,e.nodeIndex),m=void 0;switch(201347067&e.flags){case 32:m=new Array(p.length),d>0&&(m[0]=n),d>1&&(m[1]=r),d>2&&(m[2]=o),d>3&&(m[3]=i),d>4&&(m[4]=a),d>5&&(m[5]=s),d>6&&(m[6]=u),d>7&&(m[7]=c),d>8&&(m[8]=l),d>9&&(m[9]=h);break;case 64:m={},d>0&&(m[p[0].name]=n),d>1&&(m[p[1].name]=r),d>2&&(m[p[2].name]=o),d>3&&(m[p[3].name]=i),d>4&&(m[p[4].name]=a),d>5&&(m[p[5].name]=s),d>6&&(m[p[6].name]=u),d>7&&(m[p[7].name]=c),d>8&&(m[p[8].name]=l),d>9&&(m[p[9].name]=h);break;case 128:var g=n;switch(d){case 1:m=g.transform(n);break;case 2:m=g.transform(r);break;case 3:m=g.transform(r,o);break;case 4:m=g.transform(r,o,i);break;case 5:m=g.transform(r,o,i,a);break;case 6:m=g.transform(r,o,i,a,s);break;case 7:m=g.transform(r,o,i,a,s,u);break;case 8:m=g.transform(r,o,i,a,s,u,c);break;case 9:m=g.transform(r,o,i,a,s,u,c,l);break;case 10:m=g.transform(r,o,i,a,s,u,c,l,h)}}v.value=m}return f}(t,e,n,r,o,i,a,s,u,c,l,h);default:throw"unreachable"}}(t,e,r,o,i,a,s,u,c,l,h,p):function(t,e,n){switch(201347067&e.flags){case 1:return function(t,e,n){for(var r=!1,o=0;o<n.length;o++)Es(t,e,o,n[o])&&(r=!0);return r}(t,e,n);case 2:return function(t,e,n){for(var r=e.bindings,o=!1,i=0;i<n.length;i++)Xa(t,e,i,n[i])&&(o=!0);if(o){var a="";for(i=0;i<n.length;i++)a+=Iu(n[i],r[i]);a=e.text.prefix+a;var s=Da(t,e.nodeIndex).renderText;t.renderer.setValue(s,a)}return o}(t,e,n);case 16384:return function(t,e,n){for(var r=Pa(t,e.nodeIndex),o=r.instance,i=!1,a=void 0,s=0;s<n.length;s++)Ka(t,e,s,n[s])&&(i=!0,a=gu(t,r,e,s,n[s],a));return a&&o.ngOnChanges(a),65536&e.flags&&Aa(t,256,e.nodeIndex)&&o.ngOnInit(),262144&e.flags&&o.ngDoCheck(),i}(t,e,n);case 32:case 64:case 128:return function(t,e,n){for(var r=e.bindings,o=!1,i=0;i<n.length;i++)Xa(t,e,i,n[i])&&(o=!0);if(o){var a=Oa(t,e.nodeIndex),s=void 0;switch(201347067&e.flags){case 32:s=n;break;case 64:for(s={},i=0;i<n.length;i++)s[r[i].name]=n[i];break;case 128:var u=n[0],c=n.slice(1);s=u.transform.apply(u,f(c))}a.value=s}return o}(t,e,n);default:throw"unreachable"}}(t,e,r)}function zu(t){var e=t.def;if(4&e.nodeFlags)for(var n=0;n<e.nodes.length;n++){var r=e.nodes[n];if(4&r.flags){var o=Ma(t,n).template._projectedViews;if(o)for(var i=0;i<o.length;i++){var a=o[i];a.state|=32,Za(a,t)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function Wu(t,e,n,r,o,i,a,s,u,c,l,h,p){return 0===n?function(t,e,n,r,o,i,a,s,u,c,l,h){var p=e.bindings.length;p>0&&Qa(t,e,0,n),p>1&&Qa(t,e,1,r),p>2&&Qa(t,e,2,o),p>3&&Qa(t,e,3,i),p>4&&Qa(t,e,4,a),p>5&&Qa(t,e,5,s),p>6&&Qa(t,e,6,u),p>7&&Qa(t,e,7,c),p>8&&Qa(t,e,8,l),p>9&&Qa(t,e,9,h)}(t,e,r,o,i,a,s,u,c,l,h,p):function(t,e,n){for(var r=0;r<n.length;r++)Qa(t,e,r,n[r])}(t,e,r),!1}function Hu(t,e){if(Fa(t,e.nodeIndex).dirty)throw Ba(La.createDebugContext(t,e.nodeIndex),"Query "+e.query.id+" not dirty","Query "+e.query.id+" dirty",0!=(1&t.state))}function Gu(t){if(!(128&t.state)){if(Ku(t,qu.Destroy),$u(t,qu.Destroy),yu(t,131072),t.disposables)for(var e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(16&t.state){var e=ts(t);if(e){var n=e.template._projectedViews;n&&(Fs(n,n.indexOf(t)),La.dirtyParentQueries(t))}}}(t),t.renderer.destroyNode&&function(t){for(var e=t.def.nodes.length,n=0;n<e;n++){var r=t.def.nodes[n];1&r.flags?t.renderer.destroyNode(Ma(t,n).renderElement):2&r.flags?t.renderer.destroyNode(Da(t,n).renderText):(67108864&r.flags||134217728&r.flags)&&Fa(t,n).destroy()}}(t),rs(t)&&t.renderer.destroy(),t.state|=128}}var qu=function(t){return t[t.CreateViewNodes=0]="CreateViewNodes",t[t.CheckNoChanges=1]="CheckNoChanges",t[t.CheckNoChangesProjectedViews=2]="CheckNoChangesProjectedViews",t[t.CheckAndUpdate=3]="CheckAndUpdate",t[t.CheckAndUpdateProjectedViews=4]="CheckAndUpdateProjectedViews",t[t.Destroy=5]="Destroy",t}({});function $u(t,e){var n=t.def;if(33554432&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var o=n.nodes[r];33554432&o.flags?Xu(Ma(t,r).componentView,e):0==(33554432&o.childFlags)&&(r+=o.childCount)}}function Ku(t,e){var n=t.def;if(16777216&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var o=n.nodes[r];if(16777216&o.flags)for(var i=Ma(t,r).viewContainer._embeddedViews,a=0;a<i.length;a++)Xu(i[a],e);else 0==(16777216&o.childFlags)&&(r+=o.childCount)}}function Xu(t,e){var n=t.state;switch(e){case qu.CheckNoChanges:0==(128&n)&&(12==(12&n)?Uu(t):64&n&&Qu(t,qu.CheckNoChangesProjectedViews));break;case qu.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?Uu(t):64&n&&Qu(t,e));break;case qu.CheckAndUpdate:0==(128&n)&&(12==(12&n)?Vu(t):64&n&&Qu(t,qu.CheckAndUpdateProjectedViews));break;case qu.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?Vu(t):64&n&&Qu(t,e));break;case qu.Destroy:Gu(t);break;case qu.CreateViewNodes:Bu(t)}}function Qu(t,e){Ku(t,e),$u(t,e)}function Yu(t,e,n,r){if(t.def.nodeFlags&e&&t.def.nodeFlags&n)for(var o=t.def.nodes.length,i=0;i<o;i++){var a=t.def.nodes[i];if(a.flags&e&&a.flags&n)switch(La.setCurrentNode(t,a.nodeIndex),r){case 0:Cu(t,a);break;case 1:Hu(t,a)}a.childFlags&e&&a.childFlags&n||(i+=a.childCount)}}var Zu=!1;function Ju(t,e,n,r,o,i){var a=o.injector.get(so);return Pu(ec(t,o,a,e,n),r,i)}function tc(t,e,n,r,o,i){var a=o.injector.get(so),s=ec(t,o,new Oc(a),e,n),u=hc(r);return Mc(bc.create,Pu,null,[s,u,i])}function ec(t,e,n,r,o){var i=e.injector.get(Qo),a=e.injector.get(ii),s=n.createRenderer(null,null);return{ngModule:e,injector:t,projectableNodes:r,selectorOrNode:o,sanitizer:i,rendererFactory:n,renderer:s,errorHandler:a}}function nc(t,e,n,r){var o=hc(n);return Mc(bc.create,Mu,null,[t,e,o,r])}function rc(t,e,n,r){return n=sc.get(e.element.componentProvider.provider.token)||hc(n),Mc(bc.create,Ou,null,[t,e,n,r])}function oc(t,e,n,r){return Ys(t,e,n,function(t){var e=function(t){var e=!1,n=!1;return 0===ic.size?{hasOverrides:e,hasDeprecatedOverrides:n}:(t.providers.forEach(function(t){var r=ic.get(t.token);3840&t.flags&&r&&(e=!0,n=n||r.deprecatedBehavior)}),t.modules.forEach(function(t){ac.forEach(function(r,o){Tt(o).providedIn===t&&(e=!0,n=n||r.deprecatedBehavior)})}),{hasOverrides:e,hasDeprecatedOverrides:n})}(t),n=e.hasDeprecatedOverrides;return e.hasOverrides?(function(t){for(var e=0;e<t.providers.length;e++){var r=t.providers[e];n&&(r.flags|=4096);var o=ic.get(r.token);o&&(r.flags=-3841&r.flags|o.flags,r.deps=ss(o.deps),r.value=o.value)}if(ac.size>0){var i=new Set(t.modules);ac.forEach(function(e,r){if(i.has(Tt(r).providedIn)){var o={token:r,flags:e.flags|(n?4096:0),deps:ss(e.deps),value:e.value,index:t.providers.length};t.providers.push(o),t.providersByKey[Wa(r)]=o}})}}(t=t.factory(function(){return ja})),t):t}(r))}var ic=new Map,ac=new Map,sc=new Map;function uc(t){var e;ic.set(t.token,t),"function"==typeof t.token&&(e=Tt(t.token))&&"function"==typeof e.providedIn&&ac.set(t.token,t)}function cc(t,e){var n=ls(e.viewDefFactory),r=ls(n.nodes[0].element.componentView);sc.set(t,r)}function lc(){ic.clear(),ac.clear(),sc.clear()}function hc(t){if(0===ic.size)return t;var e=function(t){for(var e=[],n=null,r=0;r<t.nodes.length;r++){var o=t.nodes[r];1&o.flags&&(n=o),n&&3840&o.flags&&ic.has(o.provider.token)&&(e.push(n.nodeIndex),n=null)}return e}(t);if(0===e.length)return t;t=t.factory(function(){return ja});for(var n=0;n<e.length;n++)r(t,e[n]);return t;function r(t,e){for(var n=e+1;n<t.nodes.length;n++){var r=t.nodes[n];if(1&r.flags)return;if(3840&r.flags){var o=r.provider,i=ic.get(o.token);i&&(r.flags=-3841&r.flags|i.flags,o.deps=ss(i.deps),o.value=i.value)}}}}function pc(t,e,n,r,o,i,a,s,u,c,l,h,p){var f=t.def.nodes[e];return ju(t,f,n,r,o,i,a,s,u,c,l,h,p),224&f.flags?Oa(t,e).value:void 0}function fc(t,e,n,r,o,i,a,s,u,c,l,h,p){var f=t.def.nodes[e];return Wu(t,f,n,r,o,i,a,s,u,c,l,h,p),224&f.flags?Oa(t,e).value:void 0}function dc(t){return Mc(bc.detectChanges,Vu,null,[t])}function vc(t){return Mc(bc.checkNoChanges,Uu,null,[t])}function mc(t){return Mc(bc.destroy,Gu,null,[t])}var gc,yc,wc,bc=function(t){return t[t.create=0]="create",t[t.detectChanges=1]="detectChanges",t[t.checkNoChanges=2]="checkNoChanges",t[t.destroy=3]="destroy",t[t.handleEvent=4]="handleEvent",t}({});function xc(t,e){yc=t,wc=e}function _c(t,e,n,r){return xc(t,e),Mc(bc.handleEvent,t.def.handleEvent,null,[t,e,n,r])}function Cc(t,e){if(128&t.state)throw Va(bc[gc]);return xc(t,Ic(t,0)),t.def.updateDirectives(function(t,n,r){for(var o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];var a=t.def.nodes[n];return 0===e?Sc(t,a,r,o):Rc(t,a,r,o),16384&a.flags&&xc(t,Ic(t,n)),224&a.flags?Oa(t,a.nodeIndex).value:void 0},t)}function Ec(t,e){if(128&t.state)throw Va(bc[gc]);return xc(t,Nc(t,0)),t.def.updateRenderer(function(t,n,r){for(var o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];var a=t.def.nodes[n];return 0===e?Sc(t,a,r,o):Rc(t,a,r,o),3&a.flags&&xc(t,Nc(t,n)),224&a.flags?Oa(t,a.nodeIndex).value:void 0},t)}function Sc(t,e,n,r){if(ju.apply(void 0,f([t,e,n],r))){var o=1===n?r[0]:r;if(16384&e.flags){for(var i={},a=0;a<e.bindings.length;a++){var s=e.bindings[a],u=o[a];8&s.flags&&(i[(p=s.nonMinifiedName,d=void 0,d=p.replace(/[$@]/g,"_"),"ng-reflect-"+(p=d.replace(Tc,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"-"+t[1].toLowerCase()})))]=kc(u))}var c=e.parent,l=Ma(t,c.nodeIndex).renderElement;if(c.element.name)for(var h in i)null!=(u=i[h])?t.renderer.setAttribute(l,h,u):t.renderer.removeAttribute(l,h);else t.renderer.setValue(l,"bindings="+JSON.stringify(i,null,2))}}var p,d}function Rc(t,e,n,r){Wu.apply(void 0,f([t,e,n],r))}var Tc=/([A-Z])/g;function kc(t){try{return null!=t?t.toString().slice(0,30):t}catch(pm){return"[ERROR] Exception while trying to serialize the value"}}function Ic(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(16384&r.flags&&r.bindings&&r.bindings.length)return n}return null}function Nc(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(3&r.flags&&r.bindings&&r.bindings.length)return n}return null}var Ac=function(){function t(t,e){this.view=t,this.nodeIndex=e,null==e&&(this.nodeIndex=e=0),this.nodeDef=t.def.nodes[e];for(var n=this.nodeDef,r=t;n&&0==(1&n.flags);)n=n.parent;if(!n)for(;!n&&r;)n=es(r),r=r.parent;this.elDef=n,this.elView=r}return Object.defineProperty(t.prototype,"elOrCompView",{get:function(){return Ma(this.elView,this.elDef.nodeIndex).componentView||this.view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return $s(this.elView,this.elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){return this.elOrCompView.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this.elOrCompView.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){var t=[];if(this.elDef)for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&t.push(n.provider.token),e+=n.childCount}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){var t={};if(this.elDef){Dc(this.elView,this.elDef,t);for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&Dc(this.elView,n,t),e+=n.childCount}}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentRenderElement",{get:function(){var t=function(t){for(;t&&!rs(t);)t=t.parent;return t.parent?Ma(t.parent,es(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderNode",{get:function(){return 2&this.nodeDef.flags?ns(this.view,this.nodeDef):ns(this.elView,this.elDef)},enumerable:!0,configurable:!0}),t.prototype.logError=function(t){for(var e,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];2&this.nodeDef.flags?(e=this.view.def,n=this.nodeDef.nodeIndex):(e=this.elView.def,n=this.elDef.nodeIndex);var i=function(t,e){for(var n=-1,r=0;r<=e;r++)3&t.nodes[r].flags&&n++;return n}(e,n),a=-1;e.factory(function(){var e;return++a===i?(e=t.error).bind.apply(e,f([t],r)):ja}),a<i&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error.apply(t,f(r)))},t}();function Dc(t,e,n){for(var r in e.references)n[r]=Su(t,e,e.references[r])}function Mc(t,e,n,r){var o=gc,i=yc,a=wc;try{gc=t;var s=e.apply(n,r);return yc=i,wc=a,gc=o,s}catch(pm){if(ni(pm)||!yc)throw pm;throw function(t,e){return t instanceof Error||(t=new Error(t.toString())),Ua(t,e),t}(pm,Pc())}}function Pc(){return yc?new Ac(yc,wc):null}var Oc=function(){function t(t){this.delegate=t}return t.prototype.createRenderer=function(t,e){return new Fc(this.delegate.createRenderer(t,e))},t.prototype.begin=function(){this.delegate.begin&&this.delegate.begin()},t.prototype.end=function(){this.delegate.end&&this.delegate.end()},t.prototype.whenRenderingDone=function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)},t}(),Fc=function(){function t(t){this.delegate=t,this.debugContextFactory=Pc,this.data=this.delegate.data}return t.prototype.createDebugContext=function(t){return this.debugContextFactory(t)},t.prototype.destroyNode=function(t){!function(t){aa.delete(t.nativeNode)}(sa(t)),this.delegate.destroyNode&&this.delegate.destroyNode(t)},t.prototype.destroy=function(){this.delegate.destroy()},t.prototype.createElement=function(t,e){var n=this.delegate.createElement(t,e),r=this.createDebugContext(n);if(r){var o=new ia(n,null,r);o.name=t,ua(o)}return n},t.prototype.createComment=function(t){var e=this.delegate.createComment(t),n=this.createDebugContext(e);return n&&ua(new oa(e,null,n)),e},t.prototype.createText=function(t){var e=this.delegate.createText(t),n=this.createDebugContext(e);return n&&ua(new oa(e,null,n)),e},t.prototype.appendChild=function(t,e){var n=sa(t),r=sa(e);n&&r&&n instanceof ia&&n.addChild(r),this.delegate.appendChild(t,e)},t.prototype.insertBefore=function(t,e,n){var r=sa(t),o=sa(e),i=sa(n);r&&o&&r instanceof ia&&r.insertBefore(i,o),this.delegate.insertBefore(t,e,n)},t.prototype.removeChild=function(t,e){var n=sa(t),r=sa(e);n&&r&&n instanceof ia&&n.removeChild(r),this.delegate.removeChild(t,e)},t.prototype.selectRootElement=function(t,e){var n=this.delegate.selectRootElement(t,e),r=Pc()||null;return r&&ua(new ia(n,null,r)),n},t.prototype.setAttribute=function(t,e,n,r){var o=sa(t);o&&o instanceof ia&&(o.attributes[r?r+":"+e:e]=n),this.delegate.setAttribute(t,e,n,r)},t.prototype.removeAttribute=function(t,e,n){var r=sa(t);r&&r instanceof ia&&(r.attributes[n?n+":"+e:e]=null),this.delegate.removeAttribute(t,e,n)},t.prototype.addClass=function(t,e){var n=sa(t);n&&n instanceof ia&&(n.classes[e]=!0),this.delegate.addClass(t,e)},t.prototype.removeClass=function(t,e){var n=sa(t);n&&n instanceof ia&&(n.classes[e]=!1),this.delegate.removeClass(t,e)},t.prototype.setStyle=function(t,e,n,r){var o=sa(t);o&&o instanceof ia&&(o.styles[e]=n),this.delegate.setStyle(t,e,n,r)},t.prototype.removeStyle=function(t,e,n){var r=sa(t);r&&r instanceof ia&&(r.styles[e]=null),this.delegate.removeStyle(t,e,n)},t.prototype.setProperty=function(t,e,n){var r=sa(t);r&&r instanceof ia&&(r.properties[e]=n),this.delegate.setProperty(t,e,n)},t.prototype.listen=function(t,e,n){if("string"!=typeof t){var r=sa(t);r&&r.listeners.push(new ra(e,n))}return this.delegate.listen(t,e,n)},t.prototype.parentNode=function(t){return this.delegate.parentNode(t)},t.prototype.nextSibling=function(t){return this.delegate.nextSibling(t)},t.prototype.setValue=function(t,e){return this.delegate.setValue(t,e)},t}();function Lc(t,e,n){return new Bc(t,e,n)}var Bc=function(t){function e(e,n,r){var o=t.call(this)||this;return o.moduleType=e,o._bootstrapComponents=n,o._ngModuleDefFactory=r,o}return i(e,t),e.prototype.create=function(t){!function(){if(!Zu){Zu=!0;var t=Co()?{setCurrentNode:xc,createRootView:tc,createEmbeddedView:nc,createComponentView:rc,createNgModuleRef:oc,overrideProvider:uc,overrideComponentView:cc,clearOverrides:lc,checkAndUpdateView:dc,checkNoChangesView:vc,destroyView:mc,createDebugContext:function(t,e){return new Ac(t,e)},handleEvent:_c,updateDirectives:Cc,updateRenderer:Ec}:{setCurrentNode:function(){},createRootView:Ju,createEmbeddedView:Mu,createComponentView:Ou,createNgModuleRef:Ys,overrideProvider:ja,overrideComponentView:ja,clearOverrides:ja,checkAndUpdateView:Vu,checkNoChangesView:Uu,destroyView:Gu,createDebugContext:function(t,e){return new Ac(t,e)},handleEvent:function(t,e,n,r){return t.def.handleEvent(t,e,n,r)},updateDirectives:function(t,e){return t.def.updateDirectives(0===e?pc:fc,t)},updateRenderer:function(t,e){return t.def.updateRenderer(0===e?pc:fc,t)}};La.setCurrentNode=t.setCurrentNode,La.createRootView=t.createRootView,La.createEmbeddedView=t.createEmbeddedView,La.createComponentView=t.createComponentView,La.createNgModuleRef=t.createNgModuleRef,La.overrideProvider=t.overrideProvider,La.overrideComponentView=t.overrideComponentView,La.clearOverrides=t.clearOverrides,La.checkAndUpdateView=t.checkAndUpdateView,La.checkNoChangesView=t.checkNoChangesView,La.destroyView=t.destroyView,La.resolveDep=vu,La.createDebugContext=t.createDebugContext,La.handleEvent=t.handleEvent,La.updateDirectives=t.updateDirectives,La.updateRenderer=t.updateRenderer,La.dirtyParentQueries=_u}}();var e=function(t){var e=Array.from(t.providers),n=Array.from(t.modules),r={};for(var o in t.providersByKey)r[o]=t.providersByKey[o];return{factory:t.factory,isRoot:t.isRoot,providers:e,modules:n,providersByKey:r}}(ls(this._ngModuleDefFactory));return La.createNgModuleRef(this.moduleType,t||zn.NULL,this._bootstrapComponents,e)},e}(rr),Uc=function(){return function(){}}(),Vc=function(){return function(){}}(),jc=new F(function(t){return t.complete()});function zc(t){return t?function(t){return new F(function(e){return t.schedule(function(){return e.complete()})})}(t):jc}function Wc(t){var e=new F(function(e){e.next(t),e.complete()});return e._isScalar=!0,e.value=t,e}function Hc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];switch(H(n)?t.pop():n=void 0,t.length){case 0:return zc(n);case 1:return n?at(t,n):Wc(t[0]);default:return at(t,n)}}var Gc=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return i(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new U;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(z);function qc(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}qc.prototype=Object.create(Error.prototype);var $c=qc,Kc={},Xc=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Qc(t,this.resultSelector))},t}(),Qc=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return i(e,t),e.prototype._next=function(t){this.values.push(Kc),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(et(this,r,r,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,o){var i=this.values,a=this.toRespond?i[n]===Kc?--this.toRespond:this.toRespond:0;i[n]=e,0===a&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)},e}(nt);function Yc(t){return new F(function(e){var n;try{n=t()}catch(r){return void e.error(r)}return(n?st(n):zc()).subscribe(e)})}function Zc(){return pt(1)}function Jc(t,e){return function(n){return n.lift(new tl(t,e))}}var tl=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new el(t,this.predicate,this.thisArg))},t}(),el=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.predicate=n,o.thisArg=r,o.count=0,o}return i(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)},e}(N);function nl(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}nl.prototype=Object.create(Error.prototype);var rl=nl;function ol(t){return function(e){return 0===t?zc():e.lift(new il(t))}}var il=function(){function t(t){if(this.total=t,this.total<0)throw new rl}return t.prototype.call=function(t,e){return e.subscribe(new al(t,this.total))},t}(),al=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.ring=new Array,r.count=0,r}return i(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,o=0;o<n;o++){var i=e++%n;t.next(r[i])}t.complete()},e}(N);function sl(t,e,n){return function(r){return r.lift(new ul(t,e,n))}}var ul=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new cl(t,this.nextOrObserver,this.error,this.complete))},t}(),cl=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i._tapNext=M,i._tapError=M,i._tapComplete=M,i._tapError=r||M,i._tapComplete=o||M,m(n)?(i._context=i,i._tapNext=n):n&&(i._context=n,i._tapNext=n.next||M,i._tapError=n.error||M,i._tapComplete=n.complete||M),i}return i(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(N),ll=function(t){return void 0===t&&(t=hl),sl({hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw t()}})};function hl(){return new $c}function pl(t){return void 0===t&&(t=null),function(e){return e.lift(new fl(t))}}var fl=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new dl(t,this.defaultValue))},t}(),dl=function(t){function e(e,n){var r=t.call(this,e)||this;return r.defaultValue=n,r.isEmpty=!0,r}return i(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(N);function vl(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?Jc(function(e,n){return t(e,n,r)}):ht,ol(1),n?pl(e):ll(function(){return new $c}))}}function ml(t){return function(e){var n=new gl(t),r=e.lift(n);return n.caught=r}}var gl=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new yl(t,this.selector,this.caught))},t}(),yl=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.selector=n,o.caught=r,o}return i(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(o){return void t.prototype.error.call(this,o)}this._unsubscribeAndRecycle();var r=new G(this,void 0,void 0);this.add(r),et(this,n,void 0,void 0,r)}},e}(nt);function wl(t){return function(e){return 0===t?zc():e.lift(new bl(t))}}var bl=function(){function t(t){if(this.total=t,this.total<0)throw new rl}return t.prototype.call=function(t,e){return e.subscribe(new xl(t,this.total))},t}(),xl=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return i(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(N);function _l(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?Jc(function(e,n){return t(e,n,r)}):ht,wl(1),n?pl(e):ll(function(){return new $c}))}}var Cl=function(){function t(t,e,n){this.predicate=t,this.thisArg=e,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new El(t,this.predicate,this.thisArg,this.source))},t}(),El=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.source=o,i.index=0,i.thisArg=r||i,i}return i(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(n){return void this.destination.error(n)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(N);function Sl(t,e){return"function"==typeof e?function(n){return n.pipe(Sl(function(n,r){return st(t(n,r)).pipe(rt(function(t,o){return e(n,t,r,o)}))}))}:function(e){return e.lift(new Rl(t))}}var Rl=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Tl(t,this.project))},t}(),Tl=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}return i(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=this.innerSubscription;r&&r.unsubscribe();var o=new G(this,void 0,void 0);this.destination.add(o),this.innerSubscription=et(this,t,e,n,o)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=null},e.prototype.notifyComplete=function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e}(nt);function kl(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Il(t,e,n))}}var Il=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new Nl(t,this.accumulator,this.seed,this.hasSeed))},t}(),Nl=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i.accumulator=n,i._seed=r,i.hasSeed=o,i.index=0,i}return i(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(r){this.destination.error(r)}this.seed=e,this.destination.next(e)},e}(N);function Al(t,e){return ut(t,e,1)}var Dl=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new Ml(t,this.callback))},t}(),Ml=function(t){function e(e,n){var r=t.call(this,e)||this;return r.add(new C(n)),r}return i(e,t),e}(N),Pl=function(){return function(){}}(),Ol=new It("Location Initialized"),Fl=function(){return function(){}}(),Ll=new It("appBaseHref"),Bl=function(){function t(t){var n=this;this._subject=new qo,this._platformStrategy=t;var r=this._platformStrategy.getBaseHref();this._baseHref=e.stripTrailingSlash(Ul(r)),this._platformStrategy.onPopState(function(t){n._subject.emit({url:n.path(!0),pop:!0,state:t.state,type:t.type})})}var e;return e=t,t.prototype.path=function(t){return void 0===t&&(t=!1),this.normalize(this._platformStrategy.path(t))},t.prototype.isCurrentPathEqualTo=function(t,n){return void 0===n&&(n=""),this.path()==this.normalize(t+e.normalizeQueryParams(n))},t.prototype.normalize=function(t){return e.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,Ul(t)))},t.prototype.prepareExternalUrl=function(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)},t.prototype.go=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n=null),this._platformStrategy.pushState(n,"",t,e)},t.prototype.replaceState=function(t,e,n){void 0===e&&(e=""),void 0===n&&(n=null),this._platformStrategy.replaceState(n,"",t,e)},t.prototype.forward=function(){this._platformStrategy.forward()},t.prototype.back=function(){this._platformStrategy.back()},t.prototype.subscribe=function(t,e,n){return this._subject.subscribe({next:t,error:e,complete:n})},t.normalizeQueryParams=function(t){return t&&"?"!==t[0]?"?"+t:t},t.joinWithSlash=function(t,e){if(0==t.length)return e;if(0==e.length)return t;var n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e},t.stripTrailingSlash=function(t){var e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)},t}();function Ul(t){return t.replace(/\/index.html$/,"")}var Vl=function(t){function e(e,n){var r=t.call(this)||this;return r._platformLocation=e,r._baseHref="",null!=n&&(r._baseHref=n),r}return i(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e},e.prototype.prepareExternalUrl=function(t){var e=Bl.joinWithSlash(this._baseHref,t);return e.length>0?"#"+e:e},e.prototype.pushState=function(t,e,n,r){var o=this.prepareExternalUrl(n+Bl.normalizeQueryParams(r));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,e,o)},e.prototype.replaceState=function(t,e,n,r){var o=this.prepareExternalUrl(n+Bl.normalizeQueryParams(r));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,o)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(Fl),jl=function(t){function e(e,n){var r=t.call(this)||this;if(r._platformLocation=e,null==n&&(n=r._platformLocation.getBaseHrefFromDOM()),null==n)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return r._baseHref=n,r}return i(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.prepareExternalUrl=function(t){return Bl.joinWithSlash(this._baseHref,t)},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.pathname+Bl.normalizeQueryParams(this._platformLocation.search),n=this._platformLocation.hash;return n&&t?""+e+n:e},e.prototype.pushState=function(t,e,n,r){var o=this.prepareExternalUrl(n+Bl.normalizeQueryParams(r));this._platformLocation.pushState(t,e,o)},e.prototype.replaceState=function(t,e,n,r){var o=this.prepareExternalUrl(n+Bl.normalizeQueryParams(r));this._platformLocation.replaceState(t,e,o)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(Fl),zl=void 0,Wl=["en",[["a","p"],["AM","PM"],zl],[["AM","PM"],zl,zl],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],zl,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],zl,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",zl,"{1} 'at' {0}",zl],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(t){var e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}],Hl={},Gl=function(t){return t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Two=2]="Two",t[t.Few=3]="Few",t[t.Many=4]="Many",t[t.Other=5]="Other",t}({}),ql=new It("UseV4Plurals"),$l=function(){return function(){}}(),Kl=function(t){function e(e,n){var r=t.call(this)||this;return r.locale=e,r.deprecatedPluralFn=n,r}return i(e,t),e.prototype.getPluralCategory=function(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){var e=t.toLowerCase().replace(/_/g,"-"),n=Hl[e];if(n)return n;var r=e.split("-")[0];if(n=Hl[r])return n;if("en"===r)return Wl;throw new Error('Missing locale data for the locale "'+t+'".')}(t)[18]}(e||this.locale)(t)){case Gl.Zero:return"zero";case Gl.One:return"one";case Gl.Two:return"two";case Gl.Few:return"few";case Gl.Many:return"many";default:return"other"}},e}($l),Xl=function(){function t(t,e){this._viewContainer=t,this._context=new Ql,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}return Object.defineProperty(t.prototype,"ngIf",{set:function(t){this._context.$implicit=this._context.ngIf=t,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfThen",{set:function(t){Yl("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfElse",{set:function(t){Yl("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),t.prototype._updateView=function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))},t.ngTemplateGuard_ngIf=function(t,e){return!0},t}(),Ql=function(){return function(){this.$implicit=null,this.ngIf=null}}();function Yl(t,e){if(e&&!e.createEmbeddedView)throw new Error(t+" must be a TemplateRef, but received '"+zt(e)+"'.")}var Zl=function(){return function(){}}(),Jl=new It("DocumentToken"),th="server",eh=function(){function t(){}return t.ngInjectableDef=Rt({providedIn:"root",factory:function(){return new nh(Zt(Jl),window)}}),t}(),nh=function(){function t(t,e){this.document=t,this.window=e,this.offset=function(){return[0,0]}}return t.prototype.setOffset=function(t){this.offset=Array.isArray(t)?function(){return t}:t},t.prototype.getScrollPosition=function(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]},t.prototype.scrollToPosition=function(t){this.supportScrollRestoration()&&this.window.scrollTo(t[0],t[1])},t.prototype.scrollToAnchor=function(t){if(this.supportScrollRestoration()){var e=this.document.querySelector("#"+t);if(e)return void this.scrollToElement(e);var n=this.document.querySelector("[name='"+t+"']");if(n)return void this.scrollToElement(n)}},t.prototype.setHistoryScrollRestoration=function(t){if(this.supportScrollRestoration()){var e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}},t.prototype.scrollToElement=function(t){var e=t.getBoundingClientRect(),n=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(n-o[0],r-o[1])},t.prototype.supportScrollRestoration=function(){try{return!!this.window&&!!this.window.scrollTo}catch(pm){return!1}},t}(),rh=null;function oh(){return rh}var ih,ah={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},sh={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},uh={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"};Ft.Node&&(ih=Ft.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))});var ch,lh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.parse=function(t){throw new Error("parse not implemented")},e.makeCurrent=function(){var t;t=new e,rh||(rh=t)},e.prototype.hasProperty=function(t,e){return e in t},e.prototype.setProperty=function(t,e,n){t[e]=n},e.prototype.getProperty=function(t,e){return t[e]},e.prototype.invoke=function(t,e,n){var r;(r=t)[e].apply(r,f(n))},e.prototype.logError=function(t){window.console&&(console.error?console.error(t):console.log(t))},e.prototype.log=function(t){window.console&&window.console.log&&window.console.log(t)},e.prototype.logGroup=function(t){window.console&&window.console.group&&window.console.group(t)},e.prototype.logGroupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},Object.defineProperty(e.prototype,"attrToPropMap",{get:function(){return ah},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){return ih.call(t,e)},e.prototype.querySelector=function(t,e){return t.querySelector(e)},e.prototype.querySelectorAll=function(t,e){return t.querySelectorAll(e)},e.prototype.on=function(t,e,n){t.addEventListener(e,n,!1)},e.prototype.onAndCancel=function(t,e,n){return t.addEventListener(e,n,!1),function(){t.removeEventListener(e,n,!1)}},e.prototype.dispatchEvent=function(t,e){t.dispatchEvent(e)},e.prototype.createMouseEvent=function(t){var e=this.getDefaultDocument().createEvent("MouseEvent");return e.initEvent(t,!0,!0),e},e.prototype.createEvent=function(t){var e=this.getDefaultDocument().createEvent("Event");return e.initEvent(t,!0,!0),e},e.prototype.preventDefault=function(t){t.preventDefault(),t.returnValue=!1},e.prototype.isPrevented=function(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue},e.prototype.getInnerHTML=function(t){return t.innerHTML},e.prototype.getTemplateContent=function(t){return"content"in t&&this.isTemplateElement(t)?t.content:null},e.prototype.getOuterHTML=function(t){return t.outerHTML},e.prototype.nodeName=function(t){return t.nodeName},e.prototype.nodeValue=function(t){return t.nodeValue},e.prototype.type=function(t){return t.type},e.prototype.content=function(t){return this.hasProperty(t,"content")?t.content:t},e.prototype.firstChild=function(t){return t.firstChild},e.prototype.nextSibling=function(t){return t.nextSibling},e.prototype.parentElement=function(t){return t.parentNode},e.prototype.childNodes=function(t){return t.childNodes},e.prototype.childNodesAsList=function(t){for(var e=t.childNodes,n=new Array(e.length),r=0;r<e.length;r++)n[r]=e[r];return n},e.prototype.clearNodes=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},e.prototype.appendChild=function(t,e){t.appendChild(e)},e.prototype.removeChild=function(t,e){t.removeChild(e)},e.prototype.replaceChild=function(t,e,n){t.replaceChild(e,n)},e.prototype.remove=function(t){return t.parentNode&&t.parentNode.removeChild(t),t},e.prototype.insertBefore=function(t,e,n){t.insertBefore(n,e)},e.prototype.insertAllBefore=function(t,e,n){n.forEach(function(n){return t.insertBefore(n,e)})},e.prototype.insertAfter=function(t,e,n){t.insertBefore(n,e.nextSibling)},e.prototype.setInnerHTML=function(t,e){t.innerHTML=e},e.prototype.getText=function(t){return t.textContent},e.prototype.setText=function(t,e){t.textContent=e},e.prototype.getValue=function(t){return t.value},e.prototype.setValue=function(t,e){t.value=e},e.prototype.getChecked=function(t){return t.checked},e.prototype.setChecked=function(t,e){t.checked=e},e.prototype.createComment=function(t){return this.getDefaultDocument().createComment(t)},e.prototype.createTemplate=function(t){var e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e},e.prototype.createElement=function(t,e){return(e=e||this.getDefaultDocument()).createElement(t)},e.prototype.createElementNS=function(t,e,n){return(n=n||this.getDefaultDocument()).createElementNS(t,e)},e.prototype.createTextNode=function(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)},e.prototype.createScriptTag=function(t,e,n){var r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(t,e),r},e.prototype.createStyleElement=function(t,e){var n=(e=e||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(t,e)),n},e.prototype.createShadowRoot=function(t){return t.createShadowRoot()},e.prototype.getShadowRoot=function(t){return t.shadowRoot},e.prototype.getHost=function(t){return t.host},e.prototype.clone=function(t){return t.cloneNode(!0)},e.prototype.getElementsByClassName=function(t,e){return t.getElementsByClassName(e)},e.prototype.getElementsByTagName=function(t,e){return t.getElementsByTagName(e)},e.prototype.classList=function(t){return Array.prototype.slice.call(t.classList,0)},e.prototype.addClass=function(t,e){t.classList.add(e)},e.prototype.removeClass=function(t,e){t.classList.remove(e)},e.prototype.hasClass=function(t,e){return t.classList.contains(e)},e.prototype.setStyle=function(t,e,n){t.style[e]=n},e.prototype.removeStyle=function(t,e){t.style[e]=""},e.prototype.getStyle=function(t,e){return t.style[e]},e.prototype.hasStyle=function(t,e,n){var r=this.getStyle(t,e)||"";return n?r==n:r.length>0},e.prototype.tagName=function(t){return t.tagName},e.prototype.attributeMap=function(t){for(var e=new Map,n=t.attributes,r=0;r<n.length;r++){var o=n.item(r);e.set(o.name,o.value)}return e},e.prototype.hasAttribute=function(t,e){return t.hasAttribute(e)},e.prototype.hasAttributeNS=function(t,e,n){return t.hasAttributeNS(e,n)},e.prototype.getAttribute=function(t,e){return t.getAttribute(e)},e.prototype.getAttributeNS=function(t,e,n){return t.getAttributeNS(e,n)},e.prototype.setAttribute=function(t,e,n){t.setAttribute(e,n)},e.prototype.setAttributeNS=function(t,e,n,r){t.setAttributeNS(e,n,r)},e.prototype.removeAttribute=function(t,e){t.removeAttribute(e)},e.prototype.removeAttributeNS=function(t,e,n){t.removeAttributeNS(e,n)},e.prototype.templateAwareRoot=function(t){return this.isTemplateElement(t)?this.content(t):t},e.prototype.createHtmlDocument=function(){return document.implementation.createHTMLDocument("fakeTitle")},e.prototype.getDefaultDocument=function(){return document},e.prototype.getBoundingClientRect=function(t){try{return t.getBoundingClientRect()}catch(pm){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}},e.prototype.getTitle=function(t){return t.title},e.prototype.setTitle=function(t,e){t.title=e||""},e.prototype.elementMatches=function(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))},e.prototype.isTemplateElement=function(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName},e.prototype.isTextNode=function(t){return t.nodeType===Node.TEXT_NODE},e.prototype.isCommentNode=function(t){return t.nodeType===Node.COMMENT_NODE},e.prototype.isElementNode=function(t){return t.nodeType===Node.ELEMENT_NODE},e.prototype.hasShadowRoot=function(t){return null!=t.shadowRoot&&t instanceof HTMLElement},e.prototype.isShadowRoot=function(t){return t instanceof DocumentFragment},e.prototype.importIntoDoc=function(t){return document.importNode(this.templateAwareRoot(t),!0)},e.prototype.adoptNode=function(t){return document.adoptNode(t)},e.prototype.getHref=function(t){return t.getAttribute("href")},e.prototype.getEventKey=function(t){var e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&uh.hasOwnProperty(e)&&(e=uh[e]))}return sh[e]||e},e.prototype.getGlobalEventTarget=function(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null},e.prototype.getHistory=function(){return window.history},e.prototype.getLocation=function(){return window.location},e.prototype.getBaseHref=function(t){var e,n=hh||(hh=document.querySelector("base"))?hh.getAttribute("href"):null;return null==n?null:(e=n,ch||(ch=document.createElement("a")),ch.setAttribute("href",e),"/"===ch.pathname.charAt(0)?ch.pathname:"/"+ch.pathname)},e.prototype.resetBaseElement=function(){hh=null},e.prototype.getUserAgent=function(){return window.navigator.userAgent},e.prototype.setData=function(t,e,n){this.setAttribute(t,"data-"+e,n)},e.prototype.getData=function(t,e){return this.getAttribute(t,"data-"+e)},e.prototype.getComputedStyle=function(t){return getComputedStyle(t)},e.prototype.supportsWebAnimation=function(){return"function"==typeof Element.prototype.animate},e.prototype.performanceNow=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},e.prototype.supportsCookies=function(){return!0},e.prototype.getCookie=function(t){return function(t,e){var n,r;e=encodeURIComponent(e);try{for(var o=h(t.split(";")),i=o.next();!i.done;i=o.next()){var a=i.value,s=a.indexOf("="),u=p(-1==s?[a,""]:[a.slice(0,s),a.slice(s+1)],2),c=u[1];if(u[0].trim()===e)return decodeURIComponent(c)}}catch(l){n={error:l}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return null}(document.cookie,t)},e.prototype.setCookie=function(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)},e}(function(t){function e(){var e=t.call(this)||this;e._animationPrefix=null,e._transitionEnd=null;try{var n=e.createElement("div",document);if(null!=e.getStyle(n,"animationName"))e._animationPrefix="";else for(var r=["Webkit","Moz","O","ms"],o=0;o<r.length;o++)if(null!=e.getStyle(n,r[o]+"AnimationName")){e._animationPrefix="-"+r[o].toLowerCase()+"-";break}var i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(i).forEach(function(t){null!=e.getStyle(n,t)&&(e._transitionEnd=i[t])})}catch(pm){e._animationPrefix=null,e._transitionEnd=null}return e}return i(e,t),e.prototype.getDistributedNodes=function(t){return t.getDistributedNodes()},e.prototype.resolveAndSetHref=function(t,e,n){t.href=null==n?e:e+"/../"+n},e.prototype.supportsDOMEvents=function(){return!0},e.prototype.supportsNativeShadowDOM=function(){return"function"==typeof document.body.createShadowRoot},e.prototype.getAnimationPrefix=function(){return this._animationPrefix?this._animationPrefix:""},e.prototype.getTransitionEnd=function(){return this._transitionEnd?this._transitionEnd:""},e.prototype.supportsAnimation=function(){return null!=this._animationPrefix&&null!=this._transitionEnd},e}(function(){function t(){this.resourceLoaderType=null}return Object.defineProperty(t.prototype,"attrToPropMap",{get:function(){return this._attrToPropMap},set:function(t){this._attrToPropMap=t},enumerable:!0,configurable:!0}),t}())),hh=null,ph=Jl;function fh(){return!!window.history.pushState}var dh=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n._init(),n}var n;return i(e,t),e.prototype._init=function(){this.location=oh().getLocation(),this._history=oh().getHistory()},e.prototype.getBaseHrefFromDOM=function(){return oh().getBaseHref(this._doc)},e.prototype.onPopState=function(t){oh().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)},e.prototype.onHashChange=function(t){oh().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)},Object.defineProperty(e.prototype,"pathname",{get:function(){return this.location.pathname},set:function(t){this.location.pathname=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"search",{get:function(){return this.location.search},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hash",{get:function(){return this.location.hash},enumerable:!0,configurable:!0}),e.prototype.pushState=function(t,e,n){fh()?this._history.pushState(t,e,n):this.location.hash=n},e.prototype.replaceState=function(t,e,n){fh()?this._history.replaceState(t,e,n):this.location.hash=n},e.prototype.forward=function(){this._history.forward()},e.prototype.back=function(){this._history.back()},s([(n=Ht(ph),function(t,e){n(t,e,0)}),u("design:paramtypes",[Object])],e)}(Pl),vh=new It("TRANSITION_ID"),mh=[{provide:ui,useFactory:function(t,e,n){return function(){n.get(ci).donePromise.then(function(){var n=oh();Array.prototype.slice.apply(n.querySelectorAll(e,"style[ng-transition]")).filter(function(e){return n.getAttribute(e,"ng-transition")===t}).forEach(function(t){return n.remove(t)})})}},deps:[vh,ph,zn],multi:!0}],gh=function(){function t(){}return t.init=function(){var e;e=new t,Li=e},t.prototype.addToWindow=function(t){Ft.getAngularTestability=function(e,n){void 0===n&&(n=!0);var r=t.findTestabilityInTree(e,n);if(null==r)throw new Error("Could not find testability for element.");return r},Ft.getAllAngularTestabilities=function(){return t.getAllTestabilities()},Ft.getAllAngularRootElements=function(){return t.getAllRootElements()},Ft.frameworkStabilizers||(Ft.frameworkStabilizers=[]),Ft.frameworkStabilizers.push(function(t){var e=Ft.getAllAngularTestabilities(),n=e.length,r=!1,o=function(e){r=r||e,0==--n&&t(r)};e.forEach(function(t){t.whenStable(o)})})},t.prototype.findTestabilityInTree=function(t,e,n){if(null==e)return null;var r=t.getTestability(e);return null!=r?r:n?oh().isShadowRoot(e)?this.findTestabilityInTree(t,oh().getHost(e),!0):this.findTestabilityInTree(t,oh().parentElement(e),!0):null},t}();function yh(t,e){"undefined"!=typeof COMPILED&&COMPILED||((Ft.ng=Ft.ng||{})[t]=e)}var wh={ApplicationRef:Hi,NgZone:Ti};function bh(t){return sa(t)}var xh=new It("EventManagerPlugins"),_h=function(){function t(t,e){var n=this;this._zone=e,this._eventNameToPlugin=new Map,t.forEach(function(t){return t.manager=n}),this._plugins=t.slice().reverse()}return t.prototype.addEventListener=function(t,e,n){return this._findPluginFor(e).addEventListener(t,e,n)},t.prototype.addGlobalEventListener=function(t,e,n){return this._findPluginFor(e).addGlobalEventListener(t,e,n)},t.prototype.getZone=function(){return this._zone},t.prototype._findPluginFor=function(t){var e=this._eventNameToPlugin.get(t);if(e)return e;for(var n=this._plugins,r=0;r<n.length;r++){var o=n[r];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error("No event manager plugin found for event "+t)},t}(),Ch=function(){function t(t){this._doc=t}return t.prototype.addGlobalEventListener=function(t,e,n){var r=oh().getGlobalEventTarget(this._doc,t);if(!r)throw new Error("Unsupported event target "+r+" for event "+e);return this.addEventListener(r,e,n)},t}(),Eh=function(){function t(){this._stylesSet=new Set}return t.prototype.addStyles=function(t){var e=this,n=new Set;t.forEach(function(t){e._stylesSet.has(t)||(e._stylesSet.add(t),n.add(t))}),this.onStylesAdded(n)},t.prototype.onStylesAdded=function(t){},t.prototype.getAllStyles=function(){return Array.from(this._stylesSet)},t}(),Sh=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n._hostNodes=new Set,n._styleNodes=new Set,n._hostNodes.add(e.head),n}return i(e,t),e.prototype._addStylesToHost=function(t,e){var n=this;t.forEach(function(t){var r=n._doc.createElement("style");r.textContent=t,n._styleNodes.add(e.appendChild(r))})},e.prototype.addHost=function(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)},e.prototype.removeHost=function(t){this._hostNodes.delete(t)},e.prototype.onStylesAdded=function(t){var e=this;this._hostNodes.forEach(function(n){return e._addStylesToHost(t,n)})},e.prototype.ngOnDestroy=function(){this._styleNodes.forEach(function(t){return oh().remove(t)})},e}(Eh),Rh={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Th=/%COMP%/g,kh="_nghost-%COMP%",Ih="_ngcontent-%COMP%";function Nh(t,e,n){for(var r=0;r<e.length;r++){var o=e[r];Array.isArray(o)?Nh(t,o,n):(o=o.replace(Th,t),n.push(o))}return n}function Ah(t){return function(e){!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}var Dh=function(){function t(t,e){this.eventManager=t,this.sharedStylesHost=e,this.rendererByCompId=new Map,this.defaultRenderer=new Mh(t)}return t.prototype.createRenderer=function(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case Mt.Emulated:var n=this.rendererByCompId.get(e.id);return n||(n=new Lh(this.eventManager,this.sharedStylesHost,e),this.rendererByCompId.set(e.id,n)),n.applyToHost(t),n;case Mt.Native:case Mt.ShadowDom:return new Bh(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){var r=Nh(e.id,e.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}},t.prototype.begin=function(){},t.prototype.end=function(){},t}(),Mh=function(){function t(t){this.eventManager=t,this.data=Object.create(null)}return t.prototype.destroy=function(){},t.prototype.createElement=function(t,e){return e?document.createElementNS(Rh[e],t):document.createElement(t)},t.prototype.createComment=function(t){return document.createComment(t)},t.prototype.createText=function(t){return document.createTextNode(t)},t.prototype.appendChild=function(t,e){t.appendChild(e)},t.prototype.insertBefore=function(t,e,n){t&&t.insertBefore(e,n)},t.prototype.removeChild=function(t,e){t&&t.removeChild(e)},t.prototype.selectRootElement=function(t,e){var n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error('The selector "'+t+'" did not match any elements');return e||(n.textContent=""),n},t.prototype.parentNode=function(t){return t.parentNode},t.prototype.nextSibling=function(t){return t.nextSibling},t.prototype.setAttribute=function(t,e,n,r){if(r){e=r+":"+e;var o=Rh[r];o?t.setAttributeNS(o,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)},t.prototype.removeAttribute=function(t,e,n){if(n){var r=Rh[n];r?t.removeAttributeNS(r,e):t.removeAttribute(n+":"+e)}else t.removeAttribute(e)},t.prototype.addClass=function(t,e){t.classList.add(e)},t.prototype.removeClass=function(t,e){t.classList.remove(e)},t.prototype.setStyle=function(t,e,n,r){r&uo.DashCase?t.style.setProperty(e,n,r&uo.Important?"important":""):t.style[e]=n},t.prototype.removeStyle=function(t,e,n){n&uo.DashCase?t.style.removeProperty(e):t.style[e]=""},t.prototype.setProperty=function(t,e,n){Oh(e,"property"),t[e]=n},t.prototype.setValue=function(t,e){t.nodeValue=e},t.prototype.listen=function(t,e,n){return Oh(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,Ah(n)):this.eventManager.addEventListener(t,e,Ah(n))},t}(),Ph="@".charCodeAt(0);function Oh(t,e){if(t.charCodeAt(0)===Ph)throw new Error("Found the synthetic "+e+" "+t+'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.')}var Fh,Lh=function(t){function e(e,n,r){var o=t.call(this,e)||this;o.component=r;var i=Nh(r.id,r.styles,[]);return n.addStyles(i),o.contentAttr=Ih.replace(Th,r.id),o.hostAttr=kh.replace(Th,r.id),o}return i(e,t),e.prototype.applyToHost=function(e){t.prototype.setAttribute.call(this,e,this.hostAttr,"")},e.prototype.createElement=function(e,n){var r=t.prototype.createElement.call(this,e,n);return t.prototype.setAttribute.call(this,r,this.contentAttr,""),r},e}(Mh),Bh=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;i.sharedStylesHost=n,i.hostEl=r,i.component=o,i.shadowRoot=o.encapsulation===Mt.ShadowDom?r.attachShadow({mode:"open"}):r.createShadowRoot(),i.sharedStylesHost.addHost(i.shadowRoot);for(var a=Nh(o.id,o.styles,[]),s=0;s<a.length;s++){var u=document.createElement("style");u.textContent=a[s],i.shadowRoot.appendChild(u)}return i}return i(e,t),e.prototype.nodeOrShadowRoot=function(t){return t===this.hostEl?this.shadowRoot:t},e.prototype.destroy=function(){this.sharedStylesHost.removeHost(this.shadowRoot)},e.prototype.appendChild=function(e,n){return t.prototype.appendChild.call(this,this.nodeOrShadowRoot(e),n)},e.prototype.insertBefore=function(e,n,r){return t.prototype.insertBefore.call(this,this.nodeOrShadowRoot(e),n,r)},e.prototype.removeChild=function(e,n){return t.prototype.removeChild.call(this,this.nodeOrShadowRoot(e),n)},e.prototype.parentNode=function(e){return this.nodeOrShadowRoot(t.prototype.parentNode.call(this,this.nodeOrShadowRoot(e)))},e}(Mh),Uh="undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t},Vh=Uh("addEventListener"),jh=Uh("removeEventListener"),zh={},Wh="__zone_symbol__propagationStopped";"undefined"!=typeof Zone&&Zone[Uh("BLACK_LISTED_EVENTS")]&&(Fh={});var Hh=function(t){return!!Fh&&Fh.hasOwnProperty(t)},Gh=function(t){var e=zh[t.type];if(e){var n=this[e];if(n){var r=[t];if(1===n.length)return(a=n[0]).zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r);for(var o=n.slice(),i=0;i<o.length&&!0!==t[Wh];i++){var a;(a=o[i]).zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r)}}}},qh=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.ngZone=n,r&&function(t){return t===th}(r)||o.patchEvent(),o}return i(e,t),e.prototype.patchEvent=function(){if("undefined"!=typeof Event&&Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[Wh]=!0),t&&t.apply(this,arguments)}}},e.prototype.supports=function(t){return!0},e.prototype.addEventListener=function(t,e,n){var r=this,o=n;if(!t[Vh]||Ti.isInAngularZone()&&!Hh(e))t.addEventListener(e,o,!1);else{var i=zh[e];i||(i=zh[e]=Uh("ANGULAR"+e+"FALSE"));var a=t[i],s=a&&a.length>0;a||(a=t[i]=[]);var u=Hh(e)?Zone.root:Zone.current;if(0===a.length)a.push({zone:u,handler:o});else{for(var c=!1,l=0;l<a.length;l++)if(a[l].handler===o){c=!0;break}c||a.push({zone:u,handler:o})}s||t[Vh](e,Gh,!1)}return function(){return r.removeEventListener(t,e,o)}},e.prototype.removeEventListener=function(t,e,n){var r=t[jh];if(!r)return t.removeEventListener.apply(t,[e,n,!1]);var o=zh[e],i=o&&t[o];if(!i)return t.removeEventListener.apply(t,[e,n,!1]);for(var a=!1,s=0;s<i.length;s++)if(i[s].handler===n){a=!0,i.splice(s,1);break}a?0===i.length&&r.apply(t,[e,Gh,!1]):t.removeEventListener.apply(t,[e,n,!1])},e}(Ch),$h={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},Kh=new It("HammerGestureConfig"),Xh=new It("HammerLoader"),Qh=function(){function t(){this.events=[],this.overrides={}}return t.prototype.buildHammer=function(t){var e=new Hammer(t,this.options);for(var n in e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0}),this.overrides)e.get(n).set(this.overrides[n]);return e},t}(),Yh=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i._config=n,i.console=r,i.loader=o,i}return i(e,t),e.prototype.supports=function(t){return!(!$h.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t)||!window.Hammer&&!this.loader&&(this.console.warn('The "'+t+'" event cannot be bound because Hammer.JS is not loaded and no custom loader has been specified.'),1))},e.prototype.addEventListener=function(t,e,n){var r=this,o=this.manager.getZone();if(e=e.toLowerCase(),!window.Hammer&&this.loader){var i=!1,a=function(){i=!0};return this.loader().then(function(){if(!window.Hammer)return r.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(a=function(){});i||(a=r.addEventListener(t,e,n))}).catch(function(){r.console.warn('The "'+e+'" event cannot be bound because the custom Hammer.JS loader failed.'),a=function(){}}),function(){a()}}return o.runOutsideAngular(function(){var i=r._config.buildHammer(t),a=function(t){o.runGuarded(function(){n(t)})};return i.on(e,a),function(){i.off(e,a),"function"==typeof i.destroy&&i.destroy()}})},e.prototype.isCustomEvent=function(t){return this._config.events.indexOf(t)>-1},e}(Ch),Zh=["alt","control","meta","shift"],Jh={alt:function(t){return t.altKey},control:function(t){return t.ctrlKey},meta:function(t){return t.metaKey},shift:function(t){return t.shiftKey}},tp=function(t){function e(e){return t.call(this,e)||this}var n;return i(e,t),n=e,e.prototype.supports=function(t){return null!=n.parseEventName(t)},e.prototype.addEventListener=function(t,e,r){var o=n.parseEventName(e),i=n.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return oh().onAndCancel(t,o.domEventName,i)})},e.parseEventName=function(t){var e=t.toLowerCase().split("."),r=e.shift();if(0===e.length||"keydown"!==r&&"keyup"!==r)return null;var o=n._normalizeKey(e.pop()),i="";if(Zh.forEach(function(t){var n=e.indexOf(t);n>-1&&(e.splice(n,1),i+=t+".")}),i+=o,0!=e.length||0===o.length)return null;var a={};return a.domEventName=r,a.fullKey=i,a},e.getEventFullKey=function(t){var e="",n=oh().getEventKey(t);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),Zh.forEach(function(r){r!=n&&(0,Jh[r])(t)&&(e+=r+".")}),e+=n},e.eventCallback=function(t,e,r){return function(o){n.getEventFullKey(o)===t&&r.runGuarded(function(){return e(o)})}},e._normalizeKey=function(t){switch(t){case"esc":return"escape";default:return t}},e}(Ch),ep=function(){return function(){}}(),np=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n}return i(e,t),e.prototype.sanitize=function(t,e){if(null==e)return null;switch(t){case Xo.NONE:return e;case Xo.HTML:return e instanceof op?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),function(t,e){var n=null;try{No=No||new Eo(t);var r=e?String(e):"";n=No.getInertBodyElement(r);var o=5,i=r;do{if(0===o)throw new Error("Failed to sanitize html because the input is unstable");o--,r=i,i=n.innerHTML,n=No.getInertBodyElement(r)}while(r!==i);var a=new Uo,s=a.sanitizeChildren(Wo(n)||n);return Co()&&a.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content (see http://g.co/ng/security#xss)."),s}finally{if(n)for(var u=Wo(n)||n;u.firstChild;)u.removeChild(u.firstChild)}}(this._doc,String(e)));case Xo.STYLE:return e instanceof ip?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),function(t){if(!(t=String(t).trim()))return"";var e=t.match(Zo);return e&&To(e[1])===e[1]||t.match(Yo)&&function(t){for(var e=!0,n=!0,r=0;r<t.length;r++){var o=t.charAt(r);"'"===o&&n?e=!e:'"'===o&&e&&(n=!n)}return e&&n}(t)?t:(Co()&&console.warn("WARNING: sanitizing unsafe style value "+t+" (see http://g.co/ng/security#xss)."),"unsafe")}(e));case Xo.SCRIPT:if(e instanceof ap)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case Xo.URL:return e instanceof up||e instanceof sp?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),To(String(e)));case Xo.RESOURCE_URL:if(e instanceof up)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext "+t+" (see http://g.co/ng/security#xss)")}},e.prototype.checkNotSafeValue=function(t,e){if(t instanceof rp)throw new Error("Required a safe "+e+", got a "+t.getTypeName()+" (see http://g.co/ng/security#xss)")},e.prototype.bypassSecurityTrustHtml=function(t){return new op(t)},e.prototype.bypassSecurityTrustStyle=function(t){return new ip(t)},e.prototype.bypassSecurityTrustScript=function(t){return new ap(t)},e.prototype.bypassSecurityTrustUrl=function(t){return new sp(t)},e.prototype.bypassSecurityTrustResourceUrl=function(t){return new up(t)},e}(ep),rp=function(){function t(t){this.changingThisBreaksApplicationSecurity=t}return t.prototype.toString=function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"},t}(),op=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getTypeName=function(){return"HTML"},e}(rp),ip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getTypeName=function(){return"Style"},e}(rp),ap=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getTypeName=function(){return"Script"},e}(rp),sp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getTypeName=function(){return"URL"},e}(rp),up=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getTypeName=function(){return"ResourceURL"},e}(rp),cp=Vi(Ea,"browser",[{provide:di,useValue:"browser"},{provide:fi,useValue:function(){lh.makeCurrent(),gh.init()},multi:!0},{provide:Pl,useClass:dh,deps:[ph]},{provide:ph,useFactory:function(){return document},deps:[]}]);function lp(){return new ii}var hp=function(){function t(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}var e;return e=t,t.withServerTransition=function(t){return{ngModule:e,providers:[{provide:li,useValue:t.appId},{provide:vh,useExisting:li},mh]}},t}();"undefined"!=typeof window&&window;var pp=function(){return function(t,e){this.id=t,this.url=e}}(),fp=function(t){function e(e,n,r,o){void 0===r&&(r="imperative"),void 0===o&&(o=null);var i=t.call(this,e,n)||this;return i.navigationTrigger=r,i.restoredState=o,i}return i(e,t),e.prototype.toString=function(){return"NavigationStart(id: "+this.id+", url: '"+this.url+"')"},e}(pp),dp=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.urlAfterRedirects=r,o}return i(e,t),e.prototype.toString=function(){return"NavigationEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"')"},e}(pp),vp=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.reason=r,o}return i(e,t),e.prototype.toString=function(){return"NavigationCancel(id: "+this.id+", url: '"+this.url+"')"},e}(pp),mp=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.error=r,o}return i(e,t),e.prototype.toString=function(){return"NavigationError(id: "+this.id+", url: '"+this.url+"', error: "+this.error+")"},e}(pp),gp=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return i(e,t),e.prototype.toString=function(){return"RoutesRecognized(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(pp),yp=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return i(e,t),e.prototype.toString=function(){return"GuardsCheckStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(pp),wp=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n)||this;return a.urlAfterRedirects=r,a.state=o,a.shouldActivate=i,a}return i(e,t),e.prototype.toString=function(){return"GuardsCheckEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+", shouldActivate: "+this.shouldActivate+")"},e}(pp),bp=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return i(e,t),e.prototype.toString=function(){return"ResolveStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(pp),xp=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return i(e,t),e.prototype.toString=function(){return"ResolveEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(pp),_p=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadStart(path: "+this.route.path+")"},t}(),Cp=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadEnd(path: "+this.route.path+")"},t}(),Ep=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ChildActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Sp=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ChildActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Rp=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),Tp=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),kp=function(){function t(t,e,n){this.routerEvent=t,this.position=e,this.anchor=n}return t.prototype.toString=function(){return"Scroll(anchor: '"+this.anchor+"', position: '"+(this.position?this.position[0]+", "+this.position[1]:null)+"')"},t}(),Ip=function(){return function(){}}(),Np="primary",Ap=function(){function t(t){this.params=t||{}}return t.prototype.has=function(t){return this.params.hasOwnProperty(t)},t.prototype.get=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e[0]:e}return null},t.prototype.getAll=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e:[e]}return[]},Object.defineProperty(t.prototype,"keys",{get:function(){return Object.keys(this.params)},enumerable:!0,configurable:!0}),t}();function Dp(t){return new Ap(t)}var Mp="ngNavigationCancelingError";function Pp(t){var e=Error("NavigationCancelingError: "+t);return e[Mp]=!0,e}function Op(t,e,n){var r=n.path.split("/");if(r.length>t.length)return null;if("full"===n.pathMatch&&(e.hasChildren()||r.length<t.length))return null;for(var o={},i=0;i<r.length;i++){var a=r[i],s=t[i];if(a.startsWith(":"))o[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}var Fp=function(){return function(t,e){this.routes=t,this.module=e}}();function Lp(t,e){void 0===e&&(e="");for(var n=0;n<t.length;n++){var r=t[n];Bp(r,Up(e,r))}}function Bp(t,e){if(!t)throw new Error("\n      Invalid configuration of route '"+e+"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    ");if(Array.isArray(t))throw new Error("Invalid configuration of route '"+e+"': Array cannot be specified");if(!t.component&&!t.children&&!t.loadChildren&&t.outlet&&t.outlet!==Np)throw new Error("Invalid configuration of route '"+e+"': a componentless route without children or loadChildren cannot have a named outlet set");if(t.redirectTo&&t.children)throw new Error("Invalid configuration of route '"+e+"': redirectTo and children cannot be used together");if(t.redirectTo&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': redirectTo and loadChildren cannot be used together");if(t.children&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': children and loadChildren cannot be used together");if(t.redirectTo&&t.component)throw new Error("Invalid configuration of route '"+e+"': redirectTo and component cannot be used together");if(t.path&&t.matcher)throw new Error("Invalid configuration of route '"+e+"': path and matcher cannot be used together");if(void 0===t.redirectTo&&!t.component&&!t.children&&!t.loadChildren)throw new Error("Invalid configuration of route '"+e+"'. One of the following must be provided: component, redirectTo, children or loadChildren");if(void 0===t.path&&void 0===t.matcher)throw new Error("Invalid configuration of route '"+e+"': routes must have either a path or a matcher specified");if("string"==typeof t.path&&"/"===t.path.charAt(0))throw new Error("Invalid configuration of route '"+e+"': path cannot start with a slash");if(""===t.path&&void 0!==t.redirectTo&&void 0===t.pathMatch)throw new Error("Invalid configuration of route '{path: \""+e+'", redirectTo: "'+t.redirectTo+"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.");if(void 0!==t.pathMatch&&"full"!==t.pathMatch&&"prefix"!==t.pathMatch)throw new Error("Invalid configuration of route '"+e+"': pathMatch can only be set to 'prefix' or 'full'");t.children&&Lp(t.children,e)}function Up(t,e){return e?t||e.path?t&&!e.path?t+"/":!t&&e.path?e.path:t+"/"+e.path:"":t}function Vp(t){var e=t.children&&t.children.map(Vp),n=e?a({},t,{children:e}):a({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==Np&&(n.component=Ip),n}function jp(t,e){var n,r=Object.keys(t),o=Object.keys(e);if(r.length!=o.length)return!1;for(var i=0;i<r.length;i++)if(t[n=r[i]]!==e[n])return!1;return!0}function zp(t){return Array.prototype.concat.apply([],t)}function Wp(t){return t.length>0?t[t.length-1]:null}function Hp(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n)}function Gp(t){return si(t)?t:ai(t)?st(Promise.resolve(t)):Hc(t)}function qp(t,e,n){return n?function(t,e){return jp(t,e)}(t.queryParams,e.queryParams)&&function t(e,n){if(!Qp(e.segments,n.segments))return!1;if(e.numberOfChildren!==n.numberOfChildren)return!1;for(var r in n.children){if(!e.children[r])return!1;if(!t(e.children[r],n.children[r]))return!1}return!0}(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(function(n){return e[n]===t[n]})}(t.queryParams,e.queryParams)&&function t(e,n){return function e(n,r,o){if(n.segments.length>o.length)return!!Qp(a=n.segments.slice(0,o.length),o)&&!r.hasChildren();if(n.segments.length===o.length){if(!Qp(n.segments,o))return!1;for(var i in r.children){if(!n.children[i])return!1;if(!t(n.children[i],r.children[i]))return!1}return!0}var a=o.slice(0,n.segments.length),s=o.slice(n.segments.length);return!!Qp(n.segments,a)&&!!n.children[Np]&&e(n.children[Np],r,s)}(e,n,n.segments)}(t.root,e.root)}var $p=function(){function t(t,e,n){this.root=t,this.queryParams=e,this.fragment=n}return Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=Dp(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return tf.serialize(this)},t}(),Kp=function(){function t(t,e){var n=this;this.segments=t,this.children=e,this.parent=null,Hp(e,function(t,e){return t.parent=n})}return t.prototype.hasChildren=function(){return this.numberOfChildren>0},Object.defineProperty(t.prototype,"numberOfChildren",{get:function(){return Object.keys(this.children).length},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return ef(this)},t}(),Xp=function(){function t(t,e){this.path=t,this.parameters=e}return Object.defineProperty(t.prototype,"parameterMap",{get:function(){return this._parameterMap||(this._parameterMap=Dp(this.parameters)),this._parameterMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return uf(this)},t}();function Qp(t,e){return t.length===e.length&&t.every(function(t,n){return t.path===e[n].path})}function Yp(t,e){var n=[];return Hp(t.children,function(t,r){r===Np&&(n=n.concat(e(t,r)))}),Hp(t.children,function(t,r){r!==Np&&(n=n.concat(e(t,r)))}),n}var Zp=function(){return function(){}}(),Jp=function(){function t(){}return t.prototype.parse=function(t){var e=new ff(t);return new $p(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())},t.prototype.serialize=function(t){var e,n;return"/"+function t(e,n){if(!e.hasChildren())return ef(e);if(n){var r=e.children[Np]?t(e.children[Np],!1):"",o=[];return Hp(e.children,function(e,n){n!==Np&&o.push(n+":"+t(e,!1))}),o.length>0?r+"("+o.join("//")+")":r}var i=Yp(e,function(n,r){return r===Np?[t(e.children[Np],!1)]:[r+":"+t(n,!1)]});return ef(e)+"/("+i.join("//")+")"}(t.root,!0)+(e=t.queryParams,(n=Object.keys(e).map(function(t){var n=e[t];return Array.isArray(n)?n.map(function(e){return rf(t)+"="+rf(e)}).join("&"):rf(t)+"="+rf(n)})).length?"?"+n.join("&"):"")+("string"==typeof t.fragment?"#"+encodeURI(t.fragment):"")},t}(),tf=new Jp;function ef(t){return t.segments.map(function(t){return uf(t)}).join("/")}function nf(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function rf(t){return nf(t).replace(/%3B/gi,";")}function of(t){return nf(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function af(t){return decodeURIComponent(t)}function sf(t){return af(t.replace(/\+/g,"%20"))}function uf(t){return""+of(t.path)+(e=t.parameters,Object.keys(e).map(function(t){return";"+of(t)+"="+of(e[t])}).join(""));var e}var cf=/^[^\/()?;=#]+/;function lf(t){var e=t.match(cf);return e?e[0]:""}var hf=/^[^=?&#]+/,pf=/^[^?&#]+/,ff=function(){function t(t){this.url=t,this.remaining=t}return t.prototype.parseRootSegment=function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Kp([],{}):new Kp([],this.parseChildren())},t.prototype.parseQueryParams=function(){var t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t},t.prototype.parseFragment=function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null},t.prototype.parseChildren=function(){if(""===this.remaining)return{};this.consumeOptional("/");var t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());var e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(n[Np]=new Kp(t,e)),n},t.prototype.parseSegment=function(){var t=lf(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(t),new Xp(af(t),this.parseMatrixParams())},t.prototype.parseMatrixParams=function(){for(var t={};this.consumeOptional(";");)this.parseParam(t);return t},t.prototype.parseParam=function(t){var e=lf(this.remaining);if(e){this.capture(e);var n="";if(this.consumeOptional("=")){var r=lf(this.remaining);r&&this.capture(n=r)}t[af(e)]=af(n)}},t.prototype.parseQueryParam=function(t){var e,n=(e=this.remaining.match(hf))?e[0]:"";if(n){this.capture(n);var r="";if(this.consumeOptional("=")){var o=function(t){var e=t.match(pf);return e?e[0]:""}(this.remaining);o&&this.capture(r=o)}var i=sf(n),a=sf(r);if(t.hasOwnProperty(i)){var s=t[i];Array.isArray(s)||(t[i]=s=[s]),s.push(a)}else t[i]=a}},t.prototype.parseParens=function(t){var e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=lf(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '"+this.url+"'");var o=void 0;n.indexOf(":")>-1?(o=n.substr(0,n.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=Np);var i=this.parseChildren();e[o]=1===Object.keys(i).length?i[Np]:new Kp([],i),this.consumeOptional("//")}return e},t.prototype.peekStartsWith=function(t){return this.remaining.startsWith(t)},t.prototype.consumeOptional=function(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)},t.prototype.capture=function(t){if(!this.consumeOptional(t))throw new Error('Expected "'+t+'".')},t}(),df=function(){function t(t){this._root=t}return Object.defineProperty(t.prototype,"root",{get:function(){return this._root.value},enumerable:!0,configurable:!0}),t.prototype.parent=function(t){var e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null},t.prototype.children=function(t){var e=vf(t,this._root);return e?e.children.map(function(t){return t.value}):[]},t.prototype.firstChild=function(t){var e=vf(t,this._root);return e&&e.children.length>0?e.children[0].value:null},t.prototype.siblings=function(t){var e=mf(t,this._root);return e.length<2?[]:e[e.length-2].children.map(function(t){return t.value}).filter(function(e){return e!==t})},t.prototype.pathFromRoot=function(t){return mf(t,this._root).map(function(t){return t.value})},t}();function vf(t,e){var n,r;if(t===e.value)return e;try{for(var o=h(e.children),i=o.next();!i.done;i=o.next()){var a=vf(t,i.value);if(a)return a}}catch(s){n={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return null}function mf(t,e){var n,r;if(t===e.value)return[e];try{for(var o=h(e.children),i=o.next();!i.done;i=o.next()){var a=mf(t,i.value);if(a.length)return a.unshift(e),a}}catch(s){n={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return[]}var gf=function(){function t(t,e){this.value=t,this.children=e}return t.prototype.toString=function(){return"TreeNode("+this.value+")"},t}();function yf(t){var e={};return t&&t.children.forEach(function(t){return e[t.value.outlet]=t}),e}var wf=function(t){function e(e,n){var r=t.call(this,e)||this;return r.snapshot=n,Sf(r,e),r}return i(e,t),e.prototype.toString=function(){return this.snapshot.toString()},e}(df);function bf(t,e){var n=function(t,e){var n=new Cf([],{},{},"",{},Np,e,null,t.root,-1,{});return new Ef("",new gf(n,[]))}(t,e),r=new Gc([new Xp("",{})]),o=new Gc({}),i=new Gc({}),a=new Gc({}),s=new Gc(""),u=new xf(r,o,a,s,i,Np,e,n.root);return u.snapshot=n.root,new wf(new gf(u,[]),n)}var xf=function(){function t(t,e,n,r,o,i,a,s){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=i,this.component=a,this._futureSnapshot=s}return Object.defineProperty(t.prototype,"routeConfig",{get:function(){return this._futureSnapshot.routeConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=this.params.pipe(rt(function(t){return Dp(t)}))),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(rt(function(t){return Dp(t)}))),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.snapshot?this.snapshot.toString():"Future("+this._futureSnapshot+")"},t}();function _f(t,e){void 0===e&&(e="emptyOnly");var n=t.pathFromRoot,r=0;if("always"!==e)for(r=n.length-1;r>=1;){var o=n[r],i=n[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(i.component)break;r--}}return function(t){return t.reduce(function(t,e){return{params:a({},t.params,e.params),data:a({},t.data,e.data),resolve:a({},t.resolve,e._resolvedData)}},{params:{},data:{},resolve:{}})}(n.slice(r))}var Cf=function(){function t(t,e,n,r,o,i,a,s,u,c,l){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=i,this.component=a,this.routeConfig=s,this._urlSegment=u,this._lastPathIndex=c,this._resolve=l}return Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=Dp(this.params)),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=Dp(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"Route(url:'"+this.url.map(function(t){return t.toString()}).join("/")+"', path:'"+(this.routeConfig?this.routeConfig.path:"")+"')"},t}(),Ef=function(t){function e(e,n){var r=t.call(this,n)||this;return r.url=e,Sf(r,n),r}return i(e,t),e.prototype.toString=function(){return Rf(this._root)},e}(df);function Sf(t,e){e.value._routerState=t,e.children.forEach(function(e){return Sf(t,e)})}function Rf(t){var e=t.children.length>0?" { "+t.children.map(Rf).join(", ")+" } ":"";return""+t.value+e}function Tf(t){if(t.snapshot){var e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,jp(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),jp(e.params,n.params)||t.params.next(n.params),function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!jp(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),jp(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function kf(t,e){var n,r;return jp(t.params,e.params)&&Qp(n=t.url,r=e.url)&&n.every(function(t,e){return jp(t.parameters,r[e].parameters)})&&!(!t.parent!=!e.parent)&&(!t.parent||kf(t.parent,e.parent))}function If(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Nf(t,e,n,r,o){var i={};return r&&Hp(r,function(t,e){i[e]=Array.isArray(t)?t.map(function(t){return""+t}):""+t}),new $p(n.root===t?e:function t(e,n,r){var o={};return Hp(e.children,function(e,i){o[i]=e===n?r:t(e,n,r)}),new Kp(e.segments,o)}(n.root,t,e),i,o)}var Af=function(){function t(t,e,n){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=n,t&&n.length>0&&If(n[0]))throw new Error("Root segment cannot have matrix parameters");var r=n.find(function(t){return"object"==typeof t&&null!=t&&t.outlets});if(r&&r!==Wp(n))throw new Error("{outlets:{}} has to be the last command")}return t.prototype.toRoot=function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]},t}(),Df=function(){return function(t,e,n){this.segmentGroup=t,this.processChildren=e,this.index=n}}();function Mf(t){return"object"==typeof t&&null!=t&&t.outlets?t.outlets[Np]:""+t}function Pf(t,e,n){if(t||(t=new Kp([],{})),0===t.segments.length&&t.hasChildren())return Of(t,e,n);var r=function(t,e,n){for(var r=0,o=e,i={match:!1,pathIndex:0,commandIndex:0};o<t.segments.length;){if(r>=n.length)return i;var a=t.segments[o],s=Mf(n[r]),u=r<n.length-1?n[r+1]:null;if(o>0&&void 0===s)break;if(s&&u&&"object"==typeof u&&void 0===u.outlets){if(!Uf(s,u,a))return i;r+=2}else{if(!Uf(s,{},a))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(t,e,n),o=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){var i=new Kp(t.segments.slice(0,r.pathIndex),{});return i.children[Np]=new Kp(t.segments.slice(r.pathIndex),t.children),Of(i,0,o)}return r.match&&0===o.length?new Kp(t.segments,{}):r.match&&!t.hasChildren()?Ff(t,e,n):r.match?Of(t,0,o):Ff(t,e,n)}function Of(t,e,n){if(0===n.length)return new Kp(t.segments,{});var r=function(t){var e,n;return"object"!=typeof t[0]?((e={})[Np]=t,e):void 0===t[0].outlets?((n={})[Np]=t,n):t[0].outlets}(n),o={};return Hp(r,function(n,r){null!==n&&(o[r]=Pf(t.children[r],e,n))}),Hp(t.children,function(t,e){void 0===r[e]&&(o[e]=t)}),new Kp(t.segments,o)}function Ff(t,e,n){for(var r=t.segments.slice(0,e),o=0;o<n.length;){if("object"==typeof n[o]&&void 0!==n[o].outlets){var i=Lf(n[o].outlets);return new Kp(r,i)}if(0===o&&If(n[0]))r.push(new Xp(t.segments[e].path,n[0])),o++;else{var a=Mf(n[o]),s=o<n.length-1?n[o+1]:null;a&&s&&If(s)?(r.push(new Xp(a,Bf(s))),o+=2):(r.push(new Xp(a,{})),o++)}}return new Kp(r,{})}function Lf(t){var e={};return Hp(t,function(t,n){null!==t&&(e[n]=Ff(new Kp([],{}),0,t))}),e}function Bf(t){var e={};return Hp(t,function(t,n){return e[n]=""+t}),e}function Uf(t,e,n){return t==n.path&&jp(e,n.parameters)}var Vf=function(){function t(t,e,n,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=n,this.forwardEvent=r}return t.prototype.activate=function(t){var e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,t),Tf(this.futureState.root),this.activateChildRoutes(e,n,t)},t.prototype.deactivateChildRoutes=function(t,e,n){var r=this,o=yf(e);t.children.forEach(function(t){var e=t.value.outlet;r.deactivateRoutes(t,o[e],n),delete o[e]}),Hp(o,function(t,e){r.deactivateRouteAndItsChildren(t,n)})},t.prototype.deactivateRoutes=function(t,e,n){var r=t.value,o=e?e.value:null;if(r===o)if(r.component){var i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(t,e,i.children)}else this.deactivateChildRoutes(t,e,n);else o&&this.deactivateRouteAndItsChildren(e,n)},t.prototype.deactivateRouteAndItsChildren=function(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)},t.prototype.detachAndStoreRouteSubtree=function(t,e){var n=e.getContext(t.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),o=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:r,route:t,contexts:o})}},t.prototype.deactivateRouteAndOutlet=function(t,e){var n=this,r=e.getContext(t.value.outlet);if(r){var o=yf(t),i=t.value.component?r.children:e;Hp(o,function(t,e){return n.deactivateRouteAndItsChildren(t,i)}),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}},t.prototype.activateChildRoutes=function(t,e,n){var r=this,o=yf(e);t.children.forEach(function(t){r.activateRoutes(t,o[t.value.outlet],n),r.forwardEvent(new Tp(t.value.snapshot))}),t.children.length&&this.forwardEvent(new Sp(t.value.snapshot))},t.prototype.activateRoutes=function(t,e,n){var r=t.value,o=e?e.value:null;if(Tf(r),r===o)if(r.component){var i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,i.children)}else this.activateChildRoutes(t,e,n);else if(r.component)if(i=n.getOrCreateContext(r.outlet),this.routeReuseStrategy.shouldAttach(r.snapshot)){var a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),i.children.onOutletReAttached(a.contexts),i.attachRef=a.componentRef,i.route=a.route.value,i.outlet&&i.outlet.attach(a.componentRef,a.route.value),jf(a.route)}else{var s=function(t){for(var e=r.snapshot.parent;e;e=e.parent){var n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(),u=s?s.module.componentFactoryResolver:null;i.attachRef=null,i.route=r,i.resolver=u,i.outlet&&i.outlet.activateWith(r,u),this.activateChildRoutes(t,null,i.children)}else this.activateChildRoutes(t,null,n)},t}();function jf(t){Tf(t.value),t.children.forEach(jf)}function zf(t){return"function"==typeof t}function Wf(t){return t instanceof $p}var Hf=function(){return function(t){this.segmentGroup=t||null}}(),Gf=function(){return function(t){this.urlTree=t}}();function qf(t){return new F(function(e){return e.error(new Hf(t))})}function $f(t){return new F(function(e){return e.error(new Gf(t))})}function Kf(t){return new F(function(e){return e.error(new Error("Only absolute redirects can have named outlets. redirectTo: '"+t+"'"))})}var Xf=function(){function t(t,e,n,r,o){this.configLoader=e,this.urlSerializer=n,this.urlTree=r,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(nr)}return t.prototype.apply=function(){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,Np).pipe(rt(function(e){return t.createUrlTree(e,t.urlTree.queryParams,t.urlTree.fragment)})).pipe(ml(function(e){if(e instanceof Gf)return t.allowRedirects=!1,t.match(e.urlTree);if(e instanceof Hf)throw t.noMatchError(e);throw e}))},t.prototype.match=function(t){var e=this;return this.expandSegmentGroup(this.ngModule,this.config,t.root,Np).pipe(rt(function(n){return e.createUrlTree(n,t.queryParams,t.fragment)})).pipe(ml(function(t){if(t instanceof Hf)throw e.noMatchError(t);throw t}))},t.prototype.noMatchError=function(t){return new Error("Cannot match any routes. URL Segment: '"+t.segmentGroup+"'")},t.prototype.createUrlTree=function(t,e,n){var r,o=t.segments.length>0?new Kp([],((r={})[Np]=t,r)):t;return new $p(o,e,n)},t.prototype.expandSegmentGroup=function(t,e,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(t,e,n).pipe(rt(function(t){return new Kp([],t)})):this.expandSegment(t,n,e,n.segments,r,!0)},t.prototype.expandChildren=function(t,e,n){var r=this;return function(n,o){if(0===Object.keys(n).length)return Hc({});var i=[],a=[],s={};return Hp(n,function(n,o){var u,c,l=(u=o,c=n,r.expandSegmentGroup(t,e,c,u)).pipe(rt(function(t){return s[o]=t}));o===Np?i.push(l):a.push(l)}),Hc.apply(null,i.concat(a)).pipe(Zc(),vl(),rt(function(){return s}))}(n.children)},t.prototype.expandSegment=function(t,e,n,r,o,i){var a=this;return Hc.apply(void 0,f(n)).pipe(rt(function(s){return a.expandSegmentAgainstRoute(t,e,n,s,r,o,i).pipe(ml(function(t){if(t instanceof Hf)return Hc(null);throw t}))}),Zc(),_l(function(t){return!!t}),ml(function(t,n){if(t instanceof $c||"EmptyError"===t.name){if(a.noLeftoversInUrl(e,r,o))return Hc(new Kp([],{}));throw new Hf(e)}throw t}))},t.prototype.noLeftoversInUrl=function(t,e,n){return 0===e.length&&!t.children[n]},t.prototype.expandSegmentAgainstRoute=function(t,e,n,r,o,i,a){return Jf(r)!==i?qf(e):void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,o):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,n,r,o,i):qf(e)},t.prototype.expandSegmentAgainstRouteUsingRedirect=function(t,e,n,r,o,i){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,i):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,r,o,i)},t.prototype.expandWildCardWithParamsAgainstRouteUsingRedirect=function(t,e,n,r){var o=this,i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?$f(i):this.lineralizeSegments(n,i).pipe(ut(function(n){var i=new Kp(n,{});return o.expandSegment(t,i,e,n,r,!1)}))},t.prototype.expandRegularSegmentAgainstRouteUsingRedirect=function(t,e,n,r,o,i){var a=this,s=Qf(e,r,o),u=s.consumedSegments,c=s.lastChild,l=s.positionalParamSegments;if(!s.matched)return qf(e);var h=this.applyRedirectCommands(u,r.redirectTo,l);return r.redirectTo.startsWith("/")?$f(h):this.lineralizeSegments(r,h).pipe(ut(function(r){return a.expandSegment(t,e,n,r.concat(o.slice(c)),i,!1)}))},t.prototype.matchSegmentAgainstRoute=function(t,e,n,r){var o=this;if("**"===n.path)return n.loadChildren?this.configLoader.load(t.injector,n).pipe(rt(function(t){return n._loadedConfig=t,new Kp(r,{})})):Hc(new Kp(r,{}));var i=Qf(e,n,r),s=i.consumedSegments,u=i.lastChild;if(!i.matched)return qf(e);var c=r.slice(u);return this.getChildConfig(t,n,r).pipe(ut(function(t){var n=t.module,r=t.routes,i=function(t,e,n,r){return n.length>0&&function(t,e,n){return r.some(function(n){return Zf(t,e,n)&&Jf(n)!==Np})}(t,n)?{segmentGroup:Yf(new Kp(e,function(t,e){var n,r,o={};o[Np]=e;try{for(var i=h(t),a=i.next();!a.done;a=i.next()){var s=a.value;""===s.path&&Jf(s)!==Np&&(o[Jf(s)]=new Kp([],{}))}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}(r,new Kp(n,t.children)))),slicedSegments:[]}:0===n.length&&function(t,e,n){return r.some(function(n){return Zf(t,e,n)})}(t,n)?{segmentGroup:Yf(new Kp(t.segments,function(t,e,n,r){var o,i,s={};try{for(var u=h(n),c=u.next();!c.done;c=u.next()){var l=c.value;Zf(t,e,l)&&!r[Jf(l)]&&(s[Jf(l)]=new Kp([],{}))}}catch(p){o={error:p}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}return a({},r,s)}(t,n,r,t.children))),slicedSegments:n}:{segmentGroup:t,slicedSegments:n}}(e,s,c,r),u=i.segmentGroup,l=i.slicedSegments;return 0===l.length&&u.hasChildren()?o.expandChildren(n,r,u).pipe(rt(function(t){return new Kp(s,t)})):0===r.length&&0===l.length?Hc(new Kp(s,{})):o.expandSegment(n,u,r,l,Np,!0).pipe(rt(function(t){return new Kp(s.concat(t.segments),t.children)}))}))},t.prototype.getChildConfig=function(t,e,n){var r=this;return e.children?Hc(new Fp(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?Hc(e._loadedConfig):function(t,e,n){var r,o=e.canLoad;return o&&0!==o.length?st(o).pipe(rt(function(r){var o,i=t.get(r);if(function(t){return t&&zf(t.canLoad)}(i))o=i.canLoad(e,n);else{if(!zf(i))throw new Error("Invalid CanLoad guard");o=i(e,n)}return Gp(o)})).pipe(Zc(),(r=function(t){return!0===t},function(t){return t.lift(new Cl(r,void 0,t))})):Hc(!0)}(t.injector,e,n).pipe(ut(function(n){return n?r.configLoader.load(t.injector,e).pipe(rt(function(t){return e._loadedConfig=t,t})):function(t){return new F(function(e){return e.error(Pp("Cannot load children because the guard of the route \"path: '"+t.path+"'\" returned false"))})}(e)})):Hc(new Fp([],t))},t.prototype.lineralizeSegments=function(t,e){for(var n=[],r=e.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Hc(n);if(r.numberOfChildren>1||!r.children[Np])return Kf(t.redirectTo);r=r.children[Np]}},t.prototype.applyRedirectCommands=function(t,e,n){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,n)},t.prototype.applyRedirectCreatreUrlTree=function(t,e,n,r){var o=this.createSegmentGroup(t,e.root,n,r);return new $p(o,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)},t.prototype.createQueryParams=function(t,e){var n={};return Hp(t,function(t,r){if("string"==typeof t&&t.startsWith(":")){var o=t.substring(1);n[r]=e[o]}else n[r]=t}),n},t.prototype.createSegmentGroup=function(t,e,n,r){var o=this,i=this.createSegments(t,e.segments,n,r),a={};return Hp(e.children,function(e,i){a[i]=o.createSegmentGroup(t,e,n,r)}),new Kp(i,a)},t.prototype.createSegments=function(t,e,n,r){var o=this;return e.map(function(e){return e.path.startsWith(":")?o.findPosParam(t,e,r):o.findOrReturn(e,n)})},t.prototype.findPosParam=function(t,e,n){var r=n[e.path.substring(1)];if(!r)throw new Error("Cannot redirect to '"+t+"'. Cannot find '"+e.path+"'.");return r},t.prototype.findOrReturn=function(t,e){var n,r,o=0;try{for(var i=h(e),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.path===t.path)return e.splice(o),s;o++}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t},t}();function Qf(t,e,n){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var r=(e.matcher||Op)(n,t,e);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function Yf(t){if(1===t.numberOfChildren&&t.children[Np]){var e=t.children[Np];return new Kp(t.segments.concat(e.segments),e.children)}return t}function Zf(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Jf(t){return t.outlet||Np}var td=function(){return function(t){this.path=t,this.route=this.path[this.path.length-1]}}(),ed=function(){return function(t,e){this.component=t,this.route=e}}();function nd(t,e,n){var r=function(t){if(!t)return null;for(var e=t.parent;e;e=e.parent){var n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(r?r.module.injector:n).get(t)}function rd(t,e,n,r,o){void 0===o&&(o={canDeactivateChecks:[],canActivateChecks:[]});var i=yf(e);return t.children.forEach(function(t){!function(t,e,n,r,o){void 0===o&&(o={canDeactivateChecks:[],canActivateChecks:[]});var i=t.value,a=e?e.value:null,s=n?n.getContext(t.value.outlet):null;if(a&&i.routeConfig===a.routeConfig){var u=function(t,e,n){switch(n){case"pathParamsChange":return!Qp(t.url,e.url);case"always":return!0;case"paramsOrQueryParamsChange":return!kf(t,e)||!jp(t.queryParams,e.queryParams);case"paramsChange":default:return!kf(t,e)}}(a,i,i.routeConfig.runGuardsAndResolvers);u?o.canActivateChecks.push(new td(r)):(i.data=a.data,i._resolvedData=a._resolvedData),rd(t,e,i.component?s?s.children:null:n,r,o),u&&o.canDeactivateChecks.push(new ed(s&&s.outlet&&s.outlet.component||null,a))}else a&&od(e,s,o),o.canActivateChecks.push(new td(r)),rd(t,null,i.component?s?s.children:null:n,r,o)}(t,i[t.value.outlet],n,r.concat([t.value]),o),delete i[t.value.outlet]}),Hp(i,function(t,e){return od(t,n.getContext(e),o)}),o}function od(t,e,n){var r=yf(t),o=t.value;Hp(r,function(t,r){od(t,o.component?e?e.children.getContext(r):null:e,n)}),n.canDeactivateChecks.push(new ed(o.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,o))}var id=Symbol("INITIAL_VALUE");function ad(){return Sl(function(t){return(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=null,r=null;return H(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&d(t[0])&&(t=t[0]),at(t,r).lift(new Xc(n))}).apply(void 0,f(t.map(function(t){return t.pipe(wl(1),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n=t[t.length-1];H(n)?t.pop():n=null;var r=t.length;return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1===t.length||2===t.length&&H(t[1])?st(t[0]):Zc()(Hc.apply(void 0,t))}(1!==r||n?r>0?at(t,n):zc(n):Wc(t[0]),e)}}(id))}))).pipe(kl(function(t,e){var n=!1;return e.reduce(function(t,r,o){if(t!==id)return t;if(r===id&&(n=!0),!n){if(!1===r)return r;if(o===e.length-1||Wf(r))return r}return t},t)},id),Jc(function(t){return t!==id}),rt(function(t){return Wf(t)?t:!0===t}),wl(1))})}function sd(t,e){return null!==t&&e&&e(new Rp(t)),Hc(!0)}function ud(t,e){return null!==t&&e&&e(new Ep(t)),Hc(!0)}function cd(t,e,n){var r=e.routeConfig?e.routeConfig.canActivate:null;return r&&0!==r.length?Hc(r.map(function(r){return Yc(function(){var o,i=nd(r,e,n);if(function(t){return t&&zf(t.canActivate)}(i))o=Gp(i.canActivate(e,t));else{if(!zf(i))throw new Error("Invalid CanActivate guard");o=Gp(i(e,t))}return o.pipe(_l())})})).pipe(ad()):Hc(!0)}function ld(t,e,n){var r=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(function(t){return function(t){var e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(t)}).filter(function(t){return null!==t}).map(function(e){return Yc(function(){return Hc(e.guards.map(function(o){var i,a=nd(o,e.node,n);if(function(t){return t&&zf(t.canActivateChild)}(a))i=Gp(a.canActivateChild(r,t));else{if(!zf(a))throw new Error("Invalid CanActivateChild guard");i=Gp(a(r,t))}return i.pipe(_l())})).pipe(ad())})});return Hc(o).pipe(ad())}var hd=function(){return function(){}}(),pd=function(){function t(t,e,n,r,o,i){this.rootComponentType=t,this.config=e,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=o,this.relativeLinkResolution=i}return t.prototype.recognize=function(){try{var t=vd(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,Np),n=new Cf([],Object.freeze({}),Object.freeze(a({},this.urlTree.queryParams)),this.urlTree.fragment,{},Np,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new gf(n,e),o=new Ef(this.url,r);return this.inheritParamsAndData(o._root),Hc(o)}catch(pm){return new F(function(e){return e.error(pm)})}},t.prototype.inheritParamsAndData=function(t){var e=this,n=t.value,r=_f(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(function(t){return e.inheritParamsAndData(t)})},t.prototype.processSegmentGroup=function(t,e,n){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,n)},t.prototype.processChildren=function(t,e){var n,r=this,o=Yp(e,function(e,n){return r.processSegmentGroup(t,e,n)});return n={},o.forEach(function(t){var e=n[t.value.outlet];if(e){var r=e.url.map(function(t){return t.toString()}).join("/"),o=t.value.url.map(function(t){return t.toString()}).join("/");throw new Error("Two segments cannot have the same outlet name: '"+r+"' and '"+o+"'.")}n[t.value.outlet]=t.value}),o.sort(function(t,e){return t.value.outlet===Np?-1:e.value.outlet===Np?1:t.value.outlet.localeCompare(e.value.outlet)}),o},t.prototype.processSegment=function(t,e,n,r){var o,i;try{for(var a=h(t),s=a.next();!s.done;s=a.next()){var u=s.value;try{return this.processSegmentAgainstRoute(u,e,n,r)}catch(pm){if(!(pm instanceof hd))throw pm}}}catch(c){o={error:c}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}if(this.noLeftoversInUrl(e,n,r))return[];throw new hd},t.prototype.noLeftoversInUrl=function(t,e,n){return 0===e.length&&!t.children[n]},t.prototype.processSegmentAgainstRoute=function(t,e,n,r){if(t.redirectTo)throw new hd;if((t.outlet||Np)!==r)throw new hd;var o,i=[],s=[];if("**"===t.path){var u=n.length>0?Wp(n).parameters:{};o=new Cf(n,u,Object.freeze(a({},this.urlTree.queryParams)),this.urlTree.fragment,yd(t),r,t.component,t,fd(e),dd(e)+n.length,wd(t))}else{var c=function(t,e,n){if(""===e.path){if("full"===e.pathMatch&&(t.hasChildren()||n.length>0))throw new hd;return{consumedSegments:[],lastChild:0,parameters:{}}}var r=(e.matcher||Op)(n,t,e);if(!r)throw new hd;var o={};Hp(r.posParams,function(t,e){o[e]=t.path});var i=r.consumed.length>0?a({},o,r.consumed[r.consumed.length-1].parameters):o;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:i}}(e,t,n);i=c.consumedSegments,s=n.slice(c.lastChild),o=new Cf(i,c.parameters,Object.freeze(a({},this.urlTree.queryParams)),this.urlTree.fragment,yd(t),r,t.component,t,fd(e),dd(e)+i.length,wd(t))}var l=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),h=vd(e,i,s,l,this.relativeLinkResolution),p=h.segmentGroup,f=h.slicedSegments;if(0===f.length&&p.hasChildren()){var d=this.processChildren(l,p);return[new gf(o,d)]}if(0===l.length&&0===f.length)return[new gf(o,[])];var v=this.processSegment(l,p,f,Np);return[new gf(o,v)]},t}();function fd(t){for(var e=t;e._sourceSegment;)e=e._sourceSegment;return e}function dd(t){for(var e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;e._sourceSegment;)n+=(e=e._sourceSegment)._segmentIndexShift?e._segmentIndexShift:0;return n-1}function vd(t,e,n,r,o){if(n.length>0&&function(t,e,n){return r.some(function(n){return md(t,e,n)&&gd(n)!==Np})}(t,n)){var i=new Kp(e,function(t,e,n,r){var o,i,a={};a[Np]=r,r._sourceSegment=t,r._segmentIndexShift=e.length;try{for(var s=h(n),u=s.next();!u.done;u=s.next()){var c=u.value;if(""===c.path&&gd(c)!==Np){var l=new Kp([],{});l._sourceSegment=t,l._segmentIndexShift=e.length,a[gd(c)]=l}}}catch(p){o={error:p}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return a}(t,e,r,new Kp(n,t.children)));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(t,e,n){return r.some(function(n){return md(t,e,n)})}(t,n)){var s=new Kp(t.segments,function(t,e,n,r,o,i){var s,u,c={};try{for(var l=h(r),p=l.next();!p.done;p=l.next()){var f=p.value;if(md(t,n,f)&&!o[gd(f)]){var d=new Kp([],{});d._sourceSegment=t,d._segmentIndexShift="legacy"===i?t.segments.length:e.length,c[gd(f)]=d}}}catch(v){s={error:v}}finally{try{p&&!p.done&&(u=l.return)&&u.call(l)}finally{if(s)throw s.error}}return a({},o,c)}(t,e,n,r,t.children,o));return s._sourceSegment=t,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:n}}var u=new Kp(t.segments,t.children);return u._sourceSegment=t,u._segmentIndexShift=e.length,{segmentGroup:u,slicedSegments:n}}function md(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function gd(t){return t.outlet||Np}function yd(t){return t.data||{}}function wd(t){return t.resolve||{}}function bd(t,e,n,r){var o=nd(t,e,r);return Gp(o.resolve?o.resolve(e,n):o(e,n))}function xd(t){return function(e){return e.pipe(Sl(function(e){var n=t(e);return n?st(n).pipe(rt(function(){return e})):st([e])}))}}var _d=function(){return function(){}}(),Cd=function(){function t(){}return t.prototype.shouldDetach=function(t){return!1},t.prototype.store=function(t,e){},t.prototype.shouldAttach=function(t){return!1},t.prototype.retrieve=function(t){return null},t.prototype.shouldReuseRoute=function(t,e){return t.routeConfig===e.routeConfig},t}(),Ed=new It("ROUTES"),Sd=function(){function t(t,e,n,r){this.loader=t,this.compiler=e,this.onLoadStartListener=n,this.onLoadEndListener=r}return t.prototype.load=function(t,e){var n=this;return this.onLoadStartListener&&this.onLoadStartListener(e),this.loadModuleFactory(e.loadChildren).pipe(rt(function(r){n.onLoadEndListener&&n.onLoadEndListener(e);var o=r.create(t);return new Fp(zp(o.injector.get(Ed)).map(Vp),o)}))},t.prototype.loadModuleFactory=function(t){var e=this;return"string"==typeof t?st(this.loader.load(t)):Gp(t()).pipe(ut(function(t){return t instanceof rr?Hc(t):st(e.compiler.compileModuleAsync(t))}))},t}(),Rd=function(){return function(){}}(),Td=function(){function t(){}return t.prototype.shouldProcessUrl=function(t){return!0},t.prototype.extract=function(t){return t},t.prototype.merge=function(t,e){return t},t}();function kd(t){throw t}function Id(t,e,n){return e.parse("/")}function Nd(t,e){return Hc(null)}var Ad=function(){function t(t,e,n,r,o,i,a,s){var u=this;this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=n,this.location=r,this.config=s,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new z,this.errorHandler=kd,this.malformedUriErrorHandler=Id,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Nd,afterPreactivation:Nd},this.urlHandlingStrategy=new Td,this.routeReuseStrategy=new Cd,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=o.get(nr),this.console=o.get(mi);var c=o.get(Ti);this.isNgZoneEnabled=c instanceof Ti,this.resetConfig(s),this.currentUrlTree=new $p(new Kp([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.configLoader=new Sd(i,a,function(t){return u.triggerEvent(new _p(t))},function(t){return u.triggerEvent(new Cp(t))}),this.routerState=bf(this.currentUrlTree,this.rootComponentType),this.transitions=new Gc({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",state:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return t.prototype.setupNavigations=function(t){var e=this,n=this.events;return t.pipe(Jc(function(t){return 0!==t.id}),rt(function(t){return a({},t,{extractedUrl:e.urlHandlingStrategy.extract(t.rawUrl)})}),Sl(function(t){var r,o,i,s,u=!1,c=!1;return Hc(t).pipe(Sl(function(t){var r,o,i,s,u=!e.navigated||t.extractedUrl.toString()!==e.currentUrlTree.toString();if(("reload"===e.onSameUrlNavigation||u)&&e.urlHandlingStrategy.shouldProcessUrl(t.rawUrl))return Hc(t).pipe(sl(function(t){return"eager"===e.urlUpdateStrategy&&!t.extras.skipLocationChange&&e.setBrowserUrl(t.rawUrl,!!t.extras.replaceUrl,t.id)}),Sl(function(t){var r=e.transitions.getValue();return n.next(new fp(t.id,e.serializeUrl(t.extractedUrl),t.source,t.state)),r!==e.transitions.getValue()?jc:[t]}),Sl(function(t){return Promise.resolve(t)}),(r=e.ngModule.injector,o=e.configLoader,i=e.urlSerializer,s=e.config,function(t){return t.pipe(Sl(function(t){return function(e,n,r,o,i){return new Xf(e,n,r,t.extractedUrl,i).apply()}(r,o,i,0,s).pipe(rt(function(e){return a({},t,{urlAfterRedirects:e})}))}))}),function(t,n,r,o,i){return function(r){return r.pipe(ut(function(r){return function(t,e,n,r,o,i){return void 0===o&&(o="emptyOnly"),void 0===i&&(i="legacy"),new pd(t,e,n,r,o,i).recognize()}(t,n,r.urlAfterRedirects,(s=r.urlAfterRedirects,e.serializeUrl(s)),o,i).pipe(rt(function(t){return a({},r,{targetSnapshot:t})}));var s}))}}(e.rootComponentType,e.config,0,e.paramsInheritanceStrategy,e.relativeLinkResolution),sl(function(t){var r=new gp(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);n.next(r)}));if(u&&e.rawUrlTree&&e.urlHandlingStrategy.shouldProcessUrl(e.rawUrlTree)){var c=t.extractedUrl,l=t.source,h=t.state,p=t.extras,f=new fp(t.id,e.serializeUrl(c),l,h);n.next(f);var d=bf(c,e.rootComponentType).snapshot;return Hc(a({},t,{targetSnapshot:d,urlAfterRedirects:c,extras:a({},p,{skipLocationChange:!1,replaceUrl:!1})}))}return e.rawUrlTree=t.rawUrl,t.resolve(null),jc}),xd(function(t){var n=t.extras;return e.hooks.beforePreactivation(t.targetSnapshot,{navigationId:t.id,appliedUrlTree:t.extractedUrl,rawUrlTree:t.rawUrl,skipLocationChange:!!n.skipLocationChange,replaceUrl:!!n.replaceUrl})}),sl(function(t){var n=new yp(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.triggerEvent(n)}),rt(function(t){return a({},t,{guards:(n=t.targetSnapshot,r=t.currentSnapshot,o=e.rootContexts,i=n._root,rd(i,r?r._root:null,o,[i.value]))});var n,r,o,i}),function(t,e){return function(n){return n.pipe(ut(function(n){var r=n.targetSnapshot,o=n.currentSnapshot,i=n.guards,s=i.canActivateChecks,u=i.canDeactivateChecks;return 0===u.length&&0===s.length?Hc(a({},n,{guardsResult:!0})):function(t,e,n,r){return st(u).pipe(ut(function(t){return function(t,e,n,r,o){var i=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return i&&0!==i.length?Hc(i.map(function(i){var a,s=nd(i,e,o);if(function(t){return t&&zf(t.canDeactivate)}(s))a=Gp(s.canDeactivate(t,e,n,r));else{if(!zf(s))throw new Error("Invalid CanDeactivate guard");a=Gp(s(t,e,n,r))}return a.pipe(_l())})).pipe(ad()):Hc(!0)}(t.component,t.route,n,e,r)}),_l(function(t){return!0!==t},!0))}(0,r,o,t).pipe(ut(function(n){return n&&"boolean"==typeof n?function(t,e,n,r){return st(s).pipe(Al(function(e){return st([ud(e.route.parent,r),sd(e.route,r),ld(t,e.path,n),cd(t,e.route,n)]).pipe(Zc(),_l(function(t){return!0!==t},!0))}),_l(function(t){return!0!==t},!0))}(r,0,t,e):Hc(n)}),rt(function(t){return a({},n,{guardsResult:t})}))}))}}(e.ngModule.injector,function(t){return e.triggerEvent(t)}),sl(function(t){if(Wf(t.guardsResult)){var n=Pp('Redirecting to "'+e.serializeUrl(t.guardsResult)+'"');throw n.url=t.guardsResult,n}}),sl(function(t){var n=new wp(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot,!!t.guardsResult);e.triggerEvent(n)}),Jc(function(t){if(!t.guardsResult){e.resetUrlToCurrentUrlTree();var r=new vp(t.id,e.serializeUrl(t.extractedUrl),"");return n.next(r),t.resolve(!1),!1}return!0}),xd(function(t){if(t.guards.canActivateChecks.length)return Hc(t).pipe(sl(function(t){var n=new bp(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.triggerEvent(n)}),(n=e.paramsInheritanceStrategy,r=e.ngModule.injector,function(t){return t.pipe(ut(function(t){var e=t.targetSnapshot,o=t.guards.canActivateChecks;return o.length?st(o).pipe(Al(function(t){return function(t,n,r,o){return function(t,e,n,r){var o=Object.keys(t);if(0===o.length)return Hc({});if(1===o.length){var i=o[0];return bd(t[i],e,n,r).pipe(rt(function(t){var e;return(e={})[i]=t,e}))}var a={};return st(o).pipe(ut(function(o){return bd(t[o],e,n,r).pipe(rt(function(t){return a[o]=t,t}))})).pipe(vl(),rt(function(){return a}))}(t._resolve,t,e,o).pipe(rt(function(e){return t._resolvedData=e,t.data=a({},t.data,_f(t,r).resolve),null}))}(t.route,0,n,r)}),function(t,e){return arguments.length>=2?function(e){return P(kl(t,void 0),ol(1),pl(void 0))(e)}:function(e){return P(kl(function(e,n,r){return t(e)}),ol(1))(e)}}(function(t,e){return t}),rt(function(e){return t})):Hc(t)}))}),sl(function(t){var n=new xp(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.triggerEvent(n)}));var n,r}),xd(function(t){var n=t.extras;return e.hooks.afterPreactivation(t.targetSnapshot,{navigationId:t.id,appliedUrlTree:t.extractedUrl,rawUrlTree:t.rawUrl,skipLocationChange:!!n.skipLocationChange,replaceUrl:!!n.replaceUrl})}),rt(function(t){var n,r,o,i=(o=function t(e,n,r){if(r&&e.shouldReuseRoute(n.value,r.value.snapshot)){(u=r.value)._futureSnapshot=n.value;var o=function(e,n,r){return n.children.map(function(n){var o,i;try{for(var a=h(r.children),s=a.next();!s.done;s=a.next()){var u=s.value;if(e.shouldReuseRoute(u.value.snapshot,n.value))return t(e,n,u)}}catch(c){o={error:c}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}return t(e,n)})}(e,n,r);return new gf(u,o)}var i=e.retrieve(n.value);if(i){var a=i.route;return function t(e,n){if(e.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=e.value;for(var r=0;r<e.children.length;++r)t(e.children[r],n.children[r])}(n,a),a}var s,u=new xf(new Gc((s=n.value).url),new Gc(s.params),new Gc(s.queryParams),new Gc(s.fragment),new Gc(s.data),s.outlet,s.component,s);return o=n.children.map(function(n){return t(e,n)}),new gf(u,o)}(e.routeReuseStrategy,(n=t.targetSnapshot)._root,(r=t.currentRouterState)?r._root:void 0),new wf(o,n));return a({},t,{targetRouterState:i})}),sl(function(t){e.currentUrlTree=t.urlAfterRedirects,e.rawUrlTree=e.urlHandlingStrategy.merge(e.currentUrlTree,t.rawUrl),e.routerState=t.targetRouterState,"deferred"!==e.urlUpdateStrategy||t.extras.skipLocationChange||e.setBrowserUrl(e.rawUrlTree,!!t.extras.replaceUrl,t.id)}),(o=e.rootContexts,i=e.routeReuseStrategy,s=function(t){return e.triggerEvent(t)},rt(function(t){return new Vf(i,t.targetRouterState,t.currentRouterState,s).activate(o),t})),sl({next:function(){u=!0},complete:function(){u=!0}}),(r=function(){if(!u&&!c){e.resetUrlToCurrentUrlTree();var r=new vp(t.id,e.serializeUrl(t.extractedUrl),"Navigation ID "+t.id+" is not equal to the current navigation id "+e.navigationId);n.next(r),t.resolve(!1)}},function(t){return t.lift(new Dl(r))}),ml(function(r){if(c=!0,(s=r)&&s[Mp]){e.navigated=!0;var o=Wf(r.url);o||e.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl);var i=new vp(t.id,e.serializeUrl(t.extractedUrl),r.message);n.next(i),t.resolve(!1),o&&e.navigateByUrl(r.url)}else{e.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl);var a=new mp(t.id,e.serializeUrl(t.extractedUrl),r);n.next(a);try{t.resolve(e.errorHandler(r))}catch(u){t.reject(u)}}var s;return jc}))}))},t.prototype.resetRootComponentType=function(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType},t.prototype.getTransition=function(){return this.transitions.value},t.prototype.setTransition=function(t){this.transitions.next(a({},this.getTransition(),t))},t.prototype.initialNavigation=function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})},t.prototype.setUpLocationChangeListener=function(){var t=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe(function(e){var n=t.parseUrl(e.url),r="popstate"===e.type?"popstate":"hashchange",o=e.state&&e.state.navigationId?{navigationId:e.state.navigationId}:null;setTimeout(function(){t.scheduleNavigation(n,r,o,{replaceUrl:!0})},0)}))},Object.defineProperty(t.prototype,"url",{get:function(){return this.serializeUrl(this.currentUrlTree)},enumerable:!0,configurable:!0}),t.prototype.triggerEvent=function(t){this.events.next(t)},t.prototype.resetConfig=function(t){Lp(t),this.config=t.map(Vp),this.navigated=!1,this.lastSuccessfulId=-1},t.prototype.ngOnDestroy=function(){this.dispose()},t.prototype.dispose=function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)},t.prototype.createUrlTree=function(t,e){void 0===e&&(e={});var n=e.relativeTo,r=e.queryParams,o=e.fragment,i=e.preserveQueryParams,s=e.queryParamsHandling,u=e.preserveFragment;Co()&&i&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var c=n||this.routerState.root,l=u?this.currentUrlTree.fragment:o,h=null;if(s)switch(s){case"merge":h=a({},this.currentUrlTree.queryParams,r);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=r||null}else h=i?this.currentUrlTree.queryParams:r||null;return null!==h&&(h=this.removeEmptyProps(h)),function(t,e,n,r,o){if(0===n.length)return Nf(e.root,e.root,e,r,o);var i=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new Af(!0,0,t);var e=0,n=!1,r=t.reduce(function(t,r,o){if("object"==typeof r&&null!=r){if(r.outlets){var i={};return Hp(r.outlets,function(t,e){i[e]="string"==typeof t?t.split("/"):t}),f(t,[{outlets:i}])}if(r.segmentPath)return f(t,[r.segmentPath])}return"string"!=typeof r?f(t,[r]):0===o?(r.split("/").forEach(function(r,o){0==o&&"."===r||(0==o&&""===r?n=!0:".."===r?e++:""!=r&&t.push(r))}),t):f(t,[r])},[]);return new Af(n,e,r)}(n);if(i.toRoot())return Nf(e.root,new Kp([],{}),e,r,o);var a=function(t,n,r){if(t.isAbsolute)return new Df(e.root,!0,0);if(-1===r.snapshot._lastPathIndex)return new Df(r.snapshot._urlSegment,!0,0);var o=If(t.commands[0])?0:1;return function(e,n,i){for(var a=r.snapshot._urlSegment,s=r.snapshot._lastPathIndex+o,u=t.numberOfDoubleDots;u>s;){if(u-=s,!(a=a.parent))throw new Error("Invalid number of '../'");s=a.segments.length}return new Df(a,!1,s-u)}()}(i,0,t),s=a.processChildren?Of(a.segmentGroup,a.index,i.commands):Pf(a.segmentGroup,a.index,i.commands);return Nf(a.segmentGroup,s,e,r,o)}(c,this.currentUrlTree,t,h,l)},t.prototype.navigateByUrl=function(t,e){void 0===e&&(e={skipLocationChange:!1}),Co()&&this.isNgZoneEnabled&&!Ti.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");var n=Wf(t)?t:this.parseUrl(t),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,e)},t.prototype.navigate=function(t,e){return void 0===e&&(e={skipLocationChange:!1}),function(t){for(var e=0;e<t.length;e++){var n=t[e];if(null==n)throw new Error("The requested path contains "+n+" segment at index "+e)}}(t),this.navigateByUrl(this.createUrlTree(t,e),e)},t.prototype.serializeUrl=function(t){return this.urlSerializer.serialize(t)},t.prototype.parseUrl=function(t){var e;try{e=this.urlSerializer.parse(t)}catch(pm){e=this.malformedUriErrorHandler(pm,this.urlSerializer,t)}return e},t.prototype.isActive=function(t,e){if(Wf(t))return qp(this.currentUrlTree,t,e);var n=this.parseUrl(t);return qp(this.currentUrlTree,n,e)},t.prototype.removeEmptyProps=function(t){return Object.keys(t).reduce(function(e,n){var r=t[n];return null!=r&&(e[n]=r),e},{})},t.prototype.processNavigations=function(){var t=this;this.navigations.subscribe(function(e){t.navigated=!0,t.lastSuccessfulId=e.id,t.events.next(new dp(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(t.currentUrlTree))),e.resolve(!0)},function(e){t.console.warn("Unhandled Navigation Error: ")})},t.prototype.scheduleNavigation=function(t,e,n,r){var o=this.getTransition();if(o&&"imperative"!==e&&"imperative"===o.source&&o.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(o&&"hashchange"==e&&"popstate"===o.source&&o.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(o&&"popstate"==e&&"hashchange"===o.source&&o.rawUrl.toString()===t.toString())return Promise.resolve(!0);var i=null,a=null,s=new Promise(function(t,e){i=t,a=e}),u=++this.navigationId;return this.setTransition({id:u,source:e,state:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:r,resolve:i,reject:a,promise:s,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),s.catch(function(t){return Promise.reject(t)})},t.prototype.setBrowserUrl=function(t,e,n){var r=this.urlSerializer.serialize(t);this.location.isCurrentPathEqualTo(r)||e?this.location.replaceState(r,"",{navigationId:n}):this.location.go(r,"",{navigationId:n})},t.prototype.resetStateAndUrl=function(t,e,n){this.routerState=t,this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()},t.prototype.resetUrlToCurrentUrlTree=function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})},t}(),Dd=function(){return function(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Md,this.attachRef=null}}(),Md=function(){function t(){this.contexts=new Map}return t.prototype.onChildOutletCreated=function(t,e){var n=this.getOrCreateContext(t);n.outlet=e,this.contexts.set(t,n)},t.prototype.onChildOutletDestroyed=function(t){var e=this.getContext(t);e&&(e.outlet=null)},t.prototype.onOutletDeactivated=function(){var t=this.contexts;return this.contexts=new Map,t},t.prototype.onOutletReAttached=function(t){this.contexts=t},t.prototype.getOrCreateContext=function(t){var e=this.getContext(t);return e||(e=new Dd,this.contexts.set(t,e)),e},t.prototype.getContext=function(t){return this.contexts.get(t)||null},t}(),Pd=function(){function t(t,e,n,r,o){this.parentContexts=t,this.location=e,this.resolver=n,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new qo,this.deactivateEvents=new qo,this.name=r||Np,t.onChildOutletCreated(this.name,this)}return t.prototype.ngOnDestroy=function(){this.parentContexts.onChildOutletDestroyed(this.name)},t.prototype.ngOnInit=function(){if(!this.activated){var t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}},Object.defineProperty(t.prototype,"isActivated",{get:function(){return!!this.activated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRoute",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRouteData",{get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}},enumerable:!0,configurable:!0}),t.prototype.detach=function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var t=this.activated;return this.activated=null,this._activatedRoute=null,t},t.prototype.attach=function(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)},t.prototype.deactivate=function(){if(this.activated){var t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}},t.prototype.activateWith=function(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;var n=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,o=new Od(t,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,o),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)},t}(),Od=function(){function t(t,e,n){this.route=t,this.childContexts=e,this.parent=n}return t.prototype.get=function(t,e){return t===xf?this.route:t===Md?this.childContexts:this.parent.get(t,e)},t}(),Fd=function(){return function(){}}(),Ld=function(){function t(){}return t.prototype.preload=function(t,e){return e().pipe(ml(function(){return Hc(null)}))},t}(),Bd=function(){function t(){}return t.prototype.preload=function(t,e){return Hc(null)},t}(),Ud=function(){function t(t,e,n,r,o){this.router=t,this.injector=r,this.preloadingStrategy=o,this.loader=new Sd(e,n,function(e){return t.triggerEvent(new _p(e))},function(e){return t.triggerEvent(new Cp(e))})}return t.prototype.setUpPreloading=function(){var t=this;this.subscription=this.router.events.pipe(Jc(function(t){return t instanceof dp}),Al(function(){return t.preload()})).subscribe(function(){})},t.prototype.preload=function(){var t=this.injector.get(nr);return this.processRoutes(t,this.router.config)},t.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},t.prototype.processRoutes=function(t,e){var n,r,o=[];try{for(var i=h(e),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.loadChildren&&!s.canLoad&&s._loadedConfig){var u=s._loadedConfig;o.push(this.processRoutes(u.module,u.routes))}else s.loadChildren&&!s.canLoad?o.push(this.preloadConfig(t,s)):s.children&&o.push(this.processRoutes(t,s.children))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return st(o).pipe(pt(),rt(function(t){}))},t.prototype.preloadConfig=function(t,e){var n=this;return this.preloadingStrategy.preload(e,function(){return n.loader.load(t.injector,e).pipe(ut(function(t){return e._loadedConfig=t,n.processRoutes(t.module,t.routes)}))})},t}(),Vd=function(){function t(t,e,n){void 0===n&&(n={}),this.router=t,this.viewportScroller=e,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}return t.prototype.init=function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()},t.prototype.createScrollEvents=function(){var t=this;return this.router.events.subscribe(function(e){e instanceof fp?(t.store[t.lastId]=t.viewportScroller.getScrollPosition(),t.lastSource=e.navigationTrigger,t.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof dp&&(t.lastId=e.id,t.scheduleScrollEvent(e,t.router.parseUrl(e.urlAfterRedirects).fragment))})},t.prototype.consumeScrollEvents=function(){var t=this;return this.router.events.subscribe(function(e){e instanceof kp&&(e.position?"top"===t.options.scrollPositionRestoration?t.viewportScroller.scrollToPosition([0,0]):"enabled"===t.options.scrollPositionRestoration&&t.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===t.options.anchorScrolling?t.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==t.options.scrollPositionRestoration&&t.viewportScroller.scrollToPosition([0,0]))})},t.prototype.scheduleScrollEvent=function(t,e){this.router.triggerEvent(new kp(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,e))},t.prototype.ngOnDestroy=function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()},t}(),jd=new It("ROUTER_CONFIGURATION"),zd=new It("ROUTER_FORROOT_GUARD"),Wd=[Bl,{provide:Zp,useClass:Jp},{provide:Ad,useFactory:Qd,deps:[Hi,Zp,Md,Bl,zn,qi,bi,Ed,jd,[Rd,new Gt],[_d,new Gt]]},Md,{provide:xf,useFactory:Yd,deps:[Ad]},{provide:qi,useClass:Qi},Ud,Bd,Ld,{provide:jd,useValue:{enableTracing:!1}}];function Hd(){return new Ui("Router",Ad)}var Gd=function(){function t(t,e){}var e;return e=t,t.forRoot=function(t,n){return{ngModule:e,providers:[Wd,Xd(t),{provide:zd,useFactory:Kd,deps:[[Ad,new Gt,new $t]]},{provide:jd,useValue:n||{}},{provide:Fl,useFactory:$d,deps:[Pl,[new Ht(Ll),new Gt],jd]},{provide:Vd,useFactory:qd,deps:[Ad,eh,jd]},{provide:Fd,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:Bd},{provide:Ui,multi:!0,useFactory:Hd},[Zd,{provide:ui,multi:!0,useFactory:Jd,deps:[Zd]},{provide:ev,useFactory:tv,deps:[Zd]},{provide:vi,multi:!0,useExisting:ev}]]}},t.forChild=function(t){return{ngModule:e,providers:[Xd(t)]}},t}();function qd(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new Vd(t,e,n)}function $d(t,e,n){return void 0===n&&(n={}),n.useHash?new Vl(t,e):new jl(t,e)}function Kd(t){if(t)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Xd(t){return[{provide:Dt,multi:!0,useValue:t},{provide:Ed,multi:!0,useValue:t}]}function Qd(t,e,n,r,o,i,a,s,u,c,l){void 0===u&&(u={});var h=new Ad(null,e,n,r,o,i,a,zp(s));if(c&&(h.urlHandlingStrategy=c),l&&(h.routeReuseStrategy=l),u.errorHandler&&(h.errorHandler=u.errorHandler),u.malformedUriErrorHandler&&(h.malformedUriErrorHandler=u.malformedUriErrorHandler),u.enableTracing){var p=oh();h.events.subscribe(function(t){p.logGroup("Router Event: "+t.constructor.name),p.log(t.toString()),p.log(t),p.logGroupEnd()})}return u.onSameUrlNavigation&&(h.onSameUrlNavigation=u.onSameUrlNavigation),u.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=u.paramsInheritanceStrategy),u.urlUpdateStrategy&&(h.urlUpdateStrategy=u.urlUpdateStrategy),u.relativeLinkResolution&&(h.relativeLinkResolution=u.relativeLinkResolution),h}function Yd(t){return t.routerState.root}var Zd=function(){function t(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new z}return t.prototype.appInitializer=function(){var t=this;return this.injector.get(Ol,Promise.resolve(null)).then(function(){var e=null,n=new Promise(function(t){return e=t}),r=t.injector.get(Ad),o=t.injector.get(jd);if(t.isLegacyDisabled(o)||t.isLegacyEnabled(o))e(!0);else if("disabled"===o.initialNavigation)r.setUpLocationChangeListener(),e(!0);else{if("enabled"!==o.initialNavigation)throw new Error("Invalid initialNavigation options: '"+o.initialNavigation+"'");r.hooks.afterPreactivation=function(){return t.initNavigation?Hc(null):(t.initNavigation=!0,e(!0),t.resultOfPreactivationDone)},r.initialNavigation()}return n})},t.prototype.bootstrapListener=function(t){var e=this.injector.get(jd),n=this.injector.get(Ud),r=this.injector.get(Vd),o=this.injector.get(Ad),i=this.injector.get(Hi);t===i.components[0]&&(this.isLegacyEnabled(e)?o.initialNavigation():this.isLegacyDisabled(e)&&o.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),o.resetRootComponentType(i.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())},t.prototype.isLegacyEnabled=function(t){return"legacy_enabled"===t.initialNavigation||!0===t.initialNavigation||void 0===t.initialNavigation},t.prototype.isLegacyDisabled=function(t){return"legacy_disabled"===t.initialNavigation||!1===t.initialNavigation},t}();function Jd(t){return t.appInitializer.bind(t)}function tv(t){return t.bootstrapListener.bind(t)}var ev=new It("Router Initializer"),nv=qa({encapsulation:2,styles:[],data:{}});function rv(t){return Nu(0,[(t()(),bs(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),su(1,212992,null,0,Pd,[Md,Ji,eo,[8,null],ea],null,null)],function(t,e){t(e,1,0)},null)}function ov(t){return Nu(0,[(t()(),bs(0,0,null,null,1,"ng-component",[],null,null,null,rv,nv)),su(1,49152,null,0,Ip,[],null,null)],null,null)}var iv=Bs("ng-component",Ip,ov,{},{},[]),av=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function sv(t,e){function n(){this.constructor=t}av(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var uv=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};function cv(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function lv(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var hv={},pv={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function fv(t){t in hv||(document.createElement("canvas").addEventListener("webglcontextlost",function(e){e.preventDefault(),delete hv[t]},!1),hv[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=document.createElement("canvas");return 1===t?e.getContext("webgl",pv)||e.getContext("experimental-webgl",pv):e.getContext("webgl2",pv)}(t));var e=hv[t];return e.isContextLost()?(delete hv[t],fv(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),hv[t])}function dv(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function vv(t,e,n){return Math.max(t,Math.min(e,n))}function mv(t){return t%2==0?t:t+1}function gv(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function yv(t,e){var n=Math.random();return e*n+(1-n)*t}function wv(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function bv(t,e,n){void 0===n&&(n=""),wv(Ev(t,e),n+" Shapes "+t+" and "+e+" must match")}function xv(t){wv(null!=t,"The input to the tensor constructor must be a non-null value.")}function _v(t,e){if(void 0===e&&(e=[]),Array.isArray(t)||Lv(t))for(var n=0;n<t.length;++n)_v(t[n],e);else e.push(t);return e}function Cv(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function Ev(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Sv(t){return t%1==0}function Rv(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function Tv(t){for(var e=Math.floor(Math.sqrt(t));e>1;--e)if(t%e==0)return[e,t/e];return[1,t]}function kv(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function Iv(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{var s=e(++i);null!=n&&i>=n?o():setTimeout(a,s)}};a()})}function Nv(t,e){for(var n=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var i=t.slice();return i[r]=e/n,i}function Av(t,e){for(var n=[],r=[],o=0,i=0;i<t.length;++i){if(null!=e){if(e[o]===i&&1!==t[i])throw new Error("Can't squeeze axis "+i+" since its dim '"+t[i]+"' is not 1");(null==e[o]||e[o]>i)&&1===t[i]&&(n.push(t[i]),r.push(i)),e[o]<=i&&o++}1!==t[i]&&(n.push(t[i]),r.push(i))}return{newShape:n,keptDims:r}}function Dv(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function Mv(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function Pv(t,e,n){if("float32"===e)for(var r=0;r<t.length;r++)if(isNaN(t[r]))throw Error("The result of the '"+n+"' has NaNs.")}function Ov(t,e){if("float32"!==e)for(var n=0;n<t.length;n++)if(isNaN(t[n]))throw Error("NaN is not a valid value for dtype: '"+e+"'.")}function Fv(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function Lv(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Bv(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function Uv(t){if(null==t)return 0;var e=0;return t.forEach(function(t){return e+=2*t.length}),e}function Vv(t){return"string"==typeof t||t instanceof String}function jv(t){return"boolean"==typeof t}function zv(t){return"number"==typeof t}function Wv(t){return t instanceof Array?Wv(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":zv(t)?"float32":Vv(t)?"string":jv(t)?"bool":"float32"}function Hv(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Gv(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function qv(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function $v(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(Array.isArray(t)&&(t=_v(t)),null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return n&&Ov(t,e),new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function Kv(t,e){for(var n=Xv(t,e),r=0;r<n.length;r++)n[r]=1;return n}function Xv(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function Qv(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof process){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}Object.freeze({shuffle:dv,clamp:vv,nearestLargerEven:mv,sum:gv,randUniform:yv,distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(e[r]);n+=o*o}return n},assert:wv,assertShapesMatch:bv,assertNonNull:xv,flatten:_v,sizeFromShape:Cv,isScalarShape:function(t){return 0===t.length},arraysEqual:Ev,isInt:Sv,tanh:Rv,sizeToSquarishShape:Tv,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return dv(e),e},rightPad:kv,repeatedTry:Iv,inferFromImplicitShape:Nv,squeezeShape:Av,getTypedArrayFromDType:Dv,getArrayFromDType:Mv,checkComputationForNaN:Pv,checkConversionForNaN:Ov,hasEncodingLoss:Fv,isTypedArray:Lv,bytesPerElement:Bv,bytesFromStringArray:Uv,isString:Vv,isBoolean:jv,isNumber:zv,inferDtype:Wv,isFunction:Hv,nearestDivisor:Gv,computeStrides:qv,toTypedArray:$v,makeOnesTypedArray:Kv,makeZerosTypedArray:Xv,now:Qv});var Yv=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new Zv)}return t.prototype.profileKernel=function(t,e){var n,r=this,o=this.backendTimer.time(function(){n=e()});return(Array.isArray(n)?n:[n]).forEach(function(e){var n=e.dataSync();Pv(n,e.dtype,t),o.then(function(o){var i="";null!=o.getExtraProfileInfo&&(i=o.getExtraProfileInfo()),r.logger.logKernelProfile(t,e,n,o.kernelMs,i)})}),n},t}(),Zv=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,o){var i=kv(r+"ms",9),a=kv(t,25),s=e.rank,u=e.size,c=kv(e.shape.toString(),14);console.log("%c"+a+"\t%c"+i+"\t%c"+s+"D "+c+"\t%c"+u+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},t}(),Jv=7;function tm(t,e){return kv(Array.isArray(t)?parseFloat(t[0].toFixed(Jv))+" + "+parseFloat(t[1].toFixed(Jv))+"j":Vv(t)?"'"+t+"'":parseFloat(t.toFixed(Jv)).toString(),e)}function em(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var nm=function(){function t(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=Cv(t),null!=n){var r=n.length;wv(r===this.size,"Length of values '"+r+"' does not match the size inferred by the shape '"+this.size+"'.")}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Mv(e,Cv(this.shape)),this.strides=qv(t)}return t.prototype.set=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length&&(e=[0]),wv(e.length===this.rank,"The number of provided coordinates ("+e.length+") must match the rank ("+this.rank+")");var r=this.locToIndex(e);this.values[r]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.values[n]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return am.make(this.shape,{values:this.values},this.dtype)},t}(),rm=null,om=null;function im(t){rm=t}var am=function(){function t(t,e,n,r){this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Cv(t),this.strides=qv(t),this.dataId=null!=r?r:{},this.id=rm().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",rm().registerTensor(this),null!=n&&rm().write(this.dataId,n)}return t.make=function(e,n,r){return new t(e,r,n.values,n.dataId)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),wv(1===this.size,"The array must have only 1 element."),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,o){return this.throwIfDisposed(),this.reshape([t,e,n,r,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),om.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];wv(t.length===this.rank,"Number of coordinates in get() must match the rank of the tensor"),wv("complex64"!==this.dtype,"Tensor.get() is not supported for complex64 tensors yet."),this.throwIfDisposed(),0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.dataSync()[n]},t.prototype.buffer=function(){return om.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.data=function(){return cv(this,void 0,void 0,function(){return lv(this,function(t){return this.throwIfDisposed(),[2,rm().read(this.dataId)]})})},t.prototype.dataSync=function(){return this.throwIfDisposed(),rm().readSync(this.dataId)},t.prototype.dispose=function(){this.isDisposed||(rm().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),om.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),om.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),om.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),om.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),om.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),om.clone(this)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var o=qv(e),i=function(t,e,n,r){var o=Cv(e),i=r[r.length-1],a=new Array(i).fill(0),s=e.length,u="complex64"===n?em(t):t;if(s>1)for(var c=0;c<o/i;c++)for(var l=c*i,h=0;h<i;h++)a[h]=Math.max(a[h],tm(u[l+h],0).length);return a}(t,e,n,o),a=e.length,s=function t(e,n,r,o,i,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[tm(em(e)[0],0)]:[e[0].toString()];if(1===c){if(u>20){var l=Array.from(e.slice(0,3*s)),h=Array.from(e.slice(u-3*s,u));return"complex64"===r&&(l=em(l),h=em(h)),["["+l.map(function(t,e){return tm(t,i[e])}).join(", ")+", ..., "+h.map(function(t,e){return tm(t,i[u-3+e])}).join(", ")+"]"]}return["["+("complex64"===r?em(e):Array.from(e)).map(function(t,e){return tm(t,i[e])}).join(", ")+"]"]}var p=n.slice(1),f=o.slice(1),d=o[0]*s,v=[];if(u>20){for(var m=0;m<3;m++){var g=(y=m*d)+d;v.push.apply(v,t(e.slice(y,g),p,r,f,i,!1))}for(v.push("..."),m=u-3;m<u;m++)g=(y=m*d)+d,v.push.apply(v,t(e.slice(y,g),p,r,f,i,m===u-1))}else for(m=0;m<u;m++){var y;g=(y=m*d)+d,v.push.apply(v,t(e.slice(y,g),p,r,f,i,m===u-1))}var w=2===c?",":"";for(v[0]="["+v[0]+w,m=1;m<v.length-1;m++)v[m]=" "+v[m]+w;var b=",\n";for(m=2;m<c;m++)b+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(a?"":b),v}(t,e,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(t){return"    "+t}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),om.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),om.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),om.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),om.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),om.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),om.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),om.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),om.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),om.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),om.stack([this,t],e)},t.prototype.unstack=function(t,e){return void 0===e&&(e=0),om.unstack(this,e)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),om.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,o){return void 0===n&&(n=.001),this.throwIfDisposed(),om.batchNormalization(this,t,e,n,r,o)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),om.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),om.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),om.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),om.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),om.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),om.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),om.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),om.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),om.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),om.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),om.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),om.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),om.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),om.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),om.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),om.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),om.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),om.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),om.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),om.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),om.div(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),om.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),om.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),om.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),om.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),om.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),om.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),om.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),om.modStrict(this,t)},t.prototype.squaredDifference=function(t){return this.throwIfDisposed(),om.squaredDifference(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),om.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),om.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),om.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),om.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),om.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),om.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),om.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),om.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),om.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),om.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),om.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),om.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),om.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),om.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),om.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),om.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),om.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),om.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),om.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),om.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),om.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),om.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),om.sign(this)},t.prototype.exp=function(){return this.throwIfDisposed(),om.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),om.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),om.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),om.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),om.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),om.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),om.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),om.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),om.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),om.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),om.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),om.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),om.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),om.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),om.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),om.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),om.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),om.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),om.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),om.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),om.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),om.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),om.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),om.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),om.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),om.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),om.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),om.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),om.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),om.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),om.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),om.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),om.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),om.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),om.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),om.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),om.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),om.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),om.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,o,i){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),om.conv1d(this,t,e,n,r,o,i)},t.prototype.conv2d=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),om.conv2d(this,t,e,n,r,o,i)},t.prototype.conv2dTranspose=function(t,e,n,r,o){return this.throwIfDisposed(),om.conv2dTranspose(this,t,e,n,r,o)},t.prototype.depthwiseConv2D=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),om.depthwiseConv2d(this,t,e,n,r,o,i)},t.prototype.separableConv2d=function(t,e,n,r,o,i){return void 0===o&&(o=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),om.separableConv2d(this,t,e,n,r,o,i)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),om.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),om.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),om.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,o){return this.throwIfDisposed(),om.pool(this,t,e,n,r,o)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),fm.variable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),om.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),om.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),om.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),om.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,o){return void 0===r&&(r=0),void 0===o&&(o=0),this.throwIfDisposed(),om.stridedSlice(this,t,e,n,r,o)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),om.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),om.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),om.spectral.ifft(this)},t}();Object.defineProperty(am,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.shape&&null!=t.dtype}});var sm,um,cm,lm,hm,pm,fm=function(t){function e(e,n,r){void 0===n&&(n=!0);var o=t.call(this,e.shape,e.dtype,null,e.dataId)||this;o.trainable=n,o.name=r,null==o.name&&(o.name=rm().nextVariableId().toString());try{rm().registerVariable(o)}catch(t){throw rm().disposeTensor(o),t}return o}return sv(e,t),e.variable=function(t,n,r,o){return void 0===n&&(n=!0),null!=o&&o!==t.dtype&&(t=t.asType(o)),new e(t,n,r)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Ev(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");rm().disposeTensor(this),this.dataId=t.dataId,rm().registerTensor(this)},e}(am);Object.defineProperty(fm,Symbol.hasInstance,{value:function(t){return t instanceof am&&null!=t.assign&&t.assign instanceof Function}}),(pm=sm||(sm={})).R0="R0",pm.R1="R1",pm.R2="R2",pm.R3="R3",pm.R4="R4",pm.R5="R5",pm.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(um||(um={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(cm||(cm={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(lm||(lm={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(hm||(hm={}));var dm={float32:lm,int32:um,bool:cm,complex64:hm};function vm(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return dm[t][e]}function mm(t){return vm(t,"int32")}function gm(t,e){if(t.dtype===e.dtype)return[t,e];var n=vm(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function ym(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof am)n.push(e);else if(function(t){return Array.isArray(t)||"object"==typeof t}(e)){var o=e;for(var i in o){var a=o[i];r.has(a)||(r.add(a),t(a,n,r))}}}(t,e,new Set),e}var wm,bm=function(){function t(t,e,n){this.backend=t,this.safeMode=e,this.debugMode=n,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientScopeCount=0,this.customGradientDepth=0,this.scopeStack=[],this.keepTensors=new Set,this.tensorInfo=new WeakMap,this.profiler=new Yv(t),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.moveData=function(t){this.write(t,this.readSync(t))},t.prototype.tidy=function(t,e,n){var r=this;void 0===n&&(n=!1);var o,i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return r.startScope(i,n)},function(){return r.endScope(o,n)},function(){return(o=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o})},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.runKernel=function(t,e,n){var r,o=this,i=[],a=function(t){return i.push(t),t},s=this.activeScope.name,u=this.numBytes,c=this.numTensors;if(this.scopedRun(function(){return o.customGradientDepth++},function(){return o.customGradientDepth--},function(){r=o.debugMode()?o.profiler.profileKernel(s,function(){return t(o.backend,a)}):t(o.backend,a)}),this.shouldRecord()){var l={id:this.nextTapeNodeId++,name:s,inputs:e,outputs:Array.isArray(r)?r:[r]};null!=n&&(l.gradient=function(t){return n(t,i)}),this.activeTape.push(l)}return this.profiling&&this.activeProfile.kernels.push({name:s,bytesAdded:this.numBytes-u,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-c,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShape:Array.isArray(r)?r.map(function(t){return t.shape}):r.shape}),r},t.prototype.registerTensor=function(t){var e=this.tensorInfo.has(t.dataId)?this.tensorInfo.get(t.dataId).refCount:0;if(this.numTensors++,"string"===t.dtype&&this.numStringTensors++,0===e){this.numDataBuffers++;var n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=Cv(t.shape)*Bv(t.dtype)),this.tensorInfo.set(t.dataId,{backend:this.backend,dtype:t.dtype,shape:t.shape,bytes:n,refCount:0}),this.numBytes+=n,this.backend.register(t.dataId,t.shape,t.dtype)}this.tensorInfo.get(t.dataId).refCount++,t instanceof fm||this.track(t)},t.prototype.registerVariable=function(t){if(null!=this.registeredVariables[t.name])throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},t.prototype.disposeTensor=function(t){if(this.tensorInfo.has(t.dataId)){this.keepTensors.has(t.id)&&this.keepTensors.delete(t.id),this.numTensors--,"string"===t.dtype&&this.numStringTensors--;var e=this.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.numBytes-=e.bytes),this.numDataBuffers--,e.backend.disposeData(t.dataId),this.tensorInfo.delete(t.dataId)):this.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.registeredVariables)this.disposeTensor(this.registeredVariables[t]),delete this.registeredVariables[t]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,this.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return cv(this,void 0,void 0,function(){var e,n;return lv(this,function(r){return this.profiling=!0,e=this.numBytes,n=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=t(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-e,this.activeProfile.newTensors=this.numTensors-n,[2,this.activeProfile]})})},t.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},t.prototype.addTapeNode=function(t,e,n){var r={};t.forEach(function(t,e){r[e]=t});var o={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:r,outputs:[e],gradient:function(t){var e={};return n(t).forEach(function(t,n){e[n]=function(){return t}}),e}};this.activeTape.push(o)},t.prototype.keep=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(t.id),t},t.prototype.startScope=function(t,e){void 0===e&&(e=!1),e&&0===this.gradientScopeCount&&(this.activeTape=[]),e&&this.gradientScopeCount++;var n={track:[],name:"unnamed scope"};t&&(n.name=t),this.scopeStack.push(n),this.activeScope=n},t.prototype.endScope=function(t,e){var n=this;void 0===e&&(e=!1),e&&(this.gradientScopeCount--,0===this.gradientScopeCount&&(this.activeTape=null));var r=new Set(this.keepTensors),o=ym(t);o.forEach(function(t){return r.add(t.id)});for(var i=0;i<this.activeScope.track.length;i++){var a=this.activeScope.track[i];r.has(a.id)||(null!=this.activeTape?o.push(a):a.dispose())}var s=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?null:this.scopeStack[this.scopeStack.length-1],o.forEach(function(t){!n.keepTensors.has(t.id)&&function(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t.id)return!0;return!1}(t,s.track)&&n.track(t)})},t.prototype.gradients=function(t,e,n,r){var o=this;if(void 0===r&&(r=!1),wv(e.length>0,"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");return this.tidy("gradients",function(){var i=t();wv(i instanceof am,"The result y returned by f() must be a tensor.");var a=function(t,e,n){for(var r={},o={},i=0;i<e.length;i++)r[e[i].id]=!0;for(i=0;i<t.length;i++){var a=(d=t[i]).inputs;for(var s in a){for(var u=a[s],c=!1,l=0;l<e.length;l++)if(r[u.id]){d.outputs.forEach(function(t){return r[t.id]=!0}),c=!0,o[d.id]=!0;break}if(c)break}}var h={};h[n.id]=!0;var p={};for(i=t.length-1;i>=0;i--)for(a=(d=t[i]).inputs,l=0;l<d.outputs.length;l++)if(h[d.outputs[l].id]){for(var s in a)h[a[s].id]=!0,p[d.id]=!0;break}var f=[];for(i=0;i<t.length;i++){var d;if(o[(d=t[i]).id]&&p[d.id]){var v={};for(var s in d.inputs){var m=d.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},d);g.inputs=v,g.outputs=d.outputs,f.push(g)}}return f}(o.activeTape,e,i);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var s={};return s[i.id]=null==n?function(t){var e=Kv(Cv(t),"float32");return am.make(t,{values:e})}(i.shape):n,function(t,e){for(var n=function(n){var r=e[n],o=[];if(r.outputs.forEach(function(e){var n=t[e.id];if(null!=n)o.push(n);else{var r=am.make(e.shape,{values:Xv(e.size,e.dtype)},e.dtype);o.push(r)}}),null==r.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+r.name+".");var i=r.gradient(1===r.outputs.length?o[0]:o);for(var a in r.inputs){if(!(a in i))throw new Error("Cannot backprop through input "+a+". Available gradients found: "+Object.keys(i)+".");var s=i[a]();if("float32"!==s.dtype)throw new Error("Error in gradient for op "+r.name+". The gradient of input "+a+" must have 'float32' dtype, but has '"+s.dtype+"'");var u=r.inputs[a];if(!Ev(s.shape,u.shape))throw new Error("Error in gradient for op "+r.name+". The gradient of input '"+a+"' has shape '"+s.shape+"', which does not match the shape of the input '"+u.shape+"'");if(null==t[u.id])t[u.id]=s;else{var c=t[u.id];t[u.id]=c.add(s),c.dispose()}}},r=e.length-1;r>=0;r--)n(r)}(s,a),{value:i,grads:e.map(function(t){return s[t.id]})}},!0)},t.prototype.customGrad=function(t){var e=this;return wv(Hv(t),"The f passed in customGrad(f) must be a function."),function(){for(var n,r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return wv(o.every(function(t){return t instanceof am}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),e.scopedRun(function(){return e.customGradientDepth++},function(){return e.customGradientDepth--},function(){r=e.tidy(t.name,function(){var e=t.apply(void 0,o),r=e.value,i=e.gradFunc;return wv(r instanceof am,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),wv(Hv(i),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n=i,r},!0)}),e.shouldRecord()&&e.addTapeNode(o,r,function(t){var e=n(t),r=Array.isArray(e)?e:[e];return wv(r.length===o.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),wv(r.every(function(t){return t instanceof am}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),r}),r}},t.prototype.write=function(t,e){var n=this.tensorInfo.get(t);if("string"===n.dtype){var r=Uv(e);this.numBytes+=r-n.bytes,n.bytes=r}this.backend!==n.backend&&(n.backend.disposeData(t),n.backend=this.backend,this.backend.register(t,n.shape,n.dtype)),this.backend.write(t,e)},t.prototype.readSync=function(t){return this.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.tensorInfo.get(t).backend.read(t)},t.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},t.prototype.time=function(t){return cv(this,void 0,void 0,function(){var e,n;return lv(this,function(r){switch(r.label){case 0:return e=Qv(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=Qv()-e,[2,n]}})})},t.prototype.track=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return null!=this.activeScope&&this.activeScope.track.push(t),t},t.nextTensorId=0,t.nextVariableId=0,t}();!function(t){t[t.NUMBER=0]="NUMBER",t[t.BOOLEAN=1]="BOOLEAN",t[t.STRING=2]="STRING"}(wm||(wm={}));var xm,_m=[{name:"DEBUG",type:wm.BOOLEAN},{name:"IS_BROWSER",type:wm.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:wm.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:wm.BOOLEAN},{name:"WEBGL_PACK",type:wm.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:wm.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:wm.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:wm.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:wm.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:wm.NUMBER},{name:"WEBGL_PAGING_ENABLED",type:wm.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:wm.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:wm.BOOLEAN},{name:"WEBGL_VERSION",type:wm.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:wm.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:wm.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:wm.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:wm.NUMBER},{name:"BACKEND",type:wm.STRING},{name:"EPSILON",type:wm.NUMBER},{name:"PROD",type:wm.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:wm.BOOLEAN}];function Cm(t){try{if(null!=fv(t))return!0}catch(t){return!1}return!1}var Em="tfjsflags";function Sm(){var t={};if("undefined"==typeof window||void 0===window.location||void 0===window.location.search)return t;var e=function(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")}),e}(window.location.search);if(Em in e){var n={};e[Em].split(",").forEach(function(t){var e=t.split(":");n[e[0]]=e[1]}),_m.forEach(function(e){e.name in n&&(console.log("Setting feature override from URL "+e.name+": "+n[e.name]),e.type===wm.NUMBER?t[e.name]=+n[e.name]:e.type===wm.BOOLEAN?t[e.name]="true"===n[e.name]:e.type===wm.STRING?t[e.name]=n[e.name]:console.warn("Unknown URL param: "+e.name+"."))})}return t}function Rm(t,e){return null!=t.getExtension(e)}function Tm(t,e){var n=t.createFramebuffer(),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,2===e?t.RGBA32F:t.RGBA,1,1,0,t.RGBA,t.FLOAT,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(n),o}var km=function(){function t(t){this.features={},this.registry={},null!=t&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return t.setBackend=function(t,e){if(void 0===e&&(e=!1),!(t in Im.registry))throw new Error("Backend name '"+t+"' not found in registry");Im.engine.backend=Im.findBackend(t),Im.backendName=t},t.getBackend=function(){return Im.initEngine(),Im.backendName},t.disposeVariables=function(){Im.engine.disposeVariables()},t.memory=function(){return Im.engine.memory()},t.profile=function(t){return Im.engine.profile(t)},t.tidy=function(t,e){return Im.engine.tidy(t,e)},t.dispose=function(t){ym(t).forEach(function(t){return t.dispose()})},t.keep=function(t){return Im.engine.keep(t)},t.time=function(t){return Im.engine.time(t)},t.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},t.prototype.getFeatures=function(){return this.features},t.prototype.set=function(t,e){this.features[t]=e},t.prototype.getBestBackendName=function(){var t=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(e){return{name:e,entry:t.registry[e]}}).sort(function(t,e){return e.entry.priority-t.entry.priority})[0].name},t.prototype.evaluateFeature=function(t){if("DEBUG"===t)return!1;if("IS_BROWSER"===t)return"undefined"!=typeof window;if("IS_NODE"===t)return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node;if("IS_CHROME"===t)return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if("WEBGL_CPU_FORWARD"===t)return!0;if("WEBGL_PACK"===t)return!1;if("WEBGL_PACK_BATCHNORMALIZATION"===t)return this.get("WEBGL_PACK");if("WEBGL_PACK_CLIP"===t)return this.get("WEBGL_PACK");if("WEBGL_PACK_DEPTHWISECONV"===t)return this.get("WEBGL_PACK");if("WEBGL_LAZILY_UNPACK"===t)return this.get("WEBGL_PACK");if("WEBGL_CONV_IM2COL"===t)return this.get("WEBGL_PACK");if("WEBGL_PAGING_ENABLED"===t)return this.get("IS_BROWSER")&&!this.get("PROD");if("WEBGL_MAX_TEXTURE_SIZE"===t)return function(t){if(null==xm){var e=fv(t);xm=e.getParameter(e.MAX_TEXTURE_SIZE)}return xm}(this.get("WEBGL_VERSION"));if("IS_TEST"===t)return!1;if("BACKEND"===t)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===t){var e=this.get("WEBGL_VERSION");return 0===e?0:function(t){if(0===t)return 0;var e=fv(t);return Rm(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:Rm(e,"EXT_disjoint_timer_query")?1:0}(e)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===t)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}();if("HAS_WEBGL"===t)return this.get("WEBGL_VERSION")>0;if("WEBGL_VERSION"===t)return Cm(2)?2:Cm(1)?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===t)return function(t){if(0===t)return!1;var e=fv(t);if(1===t){if(!Rm(e,"OES_texture_float"))return!1}else if(!Rm(e,"EXT_color_buffer_float"))return!1;return Tm(e,t)}(this.get("WEBGL_VERSION"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===t)return function(t){if(0===t)return!1;var e=fv(t);if(1===t){if(!Rm(e,"OES_texture_float"))return!1;if(!Rm(e,"WEBGL_color_buffer_float"))return!1}else if(!Rm(e,"EXT_color_buffer_float"))return!1;return Tm(e,t)}(this.get("WEBGL_VERSION"));if("WEBGL_FENCE_API_ENABLED"===t)return function(t){return 2===t&&null!=fv(t).fenceSync}(this.get("WEBGL_VERSION"));if("WEBGL_SIZE_UPLOAD_UNIFORM"===t)return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if("TEST_EPSILON"===t)return 32===this.backend.floatPrecision()?.001:.1;if("EPSILON"===t)return 32===this.backend.floatPrecision()?1e-7:1e-4;if("PROD"===t)return!1;if("TENSORLIKE_CHECK_SHAPE_CONSISTENCY"===t)return!this.get("PROD");throw new Error("Unknown feature "+t+".")},t.prototype.setFeatures=function(t){this.features=Object.assign({},t)},t.prototype.reset=function(){this.features=Sm(),null!=this.globalEngine&&(this.globalEngine=null)},Object.defineProperty(t.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),t.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},t.prototype.registerBackend=function(t,e,n,r){var o=this;if(void 0===n&&(n=1),t in this.registry)return console.warn(t+" backend was already registered. Reusing existing backend"),null!=r&&r(function(){return o.engine}),!1;try{var i=e();return i.setDataMover({moveData:function(t){return o.engine.moveData(t)}}),this.registry[t]={backend:i,priority:n},!0}catch(e){return console.warn("Registration of backend "+t+" failed"),console.warn(e.stack||e.message),!1}},t.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(t.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),t.prototype.initEngine=function(){var t=this;if(null==this.globalEngine){this.backendName=this.get("BACKEND");var e=this.findBackend(this.backendName);this.globalEngine=new bm(e,!1,function(){return t.get("DEBUG")})}},t}(),Im=function(){var t=function(){var t;if("undefined"!=typeof window)t=window;else{if("undefined"==typeof process)throw new Error("Could not find a global object");t=process}return t}();return null==t.ENV&&(t.ENV=new km(Sm()),im(function(){return t.ENV.engine})),t.ENV}();function Nm(t){return Im.engine.customGrad(t)}Object.freeze({EPSILON_FLOAT16:1e-4,EPSILON_FLOAT32:1e-7,Environment:km,ENV:Im});var Am=km.tidy,Dm=km.keep,Mm=km.dispose;function Pm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Im.get("IS_TEST")||console.warn.apply(console,t)}function Om(t,e,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=e.length,a=0;a<i;++a)o=o.concat([t[a+1]/e[a],e[a]]);o=o.concat(t.slice(i+1))}return o}function Fm(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var o=e+1;o<t;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*e+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function Lm(t,e,n,r){void 0===r&&(r=!0);var o=[];o.push(r?t[0]/n:t[0]*n);for(var i=1;i<t.length;++i)o.push(i<=e.length?r?e[i-1]*t[i]:t[i]/e[i-1]:t[i]);return o}function Bm(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function Um(t,e,n){for(var r=t.slice(0,1),o=0;o<n;++o)r.push(t[o+1]-e[o][0]-e[o][1]);return r}function Vm(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function jm(t,e){for(var n=[],r=t.length,o=0;o<r;o++)-1===e.indexOf(o)&&n.push(t[o]);return[n,e.map(function(e){return t[e]})]}function zm(t,e){return function(t,e,n){for(var r=t.length+e.length,o=[],i=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(t[i++]):o.push(e[a++]);return o}(t,e.map(function(t){return 1}),e)}function Wm(t,e){var n=e.length;return wv((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-n&&t<n}),"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t),wv(t.every(function(t){return Sv(t)}),"All values in axis param must be integers but got axis "+t),t.map(function(t){return t<0?n+t:t})}function Hm(t,e,n){wv(Vm(e,n),t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input.")}function Gm(t,e){if(Vm(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach(function(t){return n.push(t)}),n}function qm(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function $m(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function Km(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function Xm(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=t.shape,s=n.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var c=qv(t.shape).map(function(t){return t/u}).concat([1]).slice(0,r);return[s,o,u,c]}var Qm=30;function Ym(t){return t<=Qm?t:Gv(t,Math.floor(Math.sqrt(t)))}function Zm(t,e,n){for(var r=e.rank>1?e.shape[e.rank-1]:1,o=n.length,i=1,a=r;a<o;++a)i*=n[a];var s=e.size/(r<1?1:r),u=qv(n).concat([1]);return{sliceRank:r,numUpdates:s,sliceSize:i,strides:u.slice(u.length-r,u.length),outputSize:Cv(n)}}function Jm(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var c=[],l=[],h=[],p=0;p<t.length;p++)c[p]=tg(o,e,r,t,p),l[p]=eg(i,n,r,t,p),u&1<<p&&(l[p]=c[p]+1,h.push(p));var f=new Array(t.length).fill(0);return f=f.map(function(t,e){for(var n=0,o=c[e];!(r[e]>0?o>=l[e]:o<=l[e]);o+=r[e])n+=1;return n}),[c,f,h]}function tg(t,e,n,r,o){var i=e[o];t&1<<o&&(i=n[o]>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[o];return i<0&&(i+=a),vv(0,i,a-1)}function eg(t,e,n,r,o){var i=e[o];t&1<<o&&(i=n[o]>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[o];return i<0&&(i+=a),n[o]>0?vv(0,i,a):vv(-1,i,a-1)}function ng(t){var e=t;if(Lv(t))return[t.length];if(!Array.isArray(t))return[];for(var n=[];e instanceof Array||Lv(e);)n.push(e.length),e=e[0];return t instanceof Array&&Im.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],e instanceof Array||Lv(e)){wv(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),wv(e.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"});for(var o=n.slice(1),i=0;i<e.length;++i)t(e[i],o,r.concat(i))}else wv(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(t,n,[]),n}function rg(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function og(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof am)return rg(r,t.dtype,e,n),t;var o=Wv(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),rg(r,o,e,n),!Lv(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+t.constructor.name+"'");var i=ng(t);Lv(t)||Array.isArray(t)||(t=[t]);var a="string"!==o?$v(t,o,Im.get("DEBUG")):_v(t);return am.make(i,{values:a},o)}function ig(t,e,n){if(!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(t,r){return og(t,e+"["+r+"]",n)})}function ag(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Im.engine.startScope(n);try{var o=r.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Im.engine.endScope(o),o}catch(t){throw Im.engine.endScope(null),t}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}var sg=ag({softmax_:function(t,e){void 0===e&&(e=-1);var n=og(t,"logits","softmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return Nm(function(t){var n=t.logSumExp([e],!0),r=t.toFloat().sub(n).exp();return{value:r,gradFunc:function(t){var n=t.mul(r);return n.sub(n.sum([e],!0).mul(r))}}})(n)}}),ug=ag({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=og(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return Nm(function(t){var n=t.max(e,!0),r=t.sub(n),o=r.toFloat().sub(r.exp().sum(e,!0).log());return{value:o,gradFunc:function(t){var n=o.exp();return t.sub(t.sum(e,!0).mul(n))}}})(n)}}),cg=ag({complex_:function(t,e){var n=og(t,"real","complex"),r=og(e,"imag","complex");return bv(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Im.engine.runKernel(function(t){return t.complex(n,r)},{$real:n,$imag:r})}}),lg=ag({real_:function(t){var e=og(t,"input","real");return Im.engine.runKernel(function(t){return t.real(e)},{$input:e})}}),hg=ag({imag_:function(t){var e=og(t,"input","imag");return Im.engine.runKernel(function(t){return t.imag(e)},{$input:e})}});function pg(t,e,n){if(null==n&&(n=Wv(t)),"complex64"===n)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Lv(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var r=ng(t);if(null!=e){var o=Cv(e),i=Cv(r);wv(o===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<r.length;++a){var s=a!==r.length-1||r[a]!==Cv(e.slice(a));wv(r[a]===e[a]||!s,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+e+"). "})}}return Lv(t)||Array.isArray(t)||(t=[t]),e=e||r,t="string"!==n?$v(t,n,Im.get("DEBUG")):_v(t),am.make(e,{values:t},n)}function fg(t,e){if((Lv(t)||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return pg(t,[],e)}function dg(t,e){xv(t);var n=ng(t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return pg(t,n,e)}function vg(t,e,n){if(xv(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=ng(t);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return pg(t,e=e||r,n)}function mg(t,e,n){if(xv(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=ng(t);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return pg(t,e=e||r,n)}function gg(t,e,n){if(xv(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=ng(t);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return pg(t,e=e||r,n)}function yg(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=yg(t,"float32"),r=yg(t,"float32");return cg(n,r)}var o=Kv(Cv(t),e);return am.make(t,{values:o},e)}function wg(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=wg(t,"float32"),r=wg(t,"float32");return cg(n,r)}var o=Xv(Cv(t),e);return am.make(t,{values:o},e)}function bg(t,e,n){var r=Mv(n=n||Wv(e),Cv(t));return r.fill(e),am.make(t,{values:r},n)}function xg(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return wg([0],r);var o=Xv(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return dg(o,r)}var _g=ag({onesLike_:function(t){var e=og(t,"x","onesLike");return yg(e.shape,e.dtype)}}),Cg=ag({zerosLike_:function(t){var e=og(t,"x","zerosLike");return wg(e.shape,e.dtype)}}),Eg=function(){function t(t){this.dataMover=t,this.data=new WeakMap}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(t),this.data.get(t)},t.prototype.set=function(t,e){this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.data.delete(t)},t}();function Sg(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=wg(t.shape),o=t.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!Fv(t.dtype,e))return am.make(t.shape,{dataId:t.dataId},e);if("complex64"===t.dtype){var a=n.real(t);return i=a.cast(e),a.dispose(),i}if("int32"===e)return n.int(t);if("bool"===e){var s=fg(0,t.dtype);return i=n.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: unknown dtype argument ("+e+")")}function Rg(t,e){return am.make(e,{dataId:t.dataId},t.dtype)}function Tg(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function kg(t,e){return{real:t[2*e],imag:t[2*e+1]}}function Ig(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function Ng(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function Ag(t,e,n,r,o){for(var i=Array.from(e).map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>o}).sort(function(t,e){return e.score-t.score}),a=[],s=0;s<i.length;s++){var u=i[s],c=u.boxIndex;if(u.score<o)break;for(var l=!1,h=a.length-1;h>=0;--h)if(Dg(t,c,a[h])>=r){l=!0;break}if(!l&&(a.push(c),a.length>=n))break}return dg(a,"int32")}function Dg(t,e,n){var r=t.subarray(4*e,4*e+4),o=t.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),f=(s-i)*(u-a),d=(h-c)*(p-l);if(f<=0||d<=0)return 0;var v=Math.max(i,c),m=Math.max(a,l),g=Math.min(s,h),y=Math.min(u,p),w=Math.max(g-v,0)*Math.max(y-m,0);return w/(f+d-w)}function Mg(t,e,n){var r=Array(t.rank).fill(0),o=t.shape.slice();return e.map(function(e){o[n]=e;var i=t.slice(r,o);return r[n]+=e,i})}function Pg(t,e,n,r,o){for(var i=e[e.length-1],a=[t.length/i,i],s=a[0],u=a[1],c=Dv(n,s*r),l=Dv("int32",s*r),h=0;h<s;h++){for(var p=h*u,f=t.subarray(p,p+u),d=[],v=0;v<f.length;v++)d.push({value:f[v],index:v});d.sort(function(t,e){return e.value-t.value});var m=h*r,g=c.subarray(m,m+r),y=l.subarray(m,m+r);for(v=0;v<r;v++)g[v]=d[v].value,y[v]=d[v].index}var w=e.slice();return w[w.length-1]=r,[pg(c,w,n),pg(l,w,"int32")]}!function(){function t(){}t.prototype.time=function(t){throw new Error("Not yet implemented.")},t.prototype.read=function(t){throw new Error("Not yet implemented.")},t.prototype.readSync=function(t){throw new Error("Not yet implemented.")},t.prototype.disposeData=function(t){throw new Error("Not yet implemented.")},t.prototype.write=function(t,e){throw new Error("Not yet implemented.")},t.prototype.fromPixels=function(t,e){throw new Error("Not yet implemented.")},t.prototype.register=function(t,e,n){throw new Error("Not yet implemented.")},t.prototype.memory=function(){throw new Error("Not yet implemented.")},t.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},t.prototype.batchMatMul=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.slice=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){throw new Error("Not yet implemented")},t.prototype.reverse=function(t,e){throw new Error("Not yet implemented")},t.prototype.concat=function(t,e){throw new Error("Not yet implemented")},t.prototype.neg=function(t){throw new Error("Not yet implemented")},t.prototype.add=function(t,e){throw new Error("Not yet implemented")},t.prototype.addN=function(t){throw new Error("Not yet implemented")},t.prototype.subtract=function(t,e){throw new Error("Not yet implemented")},t.prototype.multiply=function(t,e){throw new Error("Not yet implemented")},t.prototype.realDivide=function(t,e){throw new Error("Not yet implemented")},t.prototype.floorDiv=function(t,e){throw new Error("Not yet implemented")},t.prototype.sum=function(t,e){throw new Error("Not yet implemented")},t.prototype.prod=function(t,e){throw new Error("Not yet implemented")},t.prototype.unsortedSegmentSum=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.argMin=function(t,e){throw new Error("Not yet implemented")},t.prototype.argMax=function(t,e){throw new Error("Not yet implemented")},t.prototype.equal=function(t,e){throw new Error("Not yet implemented")},t.prototype.notEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.less=function(t,e){throw new Error("Not yet implemented")},t.prototype.lessEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.greater=function(t,e){throw new Error("Not yet implemented")},t.prototype.greaterEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalNot=function(t){throw new Error("Not yet implemented")},t.prototype.logicalAnd=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalOr=function(t,e){throw new Error("Not yet implemented")},t.prototype.where=function(t){throw new Error("Not yet implemented")},t.prototype.select=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.topk=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.min=function(t,e){throw new Error("Not yet implemented")},t.prototype.minimum=function(t,e){throw new Error("Not yet implemented")},t.prototype.mod=function(t,e){throw new Error("Not yet implemented")},t.prototype.max=function(t,e){throw new Error("Not yet implemented")},t.prototype.maximum=function(t,e){throw new Error("Not yet implemented")},t.prototype.all=function(t,e){throw new Error("Not yet implemented")},t.prototype.any=function(t,e){throw new Error("Not yet implemented")},t.prototype.squaredDifference=function(t,e){throw new Error("Not yet implemented")},t.prototype.ceil=function(t){throw new Error("Not yet implemented")},t.prototype.floor=function(t){throw new Error("Not yet implemented")},t.prototype.round=function(t){throw new Error("Not yet implemented")},t.prototype.sign=function(t){throw new Error("Not yet implemented")},t.prototype.pow=function(t,e){throw new Error("Not yet implemented")},t.prototype.exp=function(t){throw new Error("Not yet implemented")},t.prototype.expm1=function(t){throw new Error("Not yet implemented")},t.prototype.log=function(t){throw new Error("Not yet implemented")},t.prototype.log1p=function(t){throw new Error("Not yet implemented")},t.prototype.sqrt=function(t){throw new Error("Not yet implemented")},t.prototype.rsqrt=function(t){throw new Error("Not yet implemented")},t.prototype.square=function(t){throw new Error("Not yet implemented")},t.prototype.reciprocal=function(t){throw new Error("Not yet implemented")},t.prototype.relu=function(t){throw new Error("Not yet implemented")},t.prototype.elu=function(t){throw new Error("Not yet implemented")},t.prototype.eluDer=function(t,e){throw new Error("Not yet implemented")},t.prototype.selu=function(t){throw new Error("Not yet implemented")},t.prototype.int=function(t){throw new Error("Not yet implemented")},t.prototype.clip=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.abs=function(t){throw new Error("Not yet implemented")},t.prototype.complexAbs=function(t){throw new Error("Not yet implemented")},t.prototype.sigmoid=function(t){throw new Error("Not yet implemented")},t.prototype.softplus=function(t){throw new Error("Not yet implemented")},t.prototype.sin=function(t){throw new Error("Not yet implemented")},t.prototype.cos=function(t){throw new Error("Not yet implemented")},t.prototype.tan=function(t){throw new Error("Not yet implemented")},t.prototype.asin=function(t){throw new Error("Not yet implemented")},t.prototype.acos=function(t){throw new Error("Not yet implemented")},t.prototype.atan=function(t){throw new Error("Not yet implemented")},t.prototype.atan2=function(t,e){throw new Error("Not yet implemented")},t.prototype.sinh=function(t){throw new Error("Not yet implemented")},t.prototype.cosh=function(t){throw new Error("Not yet implemented")},t.prototype.tanh=function(t){throw new Error("Not yet implemented")},t.prototype.asinh=function(t){throw new Error("Not yet implemented")},t.prototype.acosh=function(t){throw new Error("Not yet implemented")},t.prototype.atanh=function(t){throw new Error("Not yet implemented")},t.prototype.erf=function(t){throw new Error("Not yet implemented")},t.prototype.step=function(t,e){throw new Error("Not yet implemented")},t.prototype.conv2d=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2D=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3d=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3dDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3dDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.maxPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.maxPoolBackprop=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.avgPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.avgPoolBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.reshape=function(t,e){throw new Error("Not yet implemented")},t.prototype.cast=function(t,e){throw new Error("Not yet implemented")},t.prototype.tile=function(t,e){throw new Error("Not yet implemented")},t.prototype.pad=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.transpose=function(t,e){throw new Error("Not yet implemented")},t.prototype.gather=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.gatherND=function(t,e){throw new Error("Not yet implemented")},t.prototype.scatterND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchToSpaceND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.spaceToBatchND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeBilinear=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeBilinearBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchNormalization=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){throw new Error("Not yet implemented")},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){throw new Error("Not yet implemented")},t.prototype.multinomial=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.oneHot=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.cumsum=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){throw new Error("Not yet implemented")},t.prototype.fft=function(t){throw new Error("Not yet implemented")},t.prototype.ifft=function(t){throw new Error("Not yet implemented")},t.prototype.complex=function(t,e){throw new Error("Not yet implemented")},t.prototype.real=function(t){throw new Error("Not yet implemented")},t.prototype.imag=function(t){throw new Error("Not yet implemented")},t.prototype.cropAndResize=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.depthToSpace=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.split=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.sparseToDense=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.setDataMover=function(t){throw new Error("Not yet implemented")},t.prototype.dispose=function(){throw new Error("Not yet implemented")}}();var Og=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,i=Math.ceil(t.inSize/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===e?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "},Fg=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n            wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+";\n            wC+= "+t.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};function Lg(t,e){for(var n=t.length,r=[],o=0;o<n;o++){var i=n-1-o;(e[e.length-1-o]||1)>1&&1===(t[i]||1)&&r.unshift(i)}return r}function Bg(t,e){for(var n=[],r=0;r<e.length;r++){var o=t[t.length-r-1],i=e.length-r-1;(null==o||1===o&&e[i]>1)&&n.unshift(i)}return n}function Ug(t,e){for(var n=[],r=Math.max(t.length,e.length),o=0;o<r;o++){var i=t[t.length-o-1];null==i&&(i=1);var a=e[e.length-o-1];if(null==a&&(a=1),1===i)n.unshift(a);else if(1===a)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(i)}}return n}var Vg=function(t,e,n,r,o,i){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],Ug(t,e),Ug(t,n);var a="0.0";null!=r&&(Ug(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Ug(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},jg=function(t,e,n,r,o,i){this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],Ug(t,e),Ug(t,n);var a="vec4(0.0)";null!=r&&(Ug(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Ug(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},zg=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.supportsBroadcasting=!0,this.outputShape=Ug(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Wg="return a + b;",Hg="return a - b;",Gg=function(){function t(t,e,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=Ug(e,n),this.userCode="\n      uniform float NAN;\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}(),qg=function(t,e,n){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, float("+e+"), float("+n+")));\n      }\n    "},$g=function(t,e,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (hasNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4("+e+"), vec4("+n+")));\n      }\n    "},Kg=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Xg=function(t,e){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=Km([t,e],1),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+t[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+t[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "},Qg=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Yg=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Zg=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+t.strideDepth+" - "+t.padInfo.front+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Jg=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-t.padInfo.front)+", "+(n-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+t.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ty=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+t.outChannels/t.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ey=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+r+"; dm++) {\n              int d2 = d1 * "+r+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ny=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.top,n=t.padInfo.left,r=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,s=t.filterHeight,u=t.filterWidth,c=4*Math.floor(t.inChannels/4),l=t.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+o+");\n      const ivec2 pads = ivec2("+e+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+i+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+c+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===l)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+c+") *\n                getW(wR, wC, "+c+", d2);\n            } else if ("+(2===l)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+c+"),\n                getX(batch, xR, xC, "+c+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+c+", d2),\n                getW(wR, wC, "+c+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===l)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+c+"),\n                getX(batch, xR, xC, "+c+" + 1),\n                getX(batch, xR, xC, "+c+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+c+", d2),\n                getW(wR, wC, "+c+" + 1, d2),\n                getW(wR, wC, "+c+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ry=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,h=t.filterHeight,p=t.filterWidth,f=4*Math.floor(t.inChannels/4),d=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+p+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===d)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===d)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===d)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},oy=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+t.strideHeight+", "+t.strideWidth+");\n      const ivec2 pads = ivec2("+t.padInfo.top+", "+t.padInfo.left+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+e+";\n        int q = d2 - d1 * "+e+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+t.filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+t.dilationHeight+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+t.filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+t.dilationWidth+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},iy=function(t){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=t.outShape;for(var e=t.inHeight,n=t.inWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.strideHeight,a=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=Math.ceil((u+1)/2),l="int xR; int xC;",h=0;h<s;h++){for(var p=-o;p<2*c;p++)l+="vec4 "+ay(h,p)+" = vec4(0.);";for(p=0;p<u;p++)l+="\n          vec4 wR"+h+"C"+p+" = vec4(0.);\n          vec4 xR"+h+"C"+p+" = vec4(0.);"}for(h=0;h<s;h++)for(p=0;p<c;p++){var f=2*p,d=2*p+o;l+="\n          xR = xRCorner + "+h+";\n          xC = xCCorner + "+d+";\n\n          if(xR >= 0 && xR < "+e+" && xC >= 0 && xC < "+n+") {\n            "+ay(h,d)+" = getX(batch, xR, xC, d1);\n          }",0===o?f<u&&p===c-1&&(a>1&&(l+="\n                vec4 "+ay(h,d+2)+" = vec4(0.);\n\n                if(xR >= 0 && xR < "+e+" && xC + 2 < "+n+") {\n                  "+ay(h,d+2)+" = getX(batch, xR, xC + 2, d1);\n                }"),l+="\n              xR"+h+"C"+d+" = "+sy(h,d,a,o)+";\n            "):0===p&&(l+="\n            if(xR >= 0 && xR < "+e+" && xC - 2 >= 0) {\n              "+ay(h,d-2)+" = getX(batch, xR, xC - 2, d1);\n            }"),f>0&&(l+="xR"+h+"C"+(d-2)+" =\n            "+sy(h,d-2,a,o)+";"),d-1>=0&&d-1<u&&(l+="xR"+h+"C"+(d-1)+" =\n              "+sy(h,d-1,a,o)+";"),f<u&&(l+="\n            vec4 wTexel"+h+"C"+f+" = getW("+h+", "+f+", d1, q);\n            wR"+h+"C"+f+" = vec4(wTexel"+h+"C"+f+".xz, wTexel"+h+"C"+f+".xz);\n          ",f+1<u&&(l+="\n              vec4 wTexelR"+h+"C"+(f+1)+" = getW("+h+", "+(f+1)+", d1, q);\n              wR"+h+"C"+(f+1)+" =\n                vec4(wTexelR"+h+"C"+(f+1)+".xz, wTexelR"+h+"C"+(f+1)+".xz);"))}for(h=0;h<s;h++)for(p=0;p<u;p++)l+="result += xR"+h+"C"+p+" * wR"+h+"C"+p+";";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+a+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+l+"\n\n        setOutput(result);\n      }\n    "};function ay(t,e){return"xTexelR"+t+"C"+(e<0?"minus"+Math.abs(e).toString():e)}function sy(t,e,n,r){return 1===n?r%2==e%2?ay(t,e):"vec4("+ay(t,e-1)+".zw, "+ay(t,e+1)+".xy)":r%2==e%2?"vec4("+ay(t,e)+".xy, "+ay(t,e+2)+".xy)":"vec4("+ay(t,e-1)+".zw, "+ay(t,e+1)+".zw)"}var uy=function(t,e,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],u=n[0],c=n[1];this.outputShape=[e[0],u,c,t[3]];var l=[a-1+".0",s-1+".0"],h=l[0],p=l[1],f=u>1?[""+(a-1)/(u-1),"(y2-y1) * height_ratio","y1*"+h+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+h],d=c>1?[""+(s-1)/(c-1),"(x2-x1) * width_ratio","x1*"+p+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+p];this.userCode="\n      const float height_ratio = float("+f[0]+");\n      const float width_ratio = float("+d[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+f[1]+";\n        float width_scale = "+d[1]+";\n\n        float in_y = "+f[2]+";\n        if( in_y < 0.0 || in_y > "+h+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+d[2]+";\n        if( in_x < 0.0 || in_x > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexRC = vec2(in_y,in_x);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n          ivec2 sourceCeilRC = ivec2(ceil(sourceFracIndexRC));\n\n          float topLeft = getImage(b, sourceFloorRC.x, sourceFloorRC.y, d);\n          float bottomLeft = getImage(b, sourceCeilRC.x, sourceFloorRC.y, d);\n          float topRight = getImage(b, sourceFloorRC.x, sourceCeilRC.y, d);\n          float bottomRight = getImage(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n          vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n          float top = topLeft + (topRight - topLeft) * fracRC.y;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n          float newValue = top + (bottom - top) * fracRC.x;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestRC = ivec2(floor(\n            sourceFracIndexRC + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestRC.x, sourceNearestRC.y, d);\n          setOutput(newValue);\n        }\n      }\n    "};function cy(t,e,n){void 0===n&&(n="index");var r=qv(e);return r.map(function(e,o){return"int "+t[o]+" = "+n+" / "+e+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+e:"index -= "+t[o]+" * "+e)+";"}).join("")}function ly(t){return 1===t.length?""+t[0]:"vec"+t.length+"("+t.join(",")+")"}var hy="\n  float sampleTexture(sampler2D textureSampler, vec2 uv) {\n    return texture2D(textureSampler, uv).r;\n  }\n",py="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",fy="\n  void setOutput(vec4 val) {\n    gl_FragColor = val;\n  }\n",dy="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  struct ivec5\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n  };\n\n  struct ivec6\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n    int v;\n  };\n\n  "+(Im.get("PROD")?"\n    bool isNaN(float val) {\n      return false;\n    }\n\n    bool hasNaN(vec4 values) {\n      return false;\n    }\n  ":"\n    bool isNaN(float val) {\n      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n    }\n\n    bool hasNaN(vec4 values) {\n      return any(bvec4(\n        isNaN(values.x),\n        isNaN(values.y),\n        isNaN(values.z),\n        isNaN(values.w)\n      ));\n    }\n  ")+"\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  //Based on the work of Dave Hoskins\n  //https://www.shadertoy.com/view/4djSRW\n  #define HASHSCALE1 443.8975\n  float random(float seed){\n    vec2 p = resultUV * seed;\n    vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n  }\n\n  \nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom4D(int texNumR, int texNumC, int texelsInBatch2,\n    int texelsInBatch, int texelsInLogicalRow, int b2, int b,\n    int row, int col) {\n  int index = b2 * texelsInBatch2 + b * texelsInBatch +\n    (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom5D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int row, int col, int depth,\n    int depth2, int depth3) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 +\n              depth * stride2 + depth2 * stride3 + depth3;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom6D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int stride4,\n    int row, int col, int depth, int depth2, int depth3, int depth4) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2 *\n    stride3 + depth3 * stride4 + depth4;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n",vy="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function my(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function gy(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function yy(t,e){return e.map(function(e){return t[e]}).join(", ")}var wy=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+my(r)+" coords = getOutputCoords();\n        int end = "+by(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+by(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===r)return""+e;if(2===r)return e+".x, "+e+".y";if(3===r)return e+".x, "+e+".y, "+e+".z";if(4===r)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}(0,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function by(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var xy,_y,Cy=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),Ey=function(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isNaN(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        gl_FragColor = encode_float(x);\n      }\n    "},Sy=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(n?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Ry=function(t){this.variableNames=["A"];var e=t[0],n=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+n+".0, "+e+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Ty=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var o=my(this.rank),i=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<t.length;i++)o.push(i===e?"int(getIndices("+r[i]+"))":""+r[i]);return o.join()}(t,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},ky=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=my(e.length),o=my(n.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Iy(t,e){return[e,t]}function Ny(t,e){return t*e}function Ay(t,e,n){var r=function(t,e){if(t%e!=0)throw new Error("unpackedSize ("+t+") must be a multiple of "+e);return t/e}(t.length,n);if(e.length<r)throw new Error("matrix length ("+e.length+") must be >= "+r);for(var o=0,i=0;i<t.length;i+=n)e[o++]=t[i]}function Dy(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function My(t,e){var n=Dy(t,e);return n[0]*n[1]*4}function Py(t,e,n,r,o){var i=n*r;if(o.length<i)throw new Error("matrix length ("+o.length+") must be >= "+i);for(var a=r%2==1,s=n%2==1,u=Math.floor(r/2),c=Math.floor(n/2),l=Math.ceil(r/2),h=l*Math.ceil(n/2),p=mv(n)*mv(r),f=0;f<e;f++){for(var d=f*n*r,v=f*p,m=a?4:0,g=r+(a?1:0),y=v,w=d,b=d+r,x=0;x<c;++x){for(var _=0;_<u;++_)o[w++]=t[y++],o[w++]=t[y++],o[b++]=t[y++],o[b++]=t[y++];y+=m,w+=g,b+=g}if(a){y=v+4*(l-1);var C=d+r-1;for(m=4*l,g=2*r,x=0;x<c;++x)o[C]=t[y],o[C+r]=t[y+2],y+=m,C+=g}if(s){for(y=v+4*(h-l),C=d+(n-1)*r,_=0;_<u;++_)o[C++]=t[y++],o[C++]=t[y++],y+=2;a&&(o[d+n*r-1]=t[y])}}return o}function Oy(t,e){var n=e();return By(t),n}!function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(xy||(xy={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(_y||(_y={}));var Fy=!1;function Ly(t){Fy=t}function By(t){if(Fy){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Uy(t,e))}}function Uy(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Vy(t,e){return uw(t,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function jy(t,e){var n=uw(t,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Oy(t,function(){return t.shaderSource(n,e)}),Oy(t,function(){return t.compileShader(n)}),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function zy(t,e){var n=uw(t,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Oy(t,function(){return t.shaderSource(n,e)}),Oy(t,function(){return t.compileShader(n)}),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw function(t,e){var n=Wy.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],o=t.split("\n"),i=o.length.toString().length+2,a=o.map(function(t,e){return kv((e+1).toString(),i)+t}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var c=a.slice(0,r-1),l=a.slice(r-1,r),h=a.slice(r);console.log(c.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+kv(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Wy=/ERROR: [0-9]+:([0-9]+):/g;function Hy(t){return uw(t,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function Gy(t,e){if(Oy(t,function(){return t.linkProgram(e)}),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function qy(t,e){if(Oy(t,function(){return t.validateProgram(e)}),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function $y(t,e){var n=uw(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Oy(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),Oy(t,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),n}function Ky(t,e){var n=uw(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Oy(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)}),Oy(t,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),n}function Xy(){return 2===Im.get("WEBGL_VERSION")?1:4}function Qy(t){return uw(t,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function Yy(t,e){var n=Im.get("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function Zy(t){return uw(t,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Jy(t,e,n,r,o,i,a){var s=t.getAttribLocation(e,n);return-1!==s&&(Oy(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Oy(t,function(){return t.vertexAttribPointer(s,o,t.FLOAT,!1,i,a)}),Oy(t,function(){return t.enableVertexAttribArray(s)}),!0)}function tw(t,e,n){cw(t,n),Oy(t,function(){return t.activeTexture(t.TEXTURE0+n)}),Oy(t,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function ew(t,e,n){return uw(t,function(){return t.getUniformLocation(e,n)},'uniform "'+n+'" not present in program.')}function nw(t,e,n){return t.getUniformLocation(e,n)}function rw(t,e,n,r,o){Oy(t,function(){return tw(t,n,o)}),Oy(t,function(){return t.uniform1i(r,o)})}function ow(t,e,n){Oy(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),Oy(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})}function iw(t,e){Oy(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),Oy(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function aw(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+sw(t,e))}function sw(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function uw(t,e,n){var r=Oy(t,function(){return e()});if(null==r)throw new Error(n);return r}function cw(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function lw(t,e){void 0===e&&(e=!1);var n=Im.get("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,t=t.map(function(e,n){return n>=t.length-2?mv(t[n]):t[n]})),2!==t.length){var r=Av(t);t=r.newShape}var o=Cv(t);return t.length<=1&&o<=n?[1,o]:2===t.length&&t[0]<=n&&t[1]<=n?t:3===t.length&&t[0]*t[1]<=n&&t[2]<=n?[t[0]*t[1],t[2]]:3===t.length&&t[0]<=n&&t[1]*t[2]<=n?[t[0],t[1]*t[2]]:4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n?[t[0]*t[1]*t[2],t[3]]:4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n?[t[0],t[1]*t[2]*t[3]]:Tv(o)}function hw(t){return t%2==0}function pw(t,e){if(Ev(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(hw(n)&&hw(r)&&(1===t[0]||1===e[0]))return!0}else if(hw(t[0])&&hw(e[0])){if(hw(t[1])&&hw(e[1]))return!0;if(t[1]===e[1])return!0}return!1}var fw=Object.freeze({callAndCheck:Oy,enableDebugWebGLErrorChecking:Ly,checkWebGLError:By,getWebGLErrorMessage:Uy,getExtensionOrThrow:Vy,createVertexShader:jy,createFragmentShader:zy,createProgram:Hy,linkProgram:Gy,validateProgram:qy,createStaticVertexBuffer:$y,createStaticIndexBuffer:Ky,getNumChannels:Xy,createTexture:Qy,validateTextureSize:Yy,createFramebuffer:Zy,bindVertexBufferToProgramAttribute:Jy,bindTextureUnit:tw,unbindTextureUnit:function(t,e){cw(t,e),Oy(t,function(){return t.activeTexture(t.TEXTURE0+e)}),Oy(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:ew,getProgramUniformLocation:nw,bindTextureToProgramUniformSampler:rw,bindCanvasToFramebuffer:function(t){Oy(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Oy(t,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),Oy(t,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:ow,unbindColorTextureFromFramebuffer:iw,validateFramebuffer:aw,getFramebufferErrorMessage:sw,getTextureShapeFromLogicalShape:lw,isReshapeFree:pw});function dw(t){return jy(t,"\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function vw(t){return $y(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function mw(t){return Ky(t,new Uint16Array([0,1,2,2,1,3]))}function gw(t,e){var n,r,o,i,a,s,u,c=t;return 2===Im.get("WEBGL_VERSION")?(n=c.R32F,r=c.R16F,o=c.RGBA32F,i=c.RED,a=4,s=1,u=c.HALF_FLOAT):(n=t.RGBA,r=t.RGBA,o=c.RGBA,i=t.RGBA,a=4,s=4,u=null!=e?e.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedFloat:o,textureFormatFloat:i,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:s,textureTypeHalfFloat:u}}function yw(t,e,n,r,o,i){Yy(e,n);var a=Qy(t),s=t.TEXTURE_2D;return Oy(t,function(){return t.bindTexture(s,a)}),Oy(t,function(){return t.texParameteri(s,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),Oy(t,function(){return t.texParameteri(s,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),Oy(t,function(){return t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST)}),Oy(t,function(){return t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST)}),Oy(t,function(){return t.texImage2D(s,0,r,e,n,0,o,i,null)}),Oy(t,function(){return t.bindTexture(t.TEXTURE_2D,null)}),a}function ww(t,e,n,r){var o=Iy(e,n);return yw(t,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,t.FLOAT)}function bw(t,e,n,r){var o=Iy(e,n);return yw(t,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,r.textureTypeHalfFloat)}function xw(t,e,n,r){var o=Iy(e,n);return yw(t,o[0],o[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function _w(t,e,n,r){var o=Dy(e,n);return yw(t,o[0],o[1],r.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function Cw(t,e,n,r){var o=Dy(e,n);return yw(t,o[0],o[1],r.internalFormatHalfFloat,t.RGBA,r.textureTypeHalfFloat)}function Ew(t,e,n){return Oy(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),Jy(t,e,"clipSpacePos",n,3,20,0)&&Jy(t,e,"uv",n,2,20,12)}function Sw(t,e,n){Oy(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),Oy(t,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}),Oy(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Rw(t,e,n,r,o,i){Yy(n,r),Oy(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),Oy(t,function(){return t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,i,t.FLOAT,o)}),Oy(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Tw(t,e,n,r,o,i,a){var s,u=Iy(n,r),c=u[0],l=u[1];1===a.defaultNumChannels?s=o:function(t,e,n){var r=Ny(t.length,n);if(e.length<r)throw new Error("unpackedArray length ("+e.length+") must be >= "+r);for(var o=0,i=0;i<t.length;++i)e[o]=t[i],o+=n}(o,s=new Float32Array(Ny(o.length,i)),i),Rw(t,e,c,l,s,a.textureFormatFloat)}function kw(t,e,n,r,o,i,a,s,u){var c=Dy(i,a),l=c[0],h=c[1],p=new Float32Array(n*My(r,o));(function(t,e,n,r,o){var i=My(n,r);if(o.length<i)throw new Error("packedRGBA length ("+o.length+") must be >=\n        "+i);for(var a=r%2==1,s=n%2==1,u=Math.floor(r/2),c=Math.floor(n/2),l=Math.ceil(r/2),h=l*Math.ceil(n/2),p=mv(n)*mv(r),f=0;f<e;f++){for(var d=f*n*r,v=f*p,m=a?4:0,g=r,y=v,w=0;w<c;++w){for(var b=2*w*r,x=0;x<u;++x){var _=d+b+2*x;o[y]=t[_],o[y+1]=t[_+1],o[y+2]=t[_+g],o[y+3]=t[_+g+1],y+=4}y+=m}if(a){_=d+r-1,y=v+4*(l-1);var C=2*r;for(m=4*l,w=0;w<c;++w)o[y]=t[_],o[y+2]=t[_+r],_+=C,y+=m}if(s){for(_=d+(n-1)*r,y=v+4*(h-l),x=0;x<u;++x)o[y++]=t[_++],o[y++]=t[_++],y+=2;a&&s&&(o[v+p-4]=t[_])}}})(s,n,r,o,p),Rw(t,e,l,h,p,t.RGBA)}function Iw(t,e,n,r,o){var i=e;if(2===Im.get("WEBGL_VERSION")){var a=t,s=a.createBuffer();Oy(t,function(){return t.bindBuffer(a.PIXEL_PACK_BUFFER,s)});var u=4*Ny(n*r,o.downloadUnpackNumChannels);Oy(t,function(){return t.bufferData(a.PIXEL_PACK_BUFFER,u,t.STATIC_DRAW)}),Oy(t,function(){return a.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),Oy(t,function(){return t.bindBuffer(a.PIXEL_PACK_BUFFER,null)}),i=s}return i}function Nw(t,e,n,r,o){var i=t,a=new Float32Array(Ny(n*r,o.downloadUnpackNumChannels));i.bindBuffer(t.ARRAY_BUFFER,e),i.getBufferSubData(t.ARRAY_BUFFER,0,a),i.bindBuffer(t.ARRAY_BUFFER,null);var s=new Float32Array(n*r);return Ay(a,s,o.downloadUnpackNumChannels),s}function Aw(t,e,n,r){var o=Iy(e,n),i=o[0],a=o[1],s=new Float32Array(Ny(e*n,r.downloadUnpackNumChannels));Oy(t,function(){return t.readPixels(0,0,i,a,r.downloadTextureFormat,t.FLOAT,s)});var u=new Float32Array(e*n);return Ay(s,u,r.downloadUnpackNumChannels),u}function Dw(t,e,n,r){var o=Iy(e,n),i=o[0],a=o[1],s=new Uint8Array(Ny(e*n,4));return Oy(t,function(){return t.readPixels(0,0,i,a,r.downloadTextureFormat,t.UNSIGNED_BYTE,s)}),new Float32Array(s.buffer)}function Mw(t,e,n,r,o,i,a,s){var u=t,c=new Float32Array(My(i,a));u.bindBuffer(t.ARRAY_BUFFER,e),u.getBufferSubData(t.ARRAY_BUFFER,0,c),u.bindBuffer(t.ARRAY_BUFFER,null);var l=new Float32Array(Cv([n,r,o]));return Py(c,n,r,o,l),l}function Pw(t,e,n,r,o,i,a){var s=Dy(o,i),u=s[0],c=s[1],l=new Float32Array(My(o,i));Oy(t,function(){return t.readPixels(0,0,u,c,t.RGBA,t.FLOAT,l)});var h=new Float32Array(Cv([e,n,r]));return Py(l,e,n,r,h)}var Ow=Object.freeze({createVertexShader:dw,createVertexBuffer:vw,createIndexBuffer:mw,getTextureConfig:gw,createFloat32MatrixTexture:ww,createFloat16MatrixTexture:bw,createUnsignedBytesMatrixTexture:xw,createPackedMatrixTexture:_w,createFloat16PackedMatrixTexture:Cw,bindVertexProgramAttributeStreams:Ew,uploadPixelDataToTexture:Sw,uploadMatrixToTexture:Tw,uploadMatrixToPackedTexture:kw,maybeCreateBufferFromOutputTexture:Iw,downloadFloat32MatrixFromBuffer:Nw,downloadFloat32MatrixFromOutputTexture:Aw,downloadByteEncodedFloatMatrixFromOutputTexture:Dw,downloadPackedMatrixFromBuffer:Mw,downloadMatrixFromPackedOutputTexture:Pw}),Fw=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[],this.gl=null!=t?t:fv(Im.get("WEBGL_VERSION")),1===Im.get("WEBGL_VERSION")?(this.textureFloatExtension=Vy(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),Im.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Vy(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Vy(this.gl,"EXT_color_buffer_float"),this.vertexBuffer=vw(this.gl),this.indexBuffer=mw(this.gl),this.framebuffer=Zy(this.gl),this.textureConfig=gw(this.gl,this.textureHalfFloatExtension)}return t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Oy(e,function(){return e.finish()}),Oy(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Oy(e,function(){return e.deleteFramebuffer(t.framebuffer)}),Oy(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Oy(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Oy(e,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,Ly(t)},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),ww(this.gl,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),bw(this.gl,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),xw(this.gl,t,e)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),Sw(this.gl,t,e)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Cw(this.gl,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),_w(this.gl,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(iw(this.gl,this.framebuffer),this.outputTexture=null),Oy(this.gl,function(){return e.gl.deleteTexture(t)})},t.prototype.uploadMatrixToTexture=function(t,e,n,r){this.throwIfDisposed();var o=Xy();return Tw(this.gl,t,e,n,r,o,this.textureConfig)},t.prototype.uploadMatrixToPackedTexture=function(t,e,n,r,o,i,a){return this.throwIfDisposed(),kw(this.gl,t,e,n,r,o,i,a)},t.prototype.downloadFloat32MatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return Aw(r.gl,e,n,r.textureConfig)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return Dw(r.gl,e,n,r.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,o,i){return Mw(this.gl,t,e,n,r,o,i)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e,n){return Nw(this.gl,t,e,n,this.textureConfig)},t.prototype.maybeCreateBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=Iw(this.gl,t,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(Im.get("WEBGL_FENCE_API_ENABLED")){var o=t,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=o.clientWaitSync(i,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=i}else Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n,r,o,i){var a=this;return this.downloadMatrixDriver(t,function(){return Pw(a.gl,e,n,r,o,i)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=zy(e,t),r=dw(e),o=Hy(e);return Oy(e,function(){return e.attachShader(o,r)}),Oy(e,function(){return e.attachShader(o,n)}),Gy(e,o),this.autoDebugValidate&&qy(e,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Ew(e,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&Oy(this.gl,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.autoDebugValidate&&qy(this.gl,this.program),Oy(this.gl,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?ew(this.gl,t,e):nw(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),Oy(this.gl,function(){return n.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),rw(this.gl,0,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=Dy(e,n);this.setOutputMatrixTextureDriver(t,r[0],r[1])},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&qy(this.gl,this.program),aw(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.autoDebugValidate&&this.debugValidate(),Oy(t,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Oy(this.gl,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Vy(this.gl,2===Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return cv(this,void 0,void 0,function(){var e=this;return lv(this,function(n){switch(n.label){case 0:return[4,Iv(function(){return e.disposed||e.isQueryAvailable(t,Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0,n=t.length-1,r=-1;e<=n;){var o=e+n>>1;t[o]()?(r=o,e=o+1):n=o-1}return r}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||Iv(function(){return n.pollItems(),0===n.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),ow(this.gl,t,this.framebuffer),this.autoDebugValidate&&aw(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(ow(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&aw(this.gl)):iw(this.gl,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;ow(r,t,this.framebuffer),this.autoDebugValidate&&aw(r),this.outputTexture=t,Oy(r,function(){return r.viewport(0,0,e,n)}),Oy(r,function(){return r.scissor(0,0,e,n)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var o=this;this.throwIfDisposed(),Oy(this.gl,function(){return o.gl.scissor(t,e,n,r)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function Lw(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,n){var r=t.logicalShape,o=e[n],i=o.shape;if(!Ev(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,s=o.isUniform?null:o.texData.texShape;if(!Ev(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}})}var Bw=function(t,e,n){this.variableNames=["A"],this.outputShape=t;var r=n.inChannels,o=n.padInfo,i=n.outWidth,a=r*n.filterWidth;this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+t[1]+" || pos >= "+t[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+i+")) * "+n.strideHeight+" - "+o.top+";\n            int d0 = offsetY + "+n.dilationHeight+" * (pos / "+a+");\n\n            if(d0 >= "+e[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+i+".) * "+n.strideWidth+". - "+o.left+".);\n            int d1 = offsetX + "+n.dilationWidth+" * (int(mod(float(pos), "+a+".) / "+r+".));\n\n            if(d1 >= "+e[1]+" || d1 < 0) continue;\n\n            result[row * 2 + col] = getA(d0, d1, int(mod(float(pos), "+r+".)));\n          }\n        }\n\n        gl_FragColor = result;\n      }\n    "},Uw=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[];var i=e,a=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+s+")":1===o?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},Vw=function(t,e,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},jw=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n          wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(e*n-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},zw=function(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),this.variableNames=["matrixA","matrixB"];var o=n?t[1]:t[2];this.outputShape=[t[0],n?t[2]:t[1],r?e[1]:e[2]];var i=function(t,e){return n?"batch, "+e+" + "+t+", aRow":"batch, aRow, "+e+" + "+t},a=function(t,e){return r?"batch, bCol, "+e+" + "+t:"batch, "+e+" + "+t+", bCol"},s=4*Math.floor(o/4),u=o%4;this.userCode=" float dotARowBCol(int batch, int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+s+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+i(0,"i")+"),\n          getMatrixA("+i(1,"i")+"),\n          getMatrixA("+i(2,"i")+"),\n          getMatrixA("+i(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+a(0,"i")+"),\n          getMatrixB("+a(1,"i")+"),\n          getMatrixB("+a(2,"i")+"),\n          getMatrixB("+a(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===u)+") {\n        result += getMatrixA("+i(0,s)+") *\n          getMatrixB("+a(0,s)+");\n      } else if ("+(2===u)+") {\n        vec2 a = vec2(\n          getMatrixA("+i(0,s)+"),\n          getMatrixA("+i(1,s)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+a(0,s)+"),\n          getMatrixB("+a(1,s)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===u)+") {\n        vec3 a = vec3(\n          getMatrixA("+i(0,s)+"),\n          getMatrixA("+i(1,s)+"),\n          getMatrixA("+i(2,s)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+a(0,s)+"),\n          getMatrixB("+a(1,s)+"),\n          getMatrixB("+a(2,s)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec3 resBRC = getOutputCoords();\n      setOutput(dotARowBCol(resBRC.x, resBRC.y, resBRC.z));\n    }\n    "},Ww=function(t,e,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=n;var i=Math.ceil((r?t[0]:t[1])/2),a=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],s=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];this.userCode="\n      const float sharedDimension = "+i+".0;\n\n      vec4 dot2x2ARowBCol(ivec2 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+i+"; i++) {\n          vec4 a = getMatrixA("+(r?"i * 2, rc.x":"rc.x, i * 2")+");\n          vec4 b = getMatrixB("+(o?"rc.y, i * 2":"i * 2, rc.y")+");\n\n          result += ("+a[0]+" * "+s[0]+") + ("+a[1]+" * "+s[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec2 rc = getOutputCoords();\n        setOutput(dot2x2ARowBCol(rc));\n      }\n    "},Hw=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),Gw=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "};function qw(t,e){return 1===e?[t]:function(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return t+"."+e})}(t,e)}var $w=function(t){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=qw("rc",e),r=my(e),o=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",o=t-2;o<t;o++)r+=n[o]+" >= "+e[o],o<t-1&&(r+="||");return r}(e,t,n),i=function(t,e,n,r){if(1===t)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(e,t[t.length-1],t[t.length-2],n),a=function(t,e){var n=t.length,r=function(t,e){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),a=2;a<t;a++)i=e[e.length-1-a]+","+i;n.push(i)}return n}(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(t,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},Kw=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});var r=t.length,o=my(r),i=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Xw=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;var p="avg"===e,f="0.0";if(p||(f="-1.0 / 0.0"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var d=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(d="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+h+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}},Qw=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 0.0",s="min"):"max"===e&&(a="-1.0 / 0.0",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,h="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",p="vec4";"all"===e?(a="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===e&&(a="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===l)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+u+");\n      }\n    "},Yw=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+cy(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+function(t){return"\n    int getFlatIndex(ivec3 coords) {\n      return round("+function(t,e){if(t.length!==e.length)throw new Error("Vectors to be dotted must be of the same length -got "+t.length+" and "+e.length);for(var n=[],r=Math.floor(t.length/4),o=t.length%4,i=0;i<r;i++){var a=t.slice(4*i,4*i+4),s=e.slice(4*i,4*i+4);n.push(ly(a)+", "+ly(s))}return 0!==o&&(a=t.slice(4*r),s=e.slice(4*r),1===a.length&&(a=a.map(function(t){return"float("+t+")"}),s=s.map(function(t){return"float("+t+")"})),n.push(ly(a)+", "+ly(s))),n.map(function(t,e){return"dot("+t+")"}).join("+")}(["coords.x","coords.y","coords.z"],qv(t).map(function(t){return t.toString()}).concat(["1."]))+");\n    }\n  "}(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Zw=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[n&&s>1?o-1:o,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],p=c[1]/l[1],f=1/h,d=1/p,v=2*Math.ceil(f)+2,m=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Jw=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},tb=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[n&&s>1?o-1:o,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],p=c[1]/l[1],f=1/h,d=1/p,v=2*Math.ceil(f)+2,m=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},eb=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},nb=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map(function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=my(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},rb=function(t,e,n,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=my(o.length),u=my(i.length),c="";1===n?c="i":2===n&&(c="i, j");var l="";1===r?l="i":2===r&&(l="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(e>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+l+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},ob=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, filter);\n    ",l="";o%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},ib=function(t,e,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=my(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},ab=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e=my(this.rank),n=function(t){if(1===t)return"sourceLoc";if(2===t)return"sourceLoc.x, sourceLoc.y";if(3===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);this.userCode="\n      uniform "+e+" start;\n\n      void main() {\n        "+e+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+n+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){if(null!=e.startLoc||(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null!=e.startLoc))if(1===e.rank)n.gl.uniform1i(e.startLoc,t[0]);else if(2===e.rank)n.gl.uniform2i(e.startLoc,t[0],t[1]);else if(3===e.rank)n.gl.uniform3i(e.startLoc,t[0],t[1],t[2]);else{if(4!==e.rank)throw Error("Slicing for rank "+e.rank+" is not yet supported");n.gl.uniform4i(e.startLoc,t[0],t[1],t[2],t[3])}}},t}(),sb=function(t,e,n,r){this.variableNames=["x"];var o=n.filter(function(t,e){return-1===r.indexOf(e)});this.outputShape=o;var i=n.length,a=my(n.length),s=my(o.length),u="";if(1===i)u="coords * strides + begin";else{var c=0;u=n.map(function(t,e){return-1===r.indexOf(e)?(c++,1===o.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(c-1)+"] * strides["+e+"] + begin["+e+"]"):"begin["+e+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+t+");\n      "+a+" strides = "+a+"("+e+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+u+"));\n      }\n    "},ub=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,o=cb(e,n),i=lb(t,o,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[i].shift();return this.usedTextures[i].push(a),a}return this.numUsedTextures++,this.log(),o===_y.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===_y.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===_y.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===_y.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===_y.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var o=lb(e,cb(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[o],a=i.indexOf(t);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(a,1),this.log()}},t.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function cb(t,e){if(t===xy.UPLOAD)return e?_y.PACKED_2X2_FLOAT32:_y.UNPACKED_FLOAT32;if(t===xy.RENDER||null==t)return e?Im.get("WEBGL_RENDER_FLOAT32_ENABLED")?_y.PACKED_2X2_FLOAT32:_y.PACKED_2X2_FLOAT16:Im.get("WEBGL_RENDER_FLOAT32_ENABLED")?_y.UNPACKED_FLOAT32:_y.UNPACKED_FLOAT16;if(t===xy.DOWNLOAD||t===xy.PIXELS)return _y.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function lb(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var hb=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var o=my(this.rank),i=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<t.length;o++)r.push("imod("+n[o]+", "+t[o]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},pb=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var o=my(this.rank),i=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),o=0;o<t.length;o++)r[t[o]]=n[o];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},fb=function(){function t(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float NAN;\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}(),db=function(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;var e=t.length,n=qw("rc",e),r=my(e),o=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),i=n.slice(-2),a=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},vb=ag({concat_:function(t,e){void 0===e&&(e=0),wv(t.length>=1,"Pass at least one tensor to concat");var n=ig(t,"tensors","concat");e=Wm(e,n[0].shape)[0];var r=Km(n.map(function(t){return t.shape}),e);if(0===Cv(r))return pg([],r);if(1===(n=n.filter(function(t){return t.size>0})).length)return n[0];var o=n.map(function(t){return t.shape});return function(t,e){var n=t[0].length;t.forEach(function(t,e){wv(t.length===n,"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")")}),wv(e>=0&&e<n,"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+".");var r=t[0];t.forEach(function(t,o){for(var i=0;i<n;i++)wv(i===e||t[i]===r[i],"Error in concat"+n+"D: Shape of tensors["+o+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+".")})}(o,e),Im.engine.runKernel(function(t){return t.concat(n,e)},n,function(t){var n=o.map(function(t){return t[e]});return bb(t,n,e).map(function(t){return function(){return t}})})}}),mb=ag({concat1d_:function(t){return vb(t,0)}}),gb=ag({concat2d_:function(t,e){return vb(t,e)}}),yb=ag({concat3d_:function(t,e){return vb(t,e)}}),wb=ag({concat4d_:function(t,e){return vb(t,e)}}),bb=ag({split_:function(t,e,n){void 0===n&&(n=0);var r,o=og(t,"x","split");return n=Wm(n,o.shape)[0],"number"==typeof e?(wv(o.shape[n]%e==0,"Number of splits must evenly divide the axis."),r=Array(e).fill(o.shape[n]/e)):(wv(o.shape[n]===e.reduce(function(t,e){return t+e}),"The sum of sizes must match the size of the axis dimension."),r=e),Im.engine.runKernel(function(t){return t.split(o,r,n)},{$x:o},function(t){return{$x:function(){return vb(t,n)}}})}});function xb(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var _b=xb(function(t){!function(t,e,n){function r(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new function(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+1.1102230246251565e-16*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.alea=o}(0,t)}),Cb=xb(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new function(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xor128=o}(0,t)}),Eb=xb(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xorwow=o}(0,t)}),Sb=xb(function(t){!function(t,e,n){function r(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xorshift7=o}(0,t)}),Rb=xb(function(t){!function(t,e,n){function r(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,i=e.i;return e.w=r=r+1640531527|0,n=o[i+34&127],t=o[i=i+1&127],n^=n<<13,t^=t<<17,n=o[i]=(n^=n>>>15)^(t^=t>>>12),e.i=i,n+(r^r>>>16)|0},function(t,e){var n,r,o,i,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,i=-32;i<u;++i)e&&(r^=e.charCodeAt((i+32)%e.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=0==(n=s[127&i]^=r+(a=a+1640531527|0))?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,s[o]=(r^=r>>>15)^(n^=n>>>12);t.w=a,t.X=s,t.i=o}(e,t)}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xor4096=o}(0,t)}),Tb=xb(function(t){!function(t,e,n){function r(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.tychei=o}(0,t)}),kb=xb(function(t){!function(e,r){var o,i=this,a=256,s=6,u="random",c=r.pow(a,s),l=r.pow(2,52),h=2*l,p=a-1;function f(t,n,f){var g=[],y=v(function t(e,n){var r,o=[],i=typeof e;if(n&&"object"==i)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==i?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,m(e)]}}():t,3),g),w=new function(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=p&i+t[o%n]+(e=s[o])],s[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,s=r.S;t--;)e=s[o=p&o+1],n=n*a+s[p&(s[o]=s[i=p&i+e])+(s[i]=e)];return r.i=o,r.j=i,n})(a)}(g),b=function(){for(var t=w.g(s),e=c,n=0;t<l;)t=(t+n)*a,e*=a,n=w.g(1);for(;t>=h;)t/=2,e/=2,n>>>=1;return(t+n)/e};return b.int32=function(){return 0|w.g(4)},b.quick=function(){return w.g(4)/4294967296},b.double=b,v(m(w.S),e),(n.pass||f||function(t,e,n,o){return o&&(o.S&&d(o,w),t.state=function(){return d(w,{})}),n?(r[u]=t,e):t})(b,y,"global"in n?n.global:this==r,n.state)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function v(t,e){for(var n,r=t+"",o=0;o<r.length;)e[p&o]=p&(n^=19*e[p&o])+r.charCodeAt(o++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(r["seed"+u]=f,v(r.random(),e),t.exports){t.exports=f;try{o=n(!function(){var t=new Error("Cannot find module 'crypto'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){}}}([],Math)});kb.alea=_b,kb.xor128=Cb,kb.xorwow=Eb,kb.xorshift7=Sb,kb.xor4096=Rb,kb.tychei=Tb;var Ib=kb.alea,Nb=function(){function t(t,e,n,r,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=o||Math.random();this.random=Ib(i.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var o=void 0,i=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(i=2*this.random()-1)*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}();function Ab(t,e){return cv(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h,p,f,d,v,m,g,y,w,b,x;return lv(this,function(_){switch(_.label){case 0:if(n=og(t,"img","toPixels"),t instanceof am||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(a=2===n.rank?1:n.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return s=n.min(),u=n.max(),[4,s.data()];case 1:return c=_.sent()[0],[4,u.data()];case 2:if(l=_.sent()[0],s.dispose(),u.dispose(),"float32"===n.dtype){if(c<0||l>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+c+" - "+l+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(c<0||l>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+c+" - "+l+"].")}return[4,n.data()];case 3:for(h=_.sent(),p="float32"===n.dtype?255:1,f=new Uint8ClampedArray(i*o*4),d=0;d<o*i;++d)v=void 0,m=void 0,g=void 0,y=void 0,1===a?(v=h[d]*p,m=h[d]*p,g=h[d]*p,y=255):3===a?(v=h[3*d]*p,m=h[3*d+1]*p,g=h[3*d+2]*p,y=255):4===a&&(v=h[4*d]*p,m=h[4*d+1]*p,g=h[4*d+2]*p,y=h[4*d+3]*p),f[0+(w=4*d)]=Math.round(v),f[w+1]=Math.round(m),f[w+2]=Math.round(g),f[w+3]=Math.round(y);return null!=e&&(e.width=i,e.height=o,b=e.getContext("2d"),x=new ImageData(f,i,o),b.putImageData(x,0,0)),n!==t&&n.dispose(),[2,f]}})})}function Db(t,e,n){return void 0===e&&(e="float32"),new nm(t,e=e||"float32",n)}var Mb=ag({batchToSpaceND_:function(t,e,n){var r=og(t,"x","batchToSpaceND"),o=e.reduce(function(t,e){return t*e});return wv(r.rank>=1+e.length,"input rank is "+r.rank+" but should be > than blockShape.length "+e.length),wv(n.length===e.length,"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length),wv(r.shape[0]%o==0,"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o),Im.engine.runKernel(function(t){return t.batchToSpaceND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}})}}),Pb=ag({cast_:function(t,e){var n=og(t,"x","cast");return Im.engine.runKernel(function(t){return t.cast(n,e)},{$x:n},function(t){return{$x:function(){return t.clone()}}})}}),Ob=ag({clone_:function(t){var e=og(t,"x","clone",null);return Im.engine.runKernel(function(t){return am.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),Fb=ag({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=og(t,"x","cumsum"),i=Gm([e|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=$m(1,o.rank)[0],u=Im.engine.runKernel(function(t){return t.cumsum(a,s,n,r)},{permutedX:a},function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),Lb=ag({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=og(t,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return wv(o*e>=0,"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape),wv(i*e>=0,"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+" for depthToSpace with input shape\n          "+r.shape),wv(a%(e*e)==0,"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape),Im.engine.runKernel(function(t){return t.depthToSpace(r,e,n)},{$x:r})}}),Bb=ag({expandDims_:function(t,e){void 0===e&&(e=0);var n=og(t,"x","expandDims");wv(e<=n.rank,"Axis must be <= rank of the tensor");var r=n.shape.slice();return e<0&&(wv(-(n.rank+1)<=e,"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"),e=n.rank+e+1),r.splice(e,0,1),Yb(n,r)}}),Ub=ag({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var o=Db([t,e],r),i=t<=e?t:e,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,e);if(null==n)return s;if(1===n.length)return ex(Bb(s,0),[n[0],1,1]);if(2===n.length)return ex(Bb(Bb(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return ex(Bb(Bb(Bb(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Vb=ag({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return Im.engine.fromPixels(t,e)}}),jb=ag({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var o=og(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?o.as2D(1,-1):o,u=Im.engine.runKernel(function(t){return t.multinomial(s,r,e,n)},{logits2D:s});return 1===a?u.as1D():u}}),zb=ag({oneHot_:function(t,e,n,r){void 0===n&&(n=1),void 0===r&&(r=0);var o=og(t,"indices","oneHot","int32");if(e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);return Im.engine.runKernel(function(t){return t.oneHot(o,e,n,r)},{$indices:o},function(t){return{$indices:function(){return wg(o.shape,"float32")}}})}}),Wb=ag({pad_:function(t,e,n){void 0===n&&(n=0);var r=og(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=e.map(function(t){return t[0]});return Im.engine.runKernel(function(t){return t.pad(r,e,n)},{$x:r},function(t){return{$x:function(){return t.slice(o,r.shape)}}})}}),Hb=ag({pad1d_:function(t,e,n){return void 0===n&&(n=0),wv(2===e.length,"Invalid number of paddings. Must be length of 2."),Wb(t,[e],n)}}),Gb=ag({pad2d_:function(t,e,n){return void 0===n&&(n=0),wv(2===e.length&&2===e[0].length&&2===e[1].length,"Invalid number of paddings. Must be length of 2 each."),Wb(t,e,n)}}),qb=ag({pad3d_:function(t,e,n){return void 0===n&&(n=0),wv(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,"Invalid number of paddings. Must be length of 2 each."),Wb(t,e,n)}}),$b=ag({pad4d_:function(t,e,n){return void 0===n&&(n=0),wv(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,"Invalid number of paddings. Must be length of 2 each."),Wb(t,e,n)}}),Kb=ag({rand_:function(t,e,n){var r=Cv(t),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=e();return am.make(t,{values:o},n)}}),Xb=ag({randomNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Nb(e,n,r,!1,o),a=Db(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Qb=ag({randomUniform_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var o=Db(t,r),i=0;i<o.values.length;i++)o.values[i]=yv(e,n);return o.toTensor()}}),Yb=ag({reshape_:function(t,e){var n=og(t,"x","reshape",null);return e=Nv(e,n.size),wv(n.size===Cv(e),"new shape and old shape must have the same number of elements."),Im.engine.runKernel(function(t){return t.reshape(n,e)},{$x:n},function(t){return{$x:function(){return t.reshape(n.shape)}}})}}),Zb=ag({spaceToBatchND_:function(t,e,n){var r=og(t,"x","spaceToBatchND");return wv(r.rank>=1+e.length,"input rank "+r.rank+" should be > than [blockShape] "+e.length),wv(n.length===e.length,"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length),wv(r.shape.reduce(function(t,r,o){return o>0&&o<=e.length?t&&(r+n[o-1][0]+n[o-1][1])%e[o-1]==0:t},!0),"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()),Im.engine.runKernel(function(t){return t.spaceToBatchND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}})}}),Jb=ag({squeeze_:function(t,e){var n=og(t,"x","squeeze");return Yb(n,Av(n.shape,e).newShape)}}),tx=ag({stack_:function(t,e){void 0===e&&(e=0);var n=ig(t,"tensors","stack");if(wv(n.length>=1,"Pass at least one tensor to tf.stack"),1===n.length)return n[0].expandDims(e);var r=n[0].shape,o=n[0].dtype;wv(e<=n[0].rank,"Axis must be <= rank of the tensor"),n.forEach(function(t){bv(r,t.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(t){wv(o===t.dtype,"All tensors passed to stack must have matching dtypes")});var i=n.map(function(t){return t.expandDims(e)});return vb(i,e)}}),ex=ag({tile_:function(t,e){var n=og(t,"x","tile");return wv(n.rank===e.length,"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."),Im.engine.runKernel(function(t){return t.tile(n,e)},{$x:n},function(t){return{$x:function(){var r=Cg(n);if(1===n.rank)for(var o=0;o<e[0];++o)r=r.add(t.slice([o*n.shape[0]],[n.shape[0]]));else if(2===n.rank)for(o=0;o<e[0];++o)for(var i=0;i<e[1];++i)r=r.add(t.slice([o*n.shape[0],i*n.shape[1]],[n.shape[0],n.shape[1]]));else if(3===n.rank)for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(var a=0;a<e[2];++a)r=r.add(t.slice([o*n.shape[0],i*n.shape[1],a*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(4!==n.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(a=0;a<e[2];++a)for(var s=0;s<e[3];++s)r=r.add(t.slice([o*n.shape[0],i*n.shape[1],a*n.shape[2],s*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return r}}})}}),nx=ag({truncatedNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Nb(e,n,r,!0,o),a=Db(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),rx=ag({unstack_:function(t,e){void 0===e&&(e=0);for(var n,r=og(t,"x","unstack"),o=r.shape[e],i=Array(r.rank-1).fill(0),a=0,s=0;s<r.rank;s++)s!==e&&(i[a]=r.shape[s],a++);n=Array(o).fill(1);var u=Array(r.rank).fill(0),c=r.shape.slice();return n.map(function(t){c[e]=t;var n=r.slice(u,c);return u[e]+=t,n.reshape(i)})}});function ox(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var o=Db(t,"int32"),i=Db([n.length,t.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]);i.values.set(a,r*t.length)}return i.toTensor()}var ix=300,ax=function(){function t(t,e){if(void 0===e&&(e=!0),this.gpgpu=t,this.delayedStorage=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,Im.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(null==t){var n=fv(Im.get("WEBGL_VERSION"));this.gpgpu=new Fw(n),this.canvas=n.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;Im.get("WEBGL_PAGING_ENABLED")&&(this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*ix),this.textureManager=new ub(this.gpgpu)}return t.prototype.register=function(t,e,n){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:e,dtype:n})},t.prototype.setDataMover=function(t){this.texData=new Eg(t)},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.fromPixels() can not be null");var n=[t.height,t.width],r=[t.height,t.width,e];if(!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(t instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if(!Im.get("IS_BROWSER"))throw new Error("Can't read pixels from HTMLImageElement outside the browser.");if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),t=this.fromPixels2DContext.canvas}var o=this.makeTensorHandle(n,"int32");this.texData.get(o.dataId).usage=xy.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(o.dataId),t);var i=new Ry(r),a=this.compileAndRun(i,[o]);return this.disposeData(o.dataId),a},t.prototype.makeTensorHandle=function(t,e){var n={};return this.register(n,t,e),{dataId:n,shape:t,dtype:e}},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendWebGL.write(): values can not be null");var n=this.texData.get(t),r=n.texture,o=n.texShape,i=n.usage,a=n.isPacked;if("complex64"===n.dtype)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=r&&(this.releaseTexture(t,r,o,i,a),n.texture=null,n.texShape=null),n.usage=xy.UPLOAD,n.values=e,this.delayedStorage||this.uploadToGPU(t)},t.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,o=e.complexTensors;if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var i,a,s=null!=this.activeTimers;return s&&(i=performance.now()),a="complex64"===r?Tg(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(t),s&&(this.downloadWaitMs+=performance.now()-i),this.convertAndCacheOnCPU(t,a)},t.prototype.read=function(t){return cv(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,c,l,h,p,f,d,v,m,g;return lv(this,function(y){switch(y.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(t){return r.push(t)})];if(o=this.texData.get(t),i=o.texture,a=o.texShape,s=o.isPacked,u=o.shape,null!=o.values)return[2,this.convertAndCacheOnCPU(t)];if(this.pendingRead.set(t,[]),!Im.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Im.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return c=a[1],l=a[0],s&&(e=Dy(a[0],a[1]),c=e[0],l=e[1]),h=this.gpgpu.maybeCreateBufferFromTexture(i,l,c),[4,this.gpgpu.createAndWaitForFence()];case 1:return y.sent(),h instanceof WebGLTexture?p=this.getValuesFromTexture(t):s?(f=this.getBatchDim(u),d=1,v=1,u.length&&(n=this.getRowsCols(u),d=n[0],v=n[1]),p=this.gpgpu.downloadPackedMatrixFromBuffer(h,f,d,v,a[0],a[1])):p=this.gpgpu.downloadFloat32MatrixFromBuffer(h,a[0],a[1]),m=this.convertAndCacheOnCPU(t,p),g=this.pendingRead.get(t),this.pendingRead.delete(t),g.forEach(function(t){return t(m)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,m]}})})},t.prototype.getValuesFromTexture=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,i=n.texture,a=n.texShape;if(Im.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(t).isPacked){var s=this.getBatchDim(r),u=1,c=1;return r.length&&(u=(e=this.getRowsCols(r))[0],c=e[1]),this.gpgpu.downloadMatrixFromPackedTexture(i,s,u,c,a[0],a[1])}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(i,a[0],a[1])}var l=this.makeTensorHandle(r,"float32");l.size=Cv(r),this.texData.get(l.dataId).usage=xy.DOWNLOAD;var h=new Ey(r);this.compileAndRun(h,[{shape:r,dtype:o,dataId:t}],l,null,!1);var p=this.texData.get(l.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]);return this.disposeData(l.dataId),f},t.prototype.time=function(t){return cv(this,void 0,void 0,function(){var e,n,r,o,i,a,s;return lv(this,function(u){switch(u.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),o=_v(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),i=_v(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,r&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return a=u.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:gv(a),getExtraProfileInfo:function(){return a.map(function(t,e){return{name:i[e],ms:t}}).map(function(t){return t.name+": "+t.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},t.prototype.endTimer=function(t){return Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},t.prototype.getQueryTime=function(t){return cv(this,void 0,void 0,function(){var e;return lv(this,function(n){return Im.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},t.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t))if(this.pendingRead.has(t))this.pendingDisposal.add(t);else if(this.texData.has(t)){var e=this.texData.get(t),n=e.texture,r=e.complexTensors;null!=n&&this.releaseTexture(t,n,e.texShape,e.usage,e.isPacked),null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}},t.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},t.prototype.getCPUBackend=function(){return Im.get("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Im.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=10),null!=this.getCPUBackend()&&t.every(function(t){return null==n.texData.get(t.dataId).texture&&t.size<e})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.getCanvas=function(){return this.canvas},t.prototype.complex=function(t,e){var n=this.makeOutputArray(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Im.engine.keep(t.clone()),imag:Im.engine.keep(e.clone())},n},t.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},t.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);var r=new ab(n),o=r.getCustomSetupFunc(e);return this.compileAndRun(r,[t],null,o)},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r,o,i,a,s,u);var c=Jm(t.shape,e,n,r,o,i,a,s,u),l=c[0],h=c[1],p=c[2],f=h.filter(function(t,e){return-1===p.indexOf(e)});if(f.some(function(t){return 0===t}))return pg([],f);var d=new sb(l,r,h,p);return this.compileAndRun(d,[t])},t.prototype.reverse=function(t,e){var n=new nb(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.concat2Tensors=function(t,e,n){var r=Km([t.shape,e.shape],n),o=t.as2D(-1,Cv(t.shape.slice(n))),i=e.as2D(-1,Cv(e.shape.slice(n))),a=new Xg(o.shape,i.shape);return this.compileAndRun(a,[o,i]).reshape(r)},t.prototype.concat=function(t,e){if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];for(var n=t[0],r=1;r<t.length;++r)n=this.concat2Tensors(n,t[r],e);return n},t.prototype.neg=function(t){var e=new fb(t.shape,"return -x;");return this.compileAndRun(e,[t])},t.prototype.batchMatMul=function(t,e,n,r){var o=n?t.shape[2]:t.shape[1],i=r?e.shape[1]:e.shape[2],a=n?t.shape[1]:t.shape[2],s=t.shape[0];if((1===o||1===i)&&a>1e3){n&&(t=t.transpose([0,2,1])),r&&(e=e.transpose([0,2,1]));var u=1===i?t:t.as3D(s,a,1),c=1===i?2:1,l=1===i?e.as3D(s,1,a):e;return this.multiply(u,l).sum(c,!0)}var h=vm(t.dtype,e.dtype);if(1===s){var p=t.as2D(t.shape[1],t.shape[2]),f=e.as2D(e.shape[1],e.shape[2]),d=new Ww(p.shape,f.shape,[o,i],n,r),v=this.makePackedTensor(d.outputShape,h),m=this.compileAndRun(d,[p,f],v);return m.reshape([1,m.shape[0],m.shape[1]])}return d=new zw(t.shape,e.shape,n,r),v=this.makeOutputArray(d.outputShape,h),this.compileAndRun(d,[t,e],v)},t.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),o=new zg("return areal * breal - aimag * bimag;",t.shape,e.shape),i=new zg("return areal * bimag + aimag * breal;",t.shape,e.shape),a=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag),this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag)],s=this.compileAndRun(o,a),u=this.compileAndRun(i,a),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);var l=new Gg("return a * b;",t.shape,e.shape),h=this.makeOutputArray(l.outputShape,t.dtype);return this.compileAndRun(l,[t,e],h)},t.prototype.batchNormalization=function(t,e,n,r,o,i){var a=[t,e,n],s=null;null!=i&&(s=i.shape,a.push(i));var u=null;if(null!=o&&(u=o.shape,a.push(o)),Im.get("WEBGL_PACK_BATCHNORMALIZATION")){var c=new jg(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(c,a)}var l=new Vg(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(l,a)},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){var i=new Uw(t.shape,e,n,r,o);return this.compileAndRun(i,[t])},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){var s=new Vw(e.shape,r,o,i,a);return this.compileAndRun(s,[e,n,t])},t.prototype.tile=function(t,e){var n=new hb(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.pad=function(t,e,n){var r=new Kw(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.transpose=function(t,e){var n=new pb(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.gather=function(t,e,n){var r=new Ty(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},t.prototype.batchToSpaceND=function(t,e,n){wv(t.rank<=4,"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");var r=e.reduce(function(t,e){return t*e}),o=Om(t.shape,e,r),i=Fm(o.length,e.length),a=Lm(t.shape,e,r),s=Bm(n,e.length),u=Um(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(t,e,n){wv(t.rank<=4,"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=Om(a.shape,e,r,!1),u=Fm(s.length,e.length,!1),c=Lm(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(c)},t.prototype.reduce=function(t,e,n){var r=t.shape[0],o=t.shape[1],i=Ym(o),a=new Qw({windowSize:i,inSize:o,batchSize:r},e),s=a.outputShape,u=this.makeOutputArray([s[0],s[1]],n);return this.compileAndRun(a,[t],u),1===u.shape[1]?u:this.reduce(u,e,n)},t.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],o=t.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var i=Ym(o),a=new Og({windowSize:i,inSize:o,batchSize:r},e,null==n),s=a.outputShape,u=this.makeOutputArray([s[0],s[1]],"int32"),c=[t];return null!=n&&c.push(n),this.compileAndRun(a,c,u),1===u.shape[1]?u:this.argReduce(t,e,u)},t.prototype.sum=function(t,e){Hm("sum",e,t.rank);var n=jm(t.shape,e),r=n[0],o=Cv(n[1]),i=t.as2D(-1,o),a=mm(t.dtype);return this.reduce(i,"sum",a).reshape(r)},t.prototype.prod=function(t,e){var n=jm(t.shape,e),r=n[0],o=Cv(n[1]),i=t.as2D(-1,o),a=mm(t.dtype);return this.reduce(i,"prod",a).reshape(r)},t.prototype.unsortedSegmentSum=function(t,e,n){var r=0,o=Gm([r],t.rank),i=t;null!=o&&(i=t.transpose(o),r=$m(1,t.rank)[0]);var a=function(t,e,n){for(var r=[],o=t.length,i=0;i<o;i++)r.push(i!==e?t[i]:n);return r}(i.shape,r,n),s=Cv([i.shape[r]]),u=i.as2D(-1,s),c=mm(t.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",e,c,n).reshape(a);return null!=o&&(l=l.transpose(qm(o))),l},t.prototype.segOpCompute=function(t,e,n,r,o){var i=t.shape[0],a=t.shape[1],s=function(t,e){var n,r=!1;for(t<=Qm?(n=t,r=!0):n=Gv(t,Math.floor(Math.sqrt(t)));!r;){if(n>e||n===t){r=!0;break}n=Gv(t,n+1)}return n}(a,o),u=new ob({windowSize:s,inSize:a,batchSize:i,numSegments:o},e),c=u.outputShape,l=this.makeOutputArray([c[0],c[1]],r);return this.compileAndRun(u,[t,n],l),l.shape[1]===o?l:(n=xg(0,o).tile([a/s]),this.segOpCompute(l,e,n,r,o))},t.prototype.argMin=function(t,e){var n=[e];Hm("argMin",n,t.rank);var r=jm(t.shape,n),o=r[0],i=Cv(r[1]),a=t.as2D(-1,i);return this.argReduce(a,"min").reshape(o)},t.prototype.argMax=function(t,e){var n=[e];Hm("argMax",n,t.rank);var r=jm(t.shape,n),o=r[0],i=Cv(r[1]),a=t.as2D(-1,i);return this.argReduce(a,"max").reshape(o)},t.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var o=new wy(t.shape,n,r);return this.compileAndRun(o,[t])},t.prototype.equal=function(t,e){var n=new Gg("return float(a == b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.notEqual=function(t,e){var n=new Gg("return float(a != b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);var n=new Gg("return float(a < b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.lessEqual=function(t,e){var n=new Gg("return float(a <= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);var n=new Gg("return float(a > b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greaterEqual=function(t,e){var n=new Gg("return float(a >= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalNot=function(t){var e=new fb(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},t.prototype.logicalAnd=function(t,e){var n=new Gg("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalOr=function(t,e){var n=new Gg("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.select=function(t,e,n){var r=new ib(t.rank,e.shape,e.rank),o=this.makeOutputArray(r.outputShape,vm(e.dtype,n.dtype));return this.compileAndRun(r,[t,e,n],o)},t.prototype.where=function(t){Pm("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return ox(t.shape,e)},t.prototype.topk=function(t,e,n){return Pg(t.dataSync(),t.shape,t.dtype,e)},t.prototype.min=function(t,e){Hm("min",e,t.rank);var n=jm(t.shape,e),r=n[0],o=Cv(n[1]),i=t.as2D(-1,o);return this.reduce(i,"min",i.dtype).reshape(r)},t.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=new Gg("\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.mod=function(t,e){var n=new Gg("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t,e],null,r)},t.prototype.max=function(t,e){Hm("max",e,t.rank);var n=jm(t.shape,e),r=n[0],o=Cv(n[1]),i=t.as2D(-1,o);return this.reduce(i,"max",i.dtype).reshape(r)},t.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=new Gg("\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.all=function(t,e){Hm("all",e,t.rank);var n=jm(t.shape,e),r=n[0],o=Cv(n[1]),i=t.as2D(-1,o);return this.reduce(i,"all",i.dtype).reshape(r)},t.prototype.any=function(t,e){Hm("any",e,t.rank);var n=jm(t.shape,e),r=n[0],o=Cv(n[1]),i=t.as2D(-1,o);return this.reduce(i,"any",i.dtype).reshape(r)},t.prototype.squaredDifference=function(t,e){var n=new Gg("return (a - b) * (a - b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.realDivide=function(t,e){var n=new Gg("if (a == b) return 1.0;\n  return a / b;",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t,e],r)},t.prototype.floorDiv=function(t,e){var n=new Gg("\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[t,e],r)},t.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Wg);var n=new Gg(Wg,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,vm(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,o=this.texData.get(t.dataId),i=this.texData.get(e.dataId),a=[[o.complexTensors.real,i.complexTensors.real],[o.complexTensors.imag,i.complexTensors.imag]].map(function(o){var i=o[0],a=o[1],s=new Gg(n,t.shape,e.shape),u=r.makeOutputArray(s.outputShape,vm(i.dtype,a.dtype)),c=r.makeComplexComponentTensorHandle(t,i),l=r.makeComplexComponentTensorHandle(e,a);return r.compileAndRun(s,[c,l],u)}),s=a[0],u=a[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},t.prototype.makeComplexComponentTensorHandle=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},t.prototype.addN=function(t){for(var e=t[0],n=1;n<t.length;n++)e=this.add(e,t[n]);return e},t.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Hg);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=new Gg(Hg,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,vm(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.pow=function(t,e){var n=new Gg("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),r=n.getCustomSetupFunc(),o=this.makeOutputArray(n.outputShape,vm(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],o,r)},t.prototype.ceil=function(t){var e=new fb(t.shape,"return ceil(x);");return this.compileAndRun(e,[t])},t.prototype.floor=function(t){var e=new fb(t.shape,"return floor(x);");return this.compileAndRun(e,[t])},t.prototype.sign=function(t){var e=new fb(t.shape,"\n  if (isNaN(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},t.prototype.round=function(t){var e=new fb(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},t.prototype.exp=function(t){var e=new fb(t.shape,"return exp(x);");return this.compileAndRun(e,[t])},t.prototype.expm1=function(t){var e=new fb(t.shape,"return exp(x) - 1.0;");return this.compileAndRun(e,[t])},t.prototype.log=function(t){var e=new fb(t.shape,"if (x < 0.0) return NAN;\n  return log(x);"),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.log1p=function(t){var e=new fb(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},t.prototype.sqrt=function(t){var e=new fb(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},t.prototype.rsqrt=function(t){var e=new fb(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},t.prototype.square=function(t){var e=new fb(t.shape,"return x * x;");return this.compileAndRun(e,[t])},t.prototype.reciprocal=function(t){var e=new fb(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},t.prototype.relu=function(t){var e=new fb(t.shape,"if (isNaN(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n");return this.compileAndRun(e,[t])},t.prototype.elu=function(t){var e=new fb(t.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(e,[t])},t.prototype.eluDer=function(t,e){var n=new Gg("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.selu=function(t){var e=new fb(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},t.prototype.int=function(t){var e=new fb(t.shape,"return float(int(x));"),n=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[t],n)},t.prototype.clip=function(t,e,n){var r;return r=Im.get("WEBGL_PACK_CLIP")?new $g(t.shape,e,n):new qg(t.shape,e,n),this.compileAndRun(r,[t])},t.prototype.abs=function(t){var e=new fb(t.shape,"return abs(x);");return this.compileAndRun(e,[t])},t.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new Kg(t.shape),r=[this.makeComplexComponentTensorHandle(t,e.complexTensors.real),this.makeComplexComponentTensorHandle(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(t){var e=new fb(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},t.prototype.softplus=function(t){var e=new fb(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},t.prototype.sin=function(t){var e=new fb(t.shape,"if (isNaN(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])},t.prototype.cos=function(t){var e=new fb(t.shape,"if (isNaN(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])},t.prototype.tan=function(t){var e=new fb(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},t.prototype.asin=function(t){var e=new fb(t.shape,"return asin(x);");return this.compileAndRun(e,[t])},t.prototype.acos=function(t){var e=new fb(t.shape,"return acos(x);");return this.compileAndRun(e,[t])},t.prototype.atan=function(t){var e=new fb(t.shape,"if (isNaN(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])},t.prototype.atan2=function(t,e){var n=new Gg("\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.sinh=function(t){var e=new fb(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.cosh=function(t){var e=new fb(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.tanh=function(t){var e=new fb(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},t.prototype.asinh=function(t){var e=new fb(t.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},t.prototype.acosh=function(t){var e=new fb(t.shape,"if (isNaN(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));"),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.atanh=function(t){var e=new fb(t.shape,"if (isNaN(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;"),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.erf=function(t){var e=new fb(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n');return this.compileAndRun(e,[t])},t.prototype.step=function(t,e){var n=new fb(t.shape,function(t){return void 0===t&&(t=0),"if (isNaN(x)) return x;\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},t.prototype.conv2dWithIm2Row=function(t,e,n){var r=n.outWidth,o=n.outHeight,i=n.filterWidth*n.filterHeight*n.inChannels,a=o*r,s=[i,a],u=t.squeeze([0]),c=e.reshape([i,-1]),l=new Bw(s,u.shape,n),h=this.compileAndRun(l,[u]),p=new Ww(h.shape,c.shape,[a,n.outChannels],!0,!1);return this.compileAndRun(p,[h,c]).reshape([1,o,r,n.outChannels])},t.prototype.conv2d=function(t,e,n){if(Im.get("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new ny(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerInput=function(t,e,n){var r=new Yg(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerFilter=function(t,e,n){var r=new Qg(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2D=function(t,e,n){var r;return Im.get("WEBGL_PACK_DEPTHWISECONV")&&1===n.dilationWidth&&1===n.dilationHeight&&n.padInfo.left<=1&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new iy(n),this.compileAndRun(r,[t,e],this.makePackedTensor(n.outShape,t.dtype))):(r=new oy(n),this.compileAndRun(r,[t,e]))},t.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new ey(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new ty(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3d=function(t,e,n){var r=new ry(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3dDerInput=function(t,e,n){var r=new Jg(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3dDerFilter=function(t,e,n){var r=new Zg(n);return this.compileAndRun(r,[t,e])},t.prototype.maxPool=function(t,e){var n=new Xw(e,"max",!1),r=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[t],r)},t.prototype.avgPool=function(t,e){var n=new Xw(e,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],r)},t.prototype.maxPoolBackprop=function(t,e,n,r){var o=new Xw(r,"max",!0),i=this.compileAndRun(o,[e]),a=new jw(r),s=this.makeOutputArray(a.outputShape,e.dtype),u=this.compileAndRun(a,[t,i],s);return i.dispose(),u},t.prototype.avgPoolBackprop=function(t,e,n){var r=new Fg(n),o=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[t],o)},t.prototype.cast=function(t,e){return Sg(t,e,this)},t.prototype.reshape=function(t,e){return this.texData.get(t.dataId).isPacked&&!pw(t.shape,e)?this.packedReshape(t,e):Rg(t,e)},t.prototype.resizeBilinear=function(t,e,n,r){var o=new Jw(t.shape,e,n,r);return this.compileAndRun(o,[t])},t.prototype.resizeBilinearBackprop=function(t,e,n){var r=new Zw(t,e,n);return this.compileAndRun(r,[t])},t.prototype.resizeNearestNeighbor=function(t,e,n,r){var o=new eb(t.shape,e,n,r);return this.compileAndRun(o,[t])},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new tb(t,e,n);return this.compileAndRun(r,[t])},t.prototype.multinomial=function(t,e,n,r){var o=e?t:sg(t),i=new Hw(o.shape[0],o.shape[1],n),a=this.makeOutputArray(i.outputShape,"int32"),s=i.getCustomSetupFunc(r);return this.compileAndRun(i,[o],a,s)},t.prototype.oneHot=function(t,e,n,r){var o=new Gw(t.size,e,n,r);return this.compileAndRun(o,[t])},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return Pm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ag(t.dataSync(),e.dataSync(),n,r,o)},t.prototype.cropAndResize=function(t,e,n,r,o,i){var a=new uy(t.shape,e.shape,r,o,i);return this.compileAndRun(a,[t,e,n])},t.prototype.depthToSpace=function(t,e,n){wv(e>1,"blockSize should be > 1 for depthToSpace, but was: "+e);var r=t.shape[0],o=("NHWC"===n?t.shape[1]:t.shape[2])*e,i=("NHWC"===n?t.shape[2]:t.shape[3])*e,a=("NHWC"===n?t.shape[3]:t.shape[1])/(e*e),s=new Cy("NHWC"===n?[r,o,i,a]:[r,a,o,i],e,n);return this.compileAndRun(s,[t])},t.prototype.split=function(t,e,n){return Mg(t,e,n)},t.prototype.scatterND=function(t,e,n){var r=Zm(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/a,a],l=t.reshape([i,o]),h=e.reshape([i,a]);if(0===u)return Rg(pg([]),n);var p=fg(0),f=new rb(i,o,l.rank,h.rank,s,c);return this.compileAndRun(f,[h,l,p]).reshape(n)},t.prototype.sparseToDense=function(t,e,n,r){var o=Zm(0,t,n),i=new rb(o.numUpdates,o.sliceRank,t.rank,e.rank,o.strides,[o.outputSize,1],!1);return this.compileAndRun(i,[e,t,r]).reshape(n)},t.prototype.fft=function(t){return this.fftImpl(t,!1)},t.prototype.ifft=function(t){return this.fftImpl(t,!0)},t.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new Sy("return real * expR - imag * expI;",t.shape,e),o=new Sy("return real * expI + imag * expR;",t.shape,e),i=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag)],a=this.compileAndRun(r,i),s=this.compileAndRun(o,i),u=this.complex(a,s).as2D(t.shape[0],t.shape[1]);return a.dispose(),s.dispose(),u},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=Xm(t,e),i=o[0],a=o[1],s=o[2],u=o[3],c=e.reshape([a,r]),l=t.reshape([t.size/s,s]),h=new ky(r,u,[a,s]);return this.compileAndRun(h,[l,c]).reshape(i)},t.prototype.makeOutputArray=function(t,e){return am.make(t,{},e)},t.prototype.makePackedTensor=function(t,e){var n=am.make(t,{},e);return this.texData.get(n.dataId).isPacked=!0,n},t.prototype.unpackTensor=function(t){var e=new db(t.shape);return this.compileAndRun(e,[t],am.make(e.outputShape,{},t.dtype))},t.prototype.getBatchDim=function(t,e){return void 0===e&&(e=2),Cv(t.slice(0,t.length-e))},t.prototype.getRowsCols=function(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]},t.prototype.packedReshape=function(t,e){var n=t.reshape([this.getBatchDim(t.shape)].concat(this.getRowsCols(t.shape))),r=[this.getBatchDim(e)].concat(this.getRowsCols(e)),o=new Yw(r,n.shape);return this.compileAndRun(o,[n]).reshape(e)},t.prototype.compileAndRun=function(t,e,n,r,o){var i=this;if(void 0===o&&(o=!0),null==n&&(n=t.usesPackedTextures?this.makePackedTensor(t.outputShape,e[0].dtype):this.makeOutputArray(t.outputShape,e[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=Dv(n.dtype,0),n;var a=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(e.dataId);if(null==n.texture){if(!t.usesPackedTextures&&Cv(e.shape)<=Im.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:i.readSync(e.dataId)};t.usesPackedTextures&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.usesPackedTextures){var r=void 0,o=void 0;n.isPacked?(r=new db(e.shape),o=i.compileAndRun(r,[e],am.make(r.outputShape,{},e.dtype))):(r=new $w(e.shape),o=i.compileAndRun(r,[e],i.makePackedTensor(e.shape,e.dtype))),n=i.texData.get(o.dataId),e=o}else if(n.isPacked&&!pw(n.shape,e.shape)){i.delayedStorage=!1;var a=e.dataSync();i.delayedStorage=!0,e=am.make(e.shape,{values:a},e.dtype),(n=i.texData.get(e.dataId)).isPacked=!0}return i.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}});this.uploadToGPU(n.dataId);var s,u={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},c=function(t,e,n){var r="";a.concat(u).forEach(function(t){r+=t.shape+"_"+(t.isUniform?"uniform":t.texData.texShape)});var o=t.userCode,i=(!0===t.supportsBroadcasting).toString();return t.constructor.name+"_"+i+"_"+r+"_"+o}(t),l=this.getAndSaveBinary(c,function(){return function(t,e,n,r){for(var o=e.userCode,i=n.map(function(t,n){return{name:e.variableNames[n],shapeInfo:{logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked}}}),a=i.map(function(t){return t.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked},u=function(t,e,n,r,o){var i=t.map(function(t){var e=Cv(t.shapeInfo.logicalShape);return t.shapeInfo.isUniform?"uniform float "+t.name+(e>1?"["+e+"]":"")+";":"uniform sampler2D "+t.name+";"});i=i.join("\n");var a,s,u=t.map(function(t){return function(t,e,n,r){void 0===r&&(r=!1);var o=function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1)+"Flat",r=Cv(t.shapeInfo.logicalShape);if(t.shapeInfo.isUniform)return 1===r?"float "+n+"(int index) {return "+e+";}":"\n      float "+n+"(int index) {\n        for (int i = 0; i < "+r+"; i++) {\n          if (i == index) {\n            return "+e+"[i];\n          }\n        }\n      }\n    ";var o=t.shapeInfo.texShape,i=o[0],a=o[1];return 1===a&&1===i?"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ":1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+i+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = UVfrom1D("+i+", "+a+", index);\n      return sampleTexture("+e+", uv);\n    }\n  "}(t);return o+=r?function t(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name;return"\n    vec4 get"+e.charAt(0).toUpperCase()+e.slice(1)+"() {\n      return texture2D("+e+", halfCR);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return texture2D("+e+", uv);\n    }\n  "}(e);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1];if(null!=o&&Ev(e,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+i+".0);\n\n        return texture2D("+n+", uv);\n      }\n    ";var s=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+s[0]+", "+s[1]+", row, col);\n      return texture2D("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0])return"\n        "+t(gy(e,n.slice(1)))+"\n        vec4 "+o+"(int b, int row, int col) {\n          return "+o+"("+yy(["b","row","col"],[1,2])+");\n        }\n      ";var s=a[0],u=a[1],c=Math.ceil(n[2]/2);return"\n    vec4 "+o+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+s+", "+u+", "+c*Math.ceil(n[1]/2)+", "+c+", b, row, col);\n      return texture2D("+r+", uv);\n    }\n  "}(e);case 4:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],a=i[0],s=i[1],u=Math.ceil(e[3]/2),c=u*Math.ceil(e[2]/2);return"\n    vec4 "+r+"(int b2, int b, int row, int col) {\n      vec2 uv = packedUVfrom4D(\n        "+a+", "+s+", "+c*e[1]+",\n        "+c+", "+u+", b2, b, row, col);\n      return texture2D("+n+", uv);\n    }\n  "}(e);default:throw new Error("Packed "+n.length+"-D input sampling is not yet supported")}}(t):function t(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);return t.shapeInfo.isUniform?"float "+n+"() {return "+e+";}":"\n    float "+n+"() {\n      return sampleTexture("+e+", halfCR);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);return"\n    float "+n+"(int index) {\n      return "+n+"Flat(index);\n    }\n  "}(e);case 2:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Ev(n,i))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+i[0]+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ";var a=Av(n),s=a.keptDims,u=a.newShape;if(u.length<n.length)return"\n      "+t(gy(e,u))+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+yy(["row","col"],s)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        float index = dot(vec2(row, col), vec2("+n[1]+", 1));\n        return "+o+"Flat(round(index));\n      }\n    ";var c=i[0],l=i[1];return 1===l?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec2(row, col), vec2("+n[1]+", 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===c?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec2(row, col), vec2("+n[1]+", 1));\n      vec2 uv = vec2((index + 0.5) / "+l+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    vec2 uv = UVfrom2D("+c+", "+l+", "+n[1]+", row, col);\n    return sampleTexture("+r+", uv);\n  }\n"}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],a=n[2],s=Av(n),u=s.keptDims,c=s.newShape;if(c.length<n.length)return"\n        "+t(gy(e,c))+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+yy(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        float index = dot(vec3(row, col, depth),\n                          vec3("+i+", "+a+", 1));\n        return "+o+"Flat(round(index));\n      }\n    ";var l=e.shapeInfo.texShape,h=l[0],p=l[1];return p===i?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+h+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":p===a?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+h+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+h+", "+p+", "+i+", "+a+", row, col, depth);\n        return sampleTexture("+r+", uv);\n      }\n  "}(e);case 4:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],a=n[2]*i,s=n[1]*a,u=Av(n),c=u.newShape,l=u.keptDims;if(c.length<n.length)return"\n      "+t(gy(e,c))+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+yy(["row","col","depth","depth2"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float index = dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+a+", "+i+", 1));\n        return "+o+"Flat(round(index));\n      }\n    ";var h=e.shapeInfo.texShape,p=h[0],f=h[1];return f===s?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2), vec3("+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":f===i?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+p+", "+f+", "+s+", "+a+",\n          "+i+", row, col, depth, depth2);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 5:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[4],a=n[3]*i,s=n[2]*a,u=n[1]*s,c=Av(n),l=c.newShape,h=c.keptDims;if(l.length<n.length)return"\n      "+t(gy(e,l))+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+yy(["row","col","depth","depth2","depth3"],h)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+a+", "+i+")) +\n          depth3;\n        return "+o+"Flat(index);\n      }\n    ";var p=e.shapeInfo.texShape,f=p[0],d=p[1];return d===u?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(\n          vec4(col, depth, depth2, depth3),\n          vec4("+s+", "+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+f+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":d===i?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+", "+n[2]*n[3]+",\n            "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+f+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      vec2 uv = UVfrom5D("+f+", "+d+", "+u+", "+s+",\n          "+a+", "+i+", row, col, depth, depth2, depth3);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 6:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[5],a=n[4]*i,s=n[3]*a,u=n[2]*s,c=n[1]*u,l=Av(n),h=l.newShape,p=l.keptDims;if(h.length<n.length)return"\n      "+t(gy(e,h))+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+yy(["row","col","depth","depth2","depth3","depth4"],p)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c+", "+u+", "+s+", "+a+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+i+", 1));\n        return "+o+"Flat(index);\n      }\n    ";var f=e.shapeInfo.texShape,d=f[0],v=f[1];return v===c?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(\n          vec4(col, depth, depth2, depth3),\n          vec4("+u+", "+s+", "+a+", "+i+")) + depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":v===i?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + depth3;\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      vec2 uv = UVfrom6D("+d+", "+v+", "+c+", "+u+",\n          "+s+", "+a+", "+i+"\n          ,row, col, depth, depth2, depth3, depth4);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(t),(n||Ev(t.shapeInfo.logicalShape,e.logicalShape))&&(o+=r?function(t,e,n){var r=t.name,o=r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,a="get"+o+"AtOutCoords",s=e.texShape,u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=u[0],l=u[1],h=Lg(t.shapeInfo.logicalShape,e.logicalShape),p=t.shapeInfo.logicalShape.length,f=e.logicalShape.length;if(h.length)throw Error("Packed broadcast sampling is not implemented yet.");if(Ev(t.shapeInfo.texShape,s))return"\n      vec4 "+a+"() {\n        return texture2D("+r+", resultUV);\n      }\n    ";var d="return texture2D("+r+", uv)";return 1===p&&f>1?d="\n      vec4 sample = texture2D("+r+", uv);\n      return vec4(sample.xy, sample.xy);\n    ":0===p&&f>0&&(d=1===f?"\n        vec4 sample = texture2D("+r+", uv);\n        return vec4(sample.x, sample.x, 0., 0.);\n      ":"\n        vec4 sample = texture2D("+r+", uv);\n        return vec4(sample.x);\n      "),"\n    vec4 "+a+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+u[0]+", "+u[1]+"));\n      int index = resTexRC.x * "+u[1]+" + resTexRC.y;\n\n      int texR = index / "+l+";\n      int texC = index - texR * "+l+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+l+", "+c+");\n\n      "+d+";\n    }\n  "}(t,e):function(t,e,n){var r=t.name,o=r.charAt(0).toUpperCase()+r.slice(1),i="get"+o+"AtOutCoords",a=Lg(t.shapeInfo.logicalShape,e.logicalShape),s=n&&(e.logicalShape.length>t.shapeInfo.logicalShape.length||a.length>0),u=function(t){for(var e=0;e<t.length;e++)if(t[e]!==e)return!1;return!0}(a),c=t.shapeInfo.isUniform;if(s&&!u)return function(t,e,n,r){var o=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a="int";2===i?a="ivec2":3===i?a="ivec3":4===i&&(a="ivec4");var s=Lg(t.shapeInfo.logicalShape,e.logicalShape),u=i-o;return"\n    float "+r+"() {\n      "+a+" coords = getOutputCoords();\n      "+(0===o?"":i<2&&s.length>=1?"coords = 0;":s.map(function(t){return"coords["+(t+u)+"] = 0;"}).join("\n"))+"\n      return get"+n+"("+(i<2&&o>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords["+(e+u)+"]"}).join(", "))+");\n    }\n  "}(t,e,o,i);var l=Cv(t.shapeInfo.logicalShape),h="";s&&u&&(h="\n        int mainPart = index / "+l+";\n        index -= mainPart * "+l+";\n      ");var p=e.texShape;if(c)return 1===l?"float "+i+"() {return "+r+";}":"\n      float "+i+"() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                              vec2("+p[0]+", "+p[1]+"));\n        int index = resTexRC.x * "+p[1]+" + resTexRC.y;\n        "+h+"\n        return get"+o+"Flat(index);\n      }\n    ";var f=t.shapeInfo.texShape;return Ev(f,p)?"\n      float "+i+"() {\n        return sampleTexture("+r+", resultUV);\n      }\n    ":"\n    float "+i+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+p[0]+", "+p[1]+"));\n      int index = resTexRC.x * "+p[1]+" + resTexRC.y;\n      "+h+"\n      int texR = index / "+f[1]+";\n      int texC = index - texR * "+f[1]+";\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+f[1]+".0, "+f[0]+".0);\n\n      return sampleTexture("+r+", uv);\n    }\n  "}(t,e,n)),o}(t,e,r,o)}).join("\n"),c=e.texShape,l=dy;return e.isPacked?(a=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===e[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Ev(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}(t,e);case 4:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[3]/2),o=r*Math.ceil(t[2]/2),i=o*t[1];return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      int b2 = index / "+i+";\n      index -= b2 * "+i+";\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  "}(t,e);default:throw new Error(t.length+"-D packed output coordinate fetching is not yet supported")}}(e.logicalShape,c),s=fy):(a=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return Ev(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return function(t,e){var n=cy(["r","c","d"],t);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec3(r, c, d);\n    }\n  "}(t,e);case 4:return function(t,e){var n=cy(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=cy(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=cy(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}}(e.logicalShape,c),s=py),o&&(l+=vy),[l,hy,s,i,a,u,n].join("\n")}(i,s,o,!0===e.supportsBroadcasting,e.usesPackedTextures),c=t.createProgram(u),l={},h=0;h<e.variableNames.length;h++){var p=e.variableNames[h];l[p]=t.getUniformLocation(c,p,!1)}return{program:e,source:u,webGLProgram:c,uniformLocations:l,gpgpu:t,inShapeInfos:a,outShapeInfo:s}}(i.gpgpu,t,a,u)}),h=null!=this.activeTimers;if(h&&(s=this.startTimer()),function(t,e,n,r){Lw(t.inShapeInfos,e),Lw([t.outShapeInfo],[n]);var o=n.texData.texture,i=n.texData.texShape,a=t.gpgpu;n.texData.isPacked?a.setOutputPackedMatrixTexture(o,i[0],i[1]):a.setOutputMatrixTexture(o,i[0],i[1]),a.setProgram(t.webGLProgram),e.forEach(function(e,n){var r=t.uniformLocations[t.program.variableNames[n]];if(null!=r){if(e.isUniform){if(1===Cv(e.shape))a.gl.uniform1f(r,e.uniformValues[0]);else{var o=e.uniformValues;o instanceof Float32Array||(o=new Float32Array(o)),a.gl.uniform1fv(r,o)}return}a.setInputMatrixTexture(e.texData.texture,r,n)}}),null!=r&&r(a,t.webGLProgram),a.executeProgram()}(l,a,u,r),Im.get("WEBGL_PAGING_ENABLED")&&o&&this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING)for(var p=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;p>0&&this.lruDataGPU.length>0;){var f=this.lruDataGPU.shift(),d=this.texData.get(f);p-=this.computeBytes(d.shape,d.dtype),this.read(f)}return h&&(s=this.endTimer(s),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(s)})),Im.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(n.dataId).isPacked||t.isPackShader?n:this.unpackTensor(n)},t.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){if(!this.disposed){for(var t in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},t.prototype.floatPrecision=function(){var t=this;return Am(function(){return t.abs(fg(1e-8)).get()>0?32:16})},t.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.values,i=n.usage,a=n.isPacked;if(null==n.texture){var s,u=null!=this.activeTimers;u&&(s=performance.now());var c=lw(r,a);n.texShape=c;var l=this.acquireTexture(t,c,i,a);if(n.texture=l,null!=o){if(a){var h=this.getBatchDim(r),p=1,f=1;r.length&&(p=(e=this.getRowsCols(r))[0],f=e[1]),this.gpgpu.uploadMatrixToPackedTexture(l,h,p,f,c[0],c[1],sx(o))}else this.gpgpu.uploadMatrixToTexture(l,c[0],c[1],sx(o));n.values=null,u&&(this.uploadWaitMs+=performance.now()-s)}}else Im.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.indexOf(t)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(t),1),this.lruDataGPU.push(t))},t.prototype.convertAndCacheOnCPU=function(t,e){var n=this.delayedStorage,r=this.texData.get(t),o=r.texture,i=r.dtype;return n&&null!=o&&(this.releaseTexture(t,o,r.texShape,r.usage,r.isPacked),r.texture=null,r.texShape=null),r.usage=xy.UPLOAD,null!=e&&(r.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,i)),r.values},t.prototype.releaseTexture=function(t,e,n,r,o){var i=this.texData.get(t),a=i.shape,s=i.dtype;if(Im.get("WEBGL_PAGING_ENABLED")){var u=this.lruDataGPU.indexOf(t);u>=0&&this.lruDataGPU.splice(u,1)}this.numBytesInGPU-=this.computeBytes(a,s),this.textureManager.releaseTexture(e,n,r,o)},t.prototype.acquireTexture=function(t,e,n,r){var o=this.texData.get(t),i=o.shape,a=o.dtype;return Im.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.push(t),this.numBytesInGPU+=this.computeBytes(i,a),this.textureManager.acquireTexture(e,n,r)},t.prototype.computeBytes=function(t,e){return Cv(t)*Bv(e)},t}();function sx(t){return t instanceof Float32Array?t:new Float32Array(t)}Im.get("IS_BROWSER")&&Im.registerBackend("webgl",function(){return new ax},2,im);var ux=ag({abs_:function(t){var e=og(t,"x","abs");return"complex64"===e.dtype?Im.engine.runKernel(function(t){return t.complexAbs(e)},{$x:e}):Im.engine.runKernel(function(t){return t.abs(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.toFloat().step(-1))}}})}}),cx=ag({acos_:function(t){var e=og(t,"x","acos");return Im.engine.runKernel(function(t){return t.acos(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(fg(1).sub(e.toFloat().square()).sqrt()).neg()}}})}}),lx=ag({acosh_:function(t){var e=og(t,"x","acosh");return Im.engine.runKernel(function(t){return t.acosh(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.toFloat().square().sub(1).sqrt())}}})}}),hx=ag({asin_:function(t){var e=og(t,"x","asin");return Im.engine.runKernel(function(t){return t.asin(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(fg(1).sub(e.toFloat().square()).sqrt())}}})}}),px=ag({asinh_:function(t){var e=og(t,"x","asinh");return Im.engine.runKernel(function(t){return t.asinh(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(fg(1).add(e.toFloat().square()).sqrt())}}})}}),fx=ag({atan_:function(t){var e=og(t,"x","atan");return Im.engine.runKernel(function(t){return t.atan(e)},{$x:e},function(t){return{$x:function(){return t.div(e.toFloat().square().add(1))}}})}}),dx=ag({atanh_:function(t){var e=og(t,"x","atanh");return Im.engine.runKernel(function(t){return t.atanh(e)},{$x:e},function(t){return{$x:function(){return t.div(fg(1).sub(e.toFloat().square()))}}})}}),vx=ag({ceil_:function(t){var e=og(t,"x","ceil");return Im.engine.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Cg(t)}}})}}),mx=ag({clipByValue_:function(t,e,n){var r=og(t,"x","clipByValue");return wv(e<=n,"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."),Im.engine.runKernel(function(t){return t.clip(r,e,n)},{$x:r},function(t){return{$x:function(){return t.where(r.greaterEqual(e).logicalAnd(r.lessEqual(n)),Cg(t))}}})}}),gx=ag({cos_:function(t){var e=og(t,"x","cos");return Im.engine.runKernel(function(t){return t.cos(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().sin().neg().mulStrict(t)}}})}}),yx=ag({cosh_:function(t){var e=og(t,"x","cosh");return Im.engine.runKernel(function(t){return t.cosh(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().sinh().mulStrict(t)}}})}}),wx=ag({erf_:function(t){var e=og(t,"x","erf");return wv("int32"===e.dtype||"float32"===e.dtype,"Input dtype must be `int32` or `float32`."),"int32"===e.dtype&&(e=e.toFloat()),Im.engine.runKernel(function(t){return t.erf(e)},{$x:e},function(t){return{$x:function(){return t.mul(e.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),bx=ag({exp_:function(t){var e=og(t,"x","exp");return Im.engine.runKernel(function(t,n){return n(t.exp(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mulStrict(n)}}})}}),xx=ag({expm1_:function(t){var e=og(t,"x","expm1");return Im.engine.runKernel(function(t){return t.expm1(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.exp())}}})}}),_x=ag({floor_:function(t){var e=og(t,"x","floor");return Im.engine.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Cg(t)}}})}}),Cx=ag({log_:function(t){var e=og(t,"x","log");return Im.engine.runKernel(function(t){return t.log(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.toFloat())}}})}}),Ex=ag({log1p_:function(t){var e=og(t,"x","log1p");return Im.engine.runKernel(function(t){return t.log1p(e)},{$x:e},function(t){return{$x:function(){return t.div(e.add(1))}}})}}),Sx=ag({logSigmoid_:function(t){var e=og(t,"x","logSigmoid");return Im.engine.runKernel(function(t){return t.softplus(e.neg()).neg()},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.neg().sigmoid())}}})}}),Rx=ag({neg_:function(t){var e=og(t,"x","neg");return Im.engine.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),Tx=ag({reciprocal_:function(t){var e=og(t,"x","reciprocal");return Im.engine.runKernel(function(t){return t.reciprocal(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.square().neg())}}})}}),kx=ag({round_:function(t){var e=og(t,"x","round");return Im.engine.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Cg(t)}}})}}),Ix=ag({rsqrt_:function(t){var e=og(t,"x","rsqrt");return Im.engine.runKernel(function(t){return t.rsqrt(e)},{$x:e},function(t){return{$x:function(){return t.div(e.pow(1.5).mul(2)).neg()}}})}}),Nx=ag({sigmoid_:function(t){var e=og(t,"x","sigmoid");return Im.engine.runKernel(function(t,n){return n(t.sigmoid(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.mul(fg(1).sub(n)))}}})}}),Ax=ag({sign_:function(t){var e=og(t,"x","sign");return Im.engine.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Cg(t)}}})}}),Dx=ag({sin_:function(t){var e=og(t,"x","sin");return Im.engine.runKernel(function(t){return t.sin(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().cos().mulStrict(t)}}})}}),Mx=ag({sinh_:function(t){var e=og(t,"x","sinh");return Im.engine.runKernel(function(t){return t.sinh(e)},{$x:e},function(t){return{$x:function(){return e.toFloat().cosh().mulStrict(t)}}})}}),Px=ag({softplus_:function(t){var e=og(t,"x","softplus");return Im.engine.runKernel(function(t){return t.softplus(e)},{$x:e},function(t){return{$x:function(){return t.mulStrict(e.sigmoid())}}})}}),Ox=ag({sqrt_:function(t){var e=og(t,"x","sqrt");return Im.engine.runKernel(function(t){return t.sqrt(e)},{$x:e},function(t){return{$x:function(){return t.div(e.toFloat().sqrt().mul(2))}}})}}),Fx=ag({square_:function(t){var e=og(t,"x","square");return Im.engine.runKernel(function(t){return t.square(e)},{$x:e},function(t){return{$x:function(){return t.mul(e.toFloat().mul(2))}}})}}),Lx=ag({step_:function(t,e){void 0===e&&(e=0);var n=og(t,"x","step");return Im.engine.runKernel(function(t){return t.step(n,e)},{$x:n},function(t){return{$x:function(){return Cg(t)}}})}}),Bx=ag({tan_:function(t){var e=og(t,"x","tan");return Im.engine.runKernel(function(t){return t.tan(e)},{$x:e},function(t){return{$x:function(){return t.divStrict(e.cos().square())}}})}}),Ux=ag({tanh_:function(t){var e=og(t,"x","tanh");return Im.engine.runKernel(function(t,n){return n(t.tanh(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return fg(1).sub(n.square()).mulStrict(t)}}})}});function Vx(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}var jx=ag({batchNormalization2d_:function(t,e,n,r,o,i){void 0===r&&(r=.001);var a,s,u=og(t,"x","batchNormalization"),c=og(e,"mean","batchNormalization"),l=og(n,"variance","batchNormalization");return null!=o&&(a=og(o,"scale","batchNormalization")),null!=i&&(s=og(i,"offset","batchNormalization")),wv(2===u.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+u.rank+"."),wv(2===c.rank||1===c.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."),wv(2===l.rank||1===l.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."),null!=a&&wv(2===a.rank||1===a.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."),null!=s&&wv(2===s.rank||1===s.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."),Hx(u,c,l,r,a,s)}}),zx=ag({batchNormalization3d_:function(t,e,n,r,o,i){void 0===r&&(r=.001);var a,s,u=og(t,"x","batchNormalization"),c=og(e,"mean","batchNormalization"),l=og(n,"variance","batchNormalization");return null!=o&&(a=og(o,"scale","batchNormalization")),null!=i&&(s=og(i,"offset","batchNormalization")),wv(3===u.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+u.rank+"."),wv(3===c.rank||1===c.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."),wv(3===l.rank||1===l.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."),null!=a&&wv(3===a.rank||1===a.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."),null!=s&&wv(3===s.rank||1===s.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."),Hx(u,c,l,r,a,s)}}),Wx=ag({batchNormalization4d_:function(t,e,n,r,o,i){void 0===r&&(r=.001);var a,s,u=og(t,"x","batchNormalization"),c=og(e,"mean","batchNormalization"),l=og(n,"variance","batchNormalization");return null!=o&&(a=og(o,"scale","batchNormalization")),null!=i&&(s=og(i,"offset","batchNormalization")),wv(4===u.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+u.rank+"."),wv(4===c.rank||1===c.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."),wv(4===l.rank||1===l.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."),null!=a&&wv(4===a.rank||1===a.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."),null!=s&&wv(4===s.rank||1===s.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."),Hx(u,c,l,r,a,s)}}),Hx=ag({batchNormalization_:function(t,e,n,r,o,i){void 0===r&&(r=.001);var a,s,u,c=og(t,"x","batchNormalization"),l=og(e,"mean","batchNormalization"),h=og(n,"variance","batchNormalization");return null!=o&&(a=og(o,"scale","batchNormalization")),null!=i&&(s=og(i,"offset","batchNormalization")),wv(l.rank===h.rank,"Batch normalization gradient requires mean and variance to have equal ranks."),wv(null==s||l.rank===s.rank,"Batch normalization gradient requires mean and offset to have equal ranks."),wv(null==a||l.rank===a.rank,"Batch normalization gradient requires mean and scale to have equal ranks."),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,Im.engine.runKernel(function(t){return t.batchNormalization(u,Vx(l),Vx(h),r,Vx(a),Vx(s))},{$x:c,$mean:l,$variance:h,$scale:a,$offset:s},function(t){var e=null==a?fg(1):a,n=Bg(l.shape,u.shape),o=[];if(1===l.rank){for(var i=0;i<u.shape.length-1;++i)o.push(u.shape[i]);o.push(1)}var s=c.sub(l),p=t.mul(e),f=Ix(h.add(fg(r))),d=f.mul(f).mul(f).mul(fg(-.5));return{$x:function(){return 1===l.rank?t.mul(ex(f.as4D(1,1,1,l.shape[0]),o)).mul(e).reshape(c.shape):t.mul(f).mul(e).reshape(c.shape)},$mean:function(){var t=f.mul(fg(-1)).mul(p);return 1===l.rank&&(t=t.sum(n)),t.reshape(l.shape)},$variance:function(){var t=d.mul(s).mul(p);return 1===l.rank&&(t=t.sum(n)),t.reshape(l.shape)},$scale:function(){var e=s.mul(f),r=t.mul(e);return 1===l.rank&&(r=r.sum(n)),r.reshape(l.shape)},$offset:function(){var e=t;return 1===l.rank&&(e=e.sum(n)),e.reshape(l.shape)}}}).reshape(c.shape)}});function Gx(t,e,n,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=Kx(e),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,t[1],t[1]]}return qx(t,s,n,r,o,i,!1,a)}function qx(t,e,n,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],p=u[3];if("channelsLast"===s)c=t[0],l=t[1],h=t[2],p=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],p=t[1],l=t[2],h=t[3]}var f,d=e[0],v=e[1],m=e[3],g=Kx(n),y=g[0],w=g[1],b=Kx(r),x=b[0],_=b[1],C=Qx(d,x),E=Qx(v,_),S=function(t,e,n,r,o,i,a,s){var u,c,l;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var h=function(t,e,n,r,o,i){null==o&&(o=function(t,e,n,r){void 0===r&&(r=1);var o=Qx(e,r);return Math.floor((t[0]*(n-1)-n+o)/2)}(t,e,r));var a=t[1],s=Yx((t[0]-e+2*o)/r+1,i);wv(Sv(s),"The output # of rows ("+s+") must be an integer. Change the stride and/or zero pad parameters");var u=Yx((a-e+2*o)/r+1,i);return wv(Sv(u),"The output # of columns ("+u+") must be an integer. Change the stride and/or zero pad parameters"),[s,u,1]}([e,n,1],i,0,r,t,s);c=h[0],l=h[1]}else if("same"===t){var p=((c=Math.ceil(e/r))-1)*r+i-e,f=((l=Math.ceil(n/o))-1)*o+a-n,d=Math.floor(p/2),v=p-d,m=Math.floor(f/2);u={top:d,bottom:v,left:m,right:f-m,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/r),l=Math.ceil((n-a+1)/o)}return{padInfo:u,outHeight:c,outWidth:l}}(o,l,h,y,w,C,E,i),R=S.outHeight,T=S.outWidth,k=a?m*p:m;return"channelsFirst"===s?f=[c,k,R,T]:"channelsLast"===s&&(f=[c,R,T,k]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:h,inChannels:p,outHeight:R,outWidth:T,outChannels:k,padInfo:S.padInfo,strideHeight:y,strideWidth:w,filterHeight:d,filterWidth:v,effectiveFilterHeight:C,effectiveFilterWidth:E,dilationHeight:x,dilationWidth:_,inShape:t,outShape:f,filterShape:e}}function $x(t,e,n,r,o,i,a){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],c=s[1],l=s[2],h=s[3],p=s[4];if("channelsLast"===a)u=t[0],c=t[1],l=t[2],h=t[3],p=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);u=t[0],p=t[1],c=t[2],l=t[3],h=t[4]}var f,d=e[0],v=e[1],m=e[2],g=e[4],y=Xx(n),w=y[0],b=y[1],x=y[2],_=Xx(r),C=_[0],E=_[1],S=_[2],R=function(t,e,n,r,o,i,a,s,u,c){var l,h,p,f;if("same"===t){var d=((h=Math.ceil(e/o))-1)*o+s-e,v=((p=Math.ceil(n/i))-1)*i+u-n,m=((f=Math.ceil(r/a))-1)*a+c-r,g=Math.floor(d/2),y=d-g,w=Math.floor(v/2),b=v-w,x=Math.floor(m/2);l={top:w,bottom:b,left:x,right:m-x,front:g,back:y,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);l={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-s+1)/o),p=Math.ceil((n-u+1)/i),f=Math.ceil((r-c+1)/a)}return{padInfo:l,outDepth:h,outHeight:p,outWidth:f}}(o,c,l,h,w,b,x,Qx(d,C),Qx(v,E),Qx(m,S)),T=R.outDepth,k=R.outHeight,I=R.outWidth,N=i?g*p:g;return"channelsFirst"===a?f=[u,N,T,k,I]:"channelsLast"===a&&(f=[u,T,k,I,N]),{batchSize:u,dataFormat:a,inDepth:c,inHeight:l,inWidth:h,inChannels:p,outDepth:T,outHeight:k,outWidth:I,outChannels:N,padInfo:R.padInfo,strideDepth:w,strideHeight:b,strideWidth:x,filterDepth:d,filterHeight:v,filterWidth:m,dilationDepth:C,dilationHeight:E,dilationWidth:S,inShape:t,outShape:f,filterShape:e}}function Kx(t){return"number"==typeof t?[t,t]:t}function Xx(t){return"number"==typeof t?[t,t,t]:t}function Qx(t,e){return e<=1?t:t+(t-1)*(e-1)}function Yx(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function Zx(t){var e=Kx(t);return 1===e[0]&&1===e[1]}function Jx(t,e){return Zx(t)||Zx(e)}var t_=ag({matMul_:function(t,e,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=og(t,"a","matMul"),a=og(e,"b","matMul");i=(o=gm(i,a))[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=n?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=i.shape.slice(0,-2),p=a.shape.slice(0,-2),f=Cv(h),d=Cv(p);wv(i.rank>=2&&a.rank>=2&&i.rank===a.rank,"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."),wv(Ev(h,p),"Error in matMul: outer dimensions ("+h+") and ("+p+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."),wv(s===u,"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match.");var v=i.shape.slice(0,-2).concat([c,l]),m=n?i.as3D(f,s,c):i.as3D(f,c,s),g=r?a.as3D(d,l,u):a.as3D(d,u,l);return Im.engine.runKernel(function(t){return t.batchMatMul(m,g,n,r)},{$a:m,$b:g},function(t){return n||r?!n&&r?{$a:function(){return t.matMul(g,!1,!1)},$b:function(){return t.matMul(m,!0,!1)}}:n&&!r?{$a:function(){return g.matMul(t,!1,!0)},$b:function(){return m.matMul(t,!1,!1)}}:{$a:function(){return g.matMul(t,!0,!0)},$b:function(){return t.matMul(m,!0,!0)}}:{$a:function(){return t.matMul(g,!1,!0)},$b:function(){return m.matMul(t,!0,!1)}}}).reshape(v)}}),e_=ag({dot_:function(t,e){var n=og(t,"t1","dot"),r=og(e,"t2","dot");wv(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+".");var o=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return wv(o===i,"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),n_=ag({outerProduct_:function(t,e){var n=og(t,"v1","outerProduct"),r=og(e,"v2","outerProduct");return wv(1===n.rank&&1===r.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."),n.as2D(-1,1).matMul(r.as2D(1,-1))}});function r_(t,e,n,r,o,i){wv(t.length===e.rank,"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match");var a=t,s=e,u=!1;3===e.rank&&(u=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,t[0],t[1],t[2]]);var c=a[3],l=s.shape[3];wv(4===a.length,"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."),wv(4===s.rank,"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank),wv(4===n.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank),wv(c===n.shape[2],"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."),wv(l===n.shape[3],"Error in conv2dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[3]+"."),null!=i&&wv(Sv(o),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var h=qx(a,n.shape,r,1,o,i),p=Im.engine.runKernel(function(t){return t.conv2dDerInput(s,n,h)},{dy4D:s,filter:n},function(t){return{dy4D:function(){return s_(t,n,r,o,"NHWC",1,i)},filter:function(){return c_(t,s,n.shape,r,o,i)}}});return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function o_(t,e,n,r,o,i){var a=t;3===t.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=e;3===s.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),wv(4===a.rank,"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."),wv(4===s.rank,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."),wv(4===n.length,"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."),wv(a.shape[3]===n[2],"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+n[2]+"."),wv(s.shape[3]===n[3],"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+n[3]+")."),null!=i&&wv(Sv(o),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var u=qx(a.shape,n,r,1,o,i);return Im.engine.runKernel(function(t){return t.conv2dDerFilter(a,s,u)},{x4D:a,dy4D:s})}function i_(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t);return 1===e[0]&&1===e[1]&&1===e[2]}var a_=ag({conv1d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=og(t,"x","conv1d"),u=og(e,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),wv(3===c.rank,"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."),wv(3===u.rank,"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."),null!=a&&wv(Sv(r),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."),wv(c.shape[2]===u.shape[1],"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."),wv(Jx(n,i),"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"),wv("NWC"===o,"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported.");var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),p=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),f=s_(p,h,[1,n],r,"NHWC",[1,i],a);return l?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),s_=ag({conv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=og(t,"x","conv2d"),u=og(e,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),wv(4===c.rank,"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."),wv(4===u.rank,"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."),null!=a&&wv(Sv(r),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."),wv(c.shape[3]===u.shape[2],"Error in conv2d: depth of input ("+c.shape[3]+") must match input depth for filter "+u.shape[2]+"."),wv(Jx(n,i),"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"),wv("NHWC"===o,"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported.");var h,p=qx(c.shape,u.shape,n,i,r,a);if(1!==p.filterHeight||1!==p.filterWidth||1!==p.dilationHeight||1!==p.dilationWidth||1!==p.strideHeight||1!==p.strideWidth||"SAME"!==p.padInfo.type&&"VALID"!==p.padInfo.type)h=Im.engine.runKernel(function(t){return t.conv2d(c,u,p)},{x:c,$filter:u},function(t){return wv(Zx(i),"Error in gradient of conv2D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+i+"'"),{x:function(){return r_(c.shape,t,u,n,r)},$filter:function(){return o_(c,t,u.shape,n,r)}}});else{var f=c.reshape([-1,p.inChannels]),d=u.reshape([p.inChannels,p.outChannels]);h=t_(f,d).reshape(p.outShape)}return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),u_=ag({conv3d_:function(t,e,n,r,o,i){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1,1]);var a=og(t,"x","conv3d"),s=og(e,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),wv(5===u.rank,"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."),wv(5===s.rank,"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."),wv(u.shape[4]===s.shape[3],"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."),wv(function(t,e){return i_(n)||i_(e)}(0,i),"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"),wv("NHWC"===o,"Error in conv3d: got dataFormat of "+o+" but only NHWC is currently supported.");var l=$x(u.shape,s.shape,n,i,r),h=Im.engine.runKernel(function(t){return t.conv3d(u,s,l)},{x:u,$filter:s},function(t){return wv(i_(i),"Error in gradient of conv3D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+i+"'"),{x:function(){return function(t,e,n,r,o){wv(t.length===e.rank,"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match");var i=t,a=e,s=!1;4===e.rank&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],c=a.shape[4];wv(5===i.length,"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."),wv(5===a.rank,"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank),wv(5===n.rank,"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank),wv(u===n.shape[3],"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."),wv(c===n.shape[4],"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+".");var l=$x(i,n.shape,r,1,o),h=Im.engine.runKernel(function(t){return t.conv3dDerInput(a,n,l)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(u.shape,t,s,n,r)},$filter:function(){return function(t,e,n,r,o){var i=u;4===u.rank&&(i=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]));var a=e;4===a.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),wv(5===i.rank,"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."),wv(5===a.rank,"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."),wv(5===n.length,"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."),wv(i.shape[4]===n[3],"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."),wv(a.shape[4]===n[4],"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+").");var s=$x(i.shape,n,r,1,o);return Im.engine.runKernel(function(t){return t.conv3dDerFilter(i,a,s)},{x5D:i,dy5D:a})}(0,t,s.shape,n,r)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),c_=ag({conv2dDerFilter_:o_}),l_=ag({depthwiseConv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=og(t,"x","depthwiseConv2d"),u=og(e,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),wv(4===c.rank,"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."),wv(4===u.rank,"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."),wv(c.shape[3]===u.shape[2],"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."),null==i&&(i=[1,1]),wv(Jx(n,i),"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"),null!=a&&wv(Sv(r),"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+".");var h=qx(c.shape,u.shape,n,i,r,a,!0),p=Im.engine.runKernel(function(t){return t.depthwiseConv2D(c,u,h)},{x:c,$filter:u},function(t){return wv(Zx(i),"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"),{x:function(){return function(t,e,n,r){var o=e,i=!1;3===e.rank&&(i=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=Im.engine.runKernel(function(t){return t.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}(0,t,u,h)},$filter:function(){return function(t,e,n,r){var o=c;3===c.rank&&(o=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Im.engine.runKernel(function(t){return t.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}(0,t,0,h)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),h_=ag({separableConv2d_:function(t,e,n,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=og(t,"x","separableConv2d"),u=og(e,"depthwiseFilter","separableConv2d"),c=og(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");wv(4===l.rank,"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."),wv(4===u.rank,"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."),wv(4===c.rank,"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."),wv(1===c.shape[0],"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."),wv(1===c.shape[1],"Error in separableConv2d: the second dimension of pointwise filter  must be 1, but got "+c.shape[1]+".");var p=u.shape[2],f=u.shape[3];wv(c.shape[2]===p*f,"Error in separableConv2d: the third dimension of pointwise filter must be "+p*f+", but got "+c.shape[2]+".");var d=l_(l,u,r,o,a,i),v=s_(d,c,1,"valid",a);return h?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),p_=ag({conv2dTranspose_:function(t,e,n,r,o,i){return r_(n,og(t,"x","conv2dTranspose"),og(e,"filter","conv2dTranspose"),r,o,i)}}),f_=ag({reverse_:function(t,e){var n=og(t,"x","reverse");if(0===n.rank)return n.clone();var r=Wm(e,n.shape);return Im.engine.runKernel(function(t){return t.reverse(n,r)},{$x:n},function(t){return{$x:function(){return t.reverse(r)}}}).reshapeAs(n)}}),d_=ag({reverse1d_:function(t){var e=og(t,"x","reverse");return wv(1===e.rank,"Error in reverse1D: x must be rank 1 but got\n             rank "+e.rank+"."),f_(e,0)}}),v_=ag({reverse2d_:function(t,e){var n=og(t,"x","reverse");return wv(2===n.rank,"Error in reverse2D: x must be rank 2 but got\n             rank "+n.rank+"."),f_(n,e)}}),m_=ag({reverse3d_:function(t,e){var n=og(t,"x","reverse");return wv(3===n.rank,"Error in reverse3D: x must be rank 3 but got\n             rank "+n.rank+"."),f_(n,e)}}),g_=ag({reverse4d_:function(t,e){var n=og(t,"x","reverse");return wv(4===n.rank,"Error in reverse4D: x must be rank 4 but got\n             rank "+n.rank+"."),f_(n,e)}});function y_(t,e,n,r,o,i){var a=og(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),wv(4===s.rank,"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."),wv(Jx(n,r),"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"),null!=i&&wv(Sv(o),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var c=Gx(s.shape,e,n,r,o,i),l=Im.engine.runKernel(function(t,e){return e(t.maxPool(s,c))},{x:s},function(t,i){var a=i[0];return{x:function(){return function(t,e,n,r,o,i,a,s){var u=og(t,"dy","maxPoolBackprop"),c=og(e,"input","maxPoolBackprop"),l=og(n,"output","maxPoolBackprop");wv(c.rank===u.rank,"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"),null==i&&(i=[1,1]),wv(Jx(o,i),"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"),wv(4===u.rank,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."),wv(4===c.rank,"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+".");var h=Gx(c.shape,r,o,i,a,void 0);return Im.engine.runKernel(function(t){return t.maxPoolBackprop(u,c,l,h)},{$dy:u,$input:c})}(t,s,a,e,n,r,o)}}});return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function w_(t,e,n,r,o,i){var a=og(t,"x","avgPool","float32");null==r&&(r=[1,1]),wv(Jx(n,r),"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'");var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),wv(4===s.rank,"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."),null!=i&&wv(Sv(o),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var c=Gx(s.shape,e,n,r,o),l=Im.engine.runKernel(function(t){return t.avgPool(s,c)},{x:s},function(t){return{x:function(){return function(t,e,n,r,o,i){var a=og(t,"dy","avgPoolBackprop"),s=og(e,"input","avgPoolBackprop");wv(s.rank===a.rank,"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"),null==o&&(o=[1,1]),wv(Jx(r,o),"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'");var u=s,c=a,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),wv(4===c.rank,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."),wv(4===u.rank,"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+".");var h=Gx(u.shape,n,r,o,i),p=Im.engine.runKernel(function(t){return t.avgPoolBackprop(c,u,h)},{dy4D:c,input4D:u});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}(t,s,e,n,r,o)}}});return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var b_=ag({maxPool_:function(t,e,n,r,o){return y_(t,e,n,1,r,o)}}),x_=ag({avgPool_:function(t,e,n,r,o){return w_(t,e,n,1,r,o)}}),__=ag({pool_:function(t,e,n,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=og(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),wv(Jx(i,o),"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'");var c,l=Gx(s.shape,e,i,o,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(t,e){var n=[l.filterHeight,l.filterWidth].map(function(t,n){return t+(t-1)*(e[n]-1)}).map(function(t){return t-1}),r=n.map(function(t){return Math.floor(t/2)}),o=n.map(function(t,e){return t-r[e]});return n.map(function(t,e){return[r[e],o[e]]})}(0,h):[[0,0],[0,0]];var p=1===h[0]&&1===h[1],f=function(t,e,n){var r=n.map(function(t){return t[0]}),o=n.map(function(t){return t[1]}),i=t.concat(r,o),a=e.map(function(t,e){return(t-i[e]%t)%t}),s=o.map(function(t,e){return t+a[e]});return[e.map(function(t,e){return[r[e],s[e]]}),e.map(function(t,e){return[0,a[e]]})]}([l.inHeight,l.inWidth],h,c),d=f[1],v=p?r:"valid",m=p?s:Zb(s,h,f[0]),g=("avg"===n?function(){return w_(m,e,i,1,v)}:function(){return y_(m,e,i,1,v)})(),y=p?g:Mb(g,h,d);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),C_=ag({slice_:function(t,e,n){var r,o,i=og(t,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof e?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice(),o=(o=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(t,e){return t>=0?t:(wv(-1===t,"Bad value in size"),i.shape[e]-r[e])}),function(t,e,n){wv(t.rank===e.length,"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."),wv(t.rank===n.length,"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+").");for(var r=0;r<t.rank;++r)wv(e[r]+n[r]<=t.shape[r],"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")")}(i,r,o);var a=i.shape;return Im.engine.runKernel(function(t){return t.slice(i,r,o)},{$x:i},function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],a[n]-r[n]-o[n]]);return{$x:function(){return t.pad(e)}}})}}),E_=ag({slice1d_:function(t,e,n){var r=og(t,"x","slice1d");return wv(1===r.rank,"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"),C_(r,[e],[n])}}),S_=ag({slice2d_:function(t,e,n){var r=og(t,"x","slice2d");return wv(2===r.rank,"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"),C_(r,e,n)}}),R_=ag({slice3d_:function(t,e,n){var r=og(t,"x","slice3d");return wv(3===r.rank,"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"),C_(r,e,n)}}),T_=ag({slice4d_:function(t,e,n){var r=og(t,"x","slice4d");return wv(4===r.rank,"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"),C_(r,e,n)}});function k_(t,e,n,r,o){var i=e[0];return i.rank<n.rank&&(i=i.reshape(zm(i.shape,r))),t.rank<n.rank&&(t=t.reshape(zm(t.shape,r))),{$x:function(){var e=t.mul(n.equal(i).cast(t.dtype));return null==o?e:e.transpose(o)}}}var I_=ag({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=og(t,"x","all","bool"),o=Wm(e,r.shape),i=o,a=Gm(i,r.rank);null!=a&&(r=r.transpose(a),i=$m(i.length,r.rank));var s=Im.engine.runKernel(function(t){return t.all(r,i)},{$x:r});if(n){var u=zm(s.shape,o);return s.reshape(u)}return s}}),N_=ag({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=og(t,"x","any","bool"),o=Wm(e,r.shape),i=o,a=Gm(i,r.rank);null!=a&&(r=r.transpose(a),i=$m(i.length,r.rank));var s=Im.engine.runKernel(function(t){return t.any(r,i)},{$x:r});if(n){var u=zm(s.shape,o);return s.reshape(u)}return s}}),A_=ag({argMax_:function(t,e){void 0===e&&(e=0);var n=og(t,"x","argMax");null==e&&(e=0);var r=Wm(e,n.shape),o=Gm(r,n.rank);return null!=o&&(n=n.transpose(o),r=$m(r.length,n.rank)),Im.engine.runKernel(function(t){return t.argMax(n,r[0])},{$x:n},function(t){return{$x:function(){return Cg(n)}}})}}),D_=ag({argMin_:function(t,e){void 0===e&&(e=0);var n=og(t,"x","argMin");null==e&&(e=0);var r=Wm(e,n.shape),o=Gm(r,n.rank);return null!=o&&(n=n.transpose(o),r=$m(r.length,n.rank)),Im.engine.runKernel(function(t){return t.argMin(n,r[0])},{$x:n},function(t){return{$x:function(){return Cg(n)}}})}}),M_=ag({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=og(t,"x","logSumExp"),o=Wm(e,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=zm(s.shape,o);return s.reshape(u)}return s}}),P_=ag({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=og(t,"x","max"),o=r,i=Wm(e,r.shape),a=i,s=Gm(a,r.rank);null!=s&&(r=r.transpose(s),a=$m(a.length,r.rank));var u=Im.engine.runKernel(function(t,e){return e(t.max(r,a))},{$x:r},function(t,e){return k_(t,e,o,i,s)});if(n){var c=zm(u.shape,i);u=u.reshape(c)}return u}}),O_=ag({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=og(t,"x","mean"),o=Wm(e,r.shape),i=Cv(jm(r.shape,o)[1]);return Nm(function(t){var r=fg(i);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(yg(t.shape,"float32")).div(r)}}})(r)}}),F_=ag({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=og(t,"x","min"),o=r,i=Wm(e,r.shape),a=i,s=Gm(a,r.rank);null!=s&&(r=r.transpose(s),a=$m(a.length,r.rank));var u=Im.engine.runKernel(function(t,e){return e(t.min(r,a))},{$x:r},function(t,e){return k_(t,e,o,i,s)});if(n){var c=zm(u.shape,i);u=u.reshape(c)}return u}}),L_=ag({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Wm(e,(t=og(t,"x","moments")).shape),o=t.mean(r,n),i=o.shape;return n||(i=zm(o.shape,r)),{mean:o,variance:t.toFloat().sub(o.reshape(i)).square().mean(r,n)}}}),B_=ag({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=og(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=Wm(e,r.shape);return Nm(function(t){var e=Gm(o,t.rank),r=o,i=t;null!=e&&(i=t.transpose(e),r=$m(r.length,t.rank));var a=Im.engine.runKernel(function(t){return t.sum(i,r)},{permutedX:i});if(n){var s=zm(a.shape,o);a=a.reshape(s)}return{value:a,gradFunc:function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(yg(t.shape,"float32"))}}})(r)}}),U_=ag({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=og(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=Wm(e,r.shape),i=Gm(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=$m(a.length,r.rank));var u=Im.engine.runKernel(function(t){return t.prod(s,a)},{permutedX:s});if(n){var c=zm(u.shape,o);u=u.reshape(c)}return u}}),V_=ag({equal_:function(t,e){var n,r=og(t,"a","equal"),o=og(e,"b","equal");return n=gm(r,o),Ug((r=n[0]).shape,(o=n[1]).shape),Im.engine.runKernel(function(t){return t.equal(r,o)},{$a:r,$b:o})}}),j_=ag({equalStrict_:function(t,e){var n=og(t,"a","equalStrict"),r=og(e,"b","equalStrict");return bv(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),z_=ag({greater_:function(t,e){var n,r=og(t,"a","greater"),o=og(e,"b","greater");return n=gm(r,o),Ug((r=n[0]).shape,(o=n[1]).shape),Im.engine.runKernel(function(t){return t.greater(r,o)},{$a:r,$b:o})}}),W_=ag({greaterEqual_:function(t,e){var n,r=og(t,"a","greaterEqual"),o=og(e,"b","greaterEqual");return n=gm(r,o),Ug((r=n[0]).shape,(o=n[1]).shape),Im.engine.runKernel(function(t){return t.greaterEqual(r,o)},{$a:r,$b:o},function(t){return{$a:function(){return Cg(r)},$b:function(){return Cg(o)}}})}}),H_=ag({greaterEqualStrict_:function(t,e){var n=og(t,"a","greaterEqualStrict"),r=og(e,"b","greaterEqualStrict");return bv(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),G_=ag({greaterStrict_:function(t,e){var n=og(t,"a","greaterStrict"),r=og(e,"b","greaterStrict");return bv(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),q_=ag({less_:function(t,e){var n,r=og(t,"a","less"),o=og(e,"b","less");return n=gm(r,o),Ug((r=n[0]).shape,(o=n[1]).shape),Im.engine.runKernel(function(t){return t.less(r,o)},{$a:r,$b:o})}}),$_=ag({lessEqual_:function(t,e){var n,r=og(t,"a","lessEqual"),o=og(e,"b","lessEqual");return n=gm(r,o),Ug((r=n[0]).shape,(o=n[1]).shape),Im.engine.runKernel(function(t){return t.lessEqual(r,o)},{$a:r,$b:o})}}),K_=ag({lessEqualStrict_:function(t,e){var n=og(t,"a","lessEqualStrict"),r=og(e,"b","lessEqualStrict");return bv(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),X_=ag({lessStrict_:function(t,e){var n=og(t,"a","lessStrict"),r=og(e,"b","lessStrict");return bv(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Q_=ag({notEqual_:function(t,e){var n,r=og(t,"a","notEqual"),o=og(e,"b","notEqual");return n=gm(r,o),Ug((r=n[0]).shape,(o=n[1]).shape),Im.engine.runKernel(function(t){return t.notEqual(r,o)},{$a:r,$b:o})}}),Y_=ag({notEqualStrict_:function(t,e){var n=og(t,"a","notEqualStrict"),r=og(e,"b","notEqualStrict");return bv(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}}),Z_=ag({add_:function(t,e){var n,r=og(t,"a","add"),o=og(e,"b","add");n=gm(r,o);var i=Ug((r=n[0]).shape,(o=n[1]).shape);return Im.engine.runKernel(function(t){return t.add(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t,n=Bg(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},$b:function(){var e=t,n=Bg(o.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(o.shape)}}})}}),J_=ag({addN_:function(t){wv(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),wv(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return og(t,"tensors"+e,"addN")}),n=e[0];return e.forEach(function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!Ev(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),Im.engine.runKernel(function(t){return t.addN(e)},e,function(t){var n={};return e.forEach(function(e,r){n[r]=function(){return t.clone()}}),n})}}),tC=ag({addStrict_:function(t,e){var n=og(t,"a","addStrict"),r=og(e,"b","addStrict");return bv(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),eC=ag({atan2_:function(t,e){var n,r=og(t,"a","atan2"),o=og(e,"b","atan2");n=gm(r,o);var i=Ug((r=n[0]).shape,(o=n[1]).shape);return Im.engine.runKernel(function(t){return t.atan2(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=Z_(r.square(),o.square()),n=t.mul(o.div(e)),a=Bg(r.shape,i);return a.length>0&&(n=n.sum(a)),n.reshape(r.shape)},$b:function(){var e=Z_(r.square(),o.square()),n=Rx(t.mul(r.div(e))),a=Bg(o.shape,i);return a.length>0&&(n=n.sum(a)),n.reshape(o.shape)}}})}}),nC=ag({div_:function(t,e){var n,r,o=og(t,"a","div"),i=og(e,"b","div");if(n=gm(o,i),i=n[1],"int32"===(o=n[0]).dtype&&"int32"===i.dtype)return oC(o,i);r=function(t){return t.realDivide(o,i)};var a=Ug(o.shape,i.shape);return Im.engine.runKernel(r,{$a:o,$b:i},function(t){return{$a:function(){var e=t.div(i.toFloat()),n=Bg(o.shape,a);return n.length>0?e.sum(n).reshape(o.shape):e},$b:function(){var e=t.mul(o.toFloat()),n=Bg(i.shape,a);n.length>0&&(e=e.sum(n).reshape(i.shape));var r=i.square();return e.div(r.toFloat()).neg()}}})}}),rC=ag({divStrict_:function(t,e){var n=og(t,"a","div"),r=og(e,"b","div");return bv(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),oC=ag({floorDiv_:function(t,e){var n,r=og(t,"a","floorDiv"),o=og(e,"b","floorDiv");n=gm(r,o);var i=Ug((r=n[0]).shape,(o=n[1]).shape);return Im.engine.runKernel(function(t){return t.floorDiv(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t.div(o.toFloat()),n=Bg(r.shape,i);return n.length>0?e.sum(n).reshape(r.shape):e},$b:function(){var e=t.mul(r.toFloat()),n=Bg(o.shape,i);n.length>0&&(e=e.sum(n).reshape(o.shape));var a=o.square();return e.div(a.toFloat()).neg()}}})}}),iC=ag({maximum_:function(t,e){var n,r=og(t,"a","maximum"),o=og(e,"b","maximum");return n=gm(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),Ug(r.shape,o.shape),Im.engine.runKernel(function(t){return t.maximum(r,o)},{$a:r,$b:o},function(t){return{$a:function(){return t.mul(r.greaterEqual(o).toFloat())},$b:function(){return t.mul(r.less(o).toFloat())}}})}}),aC=ag({maximumStrict_:function(t,e){var n=og(t,"a","maximumStrict"),r=og(e,"b","maximumStrict");return bv(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),sC=ag({minimum_:function(t,e){var n,r=og(t,"a","minimum"),o=og(e,"b","minimum");return n=gm(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),Ug(r.shape,o.shape),Im.engine.runKernel(function(t){return t.minimum(r,o)},{$a:r,$b:o},function(t){return{$a:function(){return t.mul(r.lessEqual(o).toFloat())},$b:function(){return t.mul(r.greater(o).toFloat())}}})}}),uC=ag({minimumStrict_:function(t,e){var n=og(t,"a","minimumStrict"),r=og(e,"b","minimumStrict");return bv(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),cC=ag({mod_:function(t,e){var n,r=og(t,"a","mod"),o=og(e,"b","mod");n=gm(r,o);var i=Ug((r=n[0]).shape,(o=n[1]).shape);return Im.engine.runKernel(function(t){return t.mod(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=Bg(r.shape,i);return e.length>0?t.sum(e).reshape(r.shape):t},$b:function(){var e=t.mul(r.div(o).floor().neg()),n=Bg(o.shape,i);return n.length>0?e.sum(n).reshape(o.shape):e}}})}}),lC=ag({modStrict_:function(t,e){var n=og(t,"a","modStrict"),r=og(e,"b","modStrict");return bv(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),hC=ag({mul_:function(t,e){var n,r=og(t,"a","mul"),o=og(e,"b","mul");n=gm(r,o);var i=Ug((r=n[0]).shape,(o=n[1]).shape);return Im.engine.runKernel(function(t){return t.multiply(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t.mul(o.toFloat()),n=Bg(r.shape,i);return n.length>0?e.sum(n).reshape(r.shape):e},$b:function(){var e=t.mul(r.toFloat()),n=Bg(o.shape,i);return n.length>0?e.sum(n).reshape(o.shape):e}}})}}),pC=ag({mulStrict_:function(t,e){var n=og(t,"a","mul"),r=og(e,"b","mul");return bv(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),fC=ag({pow_:function(t,e){var n=og(t,"base","pow"),r=og(e,"exp","pow"),o=Ug(n.shape,r.shape);return t=n.cast(vm(n.dtype,r.dtype)),e=r.cast(vm(n.dtype,r.dtype)),Im.engine.runKernel(function(t,e){return e(t.pow(n,r))},{$base:n,$exp:r},function(t,e){var i=e[0];return{$base:function(){var e=r.toFloat(),i=t.mul(e.mul(n.pow(e.sub(fg(1))))),a=Bg(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$exp:function(){var e=t.mul(i.mul(n.log()).toFloat()),a=Bg(r.shape,o);return a.length>0&&(e=e.sum(a)),e.reshape(r.shape)}}})}}),dC=ag({powStrict_:function(t,e){return bv(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),vC=ag({squaredDifference_:function(t,e){var n,r=og(t,"a","squaredDifference"),o=og(e,"b","squaredDifference");return n=gm(r,o),Ug((r=n[0]).shape,(o=n[1]).shape),Im.engine.runKernel(function(t){return t.squaredDifference(r,o)},{$a:r,$b:o},function(t){var e=fg(2);return{$a:function(){return t.mul(r.sub(o).mul(e))},$b:function(){return t.mul(o.sub(r).mul(e))}}})}}),mC=ag({squaredDifferenceStrict_:function(t,e){var n=og(t,"a","squaredDifferenceStrict"),r=og(e,"b","squaredDifferenceStrict");return bv(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),gC=ag({sub_:function(t,e){var n,r=og(t,"a","sub"),o=og(e,"b","sub");n=gm(r,o);var i=Ug((r=n[0]).shape,(o=n[1]).shape);return Im.engine.runKernel(function(t){return t.subtract(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t,n=Bg(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},$b:function(){var e=t,n=Bg(o.shape,i);return n.length>0&&(e=e.sum(n)),e.neg().reshape(o.shape)}}})}}),yC=ag({subStrict_:function(t,e){var n=og(t,"a","subStrict"),r=og(e,"b","subStrict");return bv(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),wC=ag({logicalAnd_:function(t,e){var n=og(t,"a","logicalAnd","bool"),r=og(e,"b","logicalAnd","bool");return Ug(n.shape,r.shape),Im.engine.runKernel(function(t){return t.logicalAnd(n,r)},{$a:n,$b:r})}}),bC=ag({logicalNot_:function(t){var e=og(t,"x","logicalNot","bool");return Im.engine.runKernel(function(t){return t.logicalNot(e)},{$x:e})}}),xC=ag({logicalOr_:function(t,e){var n=og(t,"a","logicalOr","bool"),r=og(e,"b","logicalOr","bool");return Ug(n.shape,r.shape),Im.engine.runKernel(function(t){return t.logicalOr(n,r)},{$a:n,$b:r})}}),_C=ag({logicalXor_:function(t,e){var n=og(t,"a","logicalXor","bool"),r=og(e,"b","logicalXor","bool");return Ug(n.shape,r.shape),xC(t,e).logicalAnd(wC(t,e).logicalNot())}}),CC=ag({where_:function(t,e,n){var r=og(e,"a","where"),o=og(n,"b","where"),i=og(t,"condition","where","bool");return bv(r.shape,o.shape,"Error in where: "),1===i.rank?wv(i.shape[0]===r.shape[0],"The first dimension of `a` must match the size of `condition`."):bv(i.shape,o.shape,"Error in where: "),Im.engine.runKernel(function(t){return t.select(i,r,o)},{$condition:i,$a:r,$b:o},function(t){return{$condition:function(){return Cg(i).toFloat()},$a:function(){return t.mul(i.cast(t.dtype))},$b:function(){return t.mul(i.logicalNot().cast(t.dtype))}}})}}),EC=ag({elu_:function(t){var e=og(t,"x","elu");return Im.engine.runKernel(function(t,n){return n(t.elu(e))},{$x:e},function(t,e){var n=e[0];return{$x:function(){return Im.engine.runKernel(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}})}}),SC=ag({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=og(t,"x","leakyRelu");return iC(fg(e).mul(n),n)}}),RC=ag({prelu_:function(t,e){var n=og(t,"x","prelu"),r=og(e,"alpha","prelu"),o=fg(0);return iC(o,n).add(r.mul(sC(o,n)))}}),TC=ag({relu_:function(t){var e=og(t,"x","relu");return"bool"===e.dtype?e.toInt():Im.engine.runKernel(function(t){return t.relu(e)},{$x:e},function(t){var n=e.step();return{$x:function(){return t.mulStrict(n.toFloat())}}})}}),kC=ag({selu_:function(t){var e=og(t,"x","selu");return Im.engine.runKernel(function(t){return t.selu(e)},{$x:e},function(t){return{$x:function(){var n=e.greater(fg(0)),r=fg(1.7580993408473768),o=fg(1.0507009873554805),i=t.mul(o),a=t.mul(r).mul(e.toFloat().exp());return CC(n,i,a)}}})}}),IC=ag({transpose_:function(t,e){var n=og(t,"x","transpose");return null==e&&(e=n.shape.map(function(t,e){return e}).reverse()),wv(n.rank===e.length,"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."),e.forEach(function(t){wv(t>=0&&t<n.rank,"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e)}),n.rank<=1?n.clone():Im.engine.runKernel(function(t){return t.transpose(n,e)},{$x:n},function(t){var n=qm(e);return{$x:function(){return t.transpose(n)}}})}}),NC=ag({localResponseNormalization_:function(t,e,n,r,o){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=og(t,"x","localResponseNormalization");wv(4===i.rank||3===i.rank,"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."),wv(Sv(e),"Error in localResponseNormalization: depthRadius must be an integer\n                     but got depthRadius "+e+".");var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=Im.engine.runKernel(function(t,i){return i(t.localResponseNormalization4D(a,e,n,r,o))},{x4D:a},function(t,i){var s=i[0];return{x4D:function(){return Im.engine.runKernel(function(i){return i.LRNGrad(t,a,s,e,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),AC=ag({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||r instanceof Array&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(fg(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(r instanceof Array&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=og(t,"x","norm"),e,n),i=o.shape;if(r){var a=Wm(n,t.shape);i=zm(o.shape,a)}return o.reshape(i)}});function DC(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function MC(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var PC,OC=ag({gather_:function(t,e,n){void 0===n&&(n=0);var r=og(t,"x","gather"),o=og(e,"indices","gather","int32");return n=Wm(n,r.shape)[0],Im.engine.runKernel(function(t){return t.gather(r,o,n)},{$x:r},function(t){return{$x:function(){if(0===n)return FC(t,o,r.shape[n]);var e=r.shape,i=o.size,a=e.slice(0,n),s=a.length,u=e.slice(n,e.length).slice(1),c=u.length,l=DC(0,s),h=DC(s+1,s+1+c),p=MC([a,[i],u]),f=t.reshape(p),d=o.reshape([i]),v=MC([[s],l,h]),m=f.transpose(v),g=FC(m,d,r.shape[n]),y=qm(v);return g.transpose(y)}}})}}),FC=ag({unsortedSegmentSum_:function(t,e,n){var r=og(t,"x","unsortedSegmentSum"),o=og(e,"segmentIds","unsortedSegmentSum","int32");return wv(Sv(n),"numSegments must be of dtype int"),Im.engine.runKernel(function(t){return t.unsortedSegmentSum(r,o,n)},{$x:r},function(t){return{$x:function(){return function(t,e){for(var n=iC(e,Cg(e)),r=OC(t,n),o=W_(e,fg(0,"int32")),i=r.rank-o.rank,a=0;a<i;++a)o=Bb(o,a+1);o=wC(o,yg(r.shape,"bool"));var s=Cg(r);return CC(o,r,s)}(t,o)}}})}}),LC=ag({basicLSTMCell_:function(t,e,n,r,o,i){var a=og(t,"forgetBias","basicLSTMCell"),s=og(e,"lstmKernel","basicLSTMCell"),u=og(n,"lstmBias","basicLSTMCell"),c=og(r,"data","basicLSTMCell"),l=og(o,"c","basicLSTMCell"),h=og(i,"h","basicLSTMCell"),p=c.concat(h,1).matMul(s).add(u),f=p.shape[1]/4,d=[p.shape[0],f],v=p.slice([0,0],d),m=p.slice([0,f],d),g=p.slice([0,2*f],d),y=p.slice([0,3*f],d),w=v.sigmoid().mulStrict(m.tanh()).addStrict(l.mulStrict(a.add(g).sigmoid()));return[w,w.tanh().mulStrict(y.sigmoid())]}}),BC=ag({multiRNNCell_:function(t,e,n,r){for(var o=og(e,"data","multiRNNCell"),i=ig(n,"c","multiRNNCell"),a=ig(r,"h","multiRNNCell"),s=o,u=[],c=0;c<t.length;c++){var l=t[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var h=[],p=[];for(c=0;c<u.length;c+=2)h.push(u[c]),p.push(u[c+1]);return[h,p]}}),UC=ag({movingAverage_:function(t,e,n,r,o){void 0===o&&(o=!0);var i=og(t,"v","movingAverage"),a=og(e,"x","movingAverage"),s=og(n,"decay","movingAverage");wv(i.dtype===a.dtype,"The dtypes of the first("+i.dtype+") and second("+a.dtype+") input must match"),wv(Ev(i.shape,a.shape),"Shape mismatch in v and x");var u=fg(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){wv(null!=r,"When using zeroDebias: true, step is required.");var h=og(r,"step","movingAverage");l=l.div(u.sub(fC(s,h)))}return i.add(l)}}),VC=ag({stridedSlice_:function(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var c=og(t,"x","stridedSlice");return Im.engine.runKernel(function(t){return t.stridedSlice(c,e,n,r,o,i,a,s,u)},{$x:c})}}),jC=ag({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=og(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var i=Im.engine.runKernel(function(t){return t.topk(r,e,n)},{$x:r});return{values:i[0],indices:i[1]}}}),zC=ag({scatterND_:function(t,e,n){var r=og(t,"indices","scatterND","int32"),o=og(e,"updates","scatterND");return function(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}!function(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==e.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}(n,e,t)}(o,r,n),Im.engine.runKernel(function(t){return t.scatterND(r,o,n)},{$indices:r,$updates:o})}}),WC=ag({fft_:function(t){wv("complex64"===t.dtype,"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+".");var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return Im.engine.runKernel(function(t){return t.fft(n)},{input:t}).reshape(t.shape)}}),HC=ag({ifft_:function(t){wv("complex64"===t.dtype,"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+".");var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return Im.engine.runKernel(function(t){return t.ifft(n)},{input:t}).reshape(t.shape)}}),GC=ag({rfft_:function(t){wv("float32"===t.dtype,"The dtype for rfft() must be real value but\n    got "+t.dtype);var e=t.shape[t.shape.length-1],n=t.size/e,r=t.zerosLike(),o=cg(t,r).as2D(n,e),i=WC(o),a=Math.floor(e/2)+1,s=lg(i),u=hg(i),c=s.split([a,e-a],s.shape.length-1),l=u.split([a,e-a],u.shape.length-1),h=t.shape.slice();return h[t.shape.length-1]=a,cg(c[0],l[0]).reshape(h)}}),qC=ag({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),o=HC(r);return lg(o)}var i=[n,2*(e-1)],a=lg(t).as2D(n,e),s=hg(t).as2D(n,e),u=a.slice([0,1],[n,e-2]).reverse(1),c=s.slice([0,1],[n,e-2]).reverse(1).mul(fg(-1)),l=a.concat(u,1),h=s.concat(c,1);return r=cg(l,h).as2D(i[0],i[1]),o=HC(r),lg(o)}}),$C=Object.freeze({fft:WC,ifft:HC,rfft:GC,irfft:qC}),KC=ag({sparseToDense_:function(t,e,n,r){var o=og(t,"sparseIndices","sparseToDense","int32"),i=og(e,"sparseValues","sparseToDense"),a=og(r,"defaultValue","sparseToDense",i.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var o=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");if(0!==e.rank&&(1!==e.rank||e.size!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),Im.engine.runKernel(function(t){return t.sparseToDense(o,i,n,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),XC=ag({gatherND_:function(t,e){var n=og(e,"indices","gatherND","int32"),r=og(t,"x","gatherND");return Im.engine.runKernel(function(t){return t.gatherND(r,n)},{$x:r,$indices:n})}});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(PC||(PC={}));var QC=ag({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=PC.SUM_BY_NONZERO_WEIGHTS);var o=og(t,"labels","absoluteDifference"),i=og(e,"predictions","absoluteDifference"),a=null;null!=n&&(a=og(n,"weights","absoluteDifference")),bv(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return YC(s,a,r)}}),YC=ag({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=PC.SUM_BY_NONZERO_WEIGHTS);var r=og(t,"losses","computeWeightedLoss"),o=null;null!=e&&(o=og(e,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(n===PC.NONE)return i;if(n===PC.SUM)return i.sum();if(n===PC.MEAN){if(null==o)return i.mean();var a=Cv(r.shape)/Cv(o.shape),s=i.sum().div(o.sum());return a>1?s.div(fg(a)):s}if(n===PC.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(fg(r.size));var u=o.mul(yg(r.shape)).notEqual(fg(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),ZC=ag({cosineDistance_:function(t,e,n,r,o){void 0===o&&(o=PC.SUM_BY_NONZERO_WEIGHTS);var i=og(t,"labels","cosineDistance"),a=og(e,"predictions","cosineDistance"),s=null;null!=r&&(s=og(r,"weights","cosineDistance")),bv(i.shape,a.shape,"Error in cosineDistance: ");var u=fg(1).sub(i.mul(a).sum(n,!0));return YC(u,s,o)}}),JC=ag({hingeLoss_:function(t,e,n,r){void 0===r&&(r=PC.SUM_BY_NONZERO_WEIGHTS);var o=og(t,"labels","hingeLoss"),i=og(e,"predictions","hingeLoss"),a=null;null!=n&&(a=og(n,"weights","hingeLoss")),bv(o.shape,i.shape,"Error in hingeLoss: ");var s=fg(1);o=fg(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return YC(u,a,r)}}),tE=ag({huberLoss_:function(t,e,n,r,o){void 0===r&&(r=1),void 0===o&&(o=PC.SUM_BY_NONZERO_WEIGHTS);var i=og(t,"labels","huberLoss"),a=og(e,"predictions","huberLoss"),s=null;null!=n&&(s=og(n,"weights","huberLoss")),bv(i.shape,a.shape,"Error in huberLoss: ");var u=fg(r),c=a.sub(i).abs(),l=sC(c,u),h=c.sub(l),p=fg(.5).mul(l.square()).add(u.mul(h));return YC(p,s,o)}}),eE=ag({logLoss_:function(t,e,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=PC.SUM_BY_NONZERO_WEIGHTS);var i=og(t,"labels","logLoss"),a=og(e,"predictions","logLoss"),s=null;null!=n&&(s=og(n,"weights","logLoss")),bv(i.shape,a.shape,"Error in logLoss: ");var u=fg(1),c=fg(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return YC(l,s,o)}}),nE=ag({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=PC.SUM_BY_NONZERO_WEIGHTS);var o=og(t,"labels","meanSquaredError"),i=og(e,"predictions","meanSquaredError"),a=null;null!=n&&(a=og(n,"weights","meanSquaredError")),bv(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return YC(s,a,r)}}),rE=ag({sigmoidCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=PC.SUM_BY_NONZERO_WEIGHTS);var i=og(t,"multiClassLabels","sigmoidCrossEntropy"),a=og(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=og(n,"weights","sigmoidCrossEntropy")),bv(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=fg(r),c=fg(1),l=fg(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var h=function(t,e){var n=og(t,"labels","sigmoidCrossEntropyWithLogits"),r=og(e,"logits","sigmoidCrossEntropyWithLogits");bv(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(n),a=r.abs().neg().exp().log1p();return o.sub(i).add(a)}(i,a);return YC(h,s,o)}}),oE=ag({softmaxCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=PC.SUM_BY_NONZERO_WEIGHTS);var i=og(t,"onehotLabels","softmaxCrossEntropy"),a=og(e,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=og(n,"weights","softmaxCrossEntropy")),bv(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=fg(r),c=fg(1),l=fg(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var h=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return Nm(function(t,e){var r=e.logSumExp([n],!0),o=e.toFloat().sub(r);return{value:o.mul(t).neg().sum([n]),gradFunc:function(e){var r=zm(e.shape,[n]);return[e.reshape(r).mul(t.toFloat().sub(o.exp())),e.reshape(r).mul(o.exp().sub(t.toFloat()))]}}})(t,e)}(i,a);return YC(h,s,o)}}),iE=Object.freeze({get Reduction(){return PC},absoluteDifference:QC,computeWeightedLoss:YC,cosineDistance:ZC,hingeLoss:JC,huberLoss:tE,logLoss:eE,meanSquaredError:nE,sigmoidCrossEntropy:rE,softmaxCrossEntropy:oE});function aE(t,e){return void 0===e&&(e=!1),Im.engine.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],o=Ub(n),i=t.clone(),a=vg([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,c=function(t){var e,u=i,c=s,l=o;e=Im.engine.tidy(function(){var e=i.slice([t,t],[n-t,1]),u=e.norm(),c=i.slice([t,t],[1,1]),l=c.sign().neg(),h=c.sub(l.mul(u)),p=e.div(h);s=1===p.shape[0]?a.clone():a.concat(p.slice([1,0],[p.shape[0]-1,p.shape[1]]),0);var f=l.matMul(h).div(u).neg(),d=i.slice([t,0],[n-t,r]),v=f.mul(s);i=0===t?d.sub(v.matMul(s.transpose().matMul(d))):i.slice([0,0],[t,r]).concat(d.sub(v.matMul(s.transpose().matMul(d))),0);var m=o.slice([0,t],[n,o.shape[1]-t]);return o=0===t?m.sub(m.matMul(s).matMul(v.transpose())):o.slice([0,0],[n,t]).concat(m.sub(m.matMul(s).matMul(v.transpose())),1),[s,i,o]}),s=e[0],i=e[1],o=e[2],Mm([u,c,l])},l=0;l<u;++l)c(l);return!e&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var sE=ag({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,wv(null!=t&&t.length>0,"Gram-Schmidt process: input must not be null, undefined, or empty");for(var n=t[0].shape[0],r=1;r<t.length;++r)wv(t[r].shape[0]===n,"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[r].shape[0]+" vs. "+n+")")}else e=!0,t=bb(t,t.shape[0],0).map(function(t){return Jb(t,[0])});wv(t.length<=t[0].shape[0],"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+").");var o=[],i=t,a=function(t){o.push(Im.engine.tidy(function(){var e=i[t];if(t>0)for(var n=0;n<t;++n){var r=B_(o[n].mulStrict(e)).mul(o[n]);e=e.sub(r)}return e.div(AC(e,"euclidean"))}))};for(r=0;r<t.length;++r)a(r);return e?tx(o,0):o}}),uE=ag({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return aE(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),r=[],o=[];return rx(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0).forEach(function(t){var n=aE(t,e),i=n[1];r.push(n[0]),o.push(i)}),[tx(r,0).reshape(t.shape),tx(o,0).reshape(t.shape)]}}),cE=Object.freeze({gramSchmidt:sE,qr:uE});function lE(t,e,n,r,o){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY);var i=t.shape[0];return n=Math.min(n,i),wv(0<=r&&r<=1,"iouThreshold must be in [0, 1], but was '"+r+"'"),wv(2===t.rank,"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"),wv(4===t.shape[1],"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]),wv(1===e.rank,"scores must be a 1D tensor"),wv(e.shape[0]===i,"scores has incompatible shape with boxes. Expected "+i+", but was "+e.shape[0]),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o}}var hE=ag({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=og(t,"images","resizeBilinear");wv(3===r.rank||4===r.rank,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."),wv(2===e.length,"Error in resizeBilinear: new shape must 2D, but got shape "+e+".");var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=Im.engine.runKernel(function(t,e){return t.resizeBilinear(o,a,s,n)},{batchImages:o},function(t,e){return{batchImages:function(){return Im.engine.runKernel(function(e){return e.resizeBilinearBackprop(t,o,n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),pE=ag({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=og(t,"images","resizeNearestNeighbor");wv(3===r.rank||4===r.rank,"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."),wv(2===e.length,"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."),wv("float32"===r.dtype||"int32"===r.dtype,"`images` must have `int32` or `float32` as dtype");var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=Im.engine.runKernel(function(t,e){return t.resizeNearestNeighbor(o,a,s,n)},{batchImages:o},function(t,e){return{batchImages:function(){return Im.engine.runKernel(function(e){return e.resizeNearestNeighborBackprop(t,o,n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),fE=ag({nonMaxSuppression_:function(t,e,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=og(t,"boxes","nonMaxSuppression"),a=og(e,"scores","nonMaxSuppression"),s=lE(i,a,n,r,o);return n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,Im.engine.runKernel(function(t){return t.nonMaxSuppression(i,a,n,r,o)},{$boxes:i})}}),dE=Object.freeze({resizeBilinear:hE,resizeNearestNeighbor:pE,nonMaxSuppression:fE,nonMaxSuppressionAsync:function(t,e,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),cv(this,void 0,void 0,function(){var i,a,s,u,c,l;return lv(this,function(h){switch(h.label){case 0:return i=og(t,"boxes","nonMaxSuppressionAsync"),a=og(e,"scores","nonMaxSuppressionAsync"),s=lE(i,a,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,i.data()];case 1:return u=h.sent(),[4,a.data()];case 2:return c=h.sent(),l=Ag(u,c,n,r,o),i!==t&&i.dispose(),a!==e&&a.dispose(),[2,l]}})})},cropAndResize:function(t,e,n,r,o,i){var a=og(t,"image","cropAndResize","float32"),s=og(e,"boxes","cropAndResize","float32"),u=og(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return wv(4===a.rank,"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."),wv(2===s.rank&&4===s.shape[1],"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."),wv(1===u.rank&&u.shape[0]===c,"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."),wv(2===r.length,"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."),wv(r[0]>=1&&r[1]>=1,"cropSize must be atleast [1,1], but was "+r),wv("bilinear"===o||"nearest"===o,"method must be bilinear or nearest, but was "+o),Im.engine.runKernel(function(t,e){return t.cropAndResize(a,s,u,r,o,i)},{$image:a,$boxes:s})}}),vE=Object.freeze({image:dE,linalg:cE,losses:iE,spectral:$C,op:ag,batchNormalization2d:jx,batchNormalization3d:zx,batchNormalization4d:Wx,batchNormalization:Hx,complex:cg,real:lg,imag:hg,concat:vb,concat1d:mb,concat2d:gb,concat3d:yb,concat4d:wb,split:bb,conv1d:a_,conv2d:s_,conv3d:u_,conv2dDerFilter:c_,depthwiseConv2d:l_,separableConv2d:h_,conv2dTranspose:p_,matMul:t_,dot:e_,outerProduct:n_,reverse:f_,reverse1d:d_,reverse2d:v_,reverse3d:m_,reverse4d:g_,maxPool:b_,avgPool:x_,pool:__,slice:C_,slice1d:E_,slice2d:S_,slice3d:R_,slice4d:T_,abs:ux,acos:cx,acosh:lx,asin:hx,asinh:px,atan:fx,atanh:dx,ceil:vx,clipByValue:mx,cos:gx,cosh:yx,erf:wx,exp:bx,expm1:xx,floor:_x,log:Cx,log1p:Ex,logSigmoid:Sx,neg:Rx,reciprocal:Tx,round:kx,rsqrt:Ix,sigmoid:Nx,sign:Ax,sin:Dx,sinh:Mx,softplus:Px,sqrt:Ox,square:Fx,step:Lx,tan:Bx,tanh:Ux,all:I_,any:N_,argMax:A_,argMin:D_,logSumExp:M_,max:P_,mean:O_,min:F_,moments:L_,sum:B_,prod:U_,equal:V_,equalStrict:j_,greater:z_,greaterEqual:W_,greaterEqualStrict:H_,greaterStrict:G_,less:q_,lessEqual:$_,lessEqualStrict:K_,lessStrict:X_,notEqual:Q_,notEqualStrict:Y_,add:Z_,addN:J_,addStrict:tC,atan2:eC,div:nC,divStrict:rC,floorDiv:oC,maximum:iC,maximumStrict:aC,minimum:sC,minimumStrict:uC,mod:cC,modStrict:lC,mul:hC,mulStrict:pC,pow:fC,powStrict:dC,squaredDifference:vC,squaredDifferenceStrict:mC,sub:gC,subStrict:yC,elu:EC,leakyRelu:SC,prelu:RC,relu:TC,selu:kC,logicalAnd:wC,logicalNot:bC,logicalOr:xC,logicalXor:_C,where:CC,whereAsync:function(t){return cv(this,void 0,void 0,function(){var e,n,r;return lv(this,function(o){switch(o.label){case 0:return[4,(e=og(t,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=ox(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},buffer:Db,toPixels:Ab,print:function(t,e){void 0===e&&(e=!1),console.log(t.toString(e))},batchToSpaceND:Mb,cast:Pb,clone:Ob,cumsum:Fb,depthToSpace:Lb,expandDims:Bb,eye:Ub,fromPixels:Vb,multinomial:jb,oneHot:zb,pad:Wb,pad1d:Hb,pad2d:Gb,pad3d:qb,pad4d:$b,rand:Kb,randomNormal:Xb,randomUniform:Qb,reshape:Yb,spaceToBatchND:Zb,squeeze:Jb,stack:tx,tile:ex,truncatedNormal:nx,unstack:rx,setdiff1dAsync:function(t,e){return cv(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h;return lv(this,function(p){switch(p.label){case 0:return n=og(t,"x","setdiff1d"),r=og(e,"y","setdiff1d"),wv(n.dtype===r.dtype,"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."),wv(1===n.rank,"x should be 1D tensor, but got x ("+n.shape+")."),wv(1===r.rank,"y should be 1D tensor, but got y ("+r.shape+")."),[4,n.data()];case 1:return o=p.sent(),[4,r.data()];case 2:for(i=p.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new nm([s],n.dtype),c=new nm([s],"int32"),l=0,h=0;l<o.length;l++)a.has(o[l])||(u.values[h]=o[l],c.values[h]=l,h++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:bg,linspace:function(t,e,n){if(0===n)throw new Error("Cannot request zero samples");var r=(e-t)/(n-1),o=Xv(n,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return dg(o,"float32")},ones:yg,range:xg,scalar:fg,tensor:pg,tensor1d:dg,tensor2d:vg,tensor3d:mg,tensor4d:gg,tensor5d:function(t,e,n){if(xv(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=ng(t);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return pg(t,e=e||r,n)},tensor6d:function(t,e,n){if(xv(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=ng(t);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return pg(t,e=e||r,n)},zeros:wg,onesLike:_g,zerosLike:Cg,transpose:IC,softmax:sg,logSoftmax:ug,localResponseNormalization:NC,norm:AC,gather:OC,unsortedSegmentSum:FC,basicLSTMCell:LC,multiRNNCell:BC,movingAverage:UC,stridedSlice:VC,topk:jC,scatterND:zC,fft:WC,ifft:HC,rfft:GC,irfft:qC,sparseToDense:KC,gatherND:XC}),mE=function(){function t(){this.blockSize=48,this.firstUse=!0,Im.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return t.prototype.setDataMover=function(t){this.data=new Eg(t)},t.prototype.register=function(t,e,n){if(this.firstUse&&(this.firstUse=!1,Im.get("IS_NODE")&&Pm("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,{dtype:n})},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(t).values=e},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.fromPixels() can not be null");var n,r;if(Im.get("IS_NODE")&&null==t.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=t.getContext)n=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(t instanceof ImageData)n=t.data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),n=this.fromPixels2DContext.getImageData(0,0,t.width,t.height).data}if(4===e)r=new Int32Array(n);else{var o=t.width*t.height;r=new Int32Array(o*e);for(var i=0;i<o;i++)for(var a=0;a<e;++a)r[i*e+a]=n[4*i+a]}return mg(r,[t.height,t.width,e],"int32")},t.prototype.read=function(t){return cv(this,void 0,void 0,function(){return lv(this,function(e){return[2,this.readSync(t)]})})},t.prototype.readSync=function(t){var e=this.data.get(t),n=e.complexTensors;return"complex64"===e.dtype?Tg(n.real.dataSync(),n.imag.dataSync()):this.data.get(t).values},t.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},t.prototype.time=function(t){return cv(this,void 0,void 0,function(){var e;return lv(this,function(n){return e=Qv(),t(),[2,{kernelMs:Qv()-e}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(t,e){var n=am.make(t.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:Im.engine.keep(t.clone()),imag:Im.engine.keep(e.clone())},n},t.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},t.prototype.assertNotComplex=function(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){null!=t&&wv("complex64"!==t.dtype,e+" does not support complex64 tensors.")})},t.prototype.slice=function(t,e,n){this.assertNotComplex(t,"slice");for(var r=Db(n,t.dtype),o=0;o<r.size;++o){var i=r.indexToLoc(o),a=i.map(function(t,n){return t+e[n]});r.set.apply(r,[t.get.apply(t,a)].concat(i))}return r.toTensor()},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){this.assertNotComplex(t,"stridedSlice");var c=Jm(t.shape,e,n,r,o,i,a,s,u),l=c[0],h=c[1],p=c[2],f=h.filter(function(t,e){return-1===p.indexOf(e)});if(f.some(function(t){return 0===t}))return pg([],f);for(var d=Db(h,t.dtype),v=0;v<d.size;v++){for(var m=d.indexToLoc(v),g=new Array(m.length),y=0;y<g.length;y++)g[y]=m[y]*r[y]+l[y];d.set.apply(d,[t.get.apply(t,g)].concat(m))}return d.toTensor().reshape(f)},t.prototype.reverse=function(t,e){this.assertNotComplex(t,"reverse");for(var n=Db(t.shape,t.dtype),r=t.buffer(),o=function(o){var i=n.indexToLoc(o),a=i.slice();e.forEach(function(e){return a[e]=t.shape[e]-1-a[e]}),n.set.apply(n,[r.get.apply(r,a)].concat(i))},i=0;i<n.size;i++)o(i);return n.toTensor()},t.prototype.concat=function(t,e){this.assertNotComplex(t,"concat");var n=t.map(function(t){var n=Cv(t.shape.slice(e));return t.as2D(-1,n)}),r=Km(n.map(function(t){return t.shape}),1),o=Db(r,t[0].dtype).values;if(1===n[0].shape[0]){var i=0;n.forEach(function(t){o.set(t.dataSync(),i),i+=t.size})}else{var a=0;n.forEach(function(t){for(var e=t.dataSync(),n=0,i=0;i<t.shape[0];++i)for(var s=i*r[1]+a,u=0;u<t.shape[1];++u)o[s+u]=e[n++];a+=t.shape[1]})}var s=Km(t.map(function(t){return t.shape}),e);return pg(o,s,t[0].dtype)},t.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(fg(-1),t)},t.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t+n,imag:e+r}}):this.broadcastedBinaryOp(t,e,vm(t.dtype,e.dtype),function(t,e){return t+e})},t.prototype.addN=function(t){this.assertNotComplex(t,"addN");for(var e=t.map(function(t){return t.dataSync()}),n=Db(t[0].shape,t[0].dtype),r=n.values,o=0;o<t.length;o++)for(var i=e[o],a=0;a<r.length;a++)r[a]+=i[a];return n.toTensor()},t.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t-n,imag:e-r}}):this.broadcastedBinaryOp(t,e,vm(t.dtype,e.dtype),function(t,e){return t-e})},t.prototype.pow=function(t,e){return this.assertNotComplex([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},t.prototype.batchMatMul=function(t,e,n,r){this.assertNotComplex([t,e],"matMul");for(var o=n?t.shape[1]:t.shape[2],i=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],s=t.shape[0],u=t.dataSync(),c=e.dataSync(),l=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],h=l[0],p=l[1],f=l[2],d=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],v=d[0],m=d[1],g=d[2],y=i*a,w=Db([s,i,a],t.dtype),b=w.values,x=this.blockSize,_=0;_<s;_++)for(var C=0;C<i;C+=x)for(var E=0;E<a;E+=x)for(var S=0;S<o;S+=x)for(var R=Math.min(C+x,i),T=Math.min(E+x,a),k=Math.min(S+x,o),I=C;I<R;I++)for(var N=E;N<T;N++){for(var A=0,D=S;D<k;D++)A+=u[_*h+I*p+D*f]*c[D*v+N*m+_*g];b[_*y+(I*a+N)]+=A}return w.toTensor()},t.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}}):this.broadcastedBinaryOp(t,e,vm(t.dtype,e.dtype),function(t,e){return t*e})},t.prototype.realDivide=function(t,e){return this.assertNotComplex([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},t.prototype.floorDiv=function(t,e){return this.assertNotComplex([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},t.prototype.sum=function(t,e){this.assertNotComplex(t,"sum"),Hm("sum",e,t.rank);for(var n=jm(t.shape,e),r=n[1],o=wg(n[0],vm(t.dtype,"int32")),i=Cv(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var c=u*i,l=0,h=0;h<i;++h)l+=s[c+h];a[u]=l}return o},t.prototype.prod=function(t,e){this.assertNotComplex(t,"sum");for(var n=jm(t.shape,e),r=n[1],o=wg(n[0],vm(t.dtype,"int32")),i=Cv(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var c=u*i,l=1,h=0;h<i;++h)l*=s[c+h];a[u]=l}return o},t.prototype.unsortedSegmentSum=function(t,e,n){this.assertNotComplex(t,"unsortedSegmentSum");for(var r=[],o=t.rank-e.rank,i=0;i<o;++i)e=e.expandDims(i+1);for(i=0;i<n;++i){var a=fg(i,"int32"),s=V_(a,e).asType("float32").mul(t).sum(0);r.push(s)}return tx(r)},t.prototype.argMin=function(t,e){this.assertNotComplex(t,"argMin");var n=[e];Hm("argMin",n,t.rank);for(var r=jm(t.shape,n),o=r[1],i=wg(r[0],"int32"),a=Cv(o),s=i.dataSync(),u=t.dataSync(),c=0;c<s.length;++c){for(var l=c*a,h=u[l],p=0,f=0;f<a;++f){var d=u[l+f];d<h&&(h=d,p=f)}s[c]=p}return i},t.prototype.argMax=function(t,e){this.assertNotComplex(t,"argMax");var n=[e];Hm("argMax",n,t.rank);for(var r=jm(t.shape,n),o=r[1],i=wg(r[0],"int32"),a=Cv(o),s=i.dataSync(),u=t.dataSync(),c=0;c<s.length;++c){for(var l=c*a,h=u[l],p=0,f=0;f<a;++f){var d=u[l+f];d>h&&(h=d,p=f)}s[c]=p}return i},t.prototype.cumsum=function(t,e,n,r){if(this.assertNotComplex(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=vm(t.dtype,"int32"),i=wg(t.shape,o),a=i.dataSync(),s=t.dataSync(),u=t.shape[t.rank-1],c=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},l=0;l<s.length;l+=u)for(var h=0;h<u;h++){var p=c(l,h);if(0===h)a[p]=n?0:s[p];else{var f=c(l,h-1);a[p]=n?s[f]+a[f]:s[p]+a[f]}}return i},t.prototype.equal=function(t,e){return this.assertNotComplex([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},t.prototype.notEqual=function(t,e){return this.assertNotComplex([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},t.prototype.less=function(t,e){return this.assertNotComplex([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},t.prototype.lessEqual=function(t,e){return this.assertNotComplex([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},t.prototype.greater=function(t,e){return this.assertNotComplex([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},t.prototype.greaterEqual=function(t,e){return this.assertNotComplex([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},t.prototype.logicalNot=function(t){this.assertNotComplex(t,"logicalNot");for(var e=t.dataSync(),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return am.make(t.shape,{values:n},"bool")},t.prototype.logicalAnd=function(t,e){return this.assertNotComplex([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},t.prototype.logicalOr=function(t,e){return this.assertNotComplex([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},t.prototype.select=function(t,e,n){this.assertNotComplex([t,e,n],"select");for(var r=t.dataSync(),o=e.dataSync(),i=n.dataSync(),a=wg(e.shape,vm(e.dtype,n.dtype)),s=a.dataSync(),u=0,c=0===t.rank||t.rank>1||1===e.rank?1:e.shape[1],l=0;l<r.length;l++)for(var h=0;h<c;h++)s[u++]=1===r[l]?o[l]:i[l];return a},t.prototype.where=function(t){this.assertNotComplex([t],"where");var e=t.dataSync();return ox(t.shape,e)},t.prototype.topk=function(t,e,n){return this.assertNotComplex(t,"topk"),Pg(t.dataSync(),t.shape,t.dtype,e)},t.prototype.min=function(t,e){this.assertNotComplex(t,"min"),Hm("min",e,t.rank);for(var n=jm(t.shape,e),r=n[1],o=wg(n[0],t.dtype),i=Cv(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var c=u*i,l=s[c],h=0;h<i;++h){var p=s[c+h];p<l&&(l=p)}a[u]=l}return o},t.prototype.minimum=function(t,e){return this.assertNotComplex([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},t.prototype.mod=function(t,e){return this.assertNotComplex([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})},t.prototype.max=function(t,e){this.assertNotComplex(t,"max"),Hm("max",e,t.rank);for(var n=jm(t.shape,e),r=n[1],o=wg(n[0],t.dtype),i=Cv(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var c=u*i,l=s[c],h=0;h<i;++h){var p=s[c+h];p>l&&(l=p)}a[u]=l}return o},t.prototype.maximum=function(t,e){return this.assertNotComplex([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},t.prototype.all=function(t,e){this.assertNotComplex(t,"all"),Hm("all",e,t.rank);for(var n=jm(t.shape,e),r=n[1],o=wg(n[0],t.dtype),i=Cv(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var c=u*i,l=s[c],h=0;h<i;++h)l=l&&s[c+h];a[u]=l}return o},t.prototype.any=function(t,e){this.assertNotComplex(t,"any"),Hm("any",e,t.rank);for(var n=jm(t.shape,e),r=n[1],o=wg(n[0],t.dtype),i=Cv(r),a=o.dataSync(),s=t.dataSync(),u=0;u<a.length;++u){for(var c=u*i,l=s[c],h=0;h<i;++h)l=l||s[c+h];a[u]=l}return o},t.prototype.squaredDifference=function(t,e){return this.assertNotComplex([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t-e;return n*n})},t.prototype.ceil=function(t){this.assertNotComplex(t,"ceil");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return am.make(t.shape,{values:n})},t.prototype.floor=function(t){this.assertNotComplex(t,"floor");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return am.make(t.shape,{values:n})},t.prototype.sign=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=e[r]<0?-1:e[r]>0?1:0;return am.make(t.shape,{values:n})},t.prototype.round=function(t){this.assertNotComplex(t,"round");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=Math.floor(e[r]);n[r]=e[r]-o<.5?Math.floor(e[r]):e[r]-o>.5?Math.ceil(e[r]):o%2==0?o:o+1}return am.make(t.shape,{values:n})},t.prototype.exp=function(t){this.assertNotComplex(t,"exp");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return am.make(t.shape,{values:n})},t.prototype.expm1=function(t){this.assertNotComplex(t,"expm1");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return am.make(t.shape,{values:n})},t.prototype.log=function(t){this.assertNotComplex(t,"log");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log(e[r]);return am.make(t.shape,{values:n})},t.prototype.log1p=function(t){this.assertNotComplex(t,"log1p");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log1p(e[r]);return am.make(t.shape,{values:n})},t.prototype.sqrt=function(t){this.assertNotComplex(t,"sqrt");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.sqrt(e[r]);return am.make(t.shape,{values:n})},t.prototype.rsqrt=function(t){this.assertNotComplex(t,"rsqrt");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/Math.sqrt(e[r]);return am.make(t.shape,{values:n})},t.prototype.square=function(t){this.assertNotComplex(t,"square");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=o*o}return am.make(t.shape,{values:n})},t.prototype.reciprocal=function(t){this.assertNotComplex(t,"reciprocal");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return am.make(t.shape,{values:n})},t.prototype.relu=function(t){this.assertNotComplex(t,"relu");for(var e=wg(t.shape,t.dtype),n=e.dataSync(),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return e},t.prototype.elu=function(t){this.assertNotComplex(t,"elu");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?o:Math.exp(o)-1}return am.make(t.shape,{values:e})},t.prototype.eluDer=function(t,e){this.assertNotComplex([t,e],"eluDer");for(var n=new Float32Array(e.size),r=e.dataSync(),o=t.dataSync(),i=0;i<r.length;++i){var a=r[i];n[i]=a>=1?o[i]:o[i]*(a+1)}return am.make(e.shape,{values:n})},t.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?1.0507009873554805*o:1.7580993408473768*(Math.exp(o)-1)}return am.make(t.shape,{values:e})},t.prototype.clip=function(t,e,n){this.assertNotComplex(t,"clip");for(var r=new Float32Array(t.size),o=t.dataSync(),i=0;i<o.length;++i){var a=o[i];r[i]=a>n?n:a<e?e:a}return am.make(t.shape,{values:r})},t.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return am.make(t.shape,{values:e})},t.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<t.size;++r)e[r]=Math.hypot(n[2*r],n[2*r+1]);return am.make(t.shape,{values:e})},t.prototype.int=function(t){this.assertNotComplex(t,"int");for(var e=new Int32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=n[r];return am.make(t.shape,{values:e},"int32")},t.prototype.sigmoid=function(t){this.assertNotComplex(t,"sigmoid");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return am.make(t.shape,{values:e})},t.prototype.softplus=function(t){this.assertNotComplex(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o){var i,a=r[o]>-e,s=r[o]<e,u=Math.exp(r[o]);i=s?u:a?r[o]:Math.log(1+u),n[o]=i}return am.make(t.shape,{values:n})},t.prototype.sin=function(t){this.assertNotComplex(t,"sin");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return am.make(t.shape,{values:e})},t.prototype.cos=function(t){this.assertNotComplex(t,"cos");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return am.make(t.shape,{values:e})},t.prototype.tan=function(t){this.assertNotComplex(t,"tan");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return am.make(t.shape,{values:e})},t.prototype.asin=function(t){this.assertNotComplex(t,"asin");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return am.make(t.shape,{values:e})},t.prototype.acos=function(t){this.assertNotComplex(t,"acos");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return am.make(t.shape,{values:e})},t.prototype.atan=function(t){this.assertNotComplex(t,"atan");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return am.make(t.shape,{values:e})},t.prototype.atan2=function(t,e){return this.assertNotComplex([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},t.prototype.sinh=function(t){this.assertNotComplex(t,"sinh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return am.make(t.shape,{values:e})},t.prototype.cosh=function(t){this.assertNotComplex(t,"cosh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return am.make(t.shape,{values:e})},t.prototype.tanh=function(t){this.assertNotComplex(t,"tanh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Rv(n[r]);return am.make(t.shape,{values:e})},t.prototype.asinh=function(t){this.assertNotComplex(t,"asinh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return am.make(t.shape,{values:e})},t.prototype.acosh=function(t){this.assertNotComplex(t,"acosh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return am.make(t.shape,{values:e})},t.prototype.atanh=function(t){this.assertNotComplex(t,"atanh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return am.make(t.shape,{values:e})},t.prototype.erf=function(t){this.assertNotComplex(t,"erf");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var o=n[r],i=1/(1+.3275911*o);e[r]=1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-o*o)}return am.make(t.shape,{values:e})},t.prototype.step=function(t,e){void 0===e&&(e=0),this.assertNotComplex(t,"step");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o){var i=r[o];n[o]=isNaN(i)?NaN:i>0?1:e}return am.make(t.shape,{values:n})},t.prototype.conv2d=function(t,e,n){this.assertNotComplex([t,e],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=Db(n.outShape,t.dtype),l=t.dataSync(),h=e.dataSync(),p=c.values,f=0;f<n.batchSize;++f)for(var d=f*t.strides[0],v=f*c.strides[0],m=0;m<n.outHeight;++m)for(var g=v+m*c.strides[1],y=m*n.strideHeight-s,w=0;w<r;w++){var b=y+w*i;if(!(b<0||b>=n.inHeight))for(var x=w*e.strides[0],_=d+b*t.strides[1],C=0;C<n.outWidth;++C)for(var E=g+C*n.outChannels,S=C*n.strideWidth-u,R=0;R<o;R++){var T=S+R*a;if(!(T<0||T>=n.inWidth))for(var k=_+T*n.inChannels,I=x+R*e.strides[1],N=0;N<n.inChannels;++N){for(var A=l[k+N],D=0;D<n.outChannels;++D)p[E+D]+=A*h[I+D];I+=n.outChannels}}}return c.toTensor()},t.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,o=n.filterHeight,i=n.filterWidth,a=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,h=n.padInfo.top,p=Db(n.outShape,t.dtype),f=t.dataSync(),d=e.dataSync(),v=p.values,m=0;m<n.batchSize;++m)for(var g=m*t.strides[0],y=m*p.strides[0],w=0;w<n.outDepth;++w)for(var b=y+w*p.strides[1],x=w*n.strideDepth-c,_=0;_<r;_++){var C=x+_*a;if(!(C<0||C>=n.inDepth))for(var E=_*e.strides[0],S=g+C*t.strides[1],R=0;R<n.outHeight;++R)for(var T=b+R*p.strides[2],k=R*n.strideHeight-h,I=0;I<o;I++){var N=k+I*s;if(!(N<0||N>=n.inHeight))for(var A=E+I*e.strides[1],D=S+N*t.strides[2],M=0;M<n.outWidth;++M)for(var P=T+M*n.outChannels,O=M*n.strideWidth-l,F=0;F<i;F++){var L=O+F*u;if(!(L<0||L>=n.inWidth))for(var B=D+L*n.inChannels,U=A+F*e.strides[2],V=0;V<n.inChannels;++V){for(var j=f[B+V],z=0;z<n.outChannels;++z)v[P+z]+=j*d[U+z];U+=n.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerInput");for(var r=Db(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],c=t.dataSync(),l=t.strides,h=l[0],p=l[1],f=l[2],d=e.dataSync(),v=e.strides,m=v[0],g=v[1],y=v[2],w=n.batchSize,b=n.filterHeight,x=n.filterWidth,_=n.inChannels,C=n.inHeight,E=n.inWidth,S=n.outChannels,R=n.outHeight,T=n.outWidth,k=n.strideHeight,I=n.strideWidth,N=b-1-n.padInfo.top,A=x-1-n.padInfo.left,D=0;D<w;++D)for(var M=0;M<_;++M)for(var P=0;P<C;++P)for(var O=P-N,F=Math.max(0,Math.ceil(O/k)),L=Math.min(R,(b+O)/k),B=0;B<E;++B){for(var U=B-A,V=Math.max(0,Math.ceil(U/I)),j=Math.min(T,(x+U)/I),z=0,W=F;W<L;++W)for(var H=W*k-O,G=V;G<j;++G)for(var q=h*D+p*W+f*G,$=m*(b-1-H)+g*(x-1-(G*I-U))+y*M,K=0;K<S;++K)z+=c[q+K]*d[$+K];o[a*D+s*P+u*B+M]=z}return r.toTensor()},t.prototype.conv3dDerInput=function(t,e,n){for(var r=Db(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],c=i[3],l=t.dataSync(),h=t.strides,p=h[0],f=h[1],d=h[2],v=h[3],m=e.dataSync(),g=e.strides,y=g[0],w=g[1],b=g[2],x=g[3],_=n.batchSize,C=n.filterDepth,E=n.filterHeight,S=n.filterWidth,R=n.inChannels,T=n.inDepth,k=n.inHeight,I=n.inWidth,N=n.outChannels,A=n.outDepth,D=n.outHeight,M=n.outWidth,P=n.strideDepth,O=n.strideHeight,F=n.strideWidth,L=C-1-n.padInfo.front,B=E-1-n.padInfo.top,U=S-1-n.padInfo.left,V=0;V<_;++V)for(var j=0;j<R;++j)for(var z=0;z<T;++z)for(var W=z-L,H=Math.max(0,Math.ceil(W/P)),G=Math.min(A,(C+W)/P),q=0;q<k;++q)for(var $=q-B,K=Math.max(0,Math.ceil($/O)),X=Math.min(D,(E+$)/O),Q=0;Q<I;++Q){for(var Y=Q-U,Z=Math.max(0,Math.ceil(Y/F)),J=Math.min(M,(S+Y)/F),tt=0,et=H;et<G;++et)for(var nt=et*P-W,rt=K;rt<X;++rt)for(var ot=rt*O-$,it=Z;it<J;++it)for(var at=p*V+f*et+d*rt+v*it,st=y*(C-1-nt)+w*(E-1-ot)+b*(S-1-(it*F-Y))+x*j,ut=0;ut<N;++ut)tt+=l[at+ut]*m[st+ut];o[a*V+s*z+u*q+c*Q+j]=tt}return r.toTensor()},t.prototype.conv2dDerFilter=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=Db(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=0;l<i;++l)for(var h=Math.max(0,Math.ceil((c-l)/r)),p=Math.min(n.outHeight,(n.inHeight+c-l)/r),f=0;f<a;++f)for(var d=Math.max(0,Math.ceil((u-f)/o)),v=Math.min(n.outWidth,(n.inWidth+u-f)/o),m=0;m<n.inChannels;++m)for(var g=0;g<n.outChannels;++g){for(var y=0,w=0;w<n.batchSize;++w)for(var b=h;b<p;++b)for(var x=l+b*r-c,_=d;_<v;++_)y+=t.get(w,x,f+_*o-u,m)*e.get(w,b,_,g);s.set(y,l,f,m,g)}return s.toTensor()},t.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=Db(n.filterShape,"float32"),l=c.values,h=c.strides,p=h[0],f=h[1],d=h[2],v=h[3],m=e.dataSync(),g=e.strides,y=g[0],w=g[1],b=g[2],x=g[3],_=t.dataSync(),C=t.strides,E=C[0],S=C[1],R=C[2],T=C[3],k=n.padInfo.front,I=n.padInfo.left,N=n.padInfo.top,A=0;A<a;++A)for(var D=Math.max(0,Math.ceil((k-A)/r)),M=Math.min(n.outDepth,(n.inDepth+k-A)/r),P=A*p,O=0;O<s;++O)for(var F=Math.max(0,Math.ceil((N-O)/o)),L=Math.min(n.outHeight,(n.inHeight+N-O)/o),B=O*f+P,U=0;U<u;++U)for(var V=Math.max(0,Math.ceil((I-U)/i)),j=Math.min(n.outWidth,(n.inWidth+I-U)/i),z=U*d+B,W=0;W<n.inChannels;++W)for(var H=W*v+z,G=0;G<n.outChannels;++G){for(var q=0,$=0;$<n.batchSize;++$)for(var K=$*E,X=$*y,Q=D;Q<M;++Q)for(var Y=(A+Q*r-k)*S+K,Z=Q*w+X,J=F;J<L;++J)for(var tt=(O+J*o-N)*R+Y,et=J*b+Z,nt=V;nt<j;++nt)q+=_[(U+nt*i-I)*T+tt+W]*m[nt*x+et+G];l[H+G]=q}return c.toTensor()},t.prototype.depthwiseConv2D=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=Db(n.outShape,t.dtype),h=t.dataSync(),p=e.dataSync(),f=l.values,d=0;d<n.batchSize;++d)for(var v=d*t.strides[0],m=d*l.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*l.strides[1],w=g*n.strideHeight-s,b=0;b<r;++b){var x=w+b*i;if(!(x<0||x>=n.inHeight))for(var _=b*e.strides[0],C=v+x*t.strides[1],E=0;E<n.outWidth;++E)for(var S=y+E*l.strides[2],R=E*n.strideWidth-u,T=0;T<o;++T){var k=R+T*a;if(!(k<0||k>=n.inWidth))for(var I=C+k*n.inChannels,N=S,A=_+T*e.strides[1],D=0;D<n.inChannels;++D){for(var M=h[I+D],P=0;P<c;++P)f[N+P]+=M*p[A+P];N+=c,A+=c}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerInput");for(var r=Db(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],c=t.dataSync(),l=t.strides,h=l[0],p=l[1],f=l[2],d=e.dataSync(),v=e.strides,m=v[0],g=v[1],y=v[2],w=n.batchSize,b=n.filterHeight,x=n.filterWidth,_=n.inChannels,C=n.inHeight,E=n.inWidth,S=n.outHeight,R=n.outWidth,T=n.strideHeight,k=n.strideWidth,I=b-1-n.padInfo.top,N=x-1-n.padInfo.left,A=n.outChannels/_,D=0;D<w;++D)for(var M=0;M<_;++M)for(var P=0;P<C;++P)for(var O=P-I,F=Math.max(0,Math.ceil(O/T)),L=Math.min(S,(b+O)/T),B=0;B<E;++B){for(var U=B-N,V=Math.max(0,Math.ceil(U/k)),j=Math.min(R,(x+U)/k),z=0,W=F;W<L;++W)for(var H=W*T-O,G=V;G<j;++G)for(var q=h*D+p*W+f*G,$=m*(b-1-H)+g*(x-1-(G*k-U))+y*M,K=0;K<A;++K)z+=c[q+(M*A+K)]*d[$+K];o[a*D+s*P+u*B+M]=z}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=Db(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,h=0;h<i;++h)for(var p=Math.max(0,Math.ceil((c-h)/r)),f=Math.min(n.outHeight,(n.inHeight+c-h)/r),d=0;d<a;++d)for(var v=Math.max(0,Math.ceil((u-d)/o)),m=Math.min(n.outWidth,(n.inWidth+u-d)/o),g=0;g<n.outChannels;++g){for(var y=Math.trunc(g/l),w=g%l,b=0,x=0;x<n.batchSize;++x)for(var _=p;_<f;++_)for(var C=h+_*r-c,E=v;E<m;++E)b+=t.get(x,C,d+E*o-u,y)*e.get(x,_,E,g);s.set(b,h,d,y,w)}return s.toTensor()},t.prototype.tile=function(t,e){this.assertNotComplex(t,"tile");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var o=Db(n,t.dtype),i=t.buffer();for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),s=new Array(t.rank),u=0;u<s.length;u++)s[u]=a[u]%t.shape[u];var c=i.locToIndex(s);o.values[r]=i.values[c]}return o.toTensor()},t.prototype.pad=function(t,e,n){this.assertNotComplex(t,"pad");var r=e.map(function(e,n){return e[0]+t.shape[n]+e[1]}),o=e.map(function(t){return t[0]}),i=t.buffer(),a=Db(r,t.dtype);0!==n&&a.values.fill(n);for(var s=0;s<t.size;s++){var u=i.indexToLoc(s),c=u.map(function(t,e){return t+o[e]});a.set.apply(a,[t.get.apply(t,u)].concat(c))}return a.toTensor()},t.prototype.transpose=function(t,e){this.assertNotComplex(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var o=t.dataSync(),i=Db(n,t.dtype),a=t.buffer();for(r=0;r<t.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[e[c]];var l=i.locToIndex(u);i.values[l]=o[r]}return i.toTensor()},t.prototype.gather=function(t,e,n){this.assertNotComplex([t,e],"gather");var r=t.shape.slice(),o=e.dataSync();r[n]=o.length;for(var i=Db(r,t.dtype),a=t.buffer(),s=0;s<i.size;++s){var u=i.indexToLoc(s),c=u.slice();c[n]=o[u[n]];var l=a.locToIndex(c);i.values[s]=a.values[l]}return i.toTensor()},t.prototype.batchToSpaceND=function(t,e,n){this.assertNotComplex([t],"batchToSpaceND");var r=e.reduce(function(t,e){return t*e}),o=Om(t.shape,e,r),i=Fm(o.length,e.length),a=Lm(t.shape,e,r),s=Bm(n,e.length),u=Um(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(t,e,n){this.assertNotComplex([t],"spaceToBatchND");var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=Om(a.shape,e,r,!1),u=Fm(s.length,e.length,!1),c=Lm(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(c)},t.prototype.pool=function(t,e,n){this.assertNotComplex(t,"pool");for(var r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,h="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=t.dataSync(),f=Db(e.outShape,t.dtype),d=f.values,v=e.outShape[1]*e.outShape[2]*e.outShape[3],m=e.outShape[2]*e.outShape[3],g=e.outShape[3],y=0;y<e.batchSize;++y)for(var w=y*v,b=y*t.strides[0],x=0;x<e.inChannels;++x)for(var _=0;_<e.outHeight;++_)for(var C=_*r-c,E=Math.max(0,C),S=Math.min(e.inHeight,s+C),R=w+_*m,T=0;T<e.outWidth;++T){for(var k=T*o-l,I=Math.max(0,k),N=Math.min(e.inWidth,u+k),A=h,D=0,M=0,P=E;P<S;P+=i){for(var O=b+P*t.strides[1],F=I;F<N;F+=a){var L=p[O+F*t.strides[2]+x];"max"===n&&L>A?A=L:"avg"===n&&(D+=L,M++)}if(isNaN(A))break}d[R+T*g+x]="avg"===n?D/M:A}return f.toTensor()},t.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},t.prototype.maxPoolPositions=function(t,e){for(var n=Db(e.outShape,"int32"),r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,h=0;h<e.batchSize;++h)for(var p=0;p<e.inChannels;++p)for(var f=0;f<e.outHeight;++f){for(var d=f*r-c,v=d;v<0;)v+=i;for(var m=Math.min(e.inHeight,s+d),g=0;g<e.outWidth;++g){for(var y=g*o-l,w=y;w<0;)w+=a;for(var b=Math.min(e.inWidth,u+y),x=Number.NEGATIVE_INFINITY,_=-1,C=v;C<m;C+=i)for(var E=C-d,S=w;S<b;S+=a){var R=S-y,T=t.get(h,C,S,p);T>x&&(x=T,_=E*u+R)}n.set(_,h,f,g,p)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(t,e,n,r){this.assertNotComplex([e,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(e,r),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=l-1-r.padInfo.left,p=c-1-r.padInfo.top,f=Db(e.shape,"float32"),d=0;d<r.batchSize;++d)for(var v=0;v<r.inChannels;++v)for(var m=0;m<r.inHeight;++m)for(var g=0;g<r.inWidth;++g){for(var y=m-p,w=g-h,b=0,x=0;x<c;x+=s){var _=(y+x)/i;if(!(_<0||_>=r.outHeight||Math.floor(_)!==_))for(var C=0;C<l;C+=u){var E=(w+C)/a;if(!(E<0||E>=r.outWidth||Math.floor(E)!==E)){var S=c*l-1-o.get(d,_,E,v)===x*l+C?1:0;0!==S&&(b+=t.get(d,_,E,v)*S)}}}f.set(b,d,m,g,v)}return f.toTensor()},t.prototype.avgPoolBackprop=function(t,e,n){this.assertNotComplex([t,e],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=l-1-n.padInfo.left,p=c-1-n.padInfo.top,f=Db(e.shape,"float32"),d=1/(i*a),v=0;v<n.batchSize;++v)for(var m=0;m<n.inChannels;++m)for(var g=0;g<n.inHeight;++g)for(var y=0;y<n.inWidth;++y){for(var w=g-p,b=y-h,x=0,_=0;_<c;_+=s){var C=(w+_)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var E=0;E<l;E+=u){var S=(b+E)/o;S<0||S>=n.outWidth||Math.floor(S)!==S||(x+=t.get(v,C,S,m))}}f.set(x*d,v,g,y,m)}return f.toTensor()},t.prototype.cast=function(t,e){return Sg(t,e,this)},t.prototype.reshape=function(t,e){return Rg(t,e)},t.prototype.avgPool=function(t,e){return this.assertNotComplex(t,"avgPool"),this.pool(t,e,"avg").toFloat()},t.prototype.resizeBilinear=function(t,e,n,r){this.assertNotComplex(t,"resizeBilinear");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=t.dataSync(),l=new Float32Array(Cv([i,e,n,u])),h=[r&&e>1?a-1:a,r&&n>1?s-1:s],p=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=0,d=h[0]/p[0],v=h[1]/p[1],m=0;m<i;m++)for(var g=0;g<e;g++)for(var y=d*g,w=Math.floor(y),b=y-w,x=Math.min(a-1,Math.ceil(y)),_=m*t.strides[0]+w*t.strides[1],C=m*t.strides[0]+x*t.strides[1],E=0;E<n;E++)for(var S=v*E,R=Math.floor(S),T=S-R,k=Math.min(s-1,Math.ceil(S)),I=_+R*t.strides[2],N=C+R*t.strides[2],A=_+ +k*t.strides[2],D=C+k*t.strides[2],M=0;M<u;M++){var P=c[I+M],O=c[N+M],F=P+(c[A+M]-P)*T;l[f++]=F+(O+(c[D+M]-O)*T-F)*b}return pg(l,[i,e,n,u])},t.prototype.resizeBilinearBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeBilinearBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(o*i*a*s),p=[n&&c>1?i-1:i,n&&l>1?a-1:a],f=[n&&c>1?c-1:c,n&&l>1?l-1:l],d=p[0]/f[0],v=p[1]/f[1],m=t.dataSync(),g=0,y=0;y<o;y++)for(var w=y*e.strides[0],b=0;b<c;b++)for(var x=b*d,_=Math.floor(x),C=Math.min(Math.ceil(x),i-1),E=w+_*e.strides[1],S=w+C*e.strides[1],R=x-_,T=1-R,k=0;k<l;k++)for(var I=k*v,N=Math.floor(I),A=Math.min(Math.ceil(I),a-1),D=I-N,M=1-D,P=E+N*e.strides[2],O=E+A*e.strides[2],F=S+N*e.strides[2],L=S+A*e.strides[2],B=T*M,U=T*D,V=R*M,j=R*D,z=0;z<s;z++){var W=m[g++];h[P+z]+=W*B,h[O+z]+=W*U,h[F+z]+=W*V,h[L+z]+=W*j}return gg(h,[o,a,i,s],e.dtype)},t.prototype.resizeNearestNeighbor=function(t,e,n,r){this.assertNotComplex(t,"resizeNearestNeighbor");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=t.dataSync(),l=new Float32Array(i*e*n*u),h=[r&&e>1?a-1:a,r&&n>1?s-1:s],p=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=h[0]/p[0],d=h[1]/p[1],v=0,m=0;m<i;m++)for(var g=m*t.strides[0],y=0;y<e;y++)for(var w=f*y,b=g+Math.min(a-1,r?Math.round(w):Math.floor(w))*t.strides[1],x=0;x<n;x++)for(var _=d*x,C=b+Math.min(s-1,r?Math.round(_):Math.floor(_))*t.strides[2],E=0;E<u;E++)l[v++]=c[C+E];return pg(l,[i,e,n,u],t.dtype)},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(o*i*a*s),p=t.dataSync(),f=[n&&c>1?i-1:i,n&&l>1?a-1:a],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],v=f[0]/d[0],m=f[1]/d[1],g=1/v,y=1/m,w=2*Math.ceil(g)+2,b=2*Math.ceil(y)+2,x=0;x<o;x++)for(var _=x*e.strides[0],C=0;C<i;C++)for(var E=_+C*e.strides[1],S=Math.floor(C*g),R=Math.floor(S-w/2),T=0;T<a;T++)for(var k=E+T*e.strides[2],I=Math.floor(T*y),N=Math.floor(I-b/2),A=0;A<s;A++){for(var D=0,M=0;M<w;M++){var P=M+R;if(!(P<0||P>=c)){var O=_+P*t.strides[1],F=P*v;if(C===Math.min(i-1,n?Math.round(F):Math.floor(F)))for(var L=0;L<b;L++){var B=L+N;if(!(B<0||B>=l)){var U=O+B*t.strides[2],V=B*m;T===Math.min(a-1,n?Math.round(V):Math.floor(V))&&(D+=p[U+A])}}}}h[k+A]=D}return gg(h,e.shape,e.dtype)},t.prototype.batchNormalization=function(t,e,n,r,o,i){this.assertNotComplex([t,e,n,o,i],"batchNormalization");for(var a=t.dataSync(),s=e.dataSync(),u=n.dataSync(),c=o?o.dataSync():new Float32Array([1]),l=i?i.dataSync():new Float32Array([0]),h=new Float32Array(a.length),p=l.length,f=c.length,d=u.length,v=s.length,m=0,g=0,y=0,w=0,b=0;b<a.length;++b)h[b]=l[m++]+(a[b]-s[g++])*c[y++]/Math.sqrt(u[w++]+r),m>=p&&(m=0),g>=v&&(g=0),y>=f&&(y=0),w>=d&&(w=0);return gg(h,t.shape)},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){this.assertNotComplex(t,"localResponseNormalization4D");var i=t.shape[3],a=i-1,s=t.dataSync(),u=Cv(t.shape),c=new Float32Array(u);function l(t){for(var n=t%i,r=t-n+Math.max(0,n-e),o=t-n+Math.min(n+e,a),u=0;r<=o;r++){var c=s[r];u+=c*c}return u}for(var h=0;h<u;h++){var p=l(h),f=s[h]*Math.pow(n+r*p,-o);c[h]=f}return gg(c,t.shape)},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){this.assertNotComplex(t,"LRNGrad");for(var s=t.shape[3],u=t.dataSync(),c=e.dataSync(),l=n.dataSync(),h=new Float32Array(Cv(t.shape)),p=Cv(t.shape),f=0;f<p;f++){for(var d=f%s,v=f-d+Math.max(0,d-r),m=f-d+Math.min(s,d+r+1),g=0,y=v;y<m;y++)g+=Math.pow(c[y],2);for(g=i*g+o,y=v;y<m;y++){var w=-2*i*a*c[y]*l[f]/g;f===y&&(w+=Math.pow(g,-a)),h[y]+=w*=u[f]}}return gg(h,t.shape)},t.prototype.multinomial=function(t,e,n,r){this.assertNotComplex(t,"multinomial");for(var o=e?t:sg(t),i=o.shape[0],a=o.shape[1],s=wg([i,n],"int32"),u=s.dataSync(),c=o.dataSync(),l=0;l<i;++l){var h=l*a,p=new Float32Array(a-1);p[0]=c[h];for(var f=1;f<p.length;++f)p[f]=p[f-1]+c[h+f];for(var d=Ib(r.toString()),v=l*n,m=0;m<n;++m){var g=d();u[v+m]=p.length;for(var y=0;y<p.length;y++)if(g<p[y]){u[v+m]=y;break}}}return s},t.prototype.oneHot=function(t,e,n,r){this.assertNotComplex(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(r);for(var i=0;i<t.size;++i)t.get(i)>=0&&t.get(i)<e&&(o[i*e+t.get(i)]=n);return vg(o,[t.size,e],"int32")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return this.assertNotComplex(t,"nonMaxSuppression"),Ag(t.dataSync(),e.dataSync(),n,r,o)},t.prototype.fft=function(t){return this.fftBatch(t,!1)},t.prototype.ifft=function(t){return this.fftBatch(t,!0)},t.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],o=Db(t.shape,"float32"),i=Db(t.shape,"float32"),a=lg(t).as2D(n,r),s=hg(t).as2D(n,r),u=0;u<n;u++)for(var c=a.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),h=cg(c,l),p=this.fftImpl(h,e).dataSync(),f=0;f<r;f++){var d=kg(p,f);o.values[u*r+f]=d.real,i.values[u*r+f]=d.imag}return cg(o.toTensor(),i.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(o=cg(lg(o).div(fg(r)),hg(o).div(fg(r)))),o}var i=t.dataSync(),a=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(i,r,e));return cg(a.real,a.imag).as2D(t.shape[0],t.shape[1])},t.prototype.isExponentOf2=function(t){return 0==(t&t-1)},t.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=t.dataSync(),o=e/2,i=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),a=cg(i.real,i.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),u=cg(s.real,s.imag).as1D();a=this.fftRadix2(a,o,n),u=this.fftRadix2(u,o,n);var c=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),o=0;o<Math.ceil(t/2);o++){var i=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:n,imag:r}}(e,n),l=cg(c.real,c.imag).mul(u),h=a.add(l),p=a.sub(l),f=lg(h).concat(lg(p)),d=hg(h).concat(hg(p));return cg(f,d).as1D()},t.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),o=0;o<e;o++){for(var i=0,a=0,s=0;s<e;s++){var u=Ng(o*s,e,n),c=kg(t,s);i+=c.real*u.real-c.imag*u.imag,a+=c.real*u.imag+c.imag*u.real}n&&(i/=e,a/=e),Ig(r,i,a,o)}return r},t.prototype.depthToSpace=function(t,e,n){wv("NHWC"===n,"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n),wv(e>1,"blockSize should be > 1 for depthToSpace, but was: "+e);for(var r=t.shape[0],o=t.shape[1],i=t.shape[2],a=t.shape[3],s=o*e,u=i*e,c=a/(e*e),l=t.dataSync(),h=new Float32Array(r*s*u*c),p=0,f=0;f<r;++f)for(var d=0;d<s;++d)for(var v=Math.floor(d/e),m=d%e,g=0;g<u;++g)for(var y=Math.floor(g/e),w=(m*e+g%e)*c,b=0;b<c;++b)h[p++]=l[b+w+a*(y+i*(v+o*f))];return gg(h,[r,s,u,c])},t.prototype.broadcastedBinaryOp=function(t,e,n,r){var o=Ug(t.shape,e.shape),i=Db(o,n),a=t.dataSync(),s=e.dataSync(),u=Lg(t.shape,o),c=Lg(e.shape,o),l=i.values;if(u.length+c.length===0)for(var h=0;h<l.length;++h)l[h]=r(a[h%a.length],s[h%s.length]);else{var p=t.buffer(),f=e.buffer(),d=function(n){var o=i.indexToLoc(n),h=o.slice(-t.rank);u.forEach(function(t){return h[t]=0});var d=p.locToIndex(h),v=o.slice(-e.rank);c.forEach(function(t){return v[t]=0});var m=f.locToIndex(v);l[n]=r(a[d],s[m])};for(h=0;h<l.length;++h)d(h)}return i.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=Ug(t.shape,e.shape),o=Db(r,"float32"),i=Db(r,"float32"),a=t.dataSync(),s=e.dataSync(),u=Lg(t.shape,r),c=Lg(e.shape,r),l=o.values,h=i.values;if(u.length+c.length===0)for(var p=0;p<l.length;p++){var f=p%a.length,d=p%s.length,v=n(a[2*f],a[2*f+1],s[2*d],s[2*d+1]);l[p]=v.real,h[p]=v.imag}else{var m=this.data.get(t.dataId).complexTensors.real.buffer(),g=this.data.get(e.dataId).complexTensors.real.buffer(),y=function(r){var i=o.indexToLoc(r),p=i.slice(-t.rank);u.forEach(function(t){return p[t]=0});var f=m.locToIndex(p),d=i.slice(-e.rank);c.forEach(function(t){return d[t]=0});var v=g.locToIndex(d),y=n(a[2*f],a[2*f+1],s[2*v],s[2*v+1]);l[r]=y.real,h[r]=y.imag};for(p=0;p<l.length;p++)y(p)}return this.complex(o.toTensor(),i.toTensor())},t.prototype.split=function(t,e,n){return Mg(t,e,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.cropAndResize=function(t,e,n,r,o,i){for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],h=e.shape[0],p=r[0],f=r[1],d=Db([h,p,f,l],t.dtype),v=e.dataSync(),m=n.dataSync(),g=t.dataSync(),y=t.strides,w=d.strides,b=0;b<h;b++){var x=4*b,_=v[x],C=v[x+1],E=v[x+2],S=v[x+3],R=m[b];if(!(R>=s))for(var T=p>1?(E-_)*(u-1)/(p-1):0,k=f>1?(S-C)*(c-1)/(f-1):0,I=0;I<p;I++){var N=p>1?_*(u-1)+I*T:.5*(_+E)*(u-1);if(N<0||N>u-1)for(var A=0;A<f;A++)for(var D=0;D<l;D++){var M=D+A*w[2]+I*w[1]+b*w[0];d.values[M]=i}else if("bilinear"===o){var P=Math.floor(N),O=Math.ceil(N),F=N-P;for(A=0;A<f;A++)if((G=f>1?C*(c-1)+A*k:.5*(C+S)*(c-1))<0||G>c-1)for(D=0;D<l;D++)d.values[M=D+A*w[2]+I*w[1]+b*w[0]]=i;else{var L=Math.floor(G),B=Math.ceil(G),U=G-L;for(D=0;D<l;D++){var V=g[M=D+L*y[2]+P*y[1]+R*y[0]],j=g[M=D+B*y[2]+P*y[1]+R*y[0]],z=g[M=D+L*y[2]+O*y[1]+R*y[0]],W=V+(j-V)*U,H=z+(g[M=D+B*y[2]+O*y[1]+R*y[0]]-z)*U;d.values[M=D+A*w[2]+I*w[1]+b*w[0]]=W+(H-W)*F}}}else for(A=0;A<f;++A){var G;if((G=f>1?C*(c-1)+A*k:.5*(C+S)*(c-1))<0||G>c-1)for(D=0;D<l;D++)d.values[M=D+A*w[2]+I*w[1]+b*w[0]]=i;else{var q=Math.round(G),$=Math.round(N);for(D=0;D<l;D++)d.values[D+A*w[2]+I*w[1]+b*w[0]]=g[D+q*y[2]+$*y[1]+R*y[0]]}}}}return d.toTensor()},t.prototype.sparseToDense=function(t,e,n,r){var o=Zm(0,t,n);return this.scatter(t,e,n,o.outputSize,o.sliceSize,o.numUpdates,o.sliceRank,o.strides,r,!1)},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=Xm(t,e),i=o[0],a=o[1],s=o[2],u=o[3];if(0===a)return pg([],i,t.dtype);for(var c=new nm([a,s],t.dtype),l=e.dataSync(),h=t.dataSync(),p=0;p<a;p++){for(var f=[],d=0,v=0;v<r;v++){var m=l[p*r+v];d+=m*u[v],f.push(m)}if(d<0||d>=t.size/s)throw new Error("Invalid indices: "+f+" does not index into "+t.shape);for(var g=0;g<s;g++)c.values[p*s+g]=h[d*s+g]}return c.toTensor().reshape(i)},t.prototype.scatterND=function(t,e,n){var r=Zm(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=fg(0);return this.scatter(t,e,n,u,a,i,o,s,c,!0)},t.prototype.scatter=function(t,e,n,r,o,i,a,s,u,c){var l=[r/o,o],h=t.dataSync(),p=e.dataSync();if(0===r)return pg([],n,e.dtype);var f=new nm(l,e.dtype);f.values.fill(u.dataSync()[0]);for(var d=0;d<i;d++){for(var v=[],m=0,g=0;g<a;g++){var y=h[d*a+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var w=0;w<o;w++)c?f.values[m*o+w]+=p[d*o+w]:f.values[m*o+w]=0===e.rank?p[0]:p[d*o+w]}return f.toTensor().reshape(n)},t}();Im.registerBackend("cpu",function(){return new mE},1,im),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:setImmediate;var gE={float32:4,int32:4,uint16:2,uint8:1,bool:1};function yE(t,e){for(var n={},r=0,o=function(e){var o=e.name,i=e.dtype,a=e.shape,s=Cv(a),u=void 0;if("quantization"in e){var c=e.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=gE[c.dtype],h=t.slice(r,r+s*l),p="uint8"===c.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===i)u=Float32Array.from(p,function(t){return t*c.scale+c.min});else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=Int32Array.from(p,function(t){return Math.round(t*c.scale+c.min)})}r+=s*l}else{var f=gE[i];if(h=t.slice(r,r+s*f),"float32"===i)u=new Float32Array(h);else if("int32"===i)u=new Int32Array(h);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=new Uint8Array(h)}r+=s*f}var d=void 0;if("float32"===i)d=pg(u,a,"float32");else if("int32"===i)d=pg(u,a,"int32");else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);d=pg(u,a,"bool")}n[o]=d},i=0,a=e;i<a.length;i++)o(a[i]);return n}function wE(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});var r=new Uint8Array(e),o=0;return n.forEach(function(t){r.set(new Uint8Array(t.buffer),o),o+=t.byteLength}),r.buffer}var bE="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function xE(t){return bE?Buffer.byteLength(t):new Blob([t]).size}function _E(t){var e=0;t.forEach(function(t){e+=t.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function CE(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function EE(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:xE(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:xE(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var SE=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e){return t.getHandlers(e,"load")},t.getHandlers=function(t,e){var n=[];return("load"===e?this.getInstance().loadRouters:this.getInstance().saveRouters).forEach(function(e){var r=e(t);null!==r&&n.push(r)}),n},t}(),RE="://",TE=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){wv(null!=e,"scheme must not be undefined or null."),e.endsWith(RE)&&(e=e.slice(0,e.indexOf(RE))),wv(e.length>0,"scheme must not be an empty string.");var r=t.getInstance();wv(null==r.managers[e],"A model store manager is already registered for scheme '"+e+"'."),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function kE(t){if(-1===t.indexOf(RE))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+TE.getSchemes().join(","));return{scheme:t.split(RE)[0],path:t.split(RE)[1]}}function IE(t,e,n){return void 0===n&&(n=!1),cv(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,h;return lv(this,function(p){switch(p.label){case 0:return wv(t!==e,"Old path and new path are the same: '"+t+"'"),wv((r=SE.getLoadHandlers(t)).length>0,"Copying failed because no load handler is found for source URL "+t+"."),wv(r.length<2,"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."),o=r[0],wv((i=SE.getSaveHandlers(e)).length>0,"Copying failed because no save handler is found for destination URL "+e+"."),wv(i.length<2,"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."),a=i[0],s=kE(t).scheme,u=kE(t).path,c=s===kE(t).scheme,[4,o.load()];case 1:return l=p.sent(),n&&c?[4,TE.getManager(s).removeModel(u)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[4,a.save(l)];case 4:return h=p.sent(),!n||c?[3,6]:[4,TE.getManager(s).removeModel(u)];case 5:p.sent(),p.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var NE="models_store",AE="model_info_store";function DE(){if(!Im.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ME(t){var e=t.result;e.createObjectStore(NE,{keyPath:"modelPath"}),e.createObjectStore(AE,{keyPath:"modelPath"})}var PE=function(){function t(t){if(this.indexedDB=DE(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return cv(this,void 0,void 0,function(){return lv(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return cv(this,void 0,void 0,function(){return lv(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(t,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return ME(o)},o.onsuccess=function(){var i=o.result;if(null==e){var a=i.transaction(NE,"readonly"),s=a.objectStore(NE).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return i.close(),r(s.error)},a.oncomplete=function(){return i.close()}}else{var u,c=EE(e),l=i.transaction(AE,"readwrite"),h=l.objectStore(AE),p=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});p.onsuccess=function(){var o=(u=i.transaction(NE,"readwrite")).objectStore(NE).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:c});o.onsuccess=function(){return t({modelArtifactsInfo:c})},o.onerror=function(t){var e=(h=l.objectStore(AE)).delete(n.modelPath);e.onsuccess=function(){return i.close(),r(o.error)},e.onerror=function(t){return i.close(),r(o.error)}}},p.onerror=function(t){return i.close(),r(p.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},o.onerror=function(t){return r(o.error)}})},t.URL_SCHEME="indexeddb://",t}(),OE=function(t){return Im.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(PE.URL_SCHEME)?function(t){return new PE(t)}(t.slice(PE.URL_SCHEME.length)):null};SE.registerSaveRouter(OE),SE.registerLoadRouter(OE);var FE=function(){function t(){this.indexedDB=DE()}return t.prototype.listModels=function(){return cv(this,void 0,void 0,function(){var t=this;return lv(this,function(e){return[2,new Promise(function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return ME(r)},r.onsuccess=function(){var t=r.result,o=t.transaction(AE,"readonly"),i=o.objectStore(AE).getAll();i.onsuccess=function(){for(var t={},n=0,r=i.result;n<r.length;n++){var o=r[n];t[o.modelPath]=o.modelArtifactsInfo}e(t)},i.onerror=function(e){return t.close(),n(i.error)},o.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}})]})})},t.prototype.removeModel=function(t){return cv(this,void 0,void 0,function(){var e=this;return lv(this,function(n){return t=function(t){return t.startsWith(PE.URL_SCHEME)?t.slice(PE.URL_SCHEME.length):t}(t),[2,new Promise(function(n,r){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return ME(o)},o.onsuccess=function(){var e,i=o.result,a=i.transaction(AE,"readwrite"),s=a.objectStore(AE),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var o=s.delete(t),a=function(){var o=(e=i.transaction(NE,"readwrite")).objectStore(NE).delete(t);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(t){return r(u.error)}};o.onsuccess=a,o.onerror=function(t){return a(),i.close(),r(u.error)}},u.onerror=function(t){return i.close(),r(u.error)},a.oncomplete=function(){null==e?i.close():e.oncomplete=function(){return i.close()}}},o.onerror=function(t){return r(o.error)}})]})})},t}();if(Im.get("IS_BROWSER"))try{TE.registerManager(PE.URL_SCHEME,new FE)}catch(pm){}var LE="/",BE="tensorflowjs_models",UE="info",VE="model_topology",jE="weight_specs",zE="weight_data";function WE(t){return{info:[BE,t,UE].join(LE),topology:[BE,t,VE].join(LE),weightSpecs:[BE,t,jE].join(LE),weightData:[BE,t,zE].join(LE)}}function HE(t){var e=t.split(LE);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(LE)}var GE=function(){function t(t){if(!Im.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=WE(this.modelPath)}return t.prototype.save=function(t){return cv(this,void 0,void 0,function(){var e,n,r,o;return lv(this,function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=EE(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){return bE?Buffer.from(t).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(t)))}(t.weightData)),[2,{modelArtifactsInfo:r}]}catch(t){for(o in this.keys)this.LS.removeItem(this.keys[o]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return cv(this,void 0,void 0,function(){var t,e,n,r,o;return lv(this,function(i){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(bE){var e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(o),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),qE=function(t){return Im.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(GE.URL_SCHEME)?function(t){return new GE(t)}(t.slice(GE.URL_SCHEME.length)):null};SE.registerSaveRouter(qE),SE.registerLoadRouter(qE);var $E=function(){function t(){wv(Im.get("IS_BROWSER"),"Current environment is not a web browser"),wv(void 0!==window.localStorage,"Current browser does not appear to support localStorage"),this.LS=window.localStorage}return t.prototype.listModels=function(){return cv(this,void 0,void 0,function(){var t,e,n,r,o,i;return lv(this,function(a){for(t={},e=BE+LE,n=LE+UE,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(e)&&o.endsWith(n)&&(i=HE(o),t[i]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},t.prototype.removeModel=function(t){return cv(this,void 0,void 0,function(){var e,n;return lv(this,function(r){if(t=function(t){return t.startsWith(GE.URL_SCHEME)?t.slice(GE.URL_SCHEME.length):t}(t),e=WE(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},t}();if(Im.get("IS_BROWSER"))try{TE.registerManager(GE.URL_SCHEME,new $E)}catch(pm){}var KE="model",XE=".json",QE=".weights.bin",YE=function(){function t(e){if(!Im.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e=KE),this.modelTopologyFileName=e+XE,this.weightDataFileName=e+QE}return t.prototype.save=function(t){return cv(this,void 0,void 0,function(){var e,n,r,o;return lv(this,function(i){if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return n=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,r.href=n,r.click(),null!=t.weightData&&((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=e,o.click()),[2,{modelArtifactsInfo:EE(t)}]})})},t.URL_SCHEME="downloads://",t}(),ZE=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return cv(this,void 0,void 0,function(){var t,e,n=this;return lv(this,function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(r,o){var i=new FileReader;i.onload=function(i){var a=JSON.parse(i.target.result),s=a.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,e)}catch(t){return void o(t)}var l=[],h=[],p=[];u.forEach(function(t){t.paths.forEach(function(t){h.push(t),p.push(null)}),l.push.apply(l,t.weights)}),u.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,o=h.indexOf(t);p[o]=n,-1===p.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:_E(p)})},e.onerror=function(e){return o("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(c[t])})})}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},i.onerror=function(e){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map(function(t){return CE(t.name)}),o={},i=0,a=t;i<a.length;i++)a[i].paths.forEach(function(t){var i=CE(t);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");o[t]=e[r.indexOf(i)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return o},t}();function JE(t,e,n){return cv(this,void 0,void 0,function(){var r,o;return lv(this,function(i){switch(i.label){case 0:return null==n&&(n=fetch),r=t.map(function(t){return n(t,e)}),[4,Promise.all(r)];case 1:return o=i.sent(),[4,Promise.all(o.map(function(t){return t.arrayBuffer()}))];case 2:return[2,i.sent()]}})})}function tS(t){var e=this;return function(n,r,o){return void 0===r&&(r=""),cv(e,void 0,void 0,function(){var e,i,a,s,u,c,l,h,p,f;return lv(this,function(d){switch(d.label){case 0:if(e=n.map(function(){return!1}),i={},a=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(t,n){var r=0;t.weights.forEach(function(t){var u=gE["quantization"in t?t.quantization.dtype:t.dtype]*Cv(t.shape),c=function(){e[n]=!0,null==i[n]&&(i[n]=[]),i[n].push({manifestEntry:t,groupOffset:r,sizeBytes:u})};null!=o?o.forEach(function(e,n){e===t.name&&(c(),a[n]=!0)}):c(),s.push(t.name),r+=u})}),!a.every(function(t){return t}))throw u=o.filter(function(t,e){return!a[e]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return c=e.reduce(function(t,e,n){return e&&t.push(n),t},[]),l=[],c.forEach(function(t){n[t].paths.forEach(function(t){var e=r+(r.endsWith("/")?"":"/")+t;l.push(e)})}),[4,t(l)];case 1:return h=d.sent(),p={},f=0,c.forEach(function(t){for(var e=n[t].paths.length,r=0,o=0;o<e;o++)r+=h[f+o].byteLength;for(var a=new ArrayBuffer(r),s=new Uint8Array(a),u=0,c=0;c<e;c++){var l=new Uint8Array(h[f+c]);s.set(l,u),u+=l.byteLength}i[t].forEach(function(t){var e=yE(a.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)p[n]=e[n]}),f+=e}),[2,p]}})})}}SE.registerSaveRouter(function(t){return Im.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(YE.URL_SCHEME)?function(t){return void 0===t&&(t="model"),new YE(t)}(t.slice(YE.URL_SCHEME.length)):null});var eS=function(){function t(t,e,n,r){if(this.weightPathPrefix=n,this.DEFAULT_METHOD="POST",null==r){if("undefined"==typeof fetch)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");this.fetchFunc=fetch.bind("undefined"==typeof window?null:window)}else wv("function"==typeof r,"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetchFunc=r;if(wv(null!=t&&t.length>0,"URL path for browserHTTPRequest must not be null, undefined or empty."),Array.isArray(t)&&wv(2===t.length,"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+t.length+")."),this.path=t,null!=e&&null!=e.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e||{}}return t.prototype.save=function(t){return cv(this,void 0,void 0,function(){var e,n;return lv(this,function(r){switch(r.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,e)];case 1:if((n=r.sent()).ok)return[2,{modelArtifactsInfo:EE(t),responses:[n]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}})})},t.prototype.load=function(){return cv(this,void 0,void 0,function(){return lv(this,function(t){return[2,Array.isArray(this.path)?this.loadBinaryModel():this.loadJSONModel()]})})},t.prototype.loadBinaryTopology=function(){return cv(this,void 0,void 0,function(){var t,e;return lv(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this.getFetchFunc()(this.path[0],this.requestInit)];case 1:if(!(t=n.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+t.statusText);return[4,t.arrayBuffer()];case 2:return[2,n.sent()];case 3:throw e=n.sent(),new Error(this.path[0]+" not found. "+e);case 4:return[2]}})})},t.prototype.loadBinaryModel=function(){return cv(this,void 0,void 0,function(){var t,e,n,r,o,i,a,s;return lv(this,function(u){switch(u.label){case 0:return t=this.loadBinaryTopology(),[4,this.getFetchFunc()(this.path[1],this.requestInit)];case 1:if(!(e=u.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+e.statusText);return[4,Promise.all([t,e])];case 2:return n=u.sent(),r=n[0],[4,n[1].json()];case 3:return null==(o=u.sent())?[3,5]:[4,this.loadWeights(o)];case 4:s=u.sent(),i=s[0],a=s[1],u.label=5;case 5:return[2,{modelTopology:r,weightSpecs:i,weightData:a}]}})})},t.prototype.loadJSONModel=function(){return cv(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return lv(this,function(s){switch(s.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(t=s.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+t.statusText);return[4,t.json()];case 2:if(e=s.sent(),r=e.weightsManifest,null==(n=e.modelTopology)&&null==r)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==r?[3,4]:[4,this.loadWeights(e.weightsManifest)];case 3:a=s.sent(),o=a[0],i=a[1],s.label=4;case 4:return[2,{modelTopology:n,weightSpecs:o,weightData:i}]}})})},t.prototype.loadWeights=function(t){return cv(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,c,l,h;return lv(this,function(p){switch(p.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),r=n[0],o=n[1],i=this.weightPathPrefix||r,a=[],s=0,u=t;s<u.length;s++)a.push.apply(a,u[s].weights);return c=[],t.forEach(function(t){t.paths.forEach(function(t){c.push(i+t+o)})}),l=[a],h=_E,[4,JE(c,this.requestInit,this.getFetchFunc())];case 1:return[2,l.concat([h.apply(void 0,[p.sent()])])]}})})},t.prototype.getFetchFunc=function(){return this.fetchFunc},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function nS(t){return null!=t.match(eS.URL_SCHEME_REGEX)}var rS=function(t){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every(function(t){return nS(t)}):nS(t))?oS(t):null};function oS(t,e,n,r){return new eS(t,e,n,r)}SE.registerSaveRouter(rS),SE.registerLoadRouter(rS);var iS=function(){function t(t,e,n){this.modelTopology=t,this.weightSpecs=e,this.weightData=n}return t.prototype.load=function(){return cv(this,void 0,void 0,function(){var t;return lv(this,function(e){return t={},null!=this.modelTopology&&(t=uv({modelTopology:this.modelTopology},t)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(t=uv({weightSpecs:this.weightSpecs},t)),null!=this.weightData&&this.weightData.byteLength>0&&(t=uv({weightData:this.weightData},t)),[2,t]})})},t}(),aS=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return cv(this,void 0,void 0,function(){return lv(this,function(e){return[2,this.saveHandler(t)]})})},t}(),sS=Object.freeze({browserFiles:function(t){return new ZE(t)},browserHTTPRequest:oS,concatenateArrayBuffers:_E,decodeWeights:yE,encodeWeights:function(t){return cv(this,void 0,void 0,function(){var e,n,r,o;return lv(this,function(i){switch(i.label){case 0:for(r in e=[],n=[],t){if("float32"!==(o=t[r]).dtype&&"int32"!==o.dtype&&"bool"!==o.dtype)throw new Error("Unsupported dtype in weight '"+r+"': "+o.dtype);e.push({name:r,shape:o.shape,dtype:o.dtype}),n.push(o.data())}return[4,Promise.all(n)];case 1:return[2,{data:wE(i.sent()),specs:e}]}})})},fromMemory:function(t,e,n){return new iS(t,e,n)},getLoadHandlers:SE.getLoadHandlers,getModelArtifactsInfoForJSON:EE,getSaveHandlers:SE.getSaveHandlers,isHTTPScheme:nS,loadWeights:function(t,e,n,r){return void 0===e&&(e=""),cv(this,void 0,void 0,function(){return lv(this,function(o){return[2,tS(function(t){return JE(t,r)})(t,e,n)]})})},registerLoadRouter:SE.registerLoadRouter,registerSaveRouter:SE.registerSaveRouter,weightsLoaderFactory:tS,withSaveHandler:function(t){return new aS(t)},copyModel:function(t,e){return cv(this,void 0,void 0,function(){return lv(this,function(n){switch(n.label){case 0:return[4,IE(t,e,!1)];case 1:return[2,n.sent()]}})})},listModels:function(){return cv(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return lv(this,function(s){switch(s.label){case 0:t=TE.getSchemes(),e={},n=0,r=t,s.label=1;case 1:return n<r.length?[4,TE.getManager(o=r[n]).listModels()]:[3,4];case 2:for(a in i=s.sent())e[o+RE+a]=i[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return cv(this,void 0,void 0,function(){return lv(this,function(n){switch(n.label){case 0:return[4,IE(t,e,!0)];case 1:return[2,n.sent()]}})})},removeModel:function(t){return cv(this,void 0,void 0,function(){var e;return lv(this,function(n){switch(n.label){case 0:return e=kE(t),[4,TE.getManager(e.scheme).removeModel(e.path)];case 1:return[2,n.sent()]}})})}}),uS=ag({confusionMatrix_:function(t,e,n){var r=og(t,"labels","confusionMatrix"),o=og(e,"predictions","confusionMatrix");wv(null==n||n>0&&Number.isInteger(n),"If provided, numClasses must be a positive integer, but got "+n),wv(1===r.rank,"Expected the rank of labels to be 1, but got "+r.rank),wv(1===o.rank,"Expected the rank of predictions to be 1, but got "+o.rank),wv(r.shape[0]===o.shape[0],"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."),wv(n>0&&Number.isInteger(n),"numClasses is required to be a positive integer, but got "+n);var i=zb(r.asType("int32"),n),a=zb(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}}),cS=(Object.freeze({confusionMatrix:uS}),function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}()),lS=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function hS(t){wv(null!=t.className,"Class being registered does not have the static className property defined."),wv("string"==typeof t.className,"className is required to be a string, but got type "+typeof t.className),wv(t.className.length>0,"Class being registered has an empty-string as its className, which is disallowed."),lS.register(t)}function pS(t,e,n){return null==n&&(n=Im.get("TEST_EPSILON")),fS(t,e,function(t,e){return dS(t,Number(e),n)})}function fS(t,e,n){if(t instanceof am||e instanceof am){if(t instanceof am&&e instanceof am){if(t.dtype!==e.dtype)throw new Error("Arrays are of different type actual: "+t.dtype+" vs expected: "+e.dtype+".");if(!Ev(t.shape,e.shape))throw new Error("Arrays are of different shape actual: "+t.shape+" vs expected: "+e.shape+".")}}else{var r=t.constructor.name,o=e.constructor.name;if(r!==o)throw new Error("Arrays are of different type actual: "+r+" vs expected: "+o)}var i,a;if(i=t instanceof am?t.dataSync():t,a=e instanceof am?e.dataSync():e,i.length!==a.length)throw new Error("Arrays have different lengths actual: "+i.length+" vs expected: "+a.length+".\nActual:   "+i+".\nExpected: "+a+".");for(var s=0;s<a.length;++s){var u=i[s],c=a[s];if(!n(u,c))throw new Error("Arrays differ: actual["+s+"] = "+u+", expected["+s+"] = "+c+".\nActual:   "+i+".\nExpected: "+a+".")}}function dS(t,e,n){return!(!isNaN(t)||!isNaN(e))||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}Object.freeze({Serializable:cS,SerializationMap:lS,registerClass:hS}),Object.freeze({WEBGL_ENVS:{HAS_WEBGL:!0},NODE_ENVS:{IS_NODE:!0},CHROME_ENVS:{IS_CHROME:!0},BROWSER_ENVS:{IS_BROWSER:!0},CPU_ENVS:{HAS_WEBGL:!1},ALL_ENVS:{},expectArraysClose:pS,expectPromiseToFail:function(t,e){t().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(t,e){return t instanceof am&&"string"===t.dtype||e instanceof am&&"string"===e.dtype||t instanceof Array&&Vv(t[0])||e instanceof Array&&Vv(e[0])?fS(t,e,function(t,e){return t==e}):pS(t,e,0)},expectNumbersClose:function(t,e,n){if(null==n&&(n=Im.get("TEST_EPSILON")),!dS(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){var r;r=t instanceof am?t.dataSync():t;for(var o=0;o<r.length;o++)if(r[o]<e||r[o]>n)throw new Error("Value out of range:"+r[o]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),Object.freeze({gpgpu_util:Ow,webgl_util:fw,MathBackendWebGL:ax,GPGPUContext:Fw});var vS=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return sv(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),o=r.value,i=r.grads;return this.applyGradients(i),Object.keys(i).forEach(function(t){return i[t].dispose()}),e?o:(o.dispose(),null)},e.prototype.computeGradients=function(t,e){return function(t,e){if(wv(Hv(t),"The f passed in variableGrads(f) must be a function"),wv(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof fm}),"The varList passed in variableGrads(f, varList) must be an array of variables"),null==e)for(var n in e=[],Im.engine.registeredVariables)e.push(Im.engine.registeredVariables[n]);var r=e.length;wv((e=e.filter(function(t){return t.trainable})).length>0,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable.");var o=Im.engine.gradients(t,e,null,!0),i=o.value,a=o.grads;wv(a.some(function(t){return null!=t}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),wv(0===i.rank,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+i.rank+" tensor");var s={};return e.forEach(function(t,e){null!=a[e]&&(s[t.name]=a[e])}),{value:i,grads:s}}(t,e)},e}(cS),mS=function(t){function e(e,n,r){void 0===r&&(r=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=n,o.epsilon=r,o.accumulatedGrads={},o.accumulatedUpdates={},o.c=Dm(fg(-e)),o.rhoScalar=Dm(fg(n)),o.oneMinusRho=Dm(fg(1-n)),null===r&&(r=Im.get("EPSILON")),o.epsilonScalar=Dm(fg(r)),o}return sv(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var o=Im.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&Am(function(){e.accumulatedGrads[n]=Cg(o).variable(!1)}),null==r.accumulatedUpdates[n]&&Am(function(){e.accumulatedUpdates[n]=Cg(o).variable(!1)});var i=t[n],a=r.accumulatedGrads[n],s=r.accumulatedUpdates[n];Am(function(){var t=e.rhoScalar.mul(a).add(e.oneMinusRho.mul(i.square())),r=s.add(e.epsilonScalar).sqrt().div(a.add(e.epsilonScalar).sqrt()).mul(i),u=e.rhoScalar.mul(s).add(e.oneMinusRho.mul(r.square()));e.accumulatedGrads[n].assign(t),e.accumulatedUpdates[n].assign(u);var c=e.c.mul(r).add(o);o.assign(c)})},r=this;for(var o in t)n(o)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(e){return t.accumulatedUpdates[e].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="AdadeltaOptimizer",e}(vS);hS(mS);var gS=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads={},r.c=Dm(fg(-e)),r.epsilon=Dm(fg(Im.get("EPSILON"))),r}return sv(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var o=Im.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&Am(function(){e.accumulatedGrads[n]=bg(o.shape,e.initialAccumulatorValue).variable(!1)});var i=t[n],a=r.accumulatedGrads[n];Am(function(){var t=a.add(i.square());e.accumulatedGrads[n].assign(t);var r=e.c.mul(i.div(t.add(e.epsilon).sqrt())).add(o);o.assign(r)})},r=this;for(var o in t)n(o)},e.prototype.dispose=function(){var t=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="AdagradOptimizer",e}(vS);hS(gS);var yS=function(t){function e(e,n,r,o){void 0===o&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=r,i.epsilon=o,i.accumulatedFirstMoment={},i.accumulatedSecondMoment={},i.c=Dm(fg(-e)),i.beta1Scalar=Dm(fg(n)),i.beta2Scalar=Dm(fg(r)),Am(function(){i.accBeta1=fg(n).variable(),i.accBeta2=fg(r).variable()}),i.oneMinusBeta1=Dm(fg(1-n)),i.oneMinusBeta2=Dm(fg(1-r)),i.one=Dm(fg(1)),null===o&&(o=Im.get("EPSILON")),i.epsScalar=Dm(fg(o)),i}return sv(e,t),e.prototype.applyGradients=function(t){var e=this;Am(function(){var n=e.one.sub(e.accBeta1),r=e.one.sub(e.accBeta2);for(var o in t){var i=Im.engine.registeredVariables[o];if(null==e.accumulatedFirstMoment[o]){var a=!1;e.accumulatedFirstMoment[o]=Cg(i).variable(a)}null==e.accumulatedSecondMoment[o]&&(a=!1,e.accumulatedSecondMoment[o]=Cg(i).variable(a));var s=t[o],u=e.accumulatedSecondMoment[o],c=e.beta1Scalar.mul(e.accumulatedFirstMoment[o]).add(e.oneMinusBeta1.mul(s)),l=e.beta2Scalar.mul(u).add(e.oneMinusBeta2.mul(s.square())),h=c.div(n),p=l.div(r);e.accumulatedFirstMoment[o].assign(c),e.accumulatedSecondMoment[o].assign(l);var f=e.c.mul(h.div(e.epsScalar.add(p.sqrt()))).add(i);i.assign(f)}e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar)),e.accBeta2.assign(e.accBeta2.mul(e.beta2Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(e){return t.accumulatedSecondMoment[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="AdamOptimizer",e}(vS);hS(yS);var wS=function(t){function e(e,n,r,o,i){void 0===o&&(o=null),void 0===i&&(i=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=o,a.decay=i,a.accumulatedFirstMoment={},a.accumulatedWeightedInfNorm={},a.c=Dm(fg(-e)),a.beta1Scalar=Dm(fg(n)),a.beta2Scalar=Dm(fg(r)),a.decayScalar=Dm(fg(i)),Am(function(){a.iteration=fg(0).variable(),a.accBeta1=fg(n).variable()}),a.oneMinusBeta1=Dm(fg(1-n)),a.one=Dm(fg(1)),null===o&&(o=Im.get("EPSILON")),a.epsScalar=Dm(fg(o)),a}return sv(e,t),e.prototype.applyGradients=function(t){var e=this;Am(function(){var n=e.one.sub(e.accBeta1),r=e.c.div(e.one.add(e.decayScalar.mul(e.iteration)));for(var o in t){var i=Im.engine.registeredVariables[o];if(null==e.accumulatedFirstMoment[o]){var a=!1;e.accumulatedFirstMoment[o]=Cg(i).variable(a)}null==e.accumulatedWeightedInfNorm[o]&&(a=!1,e.accumulatedWeightedInfNorm[o]=Cg(i).variable(a));var s=t[o],u=e.accumulatedWeightedInfNorm[o],c=e.beta1Scalar.mul(e.accumulatedFirstMoment[o]).add(e.oneMinusBeta1.mul(s)),l=e.beta2Scalar.mul(u),h=s.abs(),p=l.maximum(h);e.accumulatedFirstMoment[o].assign(c),e.accumulatedWeightedInfNorm[o].assign(p);var f=r.div(n).mul(c.div(e.epsScalar.add(p))).add(i);i.assign(f)}e.iteration.assign(e.iteration.add(e.one)),e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(e){return t.accumulatedWeightedInfNorm[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="AdamaxOptimizer",e}(vS);hS(wS);var bS=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return sv(e,t),e.prototype.applyGradients=function(t){var e=this;Object.keys(t).forEach(function(n){var r=t[n],o=Im.engine.registeredVariables[n];Am(function(){var t=e.c.mul(r).add(o);o.assign(t)})})},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=Dm(fg(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGDOptimizer",e}(vS);hS(bS);var xS=function(t){function e(e,n,r){void 0===r&&(r=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=r,o.m=fg(o.momentum),o.accumulations={},o}return sv(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var o=Im.engine.registeredVariables[n];null==r.accumulations[n]&&Am(function(){e.accumulations[n]=Cg(o).variable(!1)});var i=r.accumulations[n],a=t[n];Am(function(){var t,r=e.m.mul(i).add(a);t=e.useNesterov?e.c.mul(a.add(r.mul(e.m))).add(o):e.c.mul(r).add(o),e.accumulations[n].assign(r),o.assign(t)})},r=this;for(var o in t)n(o)},e.prototype.dispose=function(){if(t.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var e in this.accumulations)this.accumulations[e].dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="MomentumOptimizer",e}(bS);hS(xS);var _S=function(t){function e(e,n,r,o,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1);var a=t.call(this)||this;return a.learningRate=e,a.decay=n,a.momentum=r,a.epsilon=o,a.accumulatedMeanSquares={},a.accumulatedMeanGrads={},a.accumulatedMoments={},a.c=Dm(fg(e)),a.decayScalar=Dm(fg(n)),a.momentumScalar=Dm(fg(r)),a.oneMinusDecay=Dm(fg(1-n)),a.centered=i,null===o&&(o=Im.get("EPSILON")),a.epsilonScalar=Dm(fg(o)),a}return sv(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var o=Im.engine.registeredVariables[n];null==r.accumulatedMeanSquares[n]&&Am(function(){e.accumulatedMeanSquares[n]=Cg(o).variable(!1)}),null==r.accumulatedMeanGrads[n]&&r.centered&&Am(function(){e.accumulatedMeanGrads[n]=Cg(o).variable(!1)}),null==r.accumulatedMoments[n]&&Am(function(){e.accumulatedMoments[n]=Cg(o).variable(!1)});var i=r.accumulatedMeanSquares[n],a=r.accumulatedMeanGrads[n],s=r.accumulatedMoments[n],u=t[n];Am(function(){var t=e.decayScalar.mul(i).add(e.oneMinusDecay.mul(u.square()));if(e.centered){var r=e.decayScalar.mul(a).add(e.oneMinusDecay.mul(u)),c=e.momentumScalar.mul(s).add(e.c.mul(u).div(t.sub(r.square().add(e.epsilonScalar)).sqrt()));e.accumulatedMeanSquares[n].assign(t),e.accumulatedMeanGrads[n].assign(r),e.accumulatedMoments[n].assign(c);var l=o.sub(c);o.assign(l)}else{var h=e.decayScalar.mul(i).add(e.oneMinusDecay.mul(u.square()));c=e.momentumScalar.mul(s).add(e.c.mul(u).div(h.add(e.epsilonScalar).sqrt())),e.accumulatedMeanSquares[n].assign(h),e.accumulatedMoments[n].assign(c),l=o.sub(c),o.assign(l)}})},r=this;for(var o in t)n(o)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(e){return t.accumulatedMeanSquares[e].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(e){return t.accumulatedMeanGrads[e].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(e){return t.accumulatedMoments[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSPropOptimizer",e}(vS);function CS(t,e,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Am(function(){var o=Z_(s_(t,e.filters,[1,1],n),e.bias);return r?TC(o):o})}function ES(t,e){Object.keys(t).forEach(function(n){e.some(function(t){return t.originalPath===n})||t[n].dispose()})}function SS(t,e){return function(n,r,o,i){var a=gg(t(n*r*o*o),[o,o,n,r]),s=dg(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function RS(t,e){return function(n,r,o){var i=vg(t(n*r),[n,r]),a=dg(t(r));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}hS(_S),function(){function t(){}t.sgd=function(t){return new bS(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new xS(t,e,n)},t.rmsprop=function(t,e,n,r,o){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new _S(t,e,n,r,o)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new yS(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new mS(t,e,n)},t.adamax=function(t,e,n,r,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new wS(t,e,n,r,o)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new gS(t,e)}}(),om=vE;var TS=function(){return function(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n}}();function kS(t,e){return function(n,r,o){var i=gg(t(9*n),[3,3,n,1]),a=gg(t(n*r),[1,1,n,r]),s=dg(t(r));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new TS(i,a,s)}}function IS(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),o=t(e+"/bias",1);return new TS(n,r,o)}}var NS=function(){function t(t,e){if(!US(t)||!US(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}(),AS=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}();function DS(t,e){return t instanceof am&&t.shape.length===e}function MS(t){return DS(t,3)}function PS(t){return DS(t,4)}function OS(t){return t%2==0}function FS(t){return t&&t.width&&t.height}function LS(t){return t.reduce(function(t,e){return t.add(e)},new AS(0,0)).div(new AS(t.length,t.length))}function BS(t,e,n){return Array(t).fill(0).map(function(t,r){return e+r*n})}function US(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function VS(t,e){return function(n,r,o){var i=t[n];if(!DS(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return e.push({originalPath:n,paramPath:o||n}),i}}function jS(t){var e=t;return{extractWeights:function(t){var n=e.slice(0,t);return e=e.slice(t),n},getRemainingWeights:function(){return e}}}function zS(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(r,"")).split("/").filter(function(t){return t}),i=t.endsWith(".json")?o[o.length-1]:n,a=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}var WS,HS=function(){function t(e,n){void 0===n&&(n=!1);var r=e||{},o=[r.left,r.top,r.right,r.bottom].every(US),i=[r.x,r.y,r.width,r.height].every(US);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];t.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return t.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(US)},t.assertIsValidBox=function(e,n,r){if(void 0===r&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.round(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.floor(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.toSquare=function(){var e=this.x,n=this.y,r=this.width,o=this.height,i=Math.abs(r-o);return r<o&&(e-=i/2,r+=i),o<r&&(n-=i/2,o+=i),new t({x:e,y:n,width:r,height:o})},t.prototype.rescale=function(e){var n=FS(e)?e.width:e,r=FS(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(e,n){var r=this.y,o=this.right,i=this.bottom,a=Math.max(this.x,0),s=Math.max(r,0),u=i-s;return new t({x:a,y:s,width:Math.min(o-a,e-a),height:Math.min(u,n-s)}).floor()},t.prototype.shift=function(e,n){return new t({x:this.x+e,y:this.y+n,width:this.width,height:this.height})},t.prototype.padAtBorders=function(t,e){var n=this.width+1,r=this.height+1,o=n,i=r,a=this.left,s=this.top,u=this.right,c=this.bottom;return u>e&&(o=-u+e+n,u=e),c>t&&(i=-c+t+r,c=t),a<1&&(i=2-a,a=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:o,y:s,ey:c,x:a,ex:u,w:n,h:r}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),GS=function(t){function e(e,n,r,o){return t.call(this,{left:e,top:n,right:r,bottom:o})||this}return i(e,t),e}(HS),qS=function(){function t(t,e,n,r,o){this._imageDims=new NS(o.width,o.height),this._score=t,this._classScore=e,this._className=n,this._box=new HS(r).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new HS(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}();function $S(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function KS(t){var e="";if(!t)try{t=n(!function(){var t=new Error("Cannot find module 'fs'");throw t.code="MODULE_NOT_FOUND",t}())}catch(r){e=r.toString()}return{readFile:t?function(e){return new Promise(function(n,r){t.readFile(e,function(t,e){return t?r(t):n(e)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}function XS(){var t=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,n=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},r=KS();return a({Canvas:t||function(){},Image:e||function(){},ImageData:global.ImageData||function(){},Video:global.HTMLVideoElement||function(){},createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:n},r)}function QS(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData}function YS(){return"object"==typeof global&&void 0!==t&&"undefined"!=typeof process&&!!process.version}function ZS(t){WS=t}function JS(){QS()&&ZS($S()),YS()&&ZS(XS())}var tR={getEnv:function(){if(!WS)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return WS},setEnv:ZS,initialize:JS,createBrowserEnv:$S,createFileSystem:KS,createNodejsEnv:XS,monkeyPatch:function(t){if(WS||JS(),!WS)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=void 0===e?WS.Canvas:e,r=t.Image,o=void 0===r?WS.Image:r;WS.Canvas=n,WS.Image=o,WS.createCanvasElement=t.createCanvasElement||function(){return new n},WS.createImageElement=t.createImageElement||function(){return new o},WS.ImageData=t.ImageData||WS.ImageData,WS.Video=t.Video||WS.Video,WS.fetch=t.fetch||WS.fetch,WS.readFile=t.readFile||WS.readFile},isBrowser:QS,isNodejs:YS};function eR(t){var e=tR.getEnv();return t instanceof e.Image&&t.complete||t instanceof e.Video&&t.readyState>=3}function nR(t){var e=t.getContext("2d");if(!e)throw new Error("canvas 2d context is null");return e}function rR(t){var e=tR.getEnv(),n=e.Video;return t instanceof e.Image?new NS(t.naturalWidth,t.naturalHeight):t instanceof n?new NS(t.videoWidth,t.videoHeight):new NS(t.width,t.height)}function oR(t){var e=t.width,n=t.height,r=(0,tR.getEnv().createCanvasElement)();return r.width=e,r.height=n,r}function iR(t,e){var n=tR.getEnv().ImageData;if(!(t instanceof n||eR(t)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||rR(t),o=r.width,i=r.height,a=oR({width:o,height:i});return t instanceof n?nR(a).putImageData(t,0,0):nR(a).drawImage(t,0,0,o,i),a}function aR(t){return tR.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function sR(t,e){return c(this,void 0,void 0,function(){var n;return l(this,function(r){switch(r.label){case 0:return[4,(0,tR.getEnv().fetch)(t,e)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function uR(t){return c(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return[4,sR(t)];case 1:return[2,e.sent().json()]}})})}function cR(t,e){return c(this,void 0,void 0,function(){var n,r,o,i,a,s;return l(this,function(u){switch(u.label){case 0:return n=e||tR.getEnv().createCanvasElement(),r=t.shape.slice(PS(t)?1:0),o=r[0],i=r[1],a=r[2],[4,Ab(s=Am(function(){return t.as3D(o,i,a).toInt()}),n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function lR(t){var e=tR.getEnv();return t instanceof e.Image||t instanceof e.Canvas||t instanceof e.Video}function hR(t,e){return c(this,void 0,void 0,function(){var n,r,o;return l(this,function(i){switch(i.label){case 0:return n=zS(t,e),r=n.modelBaseUri,[4,uR(n.manifestUri)];case 1:return o=i.sent(),[2,sS.loadWeights(o,r)]}})})}JS();var pR=function(){function t(t,e){void 0===e&&(e=!1);var n=this;if(this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(t,e){if(MS(t))return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape);if(PS(t)){var r=t.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape.slice(1))}var o=t instanceof tR.getEnv().Canvas?t:iR(t);n._canvases[e]=o,n._inputDimensions[e]=[o.height,o.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return BS(this.batchSize,0,1).map(function(e,n){return t.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(t,e){var n=t.width,r=t.height,o=e/Math.max(r,n);return new NS(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(t),height:this.getInputHeight(t)},this.inputSize)},t.prototype.toBatchTensor=function(t,e){var n=this;return void 0===e&&(e=!0),this._inputSize=t,Am(function(){var r=BS(n.batchSize,0,1).map(function(r){var o=n.getInput(r);if(o instanceof am){var i=PS(o)?o:o.expandDims();return(i=function(t,e){return void 0===e&&(e=!1),Am(function(){var n=t.shape.slice(1),r=n[0],o=n[1];if(r===o)return t;var i=Math.abs(r-o),a=Math.round(i*(e?.5:1)),s=r>o?2:1,u=function(e){var n=t.shape.slice();return n[s]=e,bg(n,0)},c=u(a),l=i-c.shape[s],h=[e&&l?u(l):null,t,c].filter(function(t){return!!t}).map(function(t){return t.toFloat()});return vb(h,s)})}(i,e)).shape[1]===t&&i.shape[2]===t||(i=dE.resizeBilinear(i,[t,t])),i.as3D(t,t,3)}if(o instanceof tR.getEnv().Canvas)return Vb(function(t,e,n){void 0===n&&(n=!1);var r=tR.getEnv(),o=r.Canvas;if(!(t instanceof r.Image||t instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=rR(t),a=e/Math.max(i.height,i.width),s=a*i.width,u=a*i.height,c=oR({width:e,height:e}),l=t instanceof o?t:iR(t),h=Math.abs(s-u)/2,p=n&&s<u?h:0,f=n&&u<s?h:0;return nR(c).drawImage(l,p,f,s,u),c}(o,t,e));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)});return tx(r.map(function(t){return t.toFloat()})).as4D(n.batchSize,t,t,3)})},t}();function fR(t){return c(this,void 0,void 0,function(){var e,n,r;return l(this,function(o){switch(o.label){case 0:if(t instanceof pR)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return n=function(e){return Array.isArray(t)?" at input index "+e+":":""},(r=e.map(aR)).forEach(function(t,r){if(!lR(t)&&!MS(t)&&!PS(t)){if("string"==typeof e[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+e[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(PS(t)){var o=t.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(t){return lR(t)&&(e=t,new Promise(function(t,n){if(e instanceof tR.getEnv().Canvas||eR(e))return t();function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",o),t(e))}function o(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),n(t))}e.addEventListener("load",r),e.addEventListener("error",o)}));var e}))];case 1:return o.sent(),[2,new pR(r,Array.isArray(t))]}})})}var dR=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof fm})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof fm)})},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){t.reassignParamFromPath(e.path,e.tensor.variable())})},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var n=e.path,r=e.tensor,o=pg(r.dataSync());r.dispose(),t.reassignParamFromPath(n,o)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){return Array.from(t.tensor.dataSync())}).reduce(function(t,e){return t.concat(e)}))},t.prototype.load=function(t){return c(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(n){switch(n.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromUri - expected model uri");return[4,hR(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(t){return c(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,c;return l(this,function(l){switch(l.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromDisk - expected model file path");return e=tR.getEnv().readFile,n=zS(t,this.getDefaultModelName()),r=n.manifestUri,o=n.modelBaseUri,i=sS.weightsLoaderFactory(function(t){return Promise.all(t.map(function(t){return e(t).then(function(t){return t.buffer})}))}),u=(s=JSON).parse,[4,e(r)];case 1:return a=u.apply(s,[l.sent().toString()]),[4,i(a,o)];case 2:return c=l.sent(),this.loadFromWeightMap(c),[2]}})})},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.params;this._paramMappings=e.paramMappings,this._params=n},t.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.params;this._paramMappings=e.paramMappings,this._params=n},t.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(e,n){if(!e.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+t);return{obj:e.nextObj,objProp:n,nextObj:e.nextObj[n]}},{nextObj:this.params}),n=e.obj,r=e.objProp;if(!(n&&r&&n[r]instanceof am))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:r}},t}();function vR(t,e,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return n?r/(t.area+e.area-r):r/Math.min(t.area,e.area)}function mR(t,e,n,r){void 0===r&&(r=!0);for(var o=e.map(function(t,e){return{score:t,boxIndex:e}}).sort(function(t,e){return t.score-e.score}).map(function(t){return t.boxIndex}),i=[],a=function(){var e=o.pop();i.push(e);for(var a=o,s=[],u=0;u<a.length;u++)s.push(vR(t[e],t[a[u]],r));o=o.filter(function(t,e){return s[e]<=n})};o.length>0;)a();return i}function gR(t,e){return Am(function(){var n=e[0],r=e[1],o=e[2],i=bg(t.shape.slice(0,3).concat([1]),n),a=bg(t.shape.slice(0,3).concat([1]),r),s=bg(t.shape.slice(0,3).concat([1]),o),u=vb([i,a,s],3);return gC(t,u)})}function yR(t){return 1/(1+Math.exp(-t))}var wR=function(t){return"number"==typeof t};function bR(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!wR(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(t){return"string"==typeof t}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(t){return t||{}}).every(function(t){return wR(t.x)&&wR(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(wR)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}function xR(t){return Am(function(){var e=hC(t,fg(.10000000149011612));return Z_(TC(gC(t,e)),e)})}function _R(t,e){return Am(function(){var n=Wb(t,[[0,0],[1,1],[1,1],[0,0]]);return n=s_(n,e.conv.filters,[1,1],"valid"),n=gC(n,e.bn.sub),n=hC(n,e.bn.truediv),xR(n=Z_(n,e.conv.bias))})}function CR(t,e){return Am(function(){var n=Wb(t,[[0,0],[1,1],[1,1],[0,0]]);return n=h_(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),xR(n=Z_(n,e.bias))})}var ER=function(t){return t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG",t}({}),SR=function(){function t(t){var e=void 0===t?{}:t,n=e.inputSize,r=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),RR=function(t){function e(e){var n=t.call(this,"TinyYolov2")||this;return bR(e),n._config=e,n}return i(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var n=_R(t,e.conv0);return n=_R(n=b_(n,[2,2],[2,2],"same"),e.conv1),n=_R(n=b_(n,[2,2],[2,2],"same"),e.conv2),n=_R(n=b_(n,[2,2],[2,2],"same"),e.conv3),n=_R(n=b_(n,[2,2],[2,2],"same"),e.conv4),n=_R(n=b_(n,[2,2],[2,2],"same"),e.conv5),n=_R(n=b_(n,[2,2],[1,1],"same"),e.conv6),CS(n=_R(n,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var n=this.config.isFirstLayerConv2d?xR(CS(t,e.conv0,"valid",!1)):CR(t,e.conv0);return n=CR(n=b_(n,[2,2],[2,2],"same"),e.conv1),n=CR(n=b_(n,[2,2],[2,2],"same"),e.conv2),n=CR(n=b_(n,[2,2],[2,2],"same"),e.conv3),n=CR(n=b_(n,[2,2],[2,2],"same"),e.conv4),n=CR(n=b_(n,[2,2],[2,2],"same"),e.conv5),n=b_(n,[2,2],[1,1],"same"),n=e.conv6?CR(n,e.conv6):n,CS(n=e.conv7?CR(n,e.conv7):n,e.conv8,"valid",!1)},e.prototype.forwardInput=function(t,e){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Am(function(){var o=t.toBatchTensor(e,!1).toFloat();return o=(o=n.config.meanRgb?gR(o,n.config.meanRgb):o).div(fg(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)})},e.prototype.forward=function(t,e){return c(this,void 0,void 0,function(){var n;return l(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,fR(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent()]}})})},e.prototype.detect=function(t,e){return void 0===e&&(e={}),c(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,h,p,f,d,v=this;return l(this,function(l){switch(l.label){case 0:return n=new SR(e),r=n.inputSize,o=n.scoreThreshold,[4,fR(t)];case 1:return i=l.sent(),[4,this.forwardInput(i,r)];case 2:return a=l.sent(),s=Am(function(){return rx(a)[0].expandDims()}),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},c=this.extractBoxes(s,i.getReshapedInputDimensions(0),o),a.dispose(),s.dispose(),h=c.map(function(t){return t.box}),p=c.map(function(t){return t.score}),f=c.map(function(t){return t.classScore}),d=c.map(function(t){return v.config.classes[t.label]}),[2,mR(h.map(function(t){return t.rescale(r)}),p,this.config.iouThreshold,!0).map(function(t){return new qS(p[t],f[t],d[t],h[t],u)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n,r=[],o=function(t,e){var n=VS(t,e);function r(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(t){return{conv:r(t+"/conv"),bn:function(t){return{sub:n(t+"/sub",1),truediv:n(t+"/truediv",1)}}(t+"/bn")}},extractSeparableConvParams:IS(n)}}(t,r),i=o.extractConvParams,a=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;n={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return ES(t,r),{params:n,paramMappings:r}}(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(t,e,n,r){var o,i=jS(t),a=i.getRemainingWeights,s=[],u=function(t,e){var n=SS(t,e),r=kS(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,o,i){return{conv:n(r,o,3,i+"/conv"),bn:function(n,r){var o=dg(t(n)),i=dg(t(n));return e.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:o,truediv:i}}(o,i+"/bn")}},extractSeparableConvParams:r}}(i.extractWeights,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams;if(e.withSeparableConvs){var p=r[0],f=r[1],d=r[2],v=r[3],m=r[4],g=r[5],y=r[6],w=r[7],b=r[8];o={conv0:e.isFirstLayerConv2d?c(p,f,3,"conv0"):h(p,f,"conv0"),conv1:h(f,d,"conv1"),conv2:h(d,v,"conv2"),conv3:h(v,m,"conv3"),conv4:h(m,g,"conv4"),conv5:h(g,y,"conv5"),conv6:w?h(y,w,"conv6"):void 0,conv7:b?h(w,b,"conv7"):void 0,conv8:c(b||w||y,5*n,1,"conv8")}}else d=r[2],v=r[3],m=r[4],g=r[5],y=r[6],w=r[7],b=r[8],o={conv0:l(p=r[0],f=r[1],"conv0"),conv1:l(f,d,"conv1"),conv2:l(d,v,"conv2"),conv3:l(v,m,"conv3"),conv4:l(m,g,"conv4"),conv5:l(g,y,"conv5"),conv6:l(y,w,"conv6"),conv7:l(w,b,"conv7"),conv8:c(b,5*n,1,"conv8")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:o,paramMappings:s}}(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,e,n){for(var r=this,o=e.width,i=e.height,s=Math.max(o,i),u=s/o,c=s/i,l=t.shape[1],h=this.config.anchors.length,p=Am(function(){var e=t.reshape([l,l,h,r.boxEncodingSize]);return[e.slice([0,0,0,0],[l,l,h,4]),e.slice([0,0,0,4],[l,l,h,1]),r.withClassScores?sg(e.slice([0,0,0,5],[l,l,h,r.config.classes.length]),3):fg(0)]}),f=p[0],d=p[1],v=p[2],m=[],g=0;g<l;g++)for(var y=0;y<l;y++)for(var w=0;w<h;w++){var b=yR(d.get(g,y,w,0));if(!n||b>n){var x=(y+yR(f.get(g,y,w,0)))/l*u,_=(g+yR(f.get(g,y,w,1)))/l*c,C=Math.exp(f.get(g,y,w,2))*this.config.anchors[w].x/l*u,E=Math.exp(f.get(g,y,w,3))*this.config.anchors[w].y/l*c,S=x-C/2,R=_-E/2,T={row:g,col:y,anchor:w},k=this.withClassScores?this.extractPredictedClass(v,T):{classScore:1,label:0},I=k.classScore,N=k.label;m.push(a({box:new GS(S,R,S+C,R+E),score:b,classScore:b*I,label:N},T))}}return f.dispose(),d.dispose(),v.dispose(),m},e.prototype.extractPredictedClass=function(t,e){var n=e.row,r=e.col,o=e.anchor;return Array(this.config.classes.length).fill(0).map(function(e,i){return t.get(n,r,o,i)}).map(function(t,e){return{classScore:t,label:e}}).reduce(function(t,e){return t.classScore>e.classScore?t:e})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(dR),TR=function(t){function e(e,n,r,o){return t.call(this,{x:e,y:n,width:r,height:o})||this}return i(e,t),e}(HS),kR=function(t){function e(e,n,r){return t.call(this,e,e,"",n,r)||this}return i(e,t),e.prototype.forSize=function(e,n){return t.prototype.forSize.call(this,e,n)},e}(qS),IR=function(){function t(t,e,n){void 0===n&&(n=new AS(0,0));var r=e.width,o=e.height;this._imgDims=new NS(r,o),this._shift=n,this._positions=t.map(function(t){return t.mul(new AS(r,o)).add(n)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new AS(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new AS(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new AS(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t){if(t){var e=t instanceof kR?t.box.floor():t;return this.shiftBy(e.x,e.y).align()}var n=this.getRefPointsForAlignment(),r=n[1],o=n[2],i=function(t){return o.sub(t).magnitude()},a=(i(n[0])+i(r))/2,s=Math.floor(a/.45),u=LS(n),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new TR(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),NR=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],LS([t[3],t[4]])]},e}(IR),AR=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(LS)},e}(IR);function DR(t,e){return c(this,void 0,void 0,function(){var n,r,o,i,a,s;return l(this,function(u){switch(u.label){case 0:return n=tR.getEnv().Canvas,r=t,t instanceof n?[3,5]:[4,fR(t)];case 1:if((o=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof n?(a=i,[3,4]):[3,2];case 2:return[4,cR(i)];case 3:a=u.sent(),u.label=4;case 4:r=a,u.label=5;case 5:return s=nR(r),[2,e.map(function(t){return t instanceof kR?t.forSize(r.width,r.height).box.floor():t}).map(function(t){return t.clipAtImageBorders(r.width,r.height)}).map(function(t){var e=t.x,n=t.y,r=t.width,o=t.height,i=oR({width:r,height:o});return nR(i).putImageData(s.getImageData(e,n,r,o),0,0),i})]}})})}function MR(t,e){return c(this,void 0,void 0,function(){return l(this,function(n){if(!MS(t)&&!PS(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(PS(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Am(function(){var n=t.shape.slice(PS(t)?1:0),r=n[0],o=n[1],i=n[2];return e.map(function(t){return t instanceof kR?t.forSize(o,r).box:t}).map(function(t){return t.clipAtImageBorders(o,r)}).map(function(e){var n=e.x,a=e.y,s=e.width,u=e.height;return R_(t.as3D(r,o,i),[a,n,0],[u,s,i])})})]})})}function PR(t,e,n){return Am(function(){var r=h_(t,e.depthwise_filter,e.pointwise_filter,n,"same");return Z_(r,e.bias)})}function OR(t,e,n){return void 0===n&&(n=!1),Am(function(){var r=TC(n?Z_(s_(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):PR(t,e.conv0,[2,2])),o=PR(r,e.conv1,[1,1]),i=PR(TC(Z_(r,o)),e.conv2,[1,1]);return TC(Z_(r,Z_(o,i)))})}function FR(t,e,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),Am(function(){var o=TC(n?Z_(s_(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):PR(t,e.conv0,r?[2,2]:[1,1])),i=PR(o,e.conv1,[1,1]),a=PR(TC(Z_(o,i)),e.conv2,[1,1]),s=PR(TC(Z_(o,Z_(i,a))),e.conv3,[1,1]);return TC(Z_(o,Z_(i,Z_(a,s))))})}function LR(t,e){function n(n,o,i){var a=gg(t(9*n),[3,3,n,1]),s=gg(t(n*o),[1,1,n,o]),u=dg(t(o));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new r.SeparableConvParams(a,s,u)}var o=r.extractConvParamsFactory(t,e);function i(t,e,r,i){return void 0===i&&(i=!1),{conv0:i?o(t,e,3,r+"/conv0"):n(t,e,r+"/conv0"),conv1:n(e,e,r+"/conv1"),conv2:n(e,e,r+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(t,e,r,o){void 0===o&&(o=!1);var a=i(t,e,r,o);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:n(e,e,r+"/conv3")}}}}function BR(t,e){var n=r.extractWeightEntryFactory(t,e);function o(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}function i(t){var e=n(t+"/depthwise_filter",4),o=n(t+"/pointwise_filter",4),i=n(t+"/bias",1);return new r.SeparableConvParams(e,o,i)}return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?o(t+"/conv0"):i(t+"/conv0"),conv1:i(t+"/conv1"),conv2:i(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?o(t+"/conv0"):i(t+"/conv0"),conv1:i(t+"/conv1"),conv2:i(t+"/conv2"),conv3:i(t+"/conv3")}}}}var UR=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return i(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceFeatureExtractor - load model before inference");return Am(function(){var n=FR(gR(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(fg(255)),e.dense0,!0);return n=FR(n,e.dense1),n=FR(n,e.dense2),n=FR(n,e.dense3),x_(n,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,fR(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=BR(t,e).extractDenseBlock4Params,o={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return r.disposeUnusedWeightTensors(t,e),{params:o,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=r.extractWeightsFactory(t),o=n.getRemainingWeights,i=LR(n.extractWeights,e).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}(t)},e}(dR);function VR(t,e){return Am(function(){return Z_(t_(t,e.weights),e.bias)})}var jR=function(t){function e(e,n){var r=t.call(this,e)||this;return r._faceFeatureExtractor=n,r}return i(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Am(function(){var r=t instanceof pR?e.faceFeatureExtractor.forwardInput(t):t;return VR(r.as2D(r.shape[0],-1),n.fc)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.paramMappings;this._params=e.params,this._paramMappings=n},e.prototype.extractClassifierParams=function(t){return function(t,e,n){var o=[],i=r.extractWeightsFactory(t),a=i.getRemainingWeights,s=r.extractFCParamsFactory(i.extractWeights,o)(e,n,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:o,params:{fc:s}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e=function(t){var e={},n={};return Object.keys(t).forEach(function(r){(r.startsWith("fc")?n:e)[r]=t[r]}),{featureExtractorMap:e,classifierMap:n}}(t),n=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(e.featureExtractorMap),function(t){var e=[],n=r.extractWeightEntryFactory(t,e),o={fc:{weights:n("fc/weights",2),bias:n("fc/bias",1)}};return r.disposeUnusedWeightTensors(t,e),{params:o,paramMappings:e}}(n)},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*e+n,o=t.slice(0,t.length-r),i=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(dR),zR={neutral:0,happy:1,sad:2,angry:3,fearful:4,disgusted:5,surprised:6},WR=function(t){function e(e){return void 0===e&&(e=new UR),t.call(this,"FaceExpressionNet",e)||this}return i(e,t),e.getFaceExpressionLabel=function(t){var e=zR[t];if("number"!=typeof e)throw new Error("getFaceExpressionLabel - no label for faceExpression: "+t);return e},e.decodeProbabilites=function(t){if(7!==t.length)throw new Error("decodeProbabilites - expected probabilities.length to be 7, have: "+t.length);return Object.keys(zR).map(function(e){return{expression:e,probability:t[zR[e]]}})},e.prototype.forwardInput=function(t){var e=this;return Am(function(){return sg(e.runNet(t))})},e.prototype.forward=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,fR(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.predictExpressions=function(t){return c(this,void 0,void 0,function(){var n,r,o,i,a=this;return l(this,function(s){switch(s.label){case 0:return[4,fR(t)];case 1:return n=s.sent(),[4,this.forwardInput(n)];case 2:return r=s.sent(),[4,Promise.all(rx(r).map(function(t){return c(a,void 0,void 0,function(){var e;return l(this,function(n){switch(n.label){case 0:return[4,t.data()];case 1:return e=n.sent(),t.dispose(),[2,e]}})})}))];case 3:return o=s.sent(),r.dispose(),i=o.map(function(t){return e.decodeProbabilites(t)}),[2,n.isBatchInput?i:i[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(jR),HR=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.postProcess=function(t,e,n){var r=n.map(function(t){var n=t.width,r=t.height,o=e/Math.max(r,n);return{width:n*o,height:r*o}}),o=r.length;return Am(function(){var n=function(t,e){return tx([bg([68],t),bg([68],e)],1).as2D(1,136).as1D()},i=function(t,e){var n=r[t],o=n.width,i=n.height;return e(o,i)?Math.abs(o-i)/2:0};return t.mul(bg([o,136],e)).sub(tx(Array.from(Array(o),function(t,e){return n(function(t){return i(t,function(t,e){return t<e})}(e),function(t){return i(t,function(t,e){return e<t})}(e))}))).div(tx(Array.from(Array(o),function(t,e){return n(r[e].width,r[e].height)})))})},e.prototype.forwardInput=function(t){var e=this;return Am(function(){var n=e.runNet(t);return e.postProcess(n,t.inputSize,t.inputDimensions.map(function(t){return{height:t[0],width:t[1]}}))})},e.prototype.forward=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,fR(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.detectLandmarks=function(t){return c(this,void 0,void 0,function(){var e,n,r,o=this;return l(this,function(i){switch(i.label){case 0:return[4,fR(t)];case 1:return e=i.sent(),n=Am(function(){return rx(o.forwardInput(e))}),[4,Promise.all(n.map(function(t,n){return c(o,void 0,void 0,function(){var r,o,i,a,s;return l(this,function(u){switch(u.label){case 0:return i=(o=Array).from,[4,t.data()];case 1:return r=i.apply(o,[u.sent()]),a=r.filter(function(t,e){return OS(e)}),s=r.filter(function(t,e){return!OS(e)}),[2,new AR(Array(68).fill(0).map(function(t,e){return new AS(a[e],s[e])}),{height:e.getInputHeight(n),width:e.getInputWidth(n)})]}})})}))];case 2:return r=i.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?r:r[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(jR),GR=function(t){function e(e){return void 0===e&&(e=new UR),t.call(this,"FaceLandmark68Net",e)||this}return i(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(HR),qR=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return i(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Am(function(){var n=OR(gR(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(fg(255)),e.dense0,!0);return n=OR(n,e.dense1),n=OR(n,e.dense2),x_(n,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,fR(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=BR(t,e).extractDenseBlock3Params,o={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return r.disposeUnusedWeightTensors(t,e),{params:o,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=r.extractWeightsFactory(t),o=n.getRemainingWeights,i=LR(n.extractWeights,e).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}(t)},e}(dR),$R=function(t){function e(e){return void 0===e&&(e=new qR),t.call(this,"FaceLandmark68TinyNet",e)||this}return i(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(HR);function KR(t,e,n,r,o){void 0===o&&(o="same");var i=e.conv,a=i.bias,s=s_(t,i.filters,n,o);return s=function(t,e){return Z_(hC(t,e.weights),e.biases)}(s=Z_(s,a),e.scale),r?TC(s):s}function XR(t,e){return KR(t,e,[1,1],!1)}function QR(t,e){return KR(t,e,[2,2],!0,"valid")}function YR(t,e){var n=function(t,e){return KR(t,e,[1,1],!0)}(t,e.conv1);return n=XR(n,e.conv2),n=Z_(n,t),TC(n)}function ZR(t,e){var n=QR(t,e.conv1);n=XR(n,e.conv2);var r=x_(t,2,2,"valid"),o=wg(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var a=n.shape.slice();a[1]=1;var s=wg(a),u=(n=vb([n,s],1)).shape.slice();u[2]=1;var c=wg(u);n=vb([n,c],2)}return r=i?vb([r,o],3):r,n=Z_(r,n),TC(n)}var JR=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return i(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceRecognitionNet - load model before inference");return Am(function(){var n=QR(gR(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(fg(256)),e.conv32_down);n=YR(n=b_(n,3,2,"valid"),e.conv32_1),n=YR(n,e.conv32_2),n=YR(n,e.conv32_3),n=YR(n=ZR(n,e.conv64_down),e.conv64_1),n=YR(n,e.conv64_2),n=YR(n,e.conv64_3),n=YR(n=ZR(n,e.conv128_down),e.conv128_1),n=YR(n,e.conv128_2),n=YR(n=ZR(n,e.conv256_down),e.conv256_1);var r=(n=ZR(n=YR(n,e.conv256_2),e.conv256_down_out)).mean([1,2]);return t_(r,e.fc)})},e.prototype.forward=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,fR(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return c(this,void 0,void 0,function(){var e,n,r,o=this;return l(this,function(i){switch(i.label){case 0:return[4,fR(t)];case 1:return e=i.sent(),n=Am(function(){return rx(o.forwardInput(e))}),[4,Promise.all(n.map(function(t){return t.data()}))];case 2:return r=i.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?r:r[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=function(t,e){var n=r.extractWeightEntryFactory(t,e);function o(t){return{conv:{filters:n(t+"/conv/filters",4),bias:n(t+"/conv/bias",1)},scale:function(t){return{weights:n(t+"/scale/weights",1),biases:n(t+"/scale/biases",1)}}(t)}}return{extractConvLayerParams:o,extractResidualLayerParams:function(t){return{conv1:o(t+"/conv1"),conv2:o(t+"/conv2")}}}}(t,e),o=n.extractResidualLayerParams,i=(0,n.extractConvLayerParams)("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),h=o("conv64_2"),p=o("conv64_3"),f=o("conv128_down"),d=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),y=o("conv256_2"),w=o("conv256_down_out"),b=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!DS(b,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var x={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:h,conv64_3:p,conv128_down:f,conv128_1:d,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:y,conv256_down_out:w,fc:b};return r.disposeUnusedWeightTensors(t,e),{params:x,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=r.extractWeightsFactory(t),n=e.extractWeights,o=e.getRemainingWeights,i=[],a=function(t,e){function n(n,r,o,i){var a=function(e,n,r){var o=t(e),i=o.length/(n*r*r);if(i%1!=0)throw new Error("depth has to be an integer: "+i+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return Am(function(){return IC(gg(o,[n,i,r,r]),[2,3,1,0])})}(n,r,o),s=dg(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}function r(r,o,i,a){return{conv:n(r,o,i,a+"/conv"),scale:function(n,r){var o=dg(t(n)),i=dg(t(n));return e.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:o,biases:i}}(o,a+"/scale")}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t,e,n,o,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*t,e,n,o+"/conv1"),conv2:r(t,e,n,o+"/conv2")}}}}(n,i),s=a.extractResidualLayerParams,u=(0,a.extractConvLayerParams)(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),p=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),d=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),w=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),C=Am(function(){return IC(vg(n(32768),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:h,conv64_down:p,conv64_1:f,conv64_2:d,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:y,conv256_down:w,conv256_1:b,conv256_2:x,conv256_down_out:_,fc:C},paramMappings:i}}(t)},e}(dR);function tT(t,e){return Object.assign({},t,{descriptor:e})}function eT(t,e){return Object.assign({},t,{detection:e})}function nT(t,e){return Object.assign({},t,{expressions:e})}function rT(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),o=r.align(),i=t.detection.imageDims,a=new kR(t.detection.score,o.rescale(i.reverse()),i);return Object.assign({},t,{landmarks:r,unshiftedLandmarks:e,alignedRect:a})}var oT=function(){function t(t){var e=void 0===t?{}:t,n=e.minFaceSize,r=e.scaleFactor,o=e.maxNumScales,i=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(t){return"number"!=typeof t}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(t){return"number"!=typeof t})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function iT(t,e,n){return Am(function(){var r=s_(t,e.filters,n,"same");return r=Z_(r,e.batch_norm_offset),mx(r,0,6)})}function aT(t,e,n){var r=Math.min(t.get(e,0),t.get(e,2)),o=Math.min(t.get(e,1),t.get(e,3)),i=Math.max(t.get(e,0),t.get(e,2)),a=Math.max(t.get(e,1),t.get(e,3)),s=Math.min(t.get(n,0),t.get(n,2)),u=Math.min(t.get(n,1),t.get(n,3)),c=Math.max(t.get(n,0),t.get(n,2)),l=Math.max(t.get(n,1),t.get(n,3)),h=(i-r)*(a-o),p=(c-s)*(l-u);if(h<=0||p<=0)return 0;var f=Math.max(r,s),d=Math.max(o,u),v=Math.min(i,c),m=Math.min(a,l),g=Math.max(v-f,0)*Math.max(m-d,0);return g/(h+p-g)}function sT(t,e){return Am(function(){var n=t.shape[0];return{boxPredictionEncoding:Yb(r.convLayer(t,e.box_encoding_predictor),[n,-1,1,4]),classPrediction:Yb(r.convLayer(t,e.class_predictor),[n,-1,3])}})}var uT=function(){function t(t){var e=void 0===t?{}:t,n=e.minConfidence,r=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),cT=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return i(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("SsdMobilenetv1 - load model before inference");return Am(function(){var n=t.toBatchTensor(512,!1).toFloat(),r=function(t,e){return Am(function(){var n=null,r=iT(t,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach(function(t,e){var o,i,a,s=e+1,u=function(t){return[2,4,6,12].some(function(e){return e===t})?[2,2]:[1,1]}(s);o=r,i=t.depthwise_conv,a=u,r=iT(r=Am(function(){var t=l_(o,i.filters,a,"same");return t=Hx(t,i.batch_norm_mean,i.batch_norm_variance,.0010000000474974513,i.batch_norm_scale,i.batch_norm_offset),mx(t,0,6)}),t.pointwise_conv,[1,1]),11===s&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}(gC(hC(n,fg(.007843137718737125)),fg(1)),e.mobilenetv1),o=function(t,e,n){return Am(function(){var r=iT(t,n.conv_0,[1,1]),o=iT(r,n.conv_1,[2,2]),i=iT(o,n.conv_2,[1,1]),a=iT(i,n.conv_3,[2,2]),s=iT(a,n.conv_4,[1,1]),u=iT(s,n.conv_5,[2,2]),c=iT(u,n.conv_6,[1,1]),l=iT(c,n.conv_7,[2,2]),h=sT(e,n.box_predictor_0),p=sT(t,n.box_predictor_1),f=sT(o,n.box_predictor_2),d=sT(a,n.box_predictor_3),v=sT(u,n.box_predictor_4),m=sT(l,n.box_predictor_5);return{boxPredictions:vb([h.boxPredictionEncoding,p.boxPredictionEncoding,f.boxPredictionEncoding,d.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:vb([h.classPrediction,p.classPrediction,f.classPrediction,d.classPrediction,v.classPrediction,m.classPrediction],1)}})}(r.out,r.conv11,e.prediction_layer);return function(t,e,n){return Am(function(){var r,o,i,a,s,u,c,l,h,p,f=t.shape[0],d=(r=Yb(ex(n.extra_dim,[f,1,1]),[-1,4]),o=Yb(t,[-1,4]),a=(i=function(t){var e=rx(IC(r,[1,0])),n=[gC(e[2],e[0]),gC(e[3],e[1])];return{sizes:n,centers:[Z_(e[0],nC(n[0],fg(2))),Z_(e[1],nC(n[1],fg(2)))]}}()).sizes,s=i.centers,u=rx(IC(o,[1,0])),c=nC(hC(bx(nC(u[2],fg(5))),a[0]),fg(2)),l=Z_(hC(nC(u[0],fg(10)),a[0]),s[0]),h=nC(hC(bx(nC(u[3],fg(5))),a[1]),fg(2)),p=Z_(hC(nC(u[1],fg(10)),a[1]),s[1]),IC(tx([gC(l,c),gC(p,h),Z_(l,c),Z_(p,h)]),[1,0]));d=Yb(d,[f,d.shape[0]/f,4]);var v=Nx(C_(e,[0,0,1],[-1,-1,-1])),m=C_(v,[0,0,0],[-1,-1,1]);return m=Yb(m,[f,m.shape[1]]),{boxes:rx(d),scores:rx(m)}})}(o.boxPredictions,o.classPredictions,e.output_layer)})},e.prototype.forward=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,fR(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.locateFaces=function(t,e){return void 0===e&&(e={}),c(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,h,p,f,d,v,m,g,y,w,b,x;return l(this,function(l){switch(l.label){case 0:return n=new uT(e),r=n.maxResults,o=n.minConfidence,[4,fR(t)];case 1:for(i=l.sent(),a=this.forwardInput(i),c=(s=a.boxes)[0],h=(u=a.scores)[0],p=1;p<s.length;p++)s[p].dispose(),u[p].dispose();return v=(d=Array).from,[4,h.data()];case 2:return f=v.apply(d,[l.sent()]),m=function(t,e,n,o,i){var a=Math.min(r,t.shape[0]),s=e.map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>i}).sort(function(t,e){return e.score-t.score}),u=[];return s.forEach(function(e){if(!(u.length>=a)){for(var n=e.score,r=u.length-1;r>=0;--r){var o=aT(t,e.boxIndex,u[r]);if(0!==o&&(e.score*=o<=.5?1:0,e.score<=i))break}n===e.score&&u.push(e.boxIndex)}}),u}(c,f,0,0,o),g=i.getReshapedInputDimensions(0),w=(y=i.inputSize)/g.width,b=y/g.height,x=m.map(function(t){var e=[Math.max(0,c.get(t,0)),Math.min(1,c.get(t,2))].map(function(t){return t*b}),n=e[0],r=e[1],o=[Math.max(0,c.get(t,1)),Math.min(1,c.get(t,3))].map(function(t){return t*w}),a=o[0];return new kR(f[t],new TR(a,n,o[1]-a,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),c.dispose(),h.dispose(),[2,x]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=function(t,e){var n=r.extractWeightEntryFactory(t,e);function o(t,e,r){return{filters:n(t+"/Conv2d_"+e+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function i(t){var e="mobilenetv1/conv_"+t,r="MobilenetV1/Conv2d_"+t+"_depthwise",i=e+"/depthwise_conv",a=e+"/pointwise_conv";return{depthwise_conv:{filters:n(r+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(r+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(r+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(r+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(r+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:o("MobilenetV1",t,a)}}function a(t,e){return{filters:n(t+"/weights",4,e+"/filters"),bias:n(t+"/biases",1,e+"/bias")}}function s(t){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:o("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:o("Prediction",0,"prediction_layer/conv_0"),conv_1:o("Prediction",1,"prediction_layer/conv_1"),conv_2:o("Prediction",2,"prediction_layer/conv_2"),conv_3:o("Prediction",3,"prediction_layer/conv_3"),conv_4:o("Prediction",4,"prediction_layer/conv_4"),conv_5:o("Prediction",5,"prediction_layer/conv_5"),conv_6:o("Prediction",6,"prediction_layer/conv_6"),conv_7:o("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}}}(t,e),o=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,a=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!MS(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var s={mobilenetv1:o(),prediction_layer:i(),output_layer:{extra_dim:a}};return r.disposeUnusedWeightTensors(t,e),{params:s,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=r.extractWeightsFactory(t),o=n.extractWeights,i=n.getRemainingWeights,a=function(t,e){function n(n,r,o,i,a){var s=gg(t(n*r*o*o),[o,o,n,r]),u=dg(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/"+(a?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(t,e,r,o){var i=n(t,e,r,o,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function o(n,o,i){return{depthwise_conv:function(n,r){var o=gg(t(9*n),[3,3,n,1]),i=dg(t(n)),a=dg(t(n)),s=dg(t(n)),u=dg(t(n));return e.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:o,batch_norm_scale:i,batch_norm_offset:a,batch_norm_mean:s,batch_norm_variance:u}}(n,i+"/depthwise_conv"),pointwise_conv:r(n,o,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(o,e),s=a.extractPredictionLayerParams,u=(0,a.extractMobilenetV1Params)(),c=s(),l={extra_dim:mg(o(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:e}}(t)},e}(dR),lT=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return i(e,t),e}(r.TinyYolov2Options),hT=function(){function t(){}return t.prototype.then=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}})})},t.prototype.run=function(){return c(this,void 0,void 0,function(){return l(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},t}(),pT=2,fT=12;function dT(t,e){var n=e[1];return{height:Math.floor(e[0]*t),width:Math.floor(n*t)}}var vT=function(t){function e(e,n,r,o){return t.call(this,{left:e,top:n,right:r,bottom:o},!0)||this}return i(e,t),e}(HS);function mT(t){return Am(function(){return hC(gC(t,fg(127.5)),fg(.0078125))})}function gT(t,e){return Am(function(){return Z_(TC(t),hC(e,Rx(TC(Rx(t)))))})}function yT(t,e,n){return void 0===n&&(n=!1),Am(function(){var o=r.convLayer(t,e.conv1,"valid");return o=gT(o,e.prelu1_alpha),o=b_(o,n?[2,2]:[3,3],[2,2],"same"),o=gT(o=r.convLayer(o,e.conv2,"valid"),e.prelu2_alpha),o=n?o:b_(o,[3,3],[2,2],"valid"),gT(o=r.convLayer(o,e.conv3,"valid"),e.prelu3_alpha)})}function wT(t,e,n,o,i){i.stage1=[];var a=e.map(function(e){return Am(function(){var n={scale:e},i=function(t,e){return Am(function(){var n=dT(e,t.shape.slice(1)),r=mT(dE.resizeBilinear(t,[n.height,n.width]));return IC(r,[0,2,1,3])})}(t,e),a=Date.now(),s=function(t,e){return Am(function(){var n=yT(t,e,!0),o=r.convLayer(n,e.conv4_1,"valid"),i=Bb(P_(o,3),3);return{prob:sg(gC(o,i),3),regions:r.convLayer(n,e.conv4_2,"valid")}})}(i,o),u=s.prob,c=s.regions;return n.pnet=Date.now()-a,{scoresTensor:rx(rx(u,3)[1])[0],regionsTensor:rx(c)[0],scale:e,statsForScale:n}})}).map(function(t){var e=t.scoresTensor,r=t.regionsTensor,o=t.statsForScale,a=function(t,e,n,r){for(var o=[],i=0;i<t.shape[0];i++)for(var a=0;a<t.shape[1];a++)t.get(i,a)>=r&&o.push(new AS(a,i));return o.map(function(r){return{cell:new GS(Math.round((r.y*pT+1)/n),Math.round((r.x*pT+1)/n),Math.round((r.y*pT+fT)/n),Math.round((r.x*pT+fT)/n)),score:t.get(r.y,r.x),region:new vT(e.get(r.y,r.x,0),e.get(r.y,r.x,1),e.get(r.y,r.x,2),e.get(r.y,r.x,3))}})}(e,r,t.scale,n);if(e.dispose(),r.dispose(),!a.length)return i.stage1.push(o),[];var s=Date.now(),u=mR(a.map(function(t){return t.cell}),a.map(function(t){return t.score}),.5);return o.nms=Date.now()-s,o.numBoxes=u.length,i.stage1.push(o),u.map(function(t){return a[t]})}).reduce(function(t,e){return t.concat(e)},[]),s=[],u=[];if(a.length>0){var c=Date.now(),l=mR(a.map(function(t){return t.cell}),a.map(function(t){return t.score}),.7);i.stage1_nms=Date.now()-c,u=l.map(function(t){return a[t].score}),s=l.map(function(t){return a[t]}).map(function(t){var e=t.cell,n=t.region;return new GS(e.left+n.left*e.width,e.top+n.top*e.height,e.right+n.right*e.width,e.bottom+n.bottom*e.height).toSquare().round()})}return{boxes:s,scores:u}}function bT(t,e,n){var r=n.width,o=n.height;return c(this,void 0,void 0,function(){var n,i,a,s=this;return l(this,function(u){switch(u.label){case 0:return n=nR(t),[4,Promise.all(e.map(function(e){return c(s,void 0,void 0,function(){var r,o,i,a;return l(this,function(s){return r=e.padAtBorders(t.height,t.width),a=n.getImageData(o=r.x-1,i=r.y-1,r.ex-o,r.ey-i),[2,tR.isNodejs()?iR(a):createImageBitmap(a)]})})}))];case 1:return i=u.sent(),a=[],i.forEach(function(t){var e=nR(oR({width:r,height:o}));e.drawImage(t,0,0,r,o);for(var n=e.getImageData(0,0,r,o).data,i=[],s=0;s<n.length;s+=4)i.push(n[s+2]),i.push(n[s+1]),i.push(n[s]);a.push(i)}),[2,a.map(function(t){return Am(function(){return mT(IC(gg(t,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function xT(t,e,n,r,o){return c(this,void 0,void 0,function(){var i,a,s,u,c,h,p,f,d,v,m,g,y,w;return l(this,function(l){switch(l.label){case 0:return i=Date.now(),[4,bT(t,e,{width:24,height:24})];case 1:return a=l.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(t){var e=function(t,e){return Am(function(){var n=yT(t,e),r=gT(VR(Yb(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),o=VR(r,e.fc2_1),i=Bb(P_(o,1),1),a=sg(gC(o,i),1),s=VR(r,e.fc2_2);return{scores:rx(a,1)[1],regions:s}})}(t,r);return t.dispose(),e}),o.stage2_rnet=Date.now()-i,u=s.length>1?vb(s.map(function(t){return t.scores})):s[0].scores,p=(h=Array).from,[4,u.data()];case 2:return c=p.apply(h,[l.sent()]),u.dispose(),f=c.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx}),d=f.map(function(t){return e[t]}),v=f.map(function(t){return c[t]}),m=[],g=[],d.length>0&&(i=Date.now(),y=mR(d,v,.7),o.stage2_nms=Date.now()-i,w=y.map(function(t){return new vT(s[f[t]].regions.get(0,0),s[f[t]].regions.get(0,1),s[f[t]].regions.get(0,2),s[f[t]].regions.get(0,3))}),g=y.map(function(t){return v[t]}),m=y.map(function(t,e){return d[t].calibrate(w[e])})),s.forEach(function(t){t.regions.dispose(),t.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function _T(t,e,n,o,i){return c(this,void 0,void 0,function(){var a,s,u,c,h,p,f,d,v,m,g,y,w,b,x;return l(this,function(l){switch(l.label){case 0:return a=Date.now(),[4,bT(t,e,{width:48,height:48})];case 1:return s=l.sent(),i.stage3_extractImagePatches=Date.now()-a,a=Date.now(),u=s.map(function(t){var e=function(t,e){return Am(function(){var n=yT(t,e);n=b_(n,[2,2],[2,2],"same"),n=gT(n=r.convLayer(n,e.conv4,"valid"),e.prelu4_alpha);var o=gT(VR(Yb(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),i=VR(o,e.fc2_1),a=Bb(P_(i,1),1),s=sg(gC(i,a),1),u=VR(o,e.fc2_2),c=VR(o,e.fc2_3);return{scores:rx(s,1)[1],regions:u,points:c}})}(t,o);return t.dispose(),e}),i.stage3_onet=Date.now()-a,c=u.length>1?vb(u.map(function(t){return t.scores})):u[0].scores,f=(p=Array).from,[4,c.data()];case 2:return h=f.apply(p,[l.sent()]),c.dispose(),d=h.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx}),v=d.map(function(t){return new vT(u[t].regions.get(0,0),u[t].regions.get(0,1),u[t].regions.get(0,2),u[t].regions.get(0,3))}),m=d.map(function(t,n){return e[t].calibrate(v[n])}),g=d.map(function(t){return h[t]}),y=[],w=[],b=[],m.length>0&&(a=Date.now(),x=mR(m,g,.7,!1),i.stage3_nms=Date.now()-a,y=x.map(function(t){return m[t]}),w=x.map(function(t){return g[t]}),b=x.map(function(t,e){return Array(5).fill(0).map(function(n,r){return new AS(u[t].points.get(0,r)*(y[e].width+1)+y[e].left,u[t].points.get(0,r+5)*(y[e].height+1)+y[e].top)})})),u.forEach(function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()}),[2,{boxes:y,scores:w,points:b}]}})})}var CT=function(t){function e(){return t.call(this,"Mtcnn")||this}return i(e,t),e.prototype.forwardInput=function(t,e){return void 0===e&&(e={}),c(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,h,p,f,d,v,m,g,y,w,b,x,_;return l(this,function(l){switch(l.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=t.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},i=Date.now(),a=Am(function(){return t=Bb(Vb(r)).toFloat(),Am(function(){return tx(rx(t,3).reverse(),3)});var t}),s=function(t){return a.dispose(),o.total=Date.now()-i,t},u=a.shape.slice(1),c=u[0],h=u[1],p=new oT(e),f=p.minFaceSize,d=p.scaleFactor,v=p.maxNumScales,m=p.scoreThresholds,g=(p.scaleSteps||function(t,e,n){for(var r=fT/t,o=[],i=Math.min(n[0],n[1])*r,a=0;i>=12;)o.push(r*Math.pow(e,a)),i*=e,a+=1;return o}(f,d,[c,h])).filter(function(t){var e=dT(t,[c,h]);return Math.min(e.width,e.height)>fT}).slice(0,v),o.scales=g,o.pyramid=g.map(function(t){return dT(t,[c,h])}),y=Date.now(),[4,wT(a,g,m[0],n.pnet,o)];case 1:return w=l.sent(),o.total_stage1=Date.now()-y,w.boxes.length?(o.stage2_numInputBoxes=w.boxes.length,y=Date.now(),[4,xT(r,w.boxes,m[1],n.rnet,o)]):[2,s({results:[],stats:o})];case 2:return b=l.sent(),o.total_stage2=Date.now()-y,b.boxes.length?(o.stage3_numInputBoxes=b.boxes.length,y=Date.now(),[4,_T(r,b.boxes,m[2],n.onet,o)]):[2,s({results:[],stats:o})];case 3:return x=l.sent(),o.total_stage3=Date.now()-y,_=x.boxes.map(function(t,e){return rT(eT({},new kR(x.scores[e],new TR(t.left/h,t.top/c,t.width/h,t.height/c),{height:c,width:h})),new NR(x.points[e].map(function(e){return e.sub(new AS(t.left,t.top)).div(new AS(t.width,t.height))}),{width:t.width,height:t.height}))}),[2,s({results:_,stats:o})]}})})},e.prototype.forward=function(t,e){return void 0===e&&(e={}),c(this,void 0,void 0,function(){var n;return l(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,fR(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent().results]}})})},e.prototype.forwardWithStats=function(t,e){return void 0===e&&(e={}),c(this,void 0,void 0,function(){var n;return l(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,fR(t)];case 1:return[2,n.apply(this,[r.sent(),e])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=function(t,e){var n=r.extractWeightEntryFactory(t,e);function o(t){return{filters:n(t+"/weights",4,t+"/filters"),bias:n(t+"/bias",1)}}function i(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}function s(t){return n(t,1)}function u(t){return{conv1:o(t+"/conv1"),prelu1_alpha:s(t+"/prelu1_alpha"),conv2:o(t+"/conv2"),prelu2_alpha:s(t+"/prelu2_alpha"),conv3:o(t+"/conv3"),prelu3_alpha:s(t+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=u("pnet"),e=o("pnet/conv4_1"),n=o("pnet/conv4_2");return a({},t,{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=u("rnet"),e=i("rnet/fc1"),n=s("rnet/prelu4_alpha"),r=i("rnet/fc2_1"),o=i("rnet/fc2_2");return a({},t,{fc1:e,prelu4_alpha:n,fc2_1:r,fc2_2:o})},extractONetParams:function(){var t=u("onet"),e=o("onet/conv4"),n=s("onet/prelu4_alpha"),r=i("onet/fc1"),c=s("onet/prelu5_alpha"),l=i("onet/fc2_1"),h=i("onet/fc2_2"),p=i("onet/fc2_3");return a({},t,{conv4:e,prelu4_alpha:n,fc1:r,prelu5_alpha:c,fc2_1:l,fc2_2:h,fc2_3:p})}}}(t,e),o=n.extractRNetParams,i=n.extractONetParams,s=(0,n.extractPNetParams)(),u=o(),c=i();return r.disposeUnusedWeightTensors(t,e),{params:{pnet:s,rnet:u,onet:c},paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=r.extractWeightsFactory(t),n=e.getRemainingWeights,o=[],i=function(t,e){var n=r.extractConvParamsFactory(t,e),o=r.extractFCParamsFactory(t,e);function i(n,r){var o=dg(t(n));return e.push({paramPath:r}),o}function s(t,e,r){return void 0===r&&(r=!1),{conv1:n(t[0],t[1],3,e+"/conv1"),prelu1_alpha:i(t[1],e+"/prelu1_alpha"),conv2:n(t[1],t[2],3,e+"/conv2"),prelu2_alpha:i(t[2],e+"/prelu2_alpha"),conv3:n(t[2],t[3],r?2:3,e+"/conv3"),prelu3_alpha:i(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=s([3,10,16,32],"pnet"),e=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return a({},t,{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=s([3,28,48,64],"rnet",!0),e=o(576,128,"rnet/fc1"),n=i(128,"rnet/prelu4_alpha"),r=o(128,2,"rnet/fc2_1"),u=o(128,4,"rnet/fc2_2");return a({},t,{fc1:e,prelu4_alpha:n,fc2_1:r,fc2_2:u})},extractONetParams:function(){var t=s([3,32,64,64],"onet"),e=n(64,128,2,"onet/conv4"),r=i(128,"onet/prelu4_alpha"),u=o(1152,256,"onet/fc1"),c=i(256,"onet/prelu5_alpha"),l=o(256,2,"onet/fc2_1"),h=o(256,4,"onet/fc2_2"),p=o(256,10,"onet/fc2_3");return a({},t,{conv4:e,prelu4_alpha:r,fc1:u,prelu5_alpha:c,fc2_1:l,fc2_2:h,fc2_3:p})}}}(e.extractWeights,o),s=i.extractRNetParams,u=i.extractONetParams,c=(0,i.extractPNetParams)(),l=s(),h=u();if(0!==n().length)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:c,rnet:l,onet:h},paramMappings:o}}(t)},e}(dR),ET=.4,ST=[new AS(1.603231,2.094468),new AS(6.041143,7.080126),new AS(2.882459,3.518061),new AS(4.266906,5.178857),new AS(9.041765,10.66308)],RT=[117.001,114.697,97.404],TT=function(t){function e(){return t.call(this,{withSeparableConvs:!0,iouThreshold:ET,classes:["face"],anchors:ST,meanRgb:RT,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return i(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return c(this,void 0,void 0,function(){return l(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new kR(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(r.TinyYolov2),kT=.4,IT=[new AS(.738768,.874946),new AS(2.42204,2.65704),new AS(4.30971,7.04493),new AS(10.246,4.59428),new AS(12.6868,11.8741)],NT=[new AS(1.603231,2.094468),new AS(6.041143,7.080126),new AS(2.882459,3.518061),new AS(4.266906,5.178857),new AS(9.041765,10.66308)],AT=[117.001,114.697,97.404],DT=function(t){function e(e){void 0===e&&(e=!0);var n=Object.assign({},{withSeparableConvs:e,iouThreshold:kT,classes:["face"]},e?{anchors:NT,meanRgb:AT}:{anchors:IT,withClassScores:!0});return t.call(this,n)||this}return i(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return c(this,void 0,void 0,function(){return l(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new kR(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(r.TinyYolov2),MT={ssdMobilenetv1:new cT,tinyFaceDetector:new TT,tinyYolov2:new DT,mtcnn:new CT,faceLandmark68Net:new GR,faceLandmark68TinyNet:new $R,faceRecognitionNet:new JR,faceExpressionNet:new WR},PT=function(t){function e(e,n){var r=t.call(this)||this;return r.parentTask=e,r.input=n,r}return i(e,t),e}(hT),OT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.run=function(){return c(this,void 0,void 0,function(){var t,e,n,r,o,i=this;return l(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),e=t.map(function(t){return t.alignedRect}),this.input instanceof am?[4,MR(this.input,e)]:[3,3];case 2:return r=a.sent(),[3,5];case 3:return[4,DR(this.input,e)];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,Promise.all(t.map(function(t,e){return c(i,void 0,void 0,function(){var r;return l(this,function(o){switch(o.label){case 0:return[4,MT.faceRecognitionNet.computeFaceDescriptor(n[e])];case 1:return r=o.sent(),[2,tT(t,r)]}})})}))];case 6:return o=a.sent(),n.forEach(function(t){return t instanceof am&&t.dispose()}),[2,o]}})})},e}(PT),FT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.run=function(){return c(this,void 0,void 0,function(){var t,e,n,r,o;return l(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?(e=t.alignedRect,this.input instanceof am?[4,MR(this.input,[e])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,DR(this.input,[e])];case 4:r=i.sent(),i.label=5;case 5:return[4,MT.faceRecognitionNet.computeFaceDescriptor((n=r)[0])];case 6:return o=i.sent(),n.forEach(function(t){return t instanceof am&&t.dispose()}),[2,tT(t,o)]}})})},e}(PT),LT=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.useTinyLandmarkNet=r,o}return i(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?MT.faceLandmark68TinyNet:MT.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(hT),BT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.run=function(){return c(this,void 0,void 0,function(){var t,e,n,r,o,i=this;return l(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),e=t.map(function(t){return t.detection}),this.input instanceof am?[4,MR(this.input,e)]:[3,3];case 2:return r=a.sent(),[3,5];case 3:return[4,DR(this.input,e)];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,Promise.all(n.map(function(t){return i.landmarkNet.detectLandmarks(t)}))];case 6:return o=a.sent(),n.forEach(function(t){return t instanceof am&&t.dispose()}),[2,t.map(function(t,e){return rT(t,o[e])})]}})})},e.prototype.withFaceDescriptors=function(){return new OT(this,this.input)},e}(LT),UT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.run=function(){return c(this,void 0,void 0,function(){var t,e,n,r,o;return l(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?(e=t.detection,this.input instanceof am?[4,MR(this.input,[e])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,DR(this.input,[e])];case 4:r=i.sent(),i.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((n=r)[0])];case 6:return o=i.sent(),n.forEach(function(t){return t instanceof am&&t.dispose()}),[2,rT(t,o)]}})})},e.prototype.withFaceDescriptor=function(){return new FT(this,this.input)},e}(LT),VT=function(t){function e(e,n){var r=t.call(this)||this;return r.parentTask=e,r.input=n,r}return i(e,t),e}(hT),jT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.run=function(){return c(this,void 0,void 0,function(){var t,e,n,r,o;return l(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),e=t.map(function(t){return t.detection}),this.input instanceof am?[4,MR(this.input,e)]:[3,3];case 2:return r=i.sent(),[3,5];case 3:return[4,DR(this.input,e)];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,Promise.all(n.map(function(t){return MT.faceExpressionNet.predictExpressions(t)}))];case 6:return o=i.sent(),n.forEach(function(t){return t instanceof am&&t.dispose()}),[2,t.map(function(t,e){return nT(t,o[e])})]}})})},e.prototype.withFaceLandmarks=function(){return new BT(this,this.input,!1)},e}(VT),zT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.run=function(){return c(this,void 0,void 0,function(){var t,e,n,r,o;return l(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?(e=t.detection,this.input instanceof am?[4,MR(this.input,[e])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,DR(this.input,[e])];case 4:r=i.sent(),i.label=5;case 5:return[4,MT.faceExpressionNet.predictExpressions((n=r)[0])];case 6:return o=i.sent(),n.forEach(function(t){return t instanceof am&&t.dispose()}),[2,nT(t,o)]}})})},e.prototype.withFaceLandmarks=function(){return new UT(this,this.input,!1)},e}(VT),WT=function(t){function e(e,n){void 0===n&&(n=new uT);var r=t.call(this)||this;return r.input=e,r.options=n,r}return i(e,t),e}(hT),HT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.run=function(){return c(this,void 0,void 0,function(){var t,e,n,o;return l(this,function(i){switch(i.label){case 0:return e=(t=this).input,(n=t.options)instanceof oT?[4,MT.mtcnn.forward(e,n)]:[3,2];case 1:return[2,i.sent().map(function(t){return t.detection})];case 2:if(!(o=n instanceof lT?function(t){return MT.tinyFaceDetector.locateFaces(t,n)}:n instanceof uT?function(t){return MT.ssdMobilenetv1.locateFaces(t,n)}:n instanceof r.TinyYolov2Options?function(t){return MT.tinyYolov2.locateFaces(t,n)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(e)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(e){return c(t,void 0,void 0,function(){var t;return l(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t.map(function(t){return eT({},t)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new BT(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new jT(this.runAndExtendWithFaceDetections(),this.input)},e}(WT),GT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.run=function(){return c(this,void 0,void 0,function(){var t,e;return l(this,function(n){switch(n.label){case 0:return[4,new HT(this.input,this.options)];case 1:return t=n.sent(),e=t[0],t.forEach(function(t){t.score>e.score&&(e=t)}),[2,e]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(e){return c(t,void 0,void 0,function(){var t;return l(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t?eT({},t):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new UT(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new zT(this.runAndExtendWithFaceDetection(),this.input)},e}(WT);function qT(t,e){return void 0===e&&(e=new uT),new GT(t,e)}var $T=n("qe5e"),KT=60,XT=function(){function t(){var t=this;this.state=new Gc(1),this.preparing=new Gc(-1),this.progress=new Gc(-1),this._face=!1,this._thumbs=0,this.state.subscribe(function(e){t.handlePreparing(e),t.handleInprogress(e)})}return t.prototype.checkReadyToStart=function(){var t=this;this._face&&2===this._thumbs?1===this.state.getValue()&&this.state.next(2):2===this.state.getValue()?(this.state.next(4),setTimeout(function(){t.state.next(1)},100)):3===this.state.getValue()&&(this.state.next(4),setTimeout(function(){t.state.next(1)},100))},t.prototype.face=function(t){this._face=t,this.checkReadyToStart()},t.prototype.thumb=function(t){this._thumbs+=t?1:-1,this.checkReadyToStart()},t.prototype.handlePreparing=function(t){var e=this;if(t||(t=this.state.getValue()),2===t){if(-1===this.preparing.getValue())this.preparing.next(3);else{if(1===this.preparing.getValue())return void this.state.next(3);this.preparing.next(this.preparing.getValue()-1)}this.prepareTimer=setTimeout(function(){return e.handlePreparing(null)},1e3)}else this.prepareTimer&&(clearTimeout(this.prepareTimer),this.prepareTimer=null),-1!==this.preparing.getValue()&&this.preparing.next(-1)},t.prototype.handleInprogress=function(t){var e=this;if(t||(t=this.state.getValue()),3===t){if(-1===this.progress.getValue())this.progress.next(KT);else{if(1===this.progress.getValue())return void this.state.next(5);this.progress.next(this.progress.getValue()-1)}this.progressTimer=setTimeout(function(){return e.handleInprogress(null)},1e3)}else this.progressTimer&&(clearTimeout(this.progressTimer),this.progressTimer=null),-1!==this.progress.getValue()&&this.progress.next(-1)},t.prototype.setRecorder=function(t){this._recorder=t},t.prototype.save=function(){this._recorder&&(this._recorder.save("video.webm"),this._recorder=null),5===this.state.getValue()&&this.state.next(1)},t.prototype.discard=function(){this._recorder=null,5===this.state.getValue()&&this.state.next(1)},t.ngInjectableDef=Rt({factory:function(){return new t},token:t,providedIn:"root"}),t}(),QT=function(){function t(t){var e=this;this.state=t,this.status=!1,this.failed=!1,this.active=!1,this.recording=!1,t.state.subscribe(function(n){e.active=5!==n,3!==n||e.recording||(e.startRecording(),e.recording=!0),3!==n&&e.recording&&(e.recording=!1,e.stopRecording(),5===n&&t.setRecorder(e.recordRTC))})}return t.prototype.ngOnInit=function(){var t=this;this.state.state.subscribe(function(e){t.failed=4===e,t.status=t.status&&!t.failed}),this.init()},t.prototype.init=function(){return c(this,void 0,void 0,function(){var t,e,n,r,o;return l(this,function(i){switch(i.label){case 0:return t=this.inputVideo.nativeElement,e=navigator.mediaDevices.getSupportedConstraints(),n={},r={},e.facingMode&&(n.facingMode="user"),e.echoCancellation&&(r.echoCancellation=!0),0===Object.keys(r).length&&(r=!0),console.log(n,r),o=this,[4,navigator.mediaDevices.getUserMedia({video:n,audio:r})];case 1:return o.videoStream=i.sent(),t.srcObject=this.videoStream,[2]}})})},t.prototype.onPlay=function(){return c(this,void 0,void 0,function(){var t,e,n,r=this;return l(this,function(o){switch(o.label){case 0:return t=this.inputVideo.nativeElement,e=new lT({inputSize:128,scoreThreshold:.5}),MT.tinyFaceDetector.params?[3,2]:[4,MT.tinyFaceDetector.load("/assets/")];case 1:o.sent(),o.label=2;case 2:return[4,qT(t,e)];case 3:return n=o.sent(),this.status=!!n,this.state.face(this.status),setTimeout(function(){return r.onPlay()},1e3),[2]}})})},t.prototype.startRecording=function(){this.recordRTC=$T(this.videoStream,{type:"video",mimeType:"video/webm",videoBitsPerSecond:128e3,audioBitsPerSecond:64e3,canvas:{width:240,height:320},video:{width:240,height:320}}),this.recordRTC.startRecording()},t.prototype.stopRecording=function(){this.recordRTC.stopRecording()},t}(),YT=qa({encapsulation:0,styles:[[".layer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{width:auto;height:100%}[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{width:90%;height:90%;display:block;opacity:.4;transition-property:opacity;transition-duration:0s}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#cacf85;transition-property:fill;transition-duration:3s}[_nghost-%COMP%]   svg.active[_ngcontent-%COMP%]{opacity:0;transition-duration:3s}[_nghost-%COMP%]   svg.active[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#63ba4e;transition-duration:1s}[_nghost-%COMP%]   svg.failed[_ngcontent-%COMP%]{opacity:.4;transition-duration:0s}[_nghost-%COMP%]   svg.failed[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#d36372;transition-duration:0s}"]],data:{}});function ZT(t){return Nu(0,[(t()(),bs(0,0,null,null,3,"div",[["class","overlay"]],null,null,null,null,null)),(t()(),bs(1,0,null,null,2,":svg:svg",[[":xmlns:xlink","http://www.w3.org/1999/xlink"],["preserveAspectRatio","xMidYMid meet"],["version","1.1"],["viewBox","6 4.5 17.5 22"],["xmlns","http://www.w3.org/2000/svg"]],[[2,"active",null],[2,"failed",null]],null,null,null,null)),(t()(),bs(2,0,null,null,1,":svg:g",[["fill","none"],["fill-rule","evenodd"],["stroke","none"],["stroke-width","1"]],null,null,null,null,null)),(t()(),bs(3,0,null,null,0,":svg:path",[["d","M7.23063463,18.9910923 C6.94705125,18.5520325 6.71553567,17.9660632 6.5409192,17.2145374 C6.22355077,15.8512125 6.33956358,14.9627409 6.96911602,14.6238174 C6.48546853,11.1475752 7.46135916,8.50927131 9.40412558,6.65127459 C9.9619919,6.11774993 10.5590303,5.69196635 11.1576206,5.36213028 C11.5227614,5.16092987 11.8139842,5.03418725 12.0240004,4.96174064 C13.0598066,4.65159572 13.9828641,4.55174799 14.8047825,4.62573406 C15.6299051,4.55264824 16.5517145,4.65222669 17.6156983,4.97109915 C17.7967832,5.03417988 18.0879697,5.16090596 18.4530642,5.36207867 C19.0515779,5.69186895 19.6485399,6.11759161 20.2063351,6.65103831 C22.149191,8.50908579 23.1249494,11.147552 22.6408077,14.6240635 C23.2706368,14.9630821 23.3872542,15.8513858 23.0703069,17.2146217 C22.8956273,17.9645657 22.6645237,18.5494627 22.381722,18.9881102 C22.1004515,19.4243826 21.7790798,19.7014782 21.4571773,19.8463531 C21.4088362,20.0883734 21.3347833,20.3758942 21.2275621,20.7007701 C20.9000142,21.6932274 20.3580102,22.7054397 19.5536519,23.6796219 C19.5347076,23.7025659 19.5145517,23.723983 19.4933475,23.7438491 C17.9467831,25.4964183 16.3027709,26.3802603 14.6015722,26.3166906 C13.5556076,26.2732273 12.5730124,25.8741098 11.6683607,25.2269568 C11.0644946,24.7949743 10.5684863,24.3084985 10.1920532,23.8527155 C9.32176147,22.8364832 8.74685818,21.7939818 8.40034321,20.7655787 C8.28205481,20.4145169 8.2019844,20.1045676 8.15113813,19.8454642 C7.83063927,19.7006902 7.51075431,19.4247894 7.23063463,18.9910923 Z M9.44963719,19.2450515 C9.45157509,19.2805938 9.46167711,19.3707303 9.48602675,19.508155 C9.52904718,19.7509543 9.59842843,20.0268791 9.70015965,20.3288017 C9.99538369,21.2049813 10.4921488,22.1022669 11.2401554,22.9677478 C11.2517967,22.9812175 11.2628709,22.9950912 11.2733642,23.0093322 C11.5773601,23.3727057 11.983077,23.7673964 12.4669993,24.1135758 C13.1710228,24.6172071 13.9095421,24.9171841 14.655718,24.9481962 C15.903874,24.9948325 17.1945059,24.2934513 18.5049569,22.7921824 C19.2057874,21.9360505 19.6544993,21.0918346 19.925055,20.2720615 C20.0201419,19.9839519 20.0853445,19.721353 20.1261375,19.4908516 C20.1491897,19.3605955 20.1589064,19.2755092 20.1608479,19.2423321 C20.1832894,18.8588446 20.5153153,18.5735563 20.8906118,18.5989249 C20.9894169,18.5463152 21.1014474,18.4439639 21.22862,18.2467092 C21.4193059,17.9509406 21.5933727,17.5103972 21.734476,16.9046048 C21.837709,16.460585 21.8782342,16.1305746 21.8725029,15.9127487 C21.4565736,15.9296161 21.085326,15.5539705 21.1725707,15.0983758 C21.8190218,11.7225848 21.0047269,9.3108672 19.2577893,7.64018596 C18.7908674,7.1936458 18.289918,6.83639443 17.7905204,6.56121863 C17.6175755,6.46592333 17.458261,6.38807324 17.3171862,6.32667667 C17.2373416,6.29192782 17.1847364,6.27147059 17.1931433,6.27367561 C16.2976315,6.0058774 15.5342151,5.92818917 14.8732415,5.99493838 C14.826983,5.99960985 14.7803687,5.99957084 14.7341181,5.99482196 C14.0780111,5.92745473 13.3132307,6.00551612 12.446784,6.26424867 C12.4260476,6.27147219 12.3734334,6.29193299 12.2935759,6.32668762 C12.1524796,6.38809396 11.9931409,6.46595651 11.8201699,6.56126721 C11.3206974,6.83648726 10.819673,7.19379756 10.3526806,7.64041338 C8.60574903,9.31112024 7.79130373,11.7228076 8.43731864,15.0984542 C8.52445357,15.5537637 8.15372911,15.9291057 7.7382073,15.9127859 C7.73271697,16.1307361 7.77343999,16.4607296 7.87679129,16.9046977 C8.01790764,17.5120433 8.19216218,17.9530841 8.38312076,18.248737 C8.50983733,18.4449267 8.62140371,18.5466655 8.71118577,18.5892986 C9.09608294,18.5735027 9.42866507,18.8604104 9.44963719,19.2450515 Z M15.7712921,18.0420526 C15.9961431,17.9273842 16.2715045,18.0164573 16.3863288,18.2410028 C16.5011532,18.4655484 16.411959,18.7405356 16.1871079,18.8552039 C15.7950388,19.0551493 15.3596633,19.1603457 14.9085714,19.1603457 C14.4577213,19.1603457 14.0229951,19.0548199 13.6291318,18.8545293 C13.4041488,18.7401192 13.314638,18.4652346 13.4292038,18.2405574 C13.5437696,18.0158802 13.8190282,17.926491 14.0440111,18.0409011 C14.3101805,18.1762557 14.6028651,18.2473022 14.9085714,18.2473022 C15.2146846,18.2473022 15.5076058,18.1765259 15.7712921,18.0420526 Z"],["fill","#000000"],["fill-rule","nonzero"]],null,null,null,null,null))],null,function(t,e){var n=e.component;t(e,1,0,n.status,n.failed)})}function JT(t){return Nu(0,[xu(402653184,1,{inputVideo:0}),(t()(),bs(1,0,[[1,0],["inputVideo",1]],null,0,"video",[],[[8,"autoplay",0],[8,"muted",0],[8,"volume",0]],[[null,"play"]],function(t,e,n){var r=!0;return"play"===e&&(r=!1!==t.component.onPlay()&&r),r},null,null)),(t()(),ws(16777216,null,null,1,null,ZT)),su(3,16384,null,0,Xl,[Ji,$o],{ngIf:[0,"ngIf"]},null)],function(t,e){t(e,3,0,e.component.active)},function(t,e){t(e,1,0,!0,!0,0)})}var tk=function(){function t(t){this.state=t,this.countdown=0,this.active=!1,this.show=!1}return t.prototype.ngOnInit=function(){var t=this;this.state.preparing.subscribe(function(e){t.countdown=e,t.active=e>=0,t.show=!0,setTimeout(function(){t.show=!1},100)})},t}(),ek=qa({encapsulation:0,styles:[[".layer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}[_nghost-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;display:flex;flex-flow:column;justify-content:center;align-items:center}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{font-size:200px;transition-property:opacity;transition-duration:1s;opacity:0;color:#fff;font-family:Arial,Helvetica,sans-serif}[_nghost-%COMP%]   p.show[_ngcontent-%COMP%]{opacity:1;transition-duration:0s}"]],data:{}});function nk(t){return Nu(0,[(t()(),bs(0,0,null,null,1,"p",[],[[2,"show",null]],null,null,null,null)),(t()(),Tu(1,null,["",""]))],null,function(t,e){var n=e.component;t(e,0,0,n.show),t(e,1,0,n.countdown)})}function rk(t){return Nu(0,[(t()(),ws(16777216,null,null,1,null,nk)),su(1,16384,null,0,Xl,[Ji,$o],{ngIf:[0,"ngIf"]},null)],function(t,e){t(e,1,0,e.component.active)},null)}var ok=function(){function t(t){this.state=t,this.countdown=0,this.active=!1,this.show=!1,this.DURATION=KT}return t.prototype.ngOnInit=function(){var t=this;this.state.progress.subscribe(function(e){e%2&&navigator&&navigator.vibrate&&navigator.vibrate([20,20,20]),t.countdown=e,t.active=e>=0,t.show=!0,setTimeout(function(){t.show=!1},100)})},t}(),ik=qa({encapsulation:0,styles:[[".layer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}[_nghost-%COMP%]{position:absolute;width:100%;top:0;right:0;display:flex;flex-flow:row;justify-content:flex-end;align-items:center;margin:10px}[_nghost-%COMP%] > span[_ngcontent-%COMP%]{opacity:0;transition-property:opacity}[_nghost-%COMP%] > span.show[_ngcontent-%COMP%]{opacity:1;transition-duration:0s}[_nghost-%COMP%]   .countdown[_ngcontent-%COMP%]{color:#fff;font-family:'Courier New',Courier,monospace;font-size:18px;transition-duration:20s;text-shadow:0 0 4px #000}[_nghost-%COMP%]   .record[_ngcontent-%COMP%]{height:20px;width:20px;border-radius:10px;background-color:red;border:4px double #000;margin-left:20px;transition-duration:4s}"]],data:{}});function ak(t){return Nu(0,[(t()(),bs(0,0,null,null,1,"span",[],[[2,"active",null],[2,"show",null],[2,"countdown",null]],null,null,null,null)),(t()(),Tu(1,null,["00:",""]))],null,function(t,e){var n=e.component;t(e,0,0,n.active,n.show&&n.countdown>=n.DURATION-2,!0),t(e,1,0,n.countdown)})}function sk(t){return Nu(0,[(t()(),bs(0,0,null,null,0,"span",[],[[2,"active",null],[2,"show",null],[2,"record",null]],null,null,null,null))],null,function(t,e){var n=e.component;t(e,0,0,n.active,n.show,!0)})}function uk(t){return Nu(0,[(t()(),ws(16777216,null,null,1,null,ak)),su(1,16384,null,0,Xl,[Ji,$o],{ngIf:[0,"ngIf"]},null),(t()(),ws(16777216,null,null,1,null,sk)),su(3,16384,null,0,Xl,[Ji,$o],{ngIf:[0,"ngIf"]},null)],function(t,e){var n=e.component;t(e,1,0,n.active),t(e,3,0,n.active)},null)}var ck=function(){function t(t){var e=this;this.state=t,this.active=!1,this.show=!1,t.state.subscribe(function(t){5===t?(e.active=!0,setTimeout(function(){e.show=!0},100)):(e.show=!1,setTimeout(function(){e.active=!1},1e3))})}return t.prototype.ngOnInit=function(){},t}(),lk=qa({encapsulation:0,styles:[[".layer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}[_nghost-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%;background-color:rgba(255,255,255,.7);display:flex;flex-flow:row;justify-content:space-evenly;align-items:center;transition-property:opacity;transition-duration:1s;opacity:0}[_nghost-%COMP%] > div.show[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:50px}"]],data:{}});function hk(t){return Nu(0,[(t()(),bs(0,0,null,null,4,"div",[],[[2,"active",null],[2,"show",null]],null,null,null,null)),(t()(),bs(1,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.state.save()&&r),r},null,null)),(t()(),Tu(-1,null,["\ud83d\ude4f\ud83c\udffc\ud83d\udc4d"])),(t()(),bs(3,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.state.discard()&&r),r},null,null)),(t()(),Tu(-1,null,["\ud83d\uddd1\ud83d\udc4e"]))],null,function(t,e){var n=e.component;t(e,0,0,n.active,n.show)})}function pk(t){return Nu(0,[(t()(),ws(16777216,null,null,1,null,hk)),su(1,16384,null,0,Xl,[Ji,$o],{ngIf:[0,"ngIf"]},null)],function(t,e){t(e,1,0,e.component.active)},null)}var fk=function(){function t(t){this.state=t,this._status=!1,this.failed=!1}return t.prototype.ngOnInit=function(){var t=this;this.state.state.subscribe(function(e){t.failed=4===e})},Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(t){this._status=t,this.state.thumb(t)},enumerable:!0,configurable:!0}),t}(),dk=qa({encapsulation:0,styles:[[".layer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}[_nghost-%COMP%]{height:100%}[_nghost-%COMP%]   div[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   div[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   div[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke:#000;stroke-width:.5;fill:#cacf85;opacity:.5;transition-property:fill;transition-duration:3s}[_nghost-%COMP%]   div.active[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{transition-duration:1s;fill:#63ba4e}[_nghost-%COMP%]   div.failed[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{transition-duration:0s;fill:#d36372}"]],data:{}});function vk(t){return Nu(0,[(t()(),bs(0,0,null,null,2,"div",[],[[2,"active",null],[2,"failed",null]],[[null,"click"],[null,"touchstart"],[null,"touchend"]],function(t,e,n){var r=!0,o=t.component;return"click"===e&&(r=0!=(o.status=!o.status)&&r),"touchstart"===e&&(r=0!=(o.status=!0)&&r),"touchend"===e&&(r=0!=(o.status=!1)&&r),r},null,null)),(t()(),bs(1,0,null,null,1,":svg:svg",[[":xml:space","preserve"],[":xmlns:xlink","http://www.w3.org/1999/xlink"],["enable-background","new 0 0 100 100"],["version","1.1"],["viewBox","0 0 100 125"],["x","0px"],["xmlns","http://www.w3.org/2000/svg"],["y","0px"]],null,null,null,null,null)),(t()(),bs(2,0,null,null,0,":svg:path",[["d","M75.825,54.076c-3.914,0-7.101-3.145-7.178-7.039c0.003-0.048,0.015-0.093,0.015-0.142V36.134  c0-10.171-8.373-18.446-18.664-18.446c-10.288,0-18.657,8.274-18.657,18.446c0,3.852-3.136,6.987-6.99,6.987c-1.657,0-3,1.343-3,3  c0,1.656,1.343,3,3,3c7.163,0,12.99-5.826,12.99-12.987c0-6.863,5.678-12.446,12.657-12.446c6.983,0,12.664,5.583,12.664,12.446  v10.548c-0.005,0.071-0.021,0.14-0.021,0.213c0,7.268,5.915,13.181,13.185,13.181c1.657,0,3-1.344,3-3S77.482,54.076,75.825,54.076z   M58.46,36.997c0-4.662-3.795-8.456-8.46-8.456c-4.664,0-8.458,3.794-8.458,8.456c0,9.417-7.791,17.079-17.367,17.079  c-1.657,0-3,1.344-3,3s1.343,3,3,3c12.885,0,23.367-10.353,23.367-23.079c0-1.354,1.103-2.456,2.458-2.456  c1.356,0,2.46,1.102,2.46,2.456c0,15.215-12.572,27.706-28.026,27.844c-1.656,0.015-2.987,1.37-2.973,3.027  c0.015,1.647,1.355,2.973,2.999,2.973h0.028C43.22,70.673,58.46,55.49,58.46,36.997z M50,7.197  c-15.895,0-28.825,12.932-28.825,28.828c0,1.657,1.343,3,3,3s3-1.343,3-3c0-12.587,10.239-22.828,22.825-22.828  s22.825,10.241,22.825,22.828v10.097c0,1.656,1.343,3,3,3s3-1.344,3-3V36.024C78.825,20.129,65.895,7.197,50,7.197z M63.474,76.628  c1.153-1.19,1.123-3.09-0.066-4.242c-1.189-1.153-3.088-1.124-4.242,0.066c-2.413,2.488-5.668,3.859-9.167,3.859  c-1.657,0-3,1.344-3,3c0,1.657,1.343,3,3,3C55.135,82.312,59.92,80.293,63.474,76.628z M73.828,74.399  c-1.431-0.836-3.269-0.353-4.104,1.078C65.641,82.463,58.083,86.804,50,86.804c-5.049,0-9.832-1.613-13.833-4.666  c-1.315-1.005-3.2-0.752-4.204,0.565c-1.005,1.317-0.752,3.198,0.565,4.204c5.055,3.857,11.097,5.896,17.472,5.896  c10.206,0,19.749-5.479,24.904-14.3C75.74,77.073,75.259,75.235,73.828,74.399z M75.577,64.837  c-5.655-0.077-10.936-2.921-14.124-7.609c-0.198-0.29-0.527-0.604-0.813-0.808c-0.664-0.479-1.49-0.662-2.297-0.513  c-0.804,0.149-1.511,0.621-1.959,1.304c-6.492,9.891-16.942,16.177-28.672,17.244c-1.649,0.15-2.865,1.61-2.715,3.26  c0.142,1.558,1.45,2.728,2.983,2.728c0.092,0,0.184-0.003,0.276-0.012c12.229-1.113,23.253-7.13,30.802-16.681  c4.287,4.409,10.191,7.001,16.437,7.087h0.042c1.638,0,2.977-1.316,2.999-2.959C78.559,66.221,77.234,64.86,75.577,64.837z"]],null,null,null,null,null))],null,function(t,e){var n=e.component;t(e,0,0,n._status,n.failed)})}var mk=function(){function t(t){var e=this;this.state=t,this.active=!1,t.state.subscribe(function(t){e.active=5!==t})}return t.prototype.ngOnInit=function(){},t}(),gk=qa({encapsulation:0,styles:[["div[_ngcontent-%COMP%]{width:100%;position:absolute;bottom:0;left:0;height:15%;display:flex;flex-flow:row;justify-content:space-between;align-items:center;opacity:0}div.active[_ngcontent-%COMP%]{opacity:1}"]],data:{}});function yk(t){return Nu(0,[(t()(),bs(0,0,null,null,4,"div",[],[[2,"active",null]],null,null,null,null)),(t()(),bs(1,0,null,null,1,"app-thumb",[],null,null,null,vk,dk)),su(2,114688,null,0,fk,[XT],null,null),(t()(),bs(3,0,null,null,1,"app-thumb",[],null,null,null,vk,dk)),su(4,114688,null,0,fk,[XT],null,null)],function(t,e){t(e,2,0),t(e,4,0)},function(t,e){t(e,0,0,e.component.active)})}var wk=function(){function t(){this.fullscreen=!1}return t.prototype.ngOnInit=function(){},t.prototype.clicked=function(){return c(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return this.container.nativeElement.requestFullscreen?[4,this.container.nativeElement.requestFullscreen()]:[3,2];case 1:return t.sent(),[3,4];case 2:return this.container.nativeElement.webkitRequestFullScreen?[4,this.container.nativeElement.webkitRequestFullScreen()]:[3,4];case 3:t.sent(),t.label=4;case 4:return t.trys.push([4,6,,7]),[4,screen.orientation.lock("portrait-primary")];case 5:return t.sent(),[3,7];case 6:return t.sent(),console.log("Failed to lock screen orientation"),[3,7];case 7:return this.fullscreen=!0,[2]}})})},t}(),bk=qa({encapsulation:0,styles:[["[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .splash[_ngcontent-%COMP%]{border-radius:60px;width:120px;height:120px;display:flex;flex-flow:column;align-items:center;justify-content:center;box-shadow:0 0 80px 0 grey}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .splash[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:50px}"]],data:{}});function xk(t){return Nu(0,[(t()(),bs(0,0,null,null,2,"div",[["class","splash"]],null,null,null,null,null)),(t()(),bs(1,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),Tu(-1,null,["\ud83d\ude4f\ud83c\udffc"]))],null,null)}function _k(t){return Nu(0,[(t()(),bs(0,0,null,null,10,null,null,null,null,null,null,null)),(t()(),bs(1,0,null,null,1,"app-facevideo",[],null,null,null,JT,YT)),su(2,114688,null,0,QT,[XT],null,null),(t()(),bs(3,0,null,null,1,"app-preparing",[],null,null,null,rk,ek)),su(4,114688,null,0,tk,[XT],null,null),(t()(),bs(5,0,null,null,1,"app-progress",[],null,null,null,uk,ik)),su(6,114688,null,0,ok,[XT],null,null),(t()(),bs(7,0,null,null,1,"app-complete",[],null,null,null,pk,lk)),su(8,114688,null,0,ck,[XT],null,null),(t()(),bs(9,0,null,null,1,"app-thumbs",[],null,null,null,yk,gk)),su(10,114688,null,0,mk,[XT],null,null)],function(t,e){t(e,2,0),t(e,4,0),t(e,6,0),t(e,8,0),t(e,10,0)},null)}function Ck(t){return Nu(0,[xu(402653184,1,{container:0}),(t()(),bs(1,0,[[1,0],["container",1]],null,4,"div",[["class","container"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.clicked()&&r),r},null,null)),(t()(),ws(16777216,null,null,1,null,xk)),su(3,16384,null,0,Xl,[Ji,$o],{ngIf:[0,"ngIf"]},null),(t()(),ws(16777216,null,null,1,null,_k)),su(5,16384,null,0,Xl,[Ji,$o],{ngIf:[0,"ngIf"]},null)],function(t,e){var n=e.component;t(e,3,0,!n.fullscreen),t(e,5,0,n.fullscreen)},null)}function Ek(t){return Nu(0,[(t()(),bs(0,0,null,null,1,"app-record",[],null,null,null,Ck,bk)),su(1,114688,null,0,wk,[],null,null)],function(t,e){t(e,1,0)},null)}var Sk=Bs("app-record",wk,Ek,{},{},[]),Rk=qa({encapsulation:0,styles:[[""]],data:{}});function Tk(t){return Nu(0,[(t()(),bs(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),su(1,212992,null,0,Pd,[Md,Ji,eo,[8,null],ea],null,null)],function(t,e){t(e,1,0)},null)}function kk(t){return Nu(0,[(t()(),bs(0,0,null,null,1,"app-root",[],null,null,null,Tk,Rk)),su(1,49152,null,0,Vc,[],null,null)],null,null)}var Ik=Bs("app-root",Vc,kk,{},{},[]),Nk=function(){return function(){}}(),Ak=Lc(Uc,[Vc],function(t){return function(t){for(var e={},n=[],r=!1,o=0;o<t.length;o++){var i=t[o];i.token===Br&&!0===i.value&&(r=!0),1073741824&i.flags&&n.push(i.token),i.index=o,e[Wa(i.token)]=i}return{factory:null,providersByKey:e,providers:t,modules:n,isRoot:r}}([Is(512,eo,no,[[8,[iv,Sk,Ik]],[3,eo],nr]),Is(5120,Sa,ka,[[3,Sa]]),Is(4608,$l,Kl,[Sa,[2,ql]]),Is(5120,li,hi,[]),Is(5120,wa,Ra,[]),Is(5120,ba,Ta,[]),Is(4608,ep,np,[Jl]),Is(6144,Qo,null,[ep]),Is(4608,Kh,Qh,[]),Is(5120,xh,function(t,e,n,r,o,i,a,s){return[new qh(t,e,n),new tp(r),new Yh(o,i,a,s)]},[Jl,Ti,di,Jl,Jl,Kh,mi,[2,Xh]]),Is(4608,_h,_h,[xh,Ti]),Is(135680,Sh,Sh,[Jl]),Is(4608,Dh,Dh,[_h,Sh]),Is(6144,so,null,[Dh]),Is(6144,Eh,null,[Sh]),Is(4608,Oi,Oi,[Ti]),Is(5120,xf,Yd,[Ad]),Is(4608,Bd,Bd,[]),Is(6144,Fd,null,[Bd]),Is(135680,Ud,Ud,[Ad,qi,bi,zn,Fd]),Is(4608,Ld,Ld,[]),Is(5120,Vd,qd,[Ad,eh,jd]),Is(5120,ev,tv,[Zd]),Is(5120,vi,function(t){return[t]},[ev]),Is(1073742336,Zl,Zl,[]),Is(1024,ii,lp,[]),Is(1024,Ui,function(){return[Hd()]},[]),Is(512,Zd,Zd,[zn]),Is(1024,ui,function(t,e){return[(n=t,yh("probe",bh),yh("coreTokens",a({},wh,(n||[]).reduce(function(t,e){return t[e.name]=e.token,t},{}))),function(){return bh}),Jd(e)];var n},[[2,Ui],Zd]),Is(512,ci,ci,[[2,ui]]),Is(131584,Hi,Hi,[Ti,mi,zn,ii,eo,ci]),Is(1073742336,Ia,Ia,[Hi]),Is(1073742336,hp,hp,[[3,hp]]),Is(1024,zd,Kd,[[3,Ad]]),Is(512,Zp,Jp,[]),Is(512,Md,Md,[]),Is(256,jd,{},[]),Is(1024,Fl,$d,[Pl,[2,Ll],jd]),Is(512,Bl,Bl,[Fl]),Is(512,bi,bi,[]),Is(512,qi,Qi,[bi,[2,Ki]]),Is(1024,Ed,function(){return[[{path:"",component:wk}]]},[]),Is(1024,Ad,Qd,[Hi,Zp,Md,Bl,zn,qi,bi,Ed,jd,[2,Rd],[2,_d]]),Is(1073742336,Gd,Gd,[[2,zd],[2,Ad]]),Is(1073742336,Nk,Nk,[]),Is(1073742336,Uc,Uc,[]),Is(256,Br,!0,[])])});(function(){if(_o)throw new Error("Cannot enable prod mode after platform setup.");xo=!1})(),cp().bootstrapModuleFactory(Ak).catch(function(t){return console.error(t)})}},[[0,0]]]);